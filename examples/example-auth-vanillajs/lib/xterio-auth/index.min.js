(function(y,b){typeof exports=="object"&&typeof module!="undefined"?b(exports):typeof define=="function"&&define.amd?define(["exports"],b):(y=typeof globalThis!="undefined"?globalThis:y||self,b(y.XterioAuth={}))})(this,function(y){"use strict";var Sn=Object.defineProperty,_n=Object.defineProperties;var kn=Object.getOwnPropertyDescriptors;var Ge=Object.getOwnPropertySymbols;var Kt=Object.prototype.hasOwnProperty,Yt=Object.prototype.propertyIsEnumerable;var v=Math.pow,Xt=(y,b,U)=>b in y?Sn(y,b,{enumerable:!0,configurable:!0,writable:!0,value:U}):y[b]=U,T=(y,b)=>{for(var U in b||(b={}))Kt.call(b,U)&&Xt(y,U,b[U]);if(Ge)for(var U of Ge(b))Yt.call(b,U)&&Xt(y,U,b[U]);return y},q=(y,b)=>_n(y,kn(b));var Wt=(y,b)=>{var U={};for(var $ in y)Kt.call(y,$)&&b.indexOf($)<0&&(U[$]=y[$]);if(y!=null&&Ge)for(var $ of Ge(y))b.indexOf($)<0&&Yt.call(y,$)&&(U[$]=y[$]);return U};var I=(y,b,U)=>new Promise(($,ae)=>{var Te=Q=>{try{ge(U.next(Q))}catch(be){ae(be)}},Fe=Q=>{try{ge(U.throw(Q))}catch(be){ae(be)}},ge=Q=>Q.done?$(Q.value):Promise.resolve(Q.value).then(Te,Fe);ge((U=U.apply(y,b)).next())});/*! XterioAuth v0.0.14 */var Ut,At,vt,Pt;var b=(i=>(i.Dev="Dev",i.Staging="Staging",i.Production="Production",i))(b||{}),U=(i=>(i.Default="default",i.Email="email",i.Mini="mini",i))(U||{}),$=(i=>(i.alert="alert",i.page="page",i.iframeDom="dom",i.iframeUri="url",i))($||{}),ae=(i=>(i.asset="asset",i.nft_market="nft_marketplace",i.nft_collection="nft_collection",i.setting="setting",i))(ae||{});const Te="%[a-f0-9]{2}",Fe=new RegExp("("+Te+")|([^%]+?)","gi"),ge=new RegExp("("+Te+")+","gi");function Q(i,e){try{return[decodeURIComponent(i.join(""))]}catch(a){}if(i.length===1)return i;e=e||1;const n=i.slice(0,e),o=i.slice(e);return Array.prototype.concat.call([],Q(n),Q(o))}function be(i){try{return decodeURIComponent(i)}catch(e){let n=i.match(Fe)||[];for(let o=1;o<n.length;o++)i=Q(n,o).join(""),n=i.match(Fe)||[];return i}}function Jt(i){const e={"%FE%FF":"��","%FF%FE":"��"};let n=ge.exec(i);for(;n;){try{e[n[0]]=decodeURIComponent(n[0])}catch(a){const l=be(n[0]);l!==n[0]&&(e[n[0]]=l)}n=ge.exec(i)}e["%C2"]="�";const o=Object.keys(e);for(const a of o)i=i.replace(new RegExp(a,"g"),e[a]);return i}function Zt(i){if(typeof i!="string")throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof i+"`");try{return decodeURIComponent(i)}catch(e){return Jt(i)}}function Qt(i,e){const n={};if(Array.isArray(e))for(const o of e){const a=Object.getOwnPropertyDescriptor(i,o);a!=null&&a.enumerable&&Object.defineProperty(n,o,a)}else for(const o of Reflect.ownKeys(i)){const a=Object.getOwnPropertyDescriptor(i,o);if(a.enumerable){const l=i[o];e(o,l,i)&&Object.defineProperty(n,o,a)}}return n}function ot(i,e){if(!(typeof i=="string"&&typeof e=="string"))throw new TypeError("Expected the arguments to be of type `string`");if(i===""||e==="")return[];const n=i.indexOf(e);return n===-1?[]:[i.slice(0,n),i.slice(n+e.length)]}const er=i=>i==null,tr=i=>encodeURIComponent(i).replaceAll(/[!'()*]/g,e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`),je=Symbol("encodeFragmentIdentifier");function rr(i){switch(i.arrayFormat){case"index":return e=>(n,o)=>{const a=n.length;return o===void 0||i.skipNull&&o===null||i.skipEmptyString&&o===""?n:o===null?[...n,[D(e,i),"[",a,"]"].join("")]:[...n,[D(e,i),"[",D(a,i),"]=",D(o,i)].join("")]};case"bracket":return e=>(n,o)=>o===void 0||i.skipNull&&o===null||i.skipEmptyString&&o===""?n:o===null?[...n,[D(e,i),"[]"].join("")]:[...n,[D(e,i),"[]=",D(o,i)].join("")];case"colon-list-separator":return e=>(n,o)=>o===void 0||i.skipNull&&o===null||i.skipEmptyString&&o===""?n:o===null?[...n,[D(e,i),":list="].join("")]:[...n,[D(e,i),":list=",D(o,i)].join("")];case"comma":case"separator":case"bracket-separator":{const e=i.arrayFormat==="bracket-separator"?"[]=":"=";return n=>(o,a)=>a===void 0||i.skipNull&&a===null||i.skipEmptyString&&a===""?o:(a=a===null?"":a,o.length===0?[[D(n,i),e,D(a,i)].join("")]:[[o,D(a,i)].join(i.arrayFormatSeparator)])}default:return e=>(n,o)=>o===void 0||i.skipNull&&o===null||i.skipEmptyString&&o===""?n:o===null?[...n,D(e,i)]:[...n,[D(e,i),"=",D(o,i)].join("")]}}function nr(i){let e;switch(i.arrayFormat){case"index":return(n,o,a)=>{if(e=/\[(\d*)]$/.exec(n),n=n.replace(/\[\d*]$/,""),!e){a[n]=o;return}a[n]===void 0&&(a[n]={}),a[n][e[1]]=o};case"bracket":return(n,o,a)=>{if(e=/(\[])$/.exec(n),n=n.replace(/\[]$/,""),!e){a[n]=o;return}if(a[n]===void 0){a[n]=[o];return}a[n]=[...a[n],o]};case"colon-list-separator":return(n,o,a)=>{if(e=/(:list)$/.exec(n),n=n.replace(/:list$/,""),!e){a[n]=o;return}if(a[n]===void 0){a[n]=[o];return}a[n]=[...a[n],o]};case"comma":case"separator":return(n,o,a)=>{const l=typeof o=="string"&&o.includes(i.arrayFormatSeparator),d=typeof o=="string"&&!l&&ce(o,i).includes(i.arrayFormatSeparator);o=d?ce(o,i):o;const m=l||d?o.split(i.arrayFormatSeparator).map(g=>ce(g,i)):o===null?o:ce(o,i);a[n]=m};case"bracket-separator":return(n,o,a)=>{const l=/(\[])$/.test(n);if(n=n.replace(/\[]$/,""),!l){a[n]=o&&ce(o,i);return}const d=o===null?[]:o.split(i.arrayFormatSeparator).map(m=>ce(m,i));if(a[n]===void 0){a[n]=d;return}a[n]=[...a[n],...d]};default:return(n,o,a)=>{if(a[n]===void 0){a[n]=o;return}a[n]=[...[a[n]].flat(),o]}}}function st(i){if(typeof i!="string"||i.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function D(i,e){return e.encode?e.strict?tr(i):encodeURIComponent(i):i}function ce(i,e){return e.decode?Zt(i):i}function at(i){return Array.isArray(i)?i.sort():typeof i=="object"?at(Object.keys(i)).sort((e,n)=>Number(e)-Number(n)).map(e=>i[e]):i}function ct(i){const e=i.indexOf("#");return e!==-1&&(i=i.slice(0,e)),i}function ir(i){let e="";const n=i.indexOf("#");return n!==-1&&(e=i.slice(n)),e}function lt(i,e,n){return n==="string"&&typeof i=="string"?i:typeof n=="function"&&typeof i=="string"?n(i):e.parseBooleans&&i!==null&&(i.toLowerCase()==="true"||i.toLowerCase()==="false")?i.toLowerCase()==="true":n==="number"&&!Number.isNaN(Number(i))&&typeof i=="string"&&i.trim()!==""||e.parseNumbers&&!Number.isNaN(Number(i))&&typeof i=="string"&&i.trim()!==""?Number(i):i}function ze(i){i=ct(i);const e=i.indexOf("?");return e===-1?"":i.slice(e+1)}function Xe(i,e){e=T({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1,types:Object.create(null)},e),st(e.arrayFormatSeparator);const n=nr(e),o=Object.create(null);if(typeof i!="string"||(i=i.trim().replace(/^[?#&]/,""),!i))return o;for(const a of i.split("&")){if(a==="")continue;const l=e.decode?a.replaceAll("+"," "):a;let[d,m]=ot(l,"=");d===void 0&&(d=l),m=m===void 0?null:["comma","separator","bracket-separator"].includes(e.arrayFormat)?m:ce(m,e),n(ce(d,e),m,o)}for(const[a,l]of Object.entries(o))if(typeof l=="object"&&l!==null&&e.types[a]!=="string")for(const[d,m]of Object.entries(l)){const g=e.types[a]?e.types[a].replace("[]",""):void 0;l[d]=lt(m,e,g)}else typeof l=="object"&&l!==null&&e.types[a]==="string"?o[a]=Object.values(l).join(e.arrayFormatSeparator):o[a]=lt(l,e,e.types[a]);return e.sort===!1?o:(e.sort===!0?Object.keys(o).sort():Object.keys(o).sort(e.sort)).reduce((a,l)=>{const d=o[l];return a[l]=d&&typeof d=="object"&&!Array.isArray(d)?at(d):d,a},Object.create(null))}function ut(i,e){if(!i)return"";e=T({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},e),st(e.arrayFormatSeparator);const n=d=>e.skipNull&&er(i[d])||e.skipEmptyString&&i[d]==="",o=rr(e),a={};for(const[d,m]of Object.entries(i))n(d)||(a[d]=m);const l=Object.keys(a);return e.sort!==!1&&l.sort(e.sort),l.map(d=>{const m=i[d];return m===void 0?"":m===null?D(d,e):Array.isArray(m)?m.length===0&&e.arrayFormat==="bracket-separator"?D(d,e)+"[]":m.reduce(o(d),[]).join("&"):D(d,e)+"="+D(m,e)}).filter(d=>d.length>0).join("&")}function ht(i,e){var a,l;e=T({decode:!0},e);let[n,o]=ot(i,"#");return n===void 0&&(n=i),T({url:(l=(a=n==null?void 0:n.split("?"))==null?void 0:a[0])!=null?l:"",query:Xe(ze(i),e)},e&&e.parseFragmentIdentifier&&o?{fragmentIdentifier:ce(o,e)}:{})}function dt(i,e){e=T({encode:!0,strict:!0,[je]:!0},e);const n=ct(i.url).split("?")[0]||"",o=ze(i.url),a=T(T({},Xe(o,{sort:!1})),i.query);let l=ut(a,e);l&&(l=`?${l}`);let d=ir(i.url);if(typeof i.fragmentIdentifier=="string"){const m=new URL(n);m.hash=i.fragmentIdentifier,d=e[je]?m.hash:`#${i.fragmentIdentifier}`}return`${n}${l}${d}`}function ft(i,e,n){n=T({parseFragmentIdentifier:!0,[je]:!1},n);const{url:o,query:a,fragmentIdentifier:l}=ht(i,n);return dt({url:o,query:Qt(a,e),fragmentIdentifier:l},n)}function or(i,e,n){const o=Array.isArray(e)?a=>!e.includes(a):(a,l)=>!e(a,l);return ft(i,o,n)}const we=Object.freeze(Object.defineProperty({__proto__:null,exclude:or,extract:ze,parse:Xe,parseUrl:ht,pick:ft,stringify:ut,stringifyUrl:dt},Symbol.toStringTag,{value:"Module"})),Se="0.0.14",Le="XterioAuth",pt={debug:1,info:2,warn:3,error:4,off:5};let mt=pt.debug;const sr=i=>{mt=i},Ue=(i,...e)=>{i==="OFF"||mt>pt[i.toLocaleLowerCase()]||(i==="ERROR"?console.error(`[${Le}(v${Se})]`,...e):i==="WARN"?console.warn(`[${Le}(v${Se})]`,...e):i==="DEBUG"?console.debug(`[${Le}(v${Se})]`,...e):console.log(`[${Le}(v${Se})]`,...e))},C={info:(...i)=>{Ue("INFO",...i)},debug:(...i)=>{Ue("DEBUG",...i)},warn:(...i)=>{Ue("WARN",...i)},error:(...i)=>{Ue("ERROR",...i)}},ar=()=>Se,cr=i=>{i=i||32;const e="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",n=e.length;let o="";for(let a=0;a<i;a++)o+=e.charAt(Math.floor(Math.random()*n));return o},K={[b.Dev]:{HCAPTCHA_SITE_KEY:"24e8a314-60ce-4d6e-bf78-c01c598a29f6",API_BASE:"https://api.playvrs.net",PAGE_BASE:"https://d39wr9n5mj2b6n.cloudfront.net",PAGES_URI_API:"https://resources.xter.io/configs/sdk/pages-dev.json"},[b.Staging]:{HCAPTCHA_SITE_KEY:"f274d312-aade-4b86-a8c0-05cc85a83d32",API_BASE:"https://api.xterio.net",PAGE_BASE:"https://d3vi0apu54mmeo.cloudfront.net",PAGES_URI_API:"https://resources.xter.io/configs/sdk/pages-staging.json"},[b.Production]:{HCAPTCHA_SITE_KEY:"22e2664c-fb06-482c-992c-8b74946e763a",API_BASE:"https://api.xter.io",PAGE_BASE:"https://app.xter.io",PAGES_URI_API:"https://resources.xter.io/configs/sdk/pages-production.json"}},ue={LOGIN:"xter_auth_login_success",ACCOUNT:"xter_auth_response_userinfo",REQ_ACCOUNT:"xter_auth_request_userinfo",Expired:"xter_auth_req_expired",LOGOUT:"xter_auth_logout"},G={LOGIN_TYPE:"xter_auth_login_type",TOKENS:"xter_auth_login_tokens",ID_TOKEN:"xter_auth_id_token",REFRESH_TOKEN:"xter_auth_refresh_token",ACCESS_TOKEN:"xter_auth_access_token",USERINFO:"xter_auth_userinfo"};class z{static set loginType(e){localStorage.setItem(G.LOGIN_TYPE,e)}static get loginType(){const e=localStorage.getItem(G.LOGIN_TYPE);return e||void 0}static set tokens(e){const{access_token:n="",id_token:o="",refresh_token:a=""}=e;localStorage.setItem(G.ACCESS_TOKEN,n),localStorage.setItem(G.ID_TOKEN,o),localStorage.setItem(G.REFRESH_TOKEN,a)}static get tokens(){return{access_token:localStorage.getItem(G.ACCESS_TOKEN)||"",id_token:localStorage.getItem(G.ID_TOKEN)||"",refresh_token:localStorage.getItem(G.REFRESH_TOKEN)||""}}static deleteTokens(e){e?localStorage.removeItem(e):(localStorage.removeItem(G.ACCESS_TOKEN),localStorage.removeItem(G.REFRESH_TOKEN),localStorage.removeItem(G.ID_TOKEN))}static set userInfo(e){localStorage.setItem(G.USERINFO,JSON.stringify(e))}static get userInfo(){const e=localStorage.getItem(G.USERINFO);try{if(e)return JSON.parse(e)}catch(n){return}}static deleteUserInfo(){localStorage.removeItem(G.USERINFO)}static delete(e){localStorage.removeItem(e)}}const he=class he{};he.client_id="",he.app_id="",he.baseURL="",he.pageURL="",he.authorizeUrl="",he.onAccount=[];let x=he;class j{static setTokens(e){const{id_token:n="",access_token:o="",refresh_token:a=""}=e||{};x.tokens={id_token:n,access_token:o,refresh_token:a},z.tokens=e}static removeTokens(){x.tokens=void 0,z.deleteTokens()}static removeIdToken(){const{refresh_token:e="",access_token:n=""}=x.tokens||{};x.tokens={refresh_token:e,access_token:n,id_token:""},z.deleteTokens(G.ID_TOKEN)}static get idToken(){var e;return((e=x.tokens)==null?void 0:e.id_token)||""}static get refreshToken(){var e;return((e=x.tokens)==null?void 0:e.refresh_token)||""}static get accessToken(){var e;return((e=x.tokens)==null?void 0:e.access_token)||""}}class Ke{static setUserInfo(e){x.userInfo=e,z.userInfo=e}static removeUserInfo(){x.userInfo=void 0,z.deleteUserInfo()}static get userInfo(){return x.userInfo}}const tt=class tt{static set listeners(e){this._listeners=e}static get listeners(){return this._listeners}static on(e,n){this._listeners[e]||(this._listeners[e]=[]),this._listeners[e].push(n)}static off(e,n){this._listeners[e]&&(this._listeners[e]=this._listeners[e].filter(o=>o!==n))}static emit(e,...n){this._listeners[e]&&this._listeners[e].forEach(o=>{o(...n)})}static remove(e){this._listeners[e]&&delete this._listeners[e]}static subscribe(e,n){const o=n||ue.ACCOUNT;return C.debug("subscribe event",o),this.on(o,e),()=>{C.debug("unsubscribe this event",o),this.off(o,e)}}static unsubscribe(e){const n=e||ue.ACCOUNT;C.debug("unsubscribe all event",n),this.remove(n)}static clear(){this.listeners={}}};tt._listeners={};let re=tt;function lr(i){return I(this,null,function*(){const e=yield i.json();return e.err_code!=0?(i.status===401&&e.err_code===91001?re.emit(ue.Expired):i.status,C.error("status",i.status,"statusText",i.statusText,"err_code",e.err_code,"err_msg",e.err_msg),Promise.reject(e)):e.data})}function ur(i,e){return!e||/^https?:\/\//i.test(i)?i:i.startsWith("/")?`${e}${i}`:`${e}/${i}`}const Ae=d=>I(this,[d],function*({method:i,path:e,params:n,headers:o,data:a,Authorization:l}){if(!x.client_id)throw new Error("You need set xterio-auth info");if(n){const h=we.stringify(n);e+=(e.includes("?")?"&":"?")+`${h}`}const m=ur(e,x.baseURL),g={method:i,headers:T({"content-type":"application/json","X-SDK-Version":"auth-"+ar(),"X-Platform":"Web","X-App-ID":x.app_id,"X-Client-ID":x.client_id,"X-Timestamp":Date.now().toString(),"X-Language":"en","X-Nonce":cr(),Authorization:l||j.idToken||""},o)};if(a){const h=i!=="PUT"&&(o==null?void 0:o["content-type"])!=="application/x-www-form-urlencoded";g.body=h?JSON.stringify(a):a}const w=new Request(m,g);try{const h=yield fetch(w);return h.url===x.PageUriApi?yield h.json():i==="PUT"?h:lr(h)}catch(h){throw new Error("Network error")}});function ve(i,e,n){return I(this,null,function*(){return Ae({method:"GET",path:i,params:e,Authorization:n})})}function ne(i,e,n,o){return I(this,null,function*(){return Ae({method:"POST",path:i,data:e,headers:o,Authorization:n})})}function hr(i,e){return I(this,null,function*(){return Ae({method:"DELETE",path:i,data:e})})}function dr(i,e,n){return I(this,null,function*(){return Ae({method:"PUT",path:i,data:e,headers:n})})}const He=class He{static login(e){return I(this,null,function*(){const{client_id:n="",client_secret:o="",redirect_uri:a="",grant_type:l=""}=x.config||{},d={client_id:n,client_secret:o,redirect_uri:a,grant_type:l,code:e},m=new URLSearchParams(d);C.debug("go login");const g=yield ne("/account/v1/oauth2/token",m,"",{"content-type":"application/x-www-form-urlencoded"}).then(w=>(C.info("login success."),j.setTokens(w),le.setIsLogin(!0),w)).catch(w=>(C.error("login failed."),null));if(g!=null&&g.id_token){C.debug("get userinfo");const w=yield this.getUserInfo();if(w.uuid)return w}return null})}static getUserInfo(){return I(this,null,function*(){const[e,n]=yield Promise.all([this.getProfile(),this.getWallet()]),o=q(T({},e),{wallet:n});return Ke.setUserInfo(o),o!=null&&o.uuid&&re.emit(ue.ACCOUNT,o),o})}static getProfile(){return I(this,null,function*(){const e=yield ve("/account/v1/user/profile").then(n=>(C.info("get profile success."),n)).catch(n=>(C.error("get profile failed."),null));return e!=null&&e.uuid?T({},e):{}})}static getWallet(){return I(this,null,function*(){const e=yield ve("/account/v1/wallet").then(n=>(C.info("get wallet success."),n)).catch(n=>(C.error("get wallet failed."),null));return(e==null?void 0:e.wallet)||[]})}static loginService(e,n,o){return I(this,null,function*(){const a=yield ne("/account/v1/login",{username:e,password:n,"h-recaptcha-response":o}).catch(l=>q(T({},l),{error:!0}));return C.info("ttl login",a!=null&&a.error?"failed":"success"),a!=null&&a.error||(j.setTokens(a),le.setIsLogin(!0)),a!=null&&a.error?q(T({},a),{error:!0}):q(T({},a),{error:!1})})}static refreshTokenService(e){return ne("/auth/v1/refresh",{refresh_token:e}).catch(()=>({}))}static registerService(l){return I(this,arguments,function*({username:e,password:n,subscribe:o,hcaptchaResponseToken:a=""}){const d=yield ne("/account/v1/register",{username:e,password:n,subscribe:o?1:0,invite_code:"","h-recaptcha-response":a}).catch(m=>q(T({},m),{error:!0}));return d!=null&&d.error?{error:!0,err_code:d==null?void 0:d.err_code}:{error:!1}})}static registerConfirmService(a){return I(this,arguments,function*({username:e,password:n,code:o}){const l=yield ne("/account/v1/register/code/confirm",{username:e,code:o,password:n}).catch(d=>({error:!0,err_code:d.err_code}));return l!=null&&l.error||(j.setTokens(l),le.setIsLogin(!0)),l!=null&&l.error?l:q(T({},l),{error:!1})})}static sendForgotCodeService(n){return I(this,arguments,function*({email:e}){const o=yield ne("/account/v1/password/forgot?source=forgot",{username:e}).catch(a=>({error:!0,err_code:a.err_code}));return o!=null&&o.error?o:q(T({},o),{error:!1})})}static resetPassword(a){return I(this,arguments,function*({email:e,code:n,password:o}){const l=yield ne("/account/v1/password/forgot/confirm",{username:e,password:o,confirmation_code:n}).catch(d=>({error:!0,err_code:d.err_code}));return l!=null&&l.error?l:q(T({},l),{error:!1})})}static getOtacByTokens(){return I(this,null,function*(){const e=j.idToken,n=j.refreshToken,o=j.accessToken;if(!e||!n)return"";const a=yield ne("/auth/v1/otac",{access_token:o,id_token:e,refresh_token:n}).catch(()=>({code:""}));return(a==null?void 0:a.code)||""})}static getPageUrlMap(){return I(this,null,function*(){const e=x.PageUriApi,n=yield ve(e).catch(o=>(C.error("getPageUrlMap",o),{domain:"",pages:{asset:"/asset",settings:"/settings",marketplace:"/marketplace",collection:"/collection/{app_id}/{collection_id}"}}));return C.debug(e,n),n})}};He.sendSignUpCodeService=e=>I(He,null,function*(){const n=yield ne("/account/v1/register/code/resend",{username:e}).catch(o=>q(T({},o),{error:!0}));return n!=null&&n.error?q(T({},n),{error:!0}):q(T({},n),{error:!1})});let H=He;const fr="data:image/svg+xml,%3csvg%20width='116'%20height='24'%20viewBox='0%200%20116.36363983154297%2024'%20xmlns='http://www.w3.org/2000/svg'%20class='mb-0'%3e%3cg%20clip-path='url(%23clip0_0_335)'%20fill-rule='evenodd'%20clip-rule='evenodd'%3e%3cpath%20d='M28.032%203.485a.222.222%200%2000.024.067c.006.355.014.709.027%201.073a4979.123%204979.123%200%2001.084%2010.93c-.003.18.01.36.035.538.323%201.904%201.251%203.422%202.9%204.466%201.12.71%202.363%201.104%203.658%201.347a20.98%2020.98%200%20005.866.214c.113-.01.121-.06.121-.152-.005-1.454-.005-2.91%200-4.37%200-.117-.036-.137-.143-.137a10.497%2010.497%200%2001-2.263-.267c-1-.246-1.919-.646-2.642-1.403-.681-.713-1.061-1.553-1.055-2.554a286.7%20286.7%200%20000-3.71c-.002-.165.05-.19.199-.19h4.782c.113%200%20.15-.023.15-.145a531.922%20531.922%200%20010-4.265c0-.131-.037-.15-.159-.15-1.634.005-3.278.005-4.916.005-.132%200-.177-.023-.177-.168V.77l-.008-.001.006-.003.006-.039h-6.495v2.758zM1.285%2021.519c-.185.187-.372.375-.557.566-.004.064.033.059.066.054.01-.001.02-.003.028-.002h7.892a.235.235%200%2000.183-.084l2.242-2.3%201.945-2.004.004-.003c.044-.045.075-.075.137-.009.322.342.648.676.973%201.01l.09.093a888.395%20888.395%200%20013.104%203.22.245.245%200%2000.197.08h7.863l.025.002c.03.005.062.01.084-.03l-.013-.015c-.009-.01-.017-.02-.026-.028l-2.454-2.536-3.906-4.037c-.607-.63-1.217-1.26-1.83-1.887-.08-.088-.112-.148%200-.243a3.69%203.69%200%2000.304-.311l2.76-2.848%204.348-4.5.851-.886h-7.951a.377.377%200%2000-.298.13c-.422.446-.847.885-1.271%201.324l-.001.001-.365.377-.658.679c-.596.613-1.191%201.227-1.783%201.85-.093.093-.13.088-.214%200l-.679-.706-.004-.004-.001-.001-.962-1c-.82-.842-1.638-1.687-2.455-2.533a.307.307%200%2000-.243-.108H.892c-.011%200-.024-.003-.036-.006-.04-.008-.082-.016-.1.047.603.61%201.2%201.221%201.792%201.836l3.873%204.005c.868.9%201.738%201.801%202.61%202.702.058.058.054.087%200%20.142-.14.137-.275.277-.41.417l-.146.152-4.32%204.45-2.364%202.431c-.168.173-.337.343-.506.513zm75.88-15.013a14.2%2014.2%200%2000-1.882%201.259%201.053%201.053%200%2000-.005-.069V4.933c0-.117-.018-.158-.15-.158-1.734.005-3.468.005-5.202%200-.126%200-.154.035-.154.157v17.143c-.002.129.037.152.16.152%201.728-.006%203.457-.006%205.186%200%20.14%200%20.16-.046.16-.168v-6.981c-.002-.085.01-.17.035-.25.255-.8.686-1.533%201.262-2.144.852-.934%201.902-1.6%203.04-2.134a16.1%2016.1%200%20013.839-1.233c.096-.018.13-.048.13-.152V4.916c0-.088%200-.155-.122-.144-.082.006-.166.007-.25.007-.067%200-.133.001-.2.004-2.057.11-4.06.7-5.848%201.723zm14.31%209.27v6.29c0%20.14-.038.162-.167.162h-4.99c-.122%200-.159-.027-.159-.154V9.429c0-.122.037-.156.158-.156h4.992c.13%200%20.166.03.166.163-.003%202.114-.003%204.227%200%206.34zm-34.051-.8h-9.638c-.09%200-.136%200-.155.022-.02.023-.013.069%200%20.161.18%201.25%201.014%202.09%202.265%202.25.37.03.741.036%201.112.02h3.759l1.308.003c.435.002.871.003%201.307.003.712%200%201.423%200%202.134-.015.495-.01.931-.218%201.355-.449.307-.169.6-.363.875-.581a.148.148%200%2001.196-.018c1.32.742%202.645%201.481%203.97%202.217.1.054.098.091.05.179-.84%201.486-2.1%202.473-3.669%203.096-.33.132-.67.237-1.016.316a1.413%201.413%200%2001-.327.037l-4.1-.001c-2.733-.002-5.467-.004-8.2.001a5.605%205.605%200%2001-2.928-.815c-1.293-.768-2.14-1.905-2.686-3.283a10.58%2010.58%200%2001-.662-3.005c-.095-1.046-.076-2.1.057-3.143.243-1.83.851-3.504%202.116-4.89a7.38%207.38%200%20013.851-2.258c.093-.02.188-.03.282-.029l3.468-.003c3.004-.003%206.008-.007%209.013.014%201.276.009%202.395.522%203.34%201.384.902.823%201.479%201.856%201.896%202.987.394%201.108.649%202.261.758%203.432.08.736.112%201.477.096%202.217%200%20.131-.041.15-.159.15h-9.668zm-2.53-3.56H47.77c-.089%200-.133%200-.153-.023-.021-.022-.016-.069-.005-.162.09-.788.571-1.285%201.233-1.646.302-.169.642-.255.988-.252%203.485.01%206.973.01%2010.464%200a1.492%201.492%200%20011.24.608c.306.41.526.877.646%201.374.019.07.013.107-.071.097a1.012%201.012%200%2000-.105%200l-7.111.004z'%20fill='currentColor'%3e%3c/path%3e%3cpath%20d='M113.607%2020.397a10.451%2010.451%200%20002.149-9.746c-1.696-5.954-8.221-9.124-13.981-6.796-.984.397-1.863.964-2.714%201.589-1.028.764-2.2.992-3.46.764-.973-.175-1.84-.587-2.674-1.073a2.051%202.051%200%2001-.91-1.101%202.726%202.726%200%2001-.086-.313%203.19%203.19%200%2000-5.396-1.542%203.187%203.187%200%2000-.894%201.974c-.192%202.29%202.083%204.035%204.246%203.246a2.172%202.172%200%20011.84.132%2010.35%2010.35%200%20011.728%201.124c1.325%201.086%201.977%202.45%201.824%204.187a9.748%209.748%200%2000.399%203.636%2010.456%2010.456%200%200017.929%203.919zm-12.321-9.728a5.272%205.272%200%2000-.889%202.928%205.281%205.281%200%20005.264%205.272%205.275%205.275%200%20004.874-3.25%205.272%205.272%200%2000-9.249-4.95z'%20fill='url(%23paint0_linear_0_335)'%3e%3c/path%3e%3c/g%3e%3cdefs%3e%3clinearGradient%20id='paint0_linear_0_335'%20x1='85.629'%20y1='1.216'%20x2='116.167'%20y2='24.119'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20stop-color='%23CBF2FE'%3e%3c/stop%3e%3cstop%20offset='0.391'%20stop-color='%237DD5F9'%3e%3c/stop%3e%3cstop%20offset='0.735'%20stop-color='%23E6B1F7'%3e%3c/stop%3e%3cstop%20offset='1'%20stop-color='%23E1DFA2'%3e%3c/stop%3e%3c/linearGradient%3e%3cclipPath%20id='clip0_0_335'%3e%3cpath%20fill='%23fff'%20d='M0%200h116.364v24H0z'%3e%3c/path%3e%3c/clipPath%3e%3c/defs%3e%3c/svg%3e";class pr{getElement(){const e=document.createElement("div");return e.classList.add("xa-modal-logo"),e.innerHTML=`
      <img src="${fr}" alt="Xterio" class="auth-logo" />
    `,e}}const Pe={"icon-close":'<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M13.414 12l6-6L18 4.586l-6 6-6-6L4.586 6l6 6-6 6L6 19.414l6-6 6 6L19.414 18l-6-6z" fill="currentColor"></path></svg>',"icon-show":'<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" style="color: rgb(254, 254, 254);"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 4C4 4 2 12 2 12s2 8 10 8 10-8 10-8-2-8-10-8zm-7.716 7.52c-.076.18-.137.342-.187.48A10.894 10.894 0 005.6 14.8C6.827 16.436 8.786 18 12 18c3.214 0 5.173-1.564 6.4-3.2a10.89 10.89 0 001.503-2.8A10.89 10.89 0 0018.4 9.2C17.173 7.564 15.214 6 12 6 8.786 6 6.827 7.564 5.6 9.2c-.626.834-1.05 1.68-1.316 2.32zM14 12a2 2 0 11-4 0 2 2 0 014 0zm2 0a4 4 0 11-8 0 4 4 0 018 0z" fill="currentColor"></path></svg>',"icon-hide":'<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" style="color: rgb(254, 254, 254);"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 4C4 4 2 12 2 12s1.028 4.113 4.56 6.44L5 20l1.414 1.414 2.023-2.023c1.03.38 2.21.609 3.563.609 8 0 10-8 10-8s-.516-2.066-2.074-4.098l1.488-1.488L20 5l-1.43 1.43C17.052 5.073 14.927 4 12 4zm5.153 3.847C15.948 6.797 14.293 6 12 6 8.786 6 6.827 7.564 5.6 9.2A10.894 10.894 0 004.097 12 10.894 10.894 0 005.6 14.8c.605.807 1.388 1.596 2.411 2.189l9.142-9.142zm-7.11 9.939A8.673 8.673 0 0012 18c3.214 0 5.173-1.564 6.4-3.2a10.89 10.89 0 001.503-2.8 10.946 10.946 0 00-1.406-2.668l-2.5 2.5L16 12a4 4 0 01-4.168 3.996l-1.79 1.79zM12 10c.064 0 .128.003.191.009l1.591-1.591a4 4 0 00-5.364 5.364l1.591-1.591A2 2 0 0112 10z" fill="currentColor"></path></svg>',"icon-close-iframe":'<svg fill="currentColor" width="30" height="30" viewBox="0 0 30 30"><defs><style>.icon_63_svg__cls-2{fill:var(--text-color-1)}</style></defs><g style="opacity: 0.15;"><circle cx="15" cy="15" r="15" style="fill: var(--address-icon-color);"></circle></g><rect x="11.63" y="15.53" width="1.37" height="12.99" rx="0.68" class="icon_63_svg__cls-2" transform="rotate(-45 5.79 15.469)"></rect><rect x="18.81" y="21.34" width="1.37" height="12.99" rx="0.68" class="icon_63_svg__cls-2" transform="rotate(45 32.156 16.28)"></rect></svg>'},gt=(i,e=16,n)=>{const o=document.createElement("div");return o.style.cssText=`width: ${e}px; height:${e}px; display:inline-block; color: ${n!=null?n:"#ccc"};`,o.innerHTML=Pe==null?void 0:Pe[i],o};class ie{constructor(e){this.clearIcon=null,this.props=e,this.inputElement=null,this.root=this.createInputElement(),this.setUpEventListeners()}createInputElement(){const{id:e,type:n,label:o,wrapperClassNames:a,showClearIcon:l,showPasswordToggleIcon:d,onChange:m,onBlur:g,onFocus:w}=this.props,h=document.createElement("div");h.classList.add("xa-input-wrapper",`xa-input-wrapper-${n}`),a&&a.forEach(S=>h.classList.add(S));const E=document.createElement("span");E.className="xa-input-label",E.textContent=o,h.appendChild(E);const F=document.createElement("div");F.className="xa-input-inner";const _=document.createElement("input");if(_.type=n==="password"?"password":n,_.id="auth-input",_.className="xa-input",_.placeholder="",this.inputElement=_,F.appendChild(_),l){const S=document.createElement("div");S.className="xa-input-clear",S.appendChild(gt("icon-close")),S.style.visibility="hidden",S.addEventListener("click",()=>{_.value="",S.style.visibility="hidden"}),this.clearIcon=S,F.appendChild(S)}if(n==="password"&&d){const S=document.createElement("div");S.className="xa-input-value-hide",S.addEventListener("click",()=>{_.type==="password"?(_.type="text",S.className="xa-input-value-show"):(_.type="password",S.className="xa-input-value-hide")}),F.appendChild(S)}if(this.props.addonAfterSendButton){let S=function(){const te=setInterval(()=>{ee--,ee===0?(B.disabled=!1,B.textContent="SEND",clearInterval(te),ee=60,L==null||L()):ee>0&&(B.disabled=!0,B.textContent=`${ee-1}s`)},1e3)};const{onClick:P,onCountdownEnd:L}=this.props.addonAfterSendButton,B=document.createElement("button");let ee=60;this.props.addonAfterSendButton.defaultStartCountdown&&S(),B.className="xa-input-addon-btn",B.textContent="SEND",B.addEventListener("click",te=>{te.stopPropagation(),te.preventDefault(),B.disabled=!0,S(),B.textContent=`${ee}s`,P==null||P()}),F.appendChild(B)}_.addEventListener("input",S=>{var L,B;const P=(B=(L=S.target)==null?void 0:L.value)!=null?B:"";this.clearIcon&&(this.clearIcon.style.visibility=P?"visible":"hidden"),m&&m(P)}),_.addEventListener("focus",S=>{var P,L;w&&w((L=(P=S.target)==null?void 0:P.value)!=null?L:"")}),_.addEventListener("blur",S=>{var P,L;g&&g((L=(P=S.target)==null?void 0:P.value)!=null?L:"")}),h.appendChild(F);const R=document.createElement("p");return R.className="xa-error-tip",this.props.showError?R.textContent=this.props.errorMessage||"":R.style.display="none",h.appendChild(R),h}getElement(){return this.root}setUpEventListeners(){this.root,this.root.addEventListener("click",()=>{const n=this.root.querySelector(".xa-input");n&&n.focus()}),this.root.querySelectorAll(".xa-input").forEach(n=>{n.addEventListener("focus",()=>{const o=n.closest(".xa-input-wrapper"),a=o==null?void 0:o.querySelector(".xa-input-label");a&&a.classList.add("xa-input-label_filled")}),n.addEventListener("blur",()=>{const o=n.closest(".xa-input-wrapper"),a=o==null?void 0:o.querySelector(".xa-input-label");a&&n.value===""&&a.classList.remove("xa-input-label_filled")})})}showError(e){const n=this.root.querySelector(".xa-error-tip");n.textContent=e,n.style.display="block"}hideError(){const e=this.root.querySelector(".xa-error-tip");e.style.display="none"}getValue(){return this.inputElement.value}setValue(e){this.inputElement.value=e,this.props.onChange&&this.props.onChange(e)}}class mr{constructor(){this.loader=document.createElement("div")}getElement(){return this.loader.classList.add("xa-loader"),this.loader}show(){var e;(e=this.loader)==null||e.classList.remove("xa-hide")}hide(){var e;(e=this.loader)==null||e.classList.add("xa-hide")}}class _e{constructor(e){this.props=e,this.root=this.createButtonElement()}createButtonElement(){const{id:e,text:n,wrapperClassNames:o,disabled:a,onClick:l}=this.props,d=document.createElement("button");d.className="xa-login-button",d.textContent=n;const m=new mr;return m.hide(),d.insertBefore(m.getElement(),d.firstChild),this.loader=m,o&&o.forEach(g=>d.classList.add(g)),a&&(d.disabled=!0,d.classList.add("xa-login-button_disabled")),l&&d.addEventListener("click",g=>l(g)),d}getElement(){return this.root}setDisabled(e){this.root.disabled=e,e?this.root.classList.add("xa-login-button_disabled"):this.root.classList.remove("xa-login-button_disabled")}setLoading(e){var n,o;e?(n=this.loader)==null||n.show():(o=this.loader)==null||o.hide()}}var X=(i=>(i.Login="login",i.Signup="signup",i.SignupCode="signupCode",i.ForgotPassword="forgotPassword",i.PasswordSuccess="passwordSuccess",i))(X||{});class ke{constructor(e,n){this.modal=e}}class Ne{constructor(){this.formList=[]}add(e,n){this.formList.push({name:e,formItem:n})}findFormItem(e){var o;return(o=this.formList.find(a=>a.name===e))==null?void 0:o.formItem}clearFormItemError(e){var o;const n=(o=this.formList.find(a=>a.name===e))==null?void 0:o.formItem;n==null||n.clearError()}getFormItemValue(e){var o,a,l;const n=(o=this.formList.find(d=>d.name===e))==null?void 0:o.formItem;return(l=(a=n==null?void 0:n.value)==null?void 0:a.toString())!=null?l:""}getFormItemChecked(e){var o;const n=(o=this.formList.find(a=>a.name===e))==null?void 0:o.formItem;return!!(n!=null&&n.value)}}const gr=i=>!!i&&/\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*/.test(i),wr=i=>!!i&&/^(?=.*[A-Z])(?=.*\d)[\S]{8,}$/.test(i),Ye=i=>gr(i)?"":"Invalid Email",wt=i=>wr(i)?"":"Password must be at least 8 characters with 1 upper case letter and 1 number",yt=(i,e)=>i===e?"":"The passwords don't match";class J{constructor(e,n,o){this._value="",this.root=document.createElement("div"),this.root.className="xa-form-item",this.root.innerHTML=`
    <div class="xa-form-item-error"></div>`,this.root.setAttribute("data-name",e),this.root.insertBefore(n,this.root.firstChild),this.label=document.createElement("span"),this.getValueFunction=o}getElement(){return this.root}get value(){return this.getValueFunction()}setError(e){var n,o;this.root.querySelector(".xa-form-item-error").innerHTML=e,e?(n=this.root.querySelector(".xa-input-wrapper"))==null||n.classList.add("xa-error-border"):(o=this.root.querySelector(".xa-input-wrapper"))==null||o.classList.remove("xa-error-border")}isValidate(){var e;return!((e=this.root.querySelector(".xa-form-item-error"))!=null&&e.innerHTML)}clearError(){var e;this.root.querySelector(".xa-form-item-error").innerHTML="",(e=this.root.querySelector(".xa-input-wrapper"))==null||e.classList.remove("xa-error-border")}}const xt=!1;class Et extends ke{constructor(e,n){super(e),this.loginButton=null,this.emailInput=null,this.pwdInput=null,this.form=new Ne}render(){if(!this.modal.modalContainer)return;const e=this.modal.modalContainer;this.modal.setTitle("Sign in","Sign in with email"),this.renderEmailInput(e),this.renderPwdInput(e),this.renderHcaptcha(e),this.renderTips(e),this.renderLoginButton(e),this.setupListeners()}renderEmailInput(e){const n=new ie({label:"EMAIL",type:"text",showClearIcon:!0,onChange:a=>{this.form.clearFormItemError("email"),this.handleEmailChange(a)},onBlur:a=>{var l;(l=this.form.findFormItem("email"))==null||l.setError(Ye(a)),this.handleEmailChange(a)}});this.emailInput=n;const o=new J("email",n.getElement(),()=>n.getValue());this.form.add("email",o),this.append(e,o.getElement())}renderPwdInput(e){const n=new ie({label:"PASSWORD",type:"password",showClearIcon:!0,onChange:a=>{this.handlePasswordChange(a)},onBlur:a=>{var l;(l=this.form.findFormItem("password"))==null||l.setError(wt(a)),this.handlePasswordChange(a)}});this.pwdInput=n;const o=new J("password",n.getElement(),()=>n.getValue());this.form.add("password",o),this.append(e,o.getElement())}renderHcaptcha(e){var o;const n=document.createElement("div");n.id="hcaptcha",n.classList.add("h-captcha"),hcaptcha.render(n,{size:"invisible",sitekey:(K==null?void 0:K[(o=this.modal)==null?void 0:o.env].HCAPTCHA_SITE_KEY)||""}),e.appendChild(n)}renderTips(e){const n=document.createElement("div");n.classList.add("xa-login-tip","xa-flex","xa-justify-between"),n.innerHTML=`
      <div>No account yet? <a class="xa-to-sign-up">Sign up</a></div>
      <div>
        <a class="xa-to-forgotpwd">Forgot password?</a>
      </div>
    `,e.appendChild(n)}renderLoginButton(e){const n=new _e({text:"SIGN IN",disabled:!0,onClick:o=>{this.handleLogin()}});this.loginButton=n,this.append(e,n.getElement())}setupListeners(){var o,a;const e=(o=this.modal.modalContainer)==null?void 0:o.querySelector(".xa-to-sign-up");e==null||e.addEventListener("click",()=>this.modal.switchModalState(X.Signup));const n=(a=this.modal.modalContainer)==null?void 0:a.querySelector(".xa-to-forgotpwd");n==null||n.addEventListener("click",()=>this.modal.switchModalState(X.ForgotPassword))}handleEmailChange(e){var n,o;(o=this.loginButton)==null||o.setDisabled(e.length===0||!((n=this.form.findFormItem("email"))!=null&&n.isValidate()))}handlePasswordChange(e){var n,o;(o=this.loginButton)==null||o.setDisabled(e.length===0||!((n=this.form.findFormItem("password"))!=null&&n.isValidate()))}getHCaptchaResponse(){return I(this,null,function*(){try{const e=hcaptcha.execute({async:!0}),{response:n}=yield e;return n||""}catch(e){return""}})}handleLogin(){return I(this,null,function*(){var d,m,g,w,h,E,F,_,R,S;const e=(d=this.emailInput)==null?void 0:d.getValue(),n=(m=this.pwdInput)==null?void 0:m.getValue();if(!e||!n)return;(g=this.loginButton)==null||g.setLoading(!0);const o=yield this.getHCaptchaResponse();if(!o&&!xt){(w=this.loginButton)==null||w.setLoading(!1);return}const{error:a,err_code:l}=yield this.modal.store.login(e,n,o);if((h=this.loginButton)==null||h.setLoading(!1),a){switch(l){case 11001:(E=this.form.findFormItem("email"))==null||E.setError("Wrong email or password");break;case 11103:(F=this.form.findFormItem("password"))==null||F.setError("Invalid password");break;case 11113:(_=this.form.findFormItem("password"))==null||_.setError("User does not exist.");break;case 11004:(R=this.form.findFormItem("password"))==null||R.setError("Too many attempts to login");break;case 11003:H.sendSignUpCodeService(e),this.modal.switchModalState(X.SignupCode,{email:e,password:n,alreadySendCode:!0});break;default:(S=this.form.findFormItem("password"))==null||S.setError("Unknown error, please try again later");break}return}this.modal.close()})}append(e,n){e.appendChild(n)}}const yr="https://xter.io/privacy-policy",xr="https://xter.io/terms-of-service",Er="https://js.hcaptcha.com/1/api.js";class It{constructor(e){this._checked=!1,this._checked=!!e.defaultChecked,this.props=e,this.root=document.createElement("div"),this.root.className="xa-checkbox-wrapper",this.checkboxInput=document.createElement("input"),this.checkboxInput.type="checkbox",this.checkboxInput.className="xa-checkbox-input",this.checkboxInput.checked=this._checked,this.checkboxLabel=document.createElement("label"),this.checkboxLabel.className="xa-checkbox-label",this.root.appendChild(this.checkboxInput),this.root.appendChild(this.checkboxLabel),this.root.addEventListener("click",this.handleCheckboxChange.bind(this)),this.updateCheckboxState()}getElement(){return this.root}handleCheckboxChange(){const{onChange:e}=this.props;this._checked=!this._checked,this.updateCheckboxState(),e==null||e(this._checked)}updateCheckboxState(){this._checked?(this.checkboxLabel.style.borderColor="#0a1161",this.checkboxLabel.style.backgroundColor="#0a1161",this.checkboxInput.checked=!0):(this.checkboxLabel.style.borderColor="#0a1161",this.checkboxLabel.style.backgroundColor="transparent",this.checkboxInput.checked=!1)}get checked(){return this._checked}}class Ir extends ke{constructor(e,n){super(e),this.signUpButton=null,this.extraData=n||{},this.form=new Ne}render(){if(!this.modal.modalContainer)return;const e=this.modal.modalContainer;this.modal.setTitle("Create Xterio account","Sign up with email"),this.renderEmailInput(e),this.renderPwdInput(e),this.renderConfirmPwdInput(e),this.renderHCaptcha(e),this.renderTipsCheckList(e),this.renderConfirmButton(e),this.renderBackTip(e),this.setupListeners()}renderBackTip(e){const n=document.createElement("div");n.classList.add("xa-w-full","xa-text-center"),n.innerHTML=`
      <div class="xa-login-tip">
        <span>Already have an account? </span>
        <a class="xa-to-sign-in"> Sign in </a>
      </div>
    `,this.append(e,n)}renderConfirmButton(e){const n=new _e({text:"SIGN UP",disabled:!0,onClick:o=>{this.handleSignUp()}});this.signUpButton=n,this.append(e,n.getElement())}renderTipsCheckList(e){const n=document.createElement("div"),o=document.createElement("div");o.classList.add("xa-login-tip","xa-flex"),o.innerHTML=`
      <div>
        <span>I am 18 years of age or older and agree to the terms of the</span>
        <a href="${xr}" target="_blank"> Terms of Service </a>
        <span>and the</span>
        <a href="${yr}" target="_blank"> Privacy Policy </a>
      </div>
        `;const a=new It({defaultChecked:!0,onChange:E=>{this.form.clearFormItemError("terms")}}),l=a.getElement();l.classList.add("xa-login-tip-checkbox"),o.insertBefore(l,o.firstChild),n.appendChild(o);const d=new J("terms",o,()=>a.checked);this.form.add("terms",d),n.appendChild(d.getElement());const m=document.createElement("div");m.classList.add("xa-login-tip","xa-flex","xa-items-center"),m.innerHTML=`<div class="xa-login-tip">
        <span>Subscribe to updates via email</span>
      </div>`;const g=new It({defaultChecked:!1}),w=g.getElement();w.classList.add("xa-login-tip-checkbox"),m.insertBefore(w,m.firstChild),n.appendChild(m);const h=new J("subscribe",m,()=>g.checked);this.form.add("subscribe",h),n.appendChild(h.getElement()),this.append(e,n)}renderConfirmPwdInput(e){const n=new ie({label:"CONFRIM PASSWORD",type:"password",showClearIcon:!0,onChange:a=>{this.handlePasswordChange(a)},onBlur:a=>{var l;(l=this.form.findFormItem("confirmPassword"))==null||l.setError(yt(this.form.getFormItemValue("password"),a))}});this.confirmPwdInput=n;const o=new J("confirmPassword",n.getElement(),()=>this.confirmPwdInput.getValue());this.form.add("confirmPassword",o),this.append(e,o.getElement())}renderHCaptcha(e){var o;const n=document.createElement("div");n.id="hcaptcha",n.classList.add("h-captcha"),hcaptcha.render(n,{size:"invisible",sitekey:(K==null?void 0:K[(o=this.modal)==null?void 0:o.env].HCAPTCHA_SITE_KEY)||""}),e.appendChild(n)}renderPwdInput(e){const n=new ie({label:"PASSWORD",type:"password",showClearIcon:!0,onChange:a=>{this.handlePasswordChange(a)},onBlur:a=>{var l;(l=this.form.findFormItem("password"))==null||l.setError(wt(a))}});this.pwdInput=n;const o=new J("password",n.getElement(),()=>this.pwdInput.getValue());this.form.add("password",o),this.append(e,o.getElement())}renderEmailInput(e){const n=new ie({label:"EMAIL",type:"text",showClearIcon:!0,onChange:a=>{this.form.clearFormItemError("email"),this.handleEmailChange(a)},onBlur:a=>{var l;(l=this.form.findFormItem("email"))==null||l.setError(Ye(a))}});this.emailInput=n;const o=new J("email",n.getElement(),()=>this.emailInput.getValue());this.form.add("email",o),this.append(e,o.getElement())}setupListeners(){var o,a;const e=(o=this.modal.modalContainer)==null?void 0:o.querySelector(".xa-to-sign-in");e==null||e.addEventListener("click",()=>this.modal.switchModalState(X.Login));const n=(a=this.modal.modalContainer)==null?void 0:a.querySelector(".xa-to-forgotpwd");n==null||n.addEventListener("click",()=>this.modal.switchModalState(X.ForgotPassword))}handleEmailChange(e){var n;(n=this.signUpButton)==null||n.setDisabled(e.length===0)}handlePasswordChange(e){}getHCaptchaResponse(){return I(this,null,function*(){try{const e=hcaptcha.execute({async:!0}),{response:n}=yield e;return n||""}catch(e){return""}})}handleSignUp(){return I(this,null,function*(){var g,w,h,E,F,_,R;const e=this.form.getFormItemValue("email"),n=this.form.getFormItemValue("password");this.form.getFormItemValue("confirmPassword");const o=!!this.form.getFormItemChecked("terms"),a=!!this.form.getFormItemChecked("subscribe");if(!o){(g=this.form.findFormItem("terms"))==null||g.setError("You have to accept Terms of Service and Privacy Policy to continue.");return}if(!e||!n)return;(w=this.signUpButton)==null||w.setLoading(!0);const l=yield this.getHCaptchaResponse();if(!l&&!xt){(h=this.signUpButton)==null||h.setLoading(!1);return}const{error:d,err_code:m}=yield H.registerService({username:e,password:n,subscribe:a,hcaptchaResponseToken:l});if((E=this.signUpButton)==null||E.setLoading(!1),d){switch(m){case 11102:(F=this.form.findFormItem("email"))==null||F.setError("User already registered.");break;case 11103:(_=this.form.findFormItem("password"))==null||_.setError("Invalid password.");break;default:(R=this.form.findFormItem("subscribe"))==null||R.setError("Unknown error, please try again later.");break}return}this.modal.switchModalState(X.SignupCode,{email:e,password:n,alreadySendCode:!0})})}append(e,n){e.appendChild(n)}}class Cr extends ke{constructor(e,n){super(e),this.continueButton=null,this.form=new Ne}render(){if(!this.modal.modalContainer)return;const e=this.modal.modalContainer;this.modal.setTitle("Forgot password","Please enter your email and email verification code"),this.renderEmailInput(e),this.renderCodeInput(e),this.renderPwdInput(e),this.renderConfirmPwdInput(e),this.renderConfirmButton(e),this.renderBackTip(e),this.setupListeners()}renderEmailInput(e){const n=new ie({label:"EMAIL",type:"text",showClearIcon:!0,onChange:a=>{this.form.clearFormItemError("email"),this.handleEmailChange(a)},onBlur:a=>{var l;(l=this.form.findFormItem("email"))==null||l.setError(Ye(a))}}),o=new J("email",n.getElement(),()=>n.getValue());this.form.add("email",o),this.append(e,o.getElement())}renderCodeInput(e){const n=new ie({label:"ENTER CODE",type:"text",onChange:a=>{this.handleEmailChange(a)},addonAfterSendButton:{onClick:()=>{var l;if(!this.form.getFormItemValue("email")){(l=this.form.findFormItem("email"))==null||l.setError("Email is required");return}H.sendForgotCodeService({email:this.form.getFormItemValue("email")})},onCountdownEnd:()=>{}}}),o=new J("code",n.getElement(),()=>n.getValue());this.form.add("code",o),this.append(e,o.getElement())}renderPwdInput(e){const n=new ie({label:"NEW PASSWORD",type:"password",showClearIcon:!0,onChange:a=>{this.handlePasswordChange(a)}}),o=new J("password",n.getElement(),()=>n.getValue());this.form.add("password",o),this.append(e,o.getElement())}renderConfirmPwdInput(e){const n=new ie({label:"CONFRIM PASSWORD",type:"password",showClearIcon:!0,onChange:a=>{this.handlePasswordChange(a)},onBlur:a=>{var l;(l=this.form.findFormItem("confirmPassword"))==null||l.setError(yt(this.form.getFormItemValue("password"),a))}}),o=new J("confirmPassword",n.getElement(),()=>n.getValue());this.form.add("confirmPassword",o),this.append(e,o.getElement())}renderConfirmButton(e){const n=new _e({text:"CONTINUE",disabled:!0,onClick:o=>{this.handleUpdatePassword()}});this.continueButton=n,this.append(e,n.getElement())}renderBackTip(e){const n=document.createElement("div");n.classList.add("xa-w-full","xa-text-center"),n.innerHTML=`
      <div class="xa-login-tip">
       <span>Back to </span>
        <a class="xa-to-sign-in"> Sign in </a>
      </div>
    `,this.append(e,n)}setupListeners(){var o,a;const e=(o=this.modal.modalContainer)==null?void 0:o.querySelector(".xa-to-sign-in");e==null||e.addEventListener("click",()=>this.modal.switchModalState(X.Login));const n=(a=this.modal.modalContainer)==null?void 0:a.querySelector(".xa-to-forgotpwd");n==null||n.addEventListener("click",()=>this.modal.switchModalState(X.ForgotPassword))}handleEmailChange(e){var n;(n=this.continueButton)==null||n.setDisabled(e.length===0)}handlePasswordChange(e){}handleUpdatePassword(){return I(this,null,function*(){var d,m,g,w,h,E,F;const e=this.form.getFormItemValue("email"),n=this.form.getFormItemValue("password");this.form.getFormItemValue("confirmPassword");const o=this.form.getFormItemValue("code");if(!e||!n)return;(d=this.continueButton)==null||d.setLoading(!0);const{error:a,err_code:l}=yield H.resetPassword({email:e,password:n,code:o});if((m=this.continueButton)==null||m.setLoading(!1),a){switch(l){case 10001:(g=this.form.findFormItem("code"))==null||g.setError("Invalid verification code");break;case 11111:(w=this.form.findFormItem("code"))==null||w.setError("Invalid verification code");break;case 11112:(h=this.form.findFormItem("code"))==null||h.setError("Verification code expired");break;case 11113:(E=this.form.findFormItem("email"))==null||E.setError("User does not exist");break;default:(F=this.form.findFormItem("confirmPassword"))==null||F.setError("Unknown error, please try again later.");break}return}this.modal.switchModalState(X.PasswordSuccess)})}append(e,n){e.appendChild(n)}}class br{constructor(){this.listeners=new Set}subscribe(e){return this.listeners.add(e),()=>this.listeners.delete(e)}notify(){this.listeners.forEach(e=>e())}}class Sr{constructor(){var e,n,o;this.accessToken=(e=z.tokens)==null?void 0:e.access_token,this.refreshToken=(n=z.tokens)==null?void 0:n.refresh_token,this.idToken=(o=z.tokens)==null?void 0:o.id_token}setTokens({accessToken:e,refreshToken:n,idToken:o}){this.accessToken=e,this.refreshToken=n,this.idToken=o,z.tokens={access_token:e,id_token:o,refresh_token:n}}removeTokens(){this.accessToken=void 0,this.refreshToken=void 0,this.idToken=void 0}}class _r extends br{constructor(){super(),this.userState={isLogin:!1,userInfo:null},this.tokenManager=new Sr,this.refreshUserInfo(),this.listenStateChange()}listenStateChange(){const e={isLogin:!1,userInfo:null};this.userState=new Proxy(e,{set:(n,o,a)=>(n[o]!==a&&(n[o]=a,this.setPersistUserInfo(),this.notify()),!0)})}login(e,n,o){return I(this,null,function*(){const{error:a,err_code:l,access_token:d,id_token:m,refresh_token:g}=yield H.loginService(e,n,o);return!a&&d&&g?(this.tokenManager.setTokens({accessToken:d,refreshToken:g,idToken:m}),yield this.getUserInfo(),this.userState.isLogin=!0):this.userState.isLogin=!1,{error:!!a,err_code:l}})}confirmSignUpLogin(a){return I(this,arguments,function*({username:e,password:n,code:o}){const{error:l,err_code:d,access_token:m,id_token:g,refresh_token:w}=yield H.registerConfirmService({username:e,password:n,code:o});return!l&&m&&w?(this.tokenManager.setTokens({accessToken:m,refreshToken:w,idToken:g}),yield this.getUserInfo(),this.userState.isLogin=!0):this.userState.isLogin=!1,{error:!!l,err_code:d}})}getUserInfo(){return I(this,null,function*(){const e=yield H.getUserInfo();return e&&e.uuid&&(this.userState.userInfo=T(T({},this.userState.userInfo),e),this.userState.isLogin=!0),e})}setPersistUserInfo(){this.userState.userInfo&&(z.userInfo=this.userState.userInfo)}getPersistUserInfo(){return z.userInfo}refreshUserInfo(){return I(this,null,function*(){re.subscribe(e=>{this.userState.userInfo=e,this.userState.isLogin=!!e.uuid})})}removeUserState(){this.userState.isLogin=!1,this.userState.userInfo=null,this.tokenManager.removeTokens()}logout(){le.logout()}}class kr extends ke{constructor(e,n){super(e),this.signUpButton=null,this.extraData=n||{},this.form=new Ne}render(){if(!this.modal.modalContainer)return;const e=this.modal.modalContainer;this.modal.setTitle("Verify email","Verification code has been sent to",this.extraData.email),this.renderCodeInput(e),this.renderConfirmButton(e),this.renderBackTip(e),this.setupListeners()}renderCodeInput(e){const n=new ie({id:"xaCodeInput",label:"ENTER CODE",type:"text",showClearIcon:!0,onChange:a=>{this.handleCodeChange(a)},addonAfterSendButton:{defaultStartCountdown:this.extraData.alreadySendCode,onClick:()=>{var a,l,d;if(!((a=this.extraData)!=null&&a.email)){(l=this.form.findFormItem("code"))==null||l.setError("Email is required");return}H.sendSignUpCodeService((d=this.extraData)==null?void 0:d.email)},onCountdownEnd:()=>{}}}),o=new J("code",n.getElement(),()=>n.getValue());this.form.add("code",o),this.append(e,o.getElement())}renderConfirmButton(e){const n=new _e({text:"CONTINUE",disabled:!0,onClick:o=>{this.handleContinueSignUp()}});this.signUpButton=n,this.append(e,n.getElement())}renderBackTip(e){const n=document.createElement("div");n.classList.add("xa-w-full","xa-text-center"),n.innerHTML=`
      <div class="xa-login-tip">
        <span>Already have an account? </span>
        <a class="xa-to-sign-in"> Sign in </a>
      </div>
    `,this.append(e,n)}setupListeners(){var o,a;const e=(o=this.modal.modalContainer)==null?void 0:o.querySelector(".xa-to-sign-in");e==null||e.addEventListener("click",()=>this.modal.switchModalState(X.Login));const n=(a=this.modal.modalContainer)==null?void 0:a.querySelector(".xa-to-forgotpwd");n==null||n.addEventListener("click",()=>this.modal.switchModalState(X.ForgotPassword))}handleCodeChange(e){var n;(n=this.signUpButton)==null||n.setDisabled(e.length===0)}append(e,n){e.appendChild(n)}handleContinueSignUp(){return I(this,null,function*(){var d,m,g,w,h,E;const e=this.form.getFormItemValue("code"),n=(d=this.extraData)==null?void 0:d.password,o=(m=this.extraData)==null?void 0:m.email;if(!n||!o||!e)return;(g=this.signUpButton)==null||g.setLoading(!0);const{error:a,err_code:l}=yield this.modal.store.confirmSignUpLogin({username:o,password:n,code:e});if((w=this.signUpButton)==null||w.setLoading(!1),a){switch(l){case 11111:(h=this.form.findFormItem("code"))==null||h.setError("Invalid verification code");break;default:(E=this.form.findFormItem("code"))==null||E.setError("Unknown error, please try again later.");break}return}this.modal.close()})}}const Br="data:image/svg+xml,%3csvg%20width='80'%20height='80'%20viewBox='0%200%2064%2064'%20xmlns='http://www.w3.org/2000/svg'%3e%3csvg%20width='64'%20height='64'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3ccircle%20cx='32'%20cy='32'%20r='24'%20fill='url(%23paint0_linear_0_548)'%3e%3c/circle%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M44.535%2026L29%2041.535%2019.465%2032%2023%2028.465l6%206%2012-12L44.535%2026z'%20fill='%230A1161'%3e%3c/path%3e%3cdefs%3e%3clinearGradient%20id='paint0_linear_0_548'%20x1='8'%20y1='32.828'%20x2='56'%20y2='32.828'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20stop-color='%239EE6FC'%3e%3c/stop%3e%3cstop%20offset='1'%20stop-color='%23EBB9E7'%3e%3c/stop%3e%3c/linearGradient%3e%3c/defs%3e%3c/svg%3e%3c/svg%3e";function Tr(){const i=document.createElement("div");return i.classList.add("xa-modal-logo"),i.innerHTML=`
      <img src="${Br}" alt="Xterio" class="xa-icon-success" />
    `,i}class Fr extends ke{constructor(e,n){super(e)}render(){if(!this.modal.modalContainer)return;const e=this.modal.modalContainer;this.append(e,Tr()),this.modal.setTitle("Password has been changed!","Your password has been changed successfully"),this.renderConfirmButton(e)}renderConfirmButton(e){const n=new _e({text:"SIGN IN",onClick:o=>{this.modal.switchModalState(X.Login)}});this.append(e,n.getElement())}append(e,n){e.appendChild(n)}}class Y{constructor({apiUrl:e,env:n}){this.apiUrl=e,this.env=n||b.Dev,this.initHCaptcha(),this.currentState=new Et(this),this.store=new _r}static get instance(){if(!Y._instance)throw new Error("Xterio Auth SDK is not initialized. Call XterioAuth.init({apiUrl, env}) first.");return Y._instance}static init({apiUrl:e,env:n}){Y._instance||(Y._instance=new Y({apiUrl:e,env:n}))}initHCaptcha(){const e=document.createElement("script");e.src=Er,e.async=!0,e.defer=!0,document.head.appendChild(e)}open(){const e=document.createElement("div");e.className="xa-modal-overlay",this.modalOverlay=e,e.addEventListener("click",o=>{o.target});const n=document.createElement("div");this.modalContainer=n,n.className="xa-modal",this.renderCommonElement(n),e.appendChild(n),document.body.appendChild(e),this.currentState.render()}close(){var e,n;(e=this.modalContainer)==null||e.remove(),(n=this.modalOverlay)==null||n.remove(),this.switchModalState(X.Login)}renderCommonElement(e){const n=new pr;e.appendChild(n.getElement());const o=gt("icon-close",24,"#838383");o.addEventListener("click",()=>this.close()),o.className="xa-signin-close",e.appendChild(o);const a=document.createElement("div");a.className="xa-signin-title-container",a.innerHTML=`
        <h3 class="xa-signin-title">Sign in</h3>
        <p class="xa-signin-sub-title">Sign in with email</p>
        <div class="xa-signin-title-email"></div>
       `,e.appendChild(a)}setTitle(e,n,o){const a=document.querySelector(".xa-signin-title"),l=document.querySelector(".xa-signin-sub-title"),d=document.querySelector(".xa-signin-title-email");a.innerHTML=e,l.innerHTML=n,d&&o&&(d.innerHTML=o)}renderContent(){this.modalContainer&&(this.modalContainer.innerHTML="",this.renderCommonElement(this.modalContainer)),this.currentState.render()}switchModalState(e,n){switch(e){case"login":this.currentState=new Et(this,n);break;case"signup":this.currentState=new Ir(this,n);break;case"signupCode":this.currentState=new kr(this,n);break;case"forgotPassword":this.currentState=new Cr(this,n);break;case X.PasswordSuccess:this.currentState=new Fr(this,n);break}this.renderContent()}}var Ct={},Re={};Re.byteLength=Ar,Re.toByteArray=Pr,Re.fromByteArray=Or;for(var oe=[],Z=[],Lr=typeof Uint8Array!="undefined"?Uint8Array:Array,We="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ye=0,Ur=We.length;ye<Ur;++ye)oe[ye]=We[ye],Z[We.charCodeAt(ye)]=ye;Z[45]=62,Z[95]=63;function bt(i){var e=i.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=i.indexOf("=");n===-1&&(n=e);var o=n===e?0:4-n%4;return[n,o]}function Ar(i){var e=bt(i),n=e[0],o=e[1];return(n+o)*3/4-o}function vr(i,e,n){return(e+n)*3/4-n}function Pr(i){var e,n=bt(i),o=n[0],a=n[1],l=new Lr(vr(i,o,a)),d=0,m=a>0?o-4:o,g;for(g=0;g<m;g+=4)e=Z[i.charCodeAt(g)]<<18|Z[i.charCodeAt(g+1)]<<12|Z[i.charCodeAt(g+2)]<<6|Z[i.charCodeAt(g+3)],l[d++]=e>>16&255,l[d++]=e>>8&255,l[d++]=e&255;return a===2&&(e=Z[i.charCodeAt(g)]<<2|Z[i.charCodeAt(g+1)]>>4,l[d++]=e&255),a===1&&(e=Z[i.charCodeAt(g)]<<10|Z[i.charCodeAt(g+1)]<<4|Z[i.charCodeAt(g+2)]>>2,l[d++]=e>>8&255,l[d++]=e&255),l}function Nr(i){return oe[i>>18&63]+oe[i>>12&63]+oe[i>>6&63]+oe[i&63]}function Rr(i,e,n){for(var o,a=[],l=e;l<n;l+=3)o=(i[l]<<16&16711680)+(i[l+1]<<8&65280)+(i[l+2]&255),a.push(Nr(o));return a.join("")}function Or(i){for(var e,n=i.length,o=n%3,a=[],l=16383,d=0,m=n-o;d<m;d+=l)a.push(Rr(i,d,d+l>m?m:d+l));return o===1?(e=i[n-1],a.push(oe[e>>2]+oe[e<<4&63]+"==")):o===2&&(e=(i[n-2]<<8)+i[n-1],a.push(oe[e>>10]+oe[e>>4&63]+oe[e<<2&63]+"=")),a.join("")}var Je={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */Je.read=function(i,e,n,o,a){var l,d,m=a*8-o-1,g=(1<<m)-1,w=g>>1,h=-7,E=n?a-1:0,F=n?-1:1,_=i[e+E];for(E+=F,l=_&(1<<-h)-1,_>>=-h,h+=m;h>0;l=l*256+i[e+E],E+=F,h-=8);for(d=l&(1<<-h)-1,l>>=-h,h+=o;h>0;d=d*256+i[e+E],E+=F,h-=8);if(l===0)l=1-w;else{if(l===g)return d?NaN:(_?-1:1)*(1/0);d=d+Math.pow(2,o),l=l-w}return(_?-1:1)*d*Math.pow(2,l-o)},Je.write=function(i,e,n,o,a,l){var d,m,g,w=l*8-a-1,h=(1<<w)-1,E=h>>1,F=a===23?Math.pow(2,-24)-Math.pow(2,-77):0,_=o?0:l-1,R=o?1:-1,S=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(m=isNaN(e)?1:0,d=h):(d=Math.floor(Math.log(e)/Math.LN2),e*(g=Math.pow(2,-d))<1&&(d--,g*=2),d+E>=1?e+=F/g:e+=F*Math.pow(2,1-E),e*g>=2&&(d++,g/=2),d+E>=h?(m=0,d=h):d+E>=1?(m=(e*g-1)*Math.pow(2,a),d=d+E):(m=e*Math.pow(2,E-1)*Math.pow(2,a),d=0));a>=8;i[n+_]=m&255,_+=R,m/=256,a-=8);for(d=d<<a|m,w+=a;w>0;i[n+_]=d&255,_+=R,d/=256,w-=8);i[n+_-R]|=S*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(i){const e=Re,n=Je,o=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;i.Buffer=h,i.SlowBuffer=Ve,i.INSPECT_MAX_BYTES=50;const a=2147483647;i.kMaxLength=a;const{Uint8Array:l,ArrayBuffer:d,SharedArrayBuffer:m}=globalThis;h.TYPED_ARRAY_SUPPORT=g(),!h.TYPED_ARRAY_SUPPORT&&typeof console!="undefined"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function g(){try{const s=new l(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,l.prototype),Object.setPrototypeOf(s,t),s.foo()===42}catch(s){return!1}}Object.defineProperty(h.prototype,"parent",{enumerable:!0,get:function(){if(h.isBuffer(this))return this.buffer}}),Object.defineProperty(h.prototype,"offset",{enumerable:!0,get:function(){if(h.isBuffer(this))return this.byteOffset}});function w(s){if(s>a)throw new RangeError('The value "'+s+'" is invalid for option "size"');const t=new l(s);return Object.setPrototypeOf(t,h.prototype),t}function h(s,t,r){if(typeof s=="number"){if(typeof t=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return R(s)}return E(s,t,r)}h.poolSize=8192;function E(s,t,r){if(typeof s=="string")return S(s,t);if(d.isView(s))return L(s);if(s==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof s);if(se(s,d)||s&&se(s.buffer,d)||typeof m!="undefined"&&(se(s,m)||s&&se(s.buffer,m)))return B(s,t,r);if(typeof s=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const c=s.valueOf&&s.valueOf();if(c!=null&&c!==s)return h.from(c,t,r);const u=ee(s);if(u)return u;if(typeof Symbol!="undefined"&&Symbol.toPrimitive!=null&&typeof s[Symbol.toPrimitive]=="function")return h.from(s[Symbol.toPrimitive]("string"),t,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof s)}h.from=function(s,t,r){return E(s,t,r)},Object.setPrototypeOf(h.prototype,l.prototype),Object.setPrototypeOf(h,l);function F(s){if(typeof s!="number")throw new TypeError('"size" argument must be of type number');if(s<0)throw new RangeError('The value "'+s+'" is invalid for option "size"')}function _(s,t,r){return F(s),s<=0?w(s):t!==void 0?typeof r=="string"?w(s).fill(t,r):w(s).fill(t):w(s)}h.alloc=function(s,t,r){return _(s,t,r)};function R(s){return F(s),w(s<0?0:te(s)|0)}h.allocUnsafe=function(s){return R(s)},h.allocUnsafeSlow=function(s){return R(s)};function S(s,t){if((typeof t!="string"||t==="")&&(t="utf8"),!h.isEncoding(t))throw new TypeError("Unknown encoding: "+t);const r=pe(s,t)|0;let c=w(r);const u=c.write(s,t);return u!==r&&(c=c.slice(0,u)),c}function P(s){const t=s.length<0?0:te(s.length)|0,r=w(t);for(let c=0;c<t;c+=1)r[c]=s[c]&255;return r}function L(s){if(se(s,l)){const t=new l(s);return B(t.buffer,t.byteOffset,t.byteLength)}return P(s)}function B(s,t,r){if(t<0||s.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(s.byteLength<t+(r||0))throw new RangeError('"length" is outside of buffer bounds');let c;return t===void 0&&r===void 0?c=new l(s):r===void 0?c=new l(s,t):c=new l(s,t,r),Object.setPrototypeOf(c,h.prototype),c}function ee(s){if(h.isBuffer(s)){const t=te(s.length)|0,r=w(t);return r.length===0||s.copy(r,0,0,t),r}if(s.length!==void 0)return typeof s.length!="number"||it(s.length)?w(0):P(s);if(s.type==="Buffer"&&Array.isArray(s.data))return P(s.data)}function te(s){if(s>=a)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+a.toString(16)+" bytes");return s|0}function Ve(s){return+s!=s&&(s=0),h.alloc(+s)}h.isBuffer=function(t){return t!=null&&t._isBuffer===!0&&t!==h.prototype},h.compare=function(t,r){if(se(t,l)&&(t=h.from(t,t.offset,t.byteLength)),se(r,l)&&(r=h.from(r,r.offset,r.byteLength)),!h.isBuffer(t)||!h.isBuffer(r))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(t===r)return 0;let c=t.length,u=r.length;for(let f=0,p=Math.min(c,u);f<p;++f)if(t[f]!==r[f]){c=t[f],u=r[f];break}return c<u?-1:u<c?1:0},h.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},h.concat=function(t,r){if(!Array.isArray(t))throw new TypeError('"list" argument must be an Array of Buffers');if(t.length===0)return h.alloc(0);let c;if(r===void 0)for(r=0,c=0;c<t.length;++c)r+=t[c].length;const u=h.allocUnsafe(r);let f=0;for(c=0;c<t.length;++c){let p=t[c];if(se(p,l))f+p.length>u.length?(h.isBuffer(p)||(p=h.from(p)),p.copy(u,f)):l.prototype.set.call(u,p,f);else if(h.isBuffer(p))p.copy(u,f);else throw new TypeError('"list" argument must be an Array of Buffers');f+=p.length}return u};function pe(s,t){if(h.isBuffer(s))return s.length;if(d.isView(s)||se(s,d))return s.byteLength;if(typeof s!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof s);const r=s.length,c=arguments.length>2&&arguments[2]===!0;if(!c&&r===0)return 0;let u=!1;for(;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return nt(s).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return r*2;case"hex":return r>>>1;case"base64":return zt(s).length;default:if(u)return c?-1:nt(s).length;t=(""+t).toLowerCase(),u=!0}}h.byteLength=pe;function on(s,t,r){let c=!1;if((t===void 0||t<0)&&(t=0),t>this.length||((r===void 0||r>this.length)&&(r=this.length),r<=0)||(r>>>=0,t>>>=0,r<=t))return"";for(s||(s="utf8");;)switch(s){case"hex":return mn(this,t,r);case"utf8":case"utf-8":return Ot(this,t,r);case"ascii":return fn(this,t,r);case"latin1":case"binary":return pn(this,t,r);case"base64":return hn(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return gn(this,t,r);default:if(c)throw new TypeError("Unknown encoding: "+s);s=(s+"").toLowerCase(),c=!0}}h.prototype._isBuffer=!0;function me(s,t,r){const c=s[t];s[t]=s[r],s[r]=c}h.prototype.swap16=function(){const t=this.length;if(t%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let r=0;r<t;r+=2)me(this,r,r+1);return this},h.prototype.swap32=function(){const t=this.length;if(t%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let r=0;r<t;r+=4)me(this,r,r+3),me(this,r+1,r+2);return this},h.prototype.swap64=function(){const t=this.length;if(t%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let r=0;r<t;r+=8)me(this,r,r+7),me(this,r+1,r+6),me(this,r+2,r+5),me(this,r+3,r+4);return this},h.prototype.toString=function(){const t=this.length;return t===0?"":arguments.length===0?Ot(this,0,t):on.apply(this,arguments)},h.prototype.toLocaleString=h.prototype.toString,h.prototype.equals=function(t){if(!h.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t?!0:h.compare(this,t)===0},h.prototype.inspect=function(){let t="";const r=i.INSPECT_MAX_BYTES;return t=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(t+=" ... "),"<Buffer "+t+">"},o&&(h.prototype[o]=h.prototype.inspect),h.prototype.compare=function(t,r,c,u,f){if(se(t,l)&&(t=h.from(t,t.offset,t.byteLength)),!h.isBuffer(t))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof t);if(r===void 0&&(r=0),c===void 0&&(c=t?t.length:0),u===void 0&&(u=0),f===void 0&&(f=this.length),r<0||c>t.length||u<0||f>this.length)throw new RangeError("out of range index");if(u>=f&&r>=c)return 0;if(u>=f)return-1;if(r>=c)return 1;if(r>>>=0,c>>>=0,u>>>=0,f>>>=0,this===t)return 0;let p=f-u,k=c-r;const O=Math.min(p,k),N=this.slice(u,f),M=t.slice(r,c);for(let A=0;A<O;++A)if(N[A]!==M[A]){p=N[A],k=M[A];break}return p<k?-1:k<p?1:0};function Nt(s,t,r,c,u){if(s.length===0)return-1;if(typeof r=="string"?(c=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,it(r)&&(r=u?0:s.length-1),r<0&&(r=s.length+r),r>=s.length){if(u)return-1;r=s.length-1}else if(r<0)if(u)r=0;else return-1;if(typeof t=="string"&&(t=h.from(t,c)),h.isBuffer(t))return t.length===0?-1:Rt(s,t,r,c,u);if(typeof t=="number")return t=t&255,typeof l.prototype.indexOf=="function"?u?l.prototype.indexOf.call(s,t,r):l.prototype.lastIndexOf.call(s,t,r):Rt(s,[t],r,c,u);throw new TypeError("val must be string, number or Buffer")}function Rt(s,t,r,c,u){let f=1,p=s.length,k=t.length;if(c!==void 0&&(c=String(c).toLowerCase(),c==="ucs2"||c==="ucs-2"||c==="utf16le"||c==="utf-16le")){if(s.length<2||t.length<2)return-1;f=2,p/=2,k/=2,r/=2}function O(M,A){return f===1?M[A]:M.readUInt16BE(A*f)}let N;if(u){let M=-1;for(N=r;N<p;N++)if(O(s,N)===O(t,M===-1?0:N-M)){if(M===-1&&(M=N),N-M+1===k)return M*f}else M!==-1&&(N-=N-M),M=-1}else for(r+k>p&&(r=p-k),N=r;N>=0;N--){let M=!0;for(let A=0;A<k;A++)if(O(s,N+A)!==O(t,A)){M=!1;break}if(M)return N}return-1}h.prototype.includes=function(t,r,c){return this.indexOf(t,r,c)!==-1},h.prototype.indexOf=function(t,r,c){return Nt(this,t,r,c,!0)},h.prototype.lastIndexOf=function(t,r,c){return Nt(this,t,r,c,!1)};function sn(s,t,r,c){r=Number(r)||0;const u=s.length-r;c?(c=Number(c),c>u&&(c=u)):c=u;const f=t.length;c>f/2&&(c=f/2);let p;for(p=0;p<c;++p){const k=parseInt(t.substr(p*2,2),16);if(it(k))return p;s[r+p]=k}return p}function an(s,t,r,c){return qe(nt(t,s.length-r),s,r,c)}function cn(s,t,r,c){return qe(En(t),s,r,c)}function ln(s,t,r,c){return qe(zt(t),s,r,c)}function un(s,t,r,c){return qe(In(t,s.length-r),s,r,c)}h.prototype.write=function(t,r,c,u){if(r===void 0)u="utf8",c=this.length,r=0;else if(c===void 0&&typeof r=="string")u=r,c=this.length,r=0;else if(isFinite(r))r=r>>>0,isFinite(c)?(c=c>>>0,u===void 0&&(u="utf8")):(u=c,c=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const f=this.length-r;if((c===void 0||c>f)&&(c=f),t.length>0&&(c<0||r<0)||r>this.length)throw new RangeError("Attempt to write outside buffer bounds");u||(u="utf8");let p=!1;for(;;)switch(u){case"hex":return sn(this,t,r,c);case"utf8":case"utf-8":return an(this,t,r,c);case"ascii":case"latin1":case"binary":return cn(this,t,r,c);case"base64":return ln(this,t,r,c);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return un(this,t,r,c);default:if(p)throw new TypeError("Unknown encoding: "+u);u=(""+u).toLowerCase(),p=!0}},h.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function hn(s,t,r){return t===0&&r===s.length?e.fromByteArray(s):e.fromByteArray(s.slice(t,r))}function Ot(s,t,r){r=Math.min(s.length,r);const c=[];let u=t;for(;u<r;){const f=s[u];let p=null,k=f>239?4:f>223?3:f>191?2:1;if(u+k<=r){let O,N,M,A;switch(k){case 1:f<128&&(p=f);break;case 2:O=s[u+1],(O&192)===128&&(A=(f&31)<<6|O&63,A>127&&(p=A));break;case 3:O=s[u+1],N=s[u+2],(O&192)===128&&(N&192)===128&&(A=(f&15)<<12|(O&63)<<6|N&63,A>2047&&(A<55296||A>57343)&&(p=A));break;case 4:O=s[u+1],N=s[u+2],M=s[u+3],(O&192)===128&&(N&192)===128&&(M&192)===128&&(A=(f&15)<<18|(O&63)<<12|(N&63)<<6|M&63,A>65535&&A<1114112&&(p=A))}}p===null?(p=65533,k=1):p>65535&&(p-=65536,c.push(p>>>10&1023|55296),p=56320|p&1023),c.push(p),u+=k}return dn(c)}const Mt=4096;function dn(s){const t=s.length;if(t<=Mt)return String.fromCharCode.apply(String,s);let r="",c=0;for(;c<t;)r+=String.fromCharCode.apply(String,s.slice(c,c+=Mt));return r}function fn(s,t,r){let c="";r=Math.min(s.length,r);for(let u=t;u<r;++u)c+=String.fromCharCode(s[u]&127);return c}function pn(s,t,r){let c="";r=Math.min(s.length,r);for(let u=t;u<r;++u)c+=String.fromCharCode(s[u]);return c}function mn(s,t,r){const c=s.length;(!t||t<0)&&(t=0),(!r||r<0||r>c)&&(r=c);let u="";for(let f=t;f<r;++f)u+=Cn[s[f]];return u}function gn(s,t,r){const c=s.slice(t,r);let u="";for(let f=0;f<c.length-1;f+=2)u+=String.fromCharCode(c[f]+c[f+1]*256);return u}h.prototype.slice=function(t,r){const c=this.length;t=~~t,r=r===void 0?c:~~r,t<0?(t+=c,t<0&&(t=0)):t>c&&(t=c),r<0?(r+=c,r<0&&(r=0)):r>c&&(r=c),r<t&&(r=t);const u=this.subarray(t,r);return Object.setPrototypeOf(u,h.prototype),u};function V(s,t,r){if(s%1!==0||s<0)throw new RangeError("offset is not uint");if(s+t>r)throw new RangeError("Trying to access beyond buffer length")}h.prototype.readUintLE=h.prototype.readUIntLE=function(t,r,c){t=t>>>0,r=r>>>0,c||V(t,r,this.length);let u=this[t],f=1,p=0;for(;++p<r&&(f*=256);)u+=this[t+p]*f;return u},h.prototype.readUintBE=h.prototype.readUIntBE=function(t,r,c){t=t>>>0,r=r>>>0,c||V(t,r,this.length);let u=this[t+--r],f=1;for(;r>0&&(f*=256);)u+=this[t+--r]*f;return u},h.prototype.readUint8=h.prototype.readUInt8=function(t,r){return t=t>>>0,r||V(t,1,this.length),this[t]},h.prototype.readUint16LE=h.prototype.readUInt16LE=function(t,r){return t=t>>>0,r||V(t,2,this.length),this[t]|this[t+1]<<8},h.prototype.readUint16BE=h.prototype.readUInt16BE=function(t,r){return t=t>>>0,r||V(t,2,this.length),this[t]<<8|this[t+1]},h.prototype.readUint32LE=h.prototype.readUInt32LE=function(t,r){return t=t>>>0,r||V(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+this[t+3]*16777216},h.prototype.readUint32BE=h.prototype.readUInt32BE=function(t,r){return t=t>>>0,r||V(t,4,this.length),this[t]*16777216+(this[t+1]<<16|this[t+2]<<8|this[t+3])},h.prototype.readBigUInt64LE=de(function(t){t=t>>>0,Ce(t,"offset");const r=this[t],c=this[t+7];(r===void 0||c===void 0)&&Be(t,this.length-8);const u=r+this[++t]*v(2,8)+this[++t]*v(2,16)+this[++t]*v(2,24),f=this[++t]+this[++t]*v(2,8)+this[++t]*v(2,16)+c*v(2,24);return BigInt(u)+(BigInt(f)<<BigInt(32))}),h.prototype.readBigUInt64BE=de(function(t){t=t>>>0,Ce(t,"offset");const r=this[t],c=this[t+7];(r===void 0||c===void 0)&&Be(t,this.length-8);const u=r*v(2,24)+this[++t]*v(2,16)+this[++t]*v(2,8)+this[++t],f=this[++t]*v(2,24)+this[++t]*v(2,16)+this[++t]*v(2,8)+c;return(BigInt(u)<<BigInt(32))+BigInt(f)}),h.prototype.readIntLE=function(t,r,c){t=t>>>0,r=r>>>0,c||V(t,r,this.length);let u=this[t],f=1,p=0;for(;++p<r&&(f*=256);)u+=this[t+p]*f;return f*=128,u>=f&&(u-=Math.pow(2,8*r)),u},h.prototype.readIntBE=function(t,r,c){t=t>>>0,r=r>>>0,c||V(t,r,this.length);let u=r,f=1,p=this[t+--u];for(;u>0&&(f*=256);)p+=this[t+--u]*f;return f*=128,p>=f&&(p-=Math.pow(2,8*r)),p},h.prototype.readInt8=function(t,r){return t=t>>>0,r||V(t,1,this.length),this[t]&128?(255-this[t]+1)*-1:this[t]},h.prototype.readInt16LE=function(t,r){t=t>>>0,r||V(t,2,this.length);const c=this[t]|this[t+1]<<8;return c&32768?c|4294901760:c},h.prototype.readInt16BE=function(t,r){t=t>>>0,r||V(t,2,this.length);const c=this[t+1]|this[t]<<8;return c&32768?c|4294901760:c},h.prototype.readInt32LE=function(t,r){return t=t>>>0,r||V(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},h.prototype.readInt32BE=function(t,r){return t=t>>>0,r||V(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},h.prototype.readBigInt64LE=de(function(t){t=t>>>0,Ce(t,"offset");const r=this[t],c=this[t+7];(r===void 0||c===void 0)&&Be(t,this.length-8);const u=this[t+4]+this[t+5]*v(2,8)+this[t+6]*v(2,16)+(c<<24);return(BigInt(u)<<BigInt(32))+BigInt(r+this[++t]*v(2,8)+this[++t]*v(2,16)+this[++t]*v(2,24))}),h.prototype.readBigInt64BE=de(function(t){t=t>>>0,Ce(t,"offset");const r=this[t],c=this[t+7];(r===void 0||c===void 0)&&Be(t,this.length-8);const u=(r<<24)+this[++t]*v(2,16)+this[++t]*v(2,8)+this[++t];return(BigInt(u)<<BigInt(32))+BigInt(this[++t]*v(2,24)+this[++t]*v(2,16)+this[++t]*v(2,8)+c)}),h.prototype.readFloatLE=function(t,r){return t=t>>>0,r||V(t,4,this.length),n.read(this,t,!0,23,4)},h.prototype.readFloatBE=function(t,r){return t=t>>>0,r||V(t,4,this.length),n.read(this,t,!1,23,4)},h.prototype.readDoubleLE=function(t,r){return t=t>>>0,r||V(t,8,this.length),n.read(this,t,!0,52,8)},h.prototype.readDoubleBE=function(t,r){return t=t>>>0,r||V(t,8,this.length),n.read(this,t,!1,52,8)};function W(s,t,r,c,u,f){if(!h.isBuffer(s))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>u||t<f)throw new RangeError('"value" argument is out of bounds');if(r+c>s.length)throw new RangeError("Index out of range")}h.prototype.writeUintLE=h.prototype.writeUIntLE=function(t,r,c,u){if(t=+t,r=r>>>0,c=c>>>0,!u){const k=Math.pow(2,8*c)-1;W(this,t,r,c,k,0)}let f=1,p=0;for(this[r]=t&255;++p<c&&(f*=256);)this[r+p]=t/f&255;return r+c},h.prototype.writeUintBE=h.prototype.writeUIntBE=function(t,r,c,u){if(t=+t,r=r>>>0,c=c>>>0,!u){const k=Math.pow(2,8*c)-1;W(this,t,r,c,k,0)}let f=c-1,p=1;for(this[r+f]=t&255;--f>=0&&(p*=256);)this[r+f]=t/p&255;return r+c},h.prototype.writeUint8=h.prototype.writeUInt8=function(t,r,c){return t=+t,r=r>>>0,c||W(this,t,r,1,255,0),this[r]=t&255,r+1},h.prototype.writeUint16LE=h.prototype.writeUInt16LE=function(t,r,c){return t=+t,r=r>>>0,c||W(this,t,r,2,65535,0),this[r]=t&255,this[r+1]=t>>>8,r+2},h.prototype.writeUint16BE=h.prototype.writeUInt16BE=function(t,r,c){return t=+t,r=r>>>0,c||W(this,t,r,2,65535,0),this[r]=t>>>8,this[r+1]=t&255,r+2},h.prototype.writeUint32LE=h.prototype.writeUInt32LE=function(t,r,c){return t=+t,r=r>>>0,c||W(this,t,r,4,4294967295,0),this[r+3]=t>>>24,this[r+2]=t>>>16,this[r+1]=t>>>8,this[r]=t&255,r+4},h.prototype.writeUint32BE=h.prototype.writeUInt32BE=function(t,r,c){return t=+t,r=r>>>0,c||W(this,t,r,4,4294967295,0),this[r]=t>>>24,this[r+1]=t>>>16,this[r+2]=t>>>8,this[r+3]=t&255,r+4};function Dt(s,t,r,c,u){jt(t,c,u,s,r,7);let f=Number(t&BigInt(4294967295));s[r++]=f,f=f>>8,s[r++]=f,f=f>>8,s[r++]=f,f=f>>8,s[r++]=f;let p=Number(t>>BigInt(32)&BigInt(4294967295));return s[r++]=p,p=p>>8,s[r++]=p,p=p>>8,s[r++]=p,p=p>>8,s[r++]=p,r}function $t(s,t,r,c,u){jt(t,c,u,s,r,7);let f=Number(t&BigInt(4294967295));s[r+7]=f,f=f>>8,s[r+6]=f,f=f>>8,s[r+5]=f,f=f>>8,s[r+4]=f;let p=Number(t>>BigInt(32)&BigInt(4294967295));return s[r+3]=p,p=p>>8,s[r+2]=p,p=p>>8,s[r+1]=p,p=p>>8,s[r]=p,r+8}h.prototype.writeBigUInt64LE=de(function(t,r=0){return Dt(this,t,r,BigInt(0),BigInt("0xffffffffffffffff"))}),h.prototype.writeBigUInt64BE=de(function(t,r=0){return $t(this,t,r,BigInt(0),BigInt("0xffffffffffffffff"))}),h.prototype.writeIntLE=function(t,r,c,u){if(t=+t,r=r>>>0,!u){const O=Math.pow(2,8*c-1);W(this,t,r,c,O-1,-O)}let f=0,p=1,k=0;for(this[r]=t&255;++f<c&&(p*=256);)t<0&&k===0&&this[r+f-1]!==0&&(k=1),this[r+f]=(t/p>>0)-k&255;return r+c},h.prototype.writeIntBE=function(t,r,c,u){if(t=+t,r=r>>>0,!u){const O=Math.pow(2,8*c-1);W(this,t,r,c,O-1,-O)}let f=c-1,p=1,k=0;for(this[r+f]=t&255;--f>=0&&(p*=256);)t<0&&k===0&&this[r+f+1]!==0&&(k=1),this[r+f]=(t/p>>0)-k&255;return r+c},h.prototype.writeInt8=function(t,r,c){return t=+t,r=r>>>0,c||W(this,t,r,1,127,-128),t<0&&(t=255+t+1),this[r]=t&255,r+1},h.prototype.writeInt16LE=function(t,r,c){return t=+t,r=r>>>0,c||W(this,t,r,2,32767,-32768),this[r]=t&255,this[r+1]=t>>>8,r+2},h.prototype.writeInt16BE=function(t,r,c){return t=+t,r=r>>>0,c||W(this,t,r,2,32767,-32768),this[r]=t>>>8,this[r+1]=t&255,r+2},h.prototype.writeInt32LE=function(t,r,c){return t=+t,r=r>>>0,c||W(this,t,r,4,2147483647,-2147483648),this[r]=t&255,this[r+1]=t>>>8,this[r+2]=t>>>16,this[r+3]=t>>>24,r+4},h.prototype.writeInt32BE=function(t,r,c){return t=+t,r=r>>>0,c||W(this,t,r,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),this[r]=t>>>24,this[r+1]=t>>>16,this[r+2]=t>>>8,this[r+3]=t&255,r+4},h.prototype.writeBigInt64LE=de(function(t,r=0){return Dt(this,t,r,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),h.prototype.writeBigInt64BE=de(function(t,r=0){return $t(this,t,r,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function Ht(s,t,r,c,u,f){if(r+c>s.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function Vt(s,t,r,c,u){return t=+t,r=r>>>0,u||Ht(s,t,r,4),n.write(s,t,r,c,23,4),r+4}h.prototype.writeFloatLE=function(t,r,c){return Vt(this,t,r,!0,c)},h.prototype.writeFloatBE=function(t,r,c){return Vt(this,t,r,!1,c)};function qt(s,t,r,c,u){return t=+t,r=r>>>0,u||Ht(s,t,r,8),n.write(s,t,r,c,52,8),r+8}h.prototype.writeDoubleLE=function(t,r,c){return qt(this,t,r,!0,c)},h.prototype.writeDoubleBE=function(t,r,c){return qt(this,t,r,!1,c)},h.prototype.copy=function(t,r,c,u){if(!h.isBuffer(t))throw new TypeError("argument should be a Buffer");if(c||(c=0),!u&&u!==0&&(u=this.length),r>=t.length&&(r=t.length),r||(r=0),u>0&&u<c&&(u=c),u===c||t.length===0||this.length===0)return 0;if(r<0)throw new RangeError("targetStart out of bounds");if(c<0||c>=this.length)throw new RangeError("Index out of range");if(u<0)throw new RangeError("sourceEnd out of bounds");u>this.length&&(u=this.length),t.length-r<u-c&&(u=t.length-r+c);const f=u-c;return this===t&&typeof l.prototype.copyWithin=="function"?this.copyWithin(r,c,u):l.prototype.set.call(t,this.subarray(c,u),r),f},h.prototype.fill=function(t,r,c,u){if(typeof t=="string"){if(typeof r=="string"?(u=r,r=0,c=this.length):typeof c=="string"&&(u=c,c=this.length),u!==void 0&&typeof u!="string")throw new TypeError("encoding must be a string");if(typeof u=="string"&&!h.isEncoding(u))throw new TypeError("Unknown encoding: "+u);if(t.length===1){const p=t.charCodeAt(0);(u==="utf8"&&p<128||u==="latin1")&&(t=p)}}else typeof t=="number"?t=t&255:typeof t=="boolean"&&(t=Number(t));if(r<0||this.length<r||this.length<c)throw new RangeError("Out of range index");if(c<=r)return this;r=r>>>0,c=c===void 0?this.length:c>>>0,t||(t=0);let f;if(typeof t=="number")for(f=r;f<c;++f)this[f]=t;else{const p=h.isBuffer(t)?t:h.from(t,u),k=p.length;if(k===0)throw new TypeError('The value "'+t+'" is invalid for argument "value"');for(f=0;f<c-r;++f)this[f+r]=p[f%k]}return this};const Ie={};function rt(s,t,r){Ie[s]=class extends r{constructor(){super(),Object.defineProperty(this,"message",{value:t.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${s}]`,this.stack,delete this.name}get code(){return s}set code(u){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:u,writable:!0})}toString(){return`${this.name} [${s}]: ${this.message}`}}}rt("ERR_BUFFER_OUT_OF_BOUNDS",function(s){return s?`${s} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),rt("ERR_INVALID_ARG_TYPE",function(s,t){return`The "${s}" argument must be of type number. Received type ${typeof t}`},TypeError),rt("ERR_OUT_OF_RANGE",function(s,t,r){let c=`The value of "${s}" is out of range.`,u=r;return Number.isInteger(r)&&Math.abs(r)>v(2,32)?u=Gt(String(r)):typeof r=="bigint"&&(u=String(r),(r>v(BigInt(2),BigInt(32))||r<-v(BigInt(2),BigInt(32)))&&(u=Gt(u)),u+="n"),c+=` It must be ${t}. Received ${u}`,c},RangeError);function Gt(s){let t="",r=s.length;const c=s[0]==="-"?1:0;for(;r>=c+4;r-=3)t=`_${s.slice(r-3,r)}${t}`;return`${s.slice(0,r)}${t}`}function wn(s,t,r){Ce(t,"offset"),(s[t]===void 0||s[t+r]===void 0)&&Be(t,s.length-(r+1))}function jt(s,t,r,c,u,f){if(s>r||s<t){const p=typeof t=="bigint"?"n":"";let k;throw t===0||t===BigInt(0)?k=`>= 0${p} and < 2${p} ** ${(f+1)*8}${p}`:k=`>= -(2${p} ** ${(f+1)*8-1}${p}) and < 2 ** ${(f+1)*8-1}${p}`,new Ie.ERR_OUT_OF_RANGE("value",k,s)}wn(c,u,f)}function Ce(s,t){if(typeof s!="number")throw new Ie.ERR_INVALID_ARG_TYPE(t,"number",s)}function Be(s,t,r){throw Math.floor(s)!==s?(Ce(s,r),new Ie.ERR_OUT_OF_RANGE("offset","an integer",s)):t<0?new Ie.ERR_BUFFER_OUT_OF_BOUNDS:new Ie.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${t}`,s)}const yn=/[^+/0-9A-Za-z-_]/g;function xn(s){if(s=s.split("=")[0],s=s.trim().replace(yn,""),s.length<2)return"";for(;s.length%4!==0;)s=s+"=";return s}function nt(s,t){t=t||1/0;let r;const c=s.length;let u=null;const f=[];for(let p=0;p<c;++p){if(r=s.charCodeAt(p),r>55295&&r<57344){if(!u){if(r>56319){(t-=3)>-1&&f.push(239,191,189);continue}else if(p+1===c){(t-=3)>-1&&f.push(239,191,189);continue}u=r;continue}if(r<56320){(t-=3)>-1&&f.push(239,191,189),u=r;continue}r=(u-55296<<10|r-56320)+65536}else u&&(t-=3)>-1&&f.push(239,191,189);if(u=null,r<128){if((t-=1)<0)break;f.push(r)}else if(r<2048){if((t-=2)<0)break;f.push(r>>6|192,r&63|128)}else if(r<65536){if((t-=3)<0)break;f.push(r>>12|224,r>>6&63|128,r&63|128)}else if(r<1114112){if((t-=4)<0)break;f.push(r>>18|240,r>>12&63|128,r>>6&63|128,r&63|128)}else throw new Error("Invalid code point")}return f}function En(s){const t=[];for(let r=0;r<s.length;++r)t.push(s.charCodeAt(r)&255);return t}function In(s,t){let r,c,u;const f=[];for(let p=0;p<s.length&&!((t-=2)<0);++p)r=s.charCodeAt(p),c=r>>8,u=r%256,f.push(u),f.push(c);return f}function zt(s){return e.toByteArray(xn(s))}function qe(s,t,r,c){let u;for(u=0;u<c&&!(u+r>=t.length||u>=s.length);++u)t[u+r]=s[u];return u}function se(s,t){return s instanceof t||s!=null&&s.constructor!=null&&s.constructor.name!=null&&s.constructor.name===t.name}function it(s){return s!==s}const Cn=function(){const s="0123456789abcdef",t=new Array(256);for(let r=0;r<16;++r){const c=r*16;for(let u=0;u<16;++u)t[c+u]=s[r]+s[u]}return t}();function de(s){return typeof BigInt=="undefined"?bn:s}function bn(){throw new Error("BigInt not supported")}})(Ct);const Oe=Ct.Buffer,Ze=typeof Oe=="function",St=typeof TextDecoder=="function"?new TextDecoder:void 0;typeof TextEncoder=="function"&&new TextEncoder;const Mr=Array.prototype.slice.call("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="),Me=(i=>{let e={};return i.forEach((n,o)=>e[n]=o),e})(Mr),Dr=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,fe=String.fromCharCode.bind(String),_t=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):i=>new Uint8Array(Array.prototype.slice.call(i,0)),kt=i=>i.replace(/[^A-Za-z0-9\+\/]/g,""),$r=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,Hr=i=>{switch(i.length){case 4:var e=(7&i.charCodeAt(0))<<18|(63&i.charCodeAt(1))<<12|(63&i.charCodeAt(2))<<6|63&i.charCodeAt(3),n=e-65536;return fe((n>>>10)+55296)+fe((n&1023)+56320);case 3:return fe((15&i.charCodeAt(0))<<12|(63&i.charCodeAt(1))<<6|63&i.charCodeAt(2));default:return fe((31&i.charCodeAt(0))<<6|63&i.charCodeAt(1))}},Vr=i=>i.replace($r,Hr),Bt=typeof atob=="function"?i=>atob(kt(i)):Ze?i=>Oe.from(i,"base64").toString("binary"):i=>{if(i=i.replace(/\s+/g,""),!Dr.test(i))throw new TypeError("malformed base64.");i+="==".slice(2-(i.length&3));let e,n="",o,a;for(let l=0;l<i.length;)e=Me[i.charAt(l++)]<<18|Me[i.charAt(l++)]<<12|(o=Me[i.charAt(l++)])<<6|(a=Me[i.charAt(l++)]),n+=o===64?fe(e>>16&255):a===64?fe(e>>16&255,e>>8&255):fe(e>>16&255,e>>8&255,e&255);return n},qr=Ze?i=>_t(Oe.from(i,"base64")):i=>_t(Bt(i).split("").map(e=>e.charCodeAt(0))),Gr=Ze?i=>Oe.from(i,"base64").toString("utf8"):St?i=>St.decode(qr(i)):i=>Vr(Bt(i)),jr=i=>kt(i.replace(/[-_]/g,e=>e=="-"?"+":"/")),zr=i=>Gr(jr(i)),Xr=(i,e="xterioauth")=>i.split(" ").reduce((o,a)=>o+`${e}-${a} `,""),Kr=(i,e)=>{const n=e.split(" ").filter(Boolean);if(i.classList)n.forEach(o=>{i.classList.add(o)});else{const o=i.className.split(" ");n.forEach(a=>{o.indexOf(a)===-1&&o.push(a)}),i.className=o.join(" ")}},Yr=(...i)=>{let e="";for(let n=0;n<Math.floor(i.length/2);n++){const o=i[n*2].replace(/[A-Z]/g,l=>`-${l.toLowerCase()}`),a=i[n*2+1];e+=`${o}: ${a};`}return e},Tt=(i,...e)=>{e.length===1&&typeof(e==null?void 0:e[0])=="string"&&(e==null?void 0:e[0].indexOf(":"))!==-1?i.style.cssText=i.style.cssText+(e==null?void 0:e[0]):i.style.cssText=i.style.cssText+Yr(...e)},Wr=i=>{const e=[];for(const n in i)e.push(n,i[n]);return e},De=(i,e,n="div")=>{const o=document.createElement(n);if(Kr(o,Xr(i)),e){const a=l=>{e==null||e()};return o.addEventListener("click",a),{element:o,remove:()=>{o.removeEventListener("click",a)}}}return{element:o}},Ft=i=>{const{element:e}=De("modal-shadow"),{element:n,remove:o}=De("modal-bg pointer",()=>{o==null||o(),e.remove()}),{element:a}=De("modal-container-iframe");e.appendChild(n),e.appendChild(a);const l=document.createElement("iframe");return l.width="100%",l.height="100%",l.frameBorder="0",l.src=i,a.appendChild(l),{shadow:e,iframe:l,iframeDiv:a}},Lt=()=>I(this,null,function*(){return le.isLogin&&(yield H.getOtacByTokens())||""}),Jr=(i,e,n)=>I(this,null,function*(){var te,Ve;const ee=n||{},{active:o="ingame",tab:a="account",keyword:l,collection:d,features:m,alertConfig:g}=ee,w=Wt(ee,["active","tab","keyword","collection","features","alertConfig"]),h=e||$.alert,E=((te=x.config)==null?void 0:te.app_id)||"";if(!E)throw new Error("You must set xterio-auth app_id");const{asset:F,settings:_,marketplace:R,collection:S}=x.pageUriMap||{},P=x.pageURL;let L="",B={};if(i===ae.asset&&F?(B={app_id:E,active:o},L=`${P}${F}`):i===ae.setting&&_?(B={tab:a},L=`${P}${_}`):i===ae.nft_market&&R?(B={app_id:E},d&&(B=q(T({},B),{collection:d})),l&&(B=q(T({},B),{keyword:encodeURIComponent(l)})),m&&(B=q(T({},B),{features:encodeURIComponent(JSON.stringify(m))})),L=`${P}${R}`):i===ae.nft_collection&&d&&S&&(m&&(B={features:encodeURIComponent(JSON.stringify(m))}),L=`${P}${S}`.replace("{app_id}",E).replace("{collection_id}",d)),L){B=T(T({},B),w);const pe=yield Lt();pe&&(B=q(T({},B),{_otac:pe})),(Ve=Object.keys(B))!=null&&Ve.length&&(L+=(L.includes("?")?"&":"?")+we.stringify(B))}if(C.debug("open xerio page uri:",L),h===$.iframeUri)return L;if(h===$.iframeDom){const{iframe:pe}=Ft(L);return pe}if(h===$.page&&window.open(L,"_blank"),h===$.alert){Zr(L,g);return}}),Zr=(i,e)=>{const{placement:n="right",style:o={width:"100%",height:"100%"},showCloseIcon:a=!0}=e||{},{iframeDiv:l,shadow:d}=Ft(i);if(a){const{element:g,remove:w}=De("close-icon pointer",()=>{d.remove(),w==null||w()});Tt(g,"position:absolute;top:16px;left:16px;"),g.innerHTML=Pe["icon-close-iframe"],l.appendChild(g)}document.body.appendChild(d);const m=[];m.push("margin-top",`calc((100% - ${o.height}) / 2)`),n==="right"?m.push("margin-left",`calc(100% - ${o.width})`):n==="center"&&m.push("margin-left",`calc((100% - ${o.width}) / 2)`),m.push(...Wr(o)),Tt(l,...m)},xe=class xe{constructor(){}static getInstance(){const e=this.name;return xe.instances[e]||(xe.instances[e]=new this),xe.instances[e]}};xe.instances={};let $e=xe;class Qr extends $e{addTimeout(e,n){this.removeTimeout(),C.debug("the timer init"),this._timer=setTimeout(()=>{e()},n)}removeTimeout(){this._timer&&(C.debug("the timer clear"),clearTimeout(this._timer))}}class en extends $e{constructor(){super(...arguments),this.isLoading=!1}execute(e){return I(this,null,function*(){if(!this.isLoading){this.isLoading=!0;try{yield e()}finally{this.isLoading=!1}}})}}const Ee=class Ee{static get userinfo(){return Ke.userInfo}static setTokenTimer(e){e<0||Qr.getInstance().addTimeout(()=>{this.setIsLogin(!1),j.removeIdToken(),C.info("the token timer, refresh token auto"),this.checkToken("tokenTimer")},e)}static get isVaildIdToken(){var o;const e=j.idToken;if(!e)return C.error("invalid token: idtoken null"),!1;const n=(o=e.split("."))==null?void 0:o[1];if(!n)return C.error("invalid token: idtoken error"),!1;try{const{aud:a,exp:l=0,sub:d}=JSON.parse(zr(n));return this.setTokenTimer((l-60)*1e3-Date.now()),!(!a||Date.now()>(l-60)*1e3)}catch(a){return C.error("invalid token: idtoken error"),!1}}static get isLogin(){return this._islogin}static setIsLogin(e){C.debug("set xterio auth islogin=",e),this._islogin=e}static checkToken(e="init"){return I(this,null,function*(){j.setTokens(z.tokens);const n=j.refreshToken;let o=this.isVaildIdToken;if(!o&&n){C.info("check token and refresh tokens");const a=yield H.refreshTokenService(n);j.setTokens({refresh_token:n,id_token:a.id_token,access_token:a.access_token}),o=this.isVaildIdToken}return C.info("check token and the idToken isvalid=",o),this.setIsLogin(o),o?e==="init"&&(yield H.getUserInfo()):(C.info("clear cache data"),this.clearData()),j.idToken||""})}static getCode(){var l,d;const e=z.loginType;if(C.debug("check authorize status and _type=",e),e!==U.Default&&e!==U.Email)return"";const n=(l=x.config)==null?void 0:l.redirect_uri;if(!n||!location.href.startsWith(n))return C.error("not check, different redirect_uri"),"";const o=we.parseUrl(location.href);let a=(d=o.query)==null?void 0:d.code;if(Array.isArray(a)&&(a=a==null?void 0:a[0]),a){C.debug("code=",a),delete o.query.code;const m=we.stringify(o.query),g=o.url+(m?"?"+m:"");history.pushState(null,"",g)}else return C.error("no authorize"),"";return a}static codeLogin(e){return I(this,null,function*(){C.debug("going to code login ...");const n=yield H.login(e);n!=null&&n.uuid&&z.delete(G.LOGIN_TYPE)})}static getIdToken(){return I(this,null,function*(){return yield this.checkToken("getIdToken")})}static init(e,n){return I(this,null,function*(){const o=n!=null?n:b.Dev,{app_id:a="",client_id:l="",client_secret:d="",redirect_uri:m="",mode:g="default",logout:w=o===b.Dev?"0":"1",logLevel:h=1}=e;sr(h);const E=K[o].API_BASE,F={app_id:a,client_id:l,client_secret:d,redirect_uri:m,response_type:"code",scope:"all",mode:g,grant_type:"authorization_code",logout:w};x.app_id=a,x.client_id=l,x.env=o,x.baseURL=E,x.pageURL=K[o].PAGE_BASE,Y.init({apiUrl:E,env:o}),C.debug(Y.instance);const{response_type:_,scope:R}=F;x.authorizeUrl=E+"/account/v1/oauth2/authorize?"+we.stringify({client_id:l,redirect_uri:m,response_type:_,scope:R,mode:g,logout:w}),x.config=F,x.PageUriApi=K[o].PAGES_URI_API;const S=yield H.getPageUrlMap();x.pageUriMap=S.pages,x.pageURL=S.domain?`https://${S.domain}`:K[o].PAGE_BASE,C.debug("auth initial"),re.subscribe(L=>{C.debug("the userinfo callback count=",x.onAccount.length),x.onAccount.map(B=>B(L))}),re.subscribe(()=>I(this,null,function*(){en.getInstance().execute(()=>I(this,null,function*(){C.debug("req 401, refresh token"),this.setIsLogin(!1),j.removeIdToken(),re.emit(ue.LOGOUT),yield this.checkToken()}))}),ue.Expired);const P=this.getCode();P?yield this.codeLogin(P):yield this.checkToken()})}static clearData(){j.removeTokens(),Ke.removeUserInfo()}static logout(){var e,n;C.debug("logout success"),this.clearData(),this.setIsLogin(!1),re.emit(ue.LOGOUT),(n=(e=Y==null?void 0:Y.instance)==null?void 0:e.store)==null||n.removeUserState()}static login(e){return I(this,null,function*(){if(!x.config){C.error("xterio auth sdk initial failed");return}if(e&&e!==U.Mini){x.config=q(T({},x.config),{mode:e});const{response_type:n,scope:o,logout:a,client_id:l,redirect_uri:d}=x.config;x.authorizeUrl=x.baseURL+"/account/v1/oauth2/authorize?"+we.stringify({client_id:l,redirect_uri:d,response_type:n,scope:o,mode:e,logout:a})}if(this.isLogin)return C.debug("get userinfo"),H.getUserInfo();if(e===U.Mini){Y.instance.open();return}z.loginType=e||U.Default,C.debug("going to authorize ..."),location.href=x.authorizeUrl})}static getUserInfo(e){x.onAccount.push(e),Ee.userinfo&&e(Ee.userinfo)}};Ee.openPage=Jr,Ee.getOtac=Lt;let le=Ee;const tn=({onLoginStateChange:i})=>{const e=Y.instance;function n(){e.open()}function o(){e.store.logout()}return e.store.subscribe(()=>{i==null||i(e.store.userState.isLogin,e.store.userState.userInfo)}),{open:n,logout:o}},rn={[b.Dev]:{defaultTopupUrl:`${(Ut=K[b.Dev])==null?void 0:Ut.PAGE_BASE}/game-token-topup`,fiatTopupUrl:`${(At=K[b.Dev])==null?void 0:At.PAGE_BASE}}/game-asset-merchant`},[b.Staging]:{defaultTopupUrl:"http://localhost:3000/game-token-topup",fiatTopupUrl:"http://localhost:3000/game-asset-merchant"},[b.Production]:{defaultTopupUrl:`${(vt=K[b.Production])==null?void 0:vt.PAGE_BASE}/game-token-topup`,fiatTopupUrl:`${(Pt=K[b.Production])==null?void 0:Pt.PAGE_BASE}/game-asset-merchant`}};var Qe=(i=>(i.Default="default",i.Fiat="fiat",i))(Qe||{}),et=(i=>(i.Closed="PAYMENT_MODAL_CLOSED",i.SuccessClosed="PAYMENT_MODAL_SUCCESS_CLOSED",i))(et||{});class nn{constructor(e,n){this.container=null,this.iframe=null,this.handleMessage=o=>{var a,l,d,m;if(console.log(this.TopupUrlConfig.defaultTopupUrl,"urll"),o.origin===new URL(this.TopupUrlConfig.defaultTopupUrl).origin){const{type:g,data:w}=o.data;switch(g){case et.Closed:(l=(a=this.config).onClose)==null||l.call(a,o.data),this.destroy();break;case et.SuccessClosed:(m=(d=this.config).onSuccessClose)==null||m.call(d,o.data),this.destroy();break}}},this.config=q(T({},e),{env:e.env||b.Dev}),this.TopupUrlConfig=n||rn[this.config.env],this.setupMessageListener()}setupMessageListener(){window.addEventListener("message",this.handleMessage)}close(){var e,n;this.container&&(this.container.innerHTML=""),this.iframe=null,this.container=null,window.removeEventListener("message",this.handleMessage),(n=(e=this.config).onClose)==null||n.call(e)}destroy(){this.close()}openPay(o){return I(this,arguments,function*(e,n=Qe.Default){if(this.container=this.getContainer(e),this.container.style.position="relative",this.container.innerHTML="",!le.isLogin){this.container.appendChild(this.renderNotLoginElement());return}const a=this.renderLoadingElement();this.container.appendChild(a),yield this.renderTopupIframe(n,()=>{var l,d,m;a.parentNode===this.container&&((l=this.container)==null||l.removeChild(a)),this.iframe&&(this.iframe.style.opacity="1"),(m=(d=this.config).onLoad)==null||m.call(d)})})}getContainer(e){if(typeof e=="string"){const n=document.querySelector(e);if(!n)throw new Error(`Container not found: ${e}`);return n}return e}getIframeSrc(e){return I(this,null,function*(){const n=e==="default"?this.TopupUrlConfig.defaultTopupUrl:this.TopupUrlConfig.fiatTopupUrl;let o="";if(this.config.getOtac)try{o=yield this.config.getOtac()}catch(l){throw console.error("Failed to get OTAC:",l),new Error("Failed to get OTAC")}else o=yield H.getOtacByTokens();const a=new URLSearchParams({asset_id:this.config.assetId,game_id:this.config.gameId,sku_id:this.config.skuId,hide_header:String(!!this.config.hideHeader),hide_footer:String(!!this.config.hideFooter),show_modal:String(!!this.config.showModal),_otac:o,env:this.config.env});return`${n}?${a.toString()}`})}renderTopupIframe(e,n){return I(this,null,function*(){var o;try{this.iframe=document.createElement("iframe"),this.iframe.className="xa-topup-main-iframe",this.iframe.style.width=typeof this.config.width=="number"?`${this.config.width}px`:this.config.width||"100%",this.iframe.style.height=typeof this.config.height=="number"?`${this.config.height}px`:this.config.height||"100%",this.iframe.allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",this.iframe.allowFullscreen=!0,this.config.sandbox&&this.iframe.sandbox.add("allow-forms","allow-modals","allow-pointer-lock","allow-popups","allow-same-origin","allow-scripts","allow-top-navigation-by-user-activation","allow-downloads","allow-presentation"),this.iframe.onload=()=>{n()},this.iframe.src=yield this.getIframeSrc(e),(o=this.container)==null||o.appendChild(this.iframe)}catch(a){throw console.error("Failed to open payment:",a),this.renderError(),a}})}renderLoadingElement(){const e=document.createElement("div");return e.className="xa-topup-loading-container",e.innerHTML='<div class="xa-topup-loading-spinner"></div>',e}renderNotLoginElement(){const e=document.createElement("div");return e.className="xa-topup-empty",e.textContent="Not Login yet",e}renderError(){if(this.container){this.container.innerHTML="";const e=document.createElement("div");e.className="xa-toup-error-container",e.textContent="Failed to load payment page",this.container.appendChild(e)}}}y.Env=b,y.LoginType=U,y.OpenPageMode=$,y.PageType=ae,y.XTERIO_CONST=G,y.XTERIO_EVENTS=ue,y.XterAuthModal=Y,y.XterEventEmiter=re,y.XterTopup=nn,y.XterTopupMethod=Qe,y.XterioAuth=le,y.XterioAuthService=H,y.XterioAuthTokensManager=j,y.deleteFetcher=hr,y.getFetcher=ve,y.postFetcher=ne,y.putFetcher=dr,y.useXterLoginModal=tn,Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})});/*! XterioAuth v0.0.14 */
//# sourceMappingURL=index.min.js.map
