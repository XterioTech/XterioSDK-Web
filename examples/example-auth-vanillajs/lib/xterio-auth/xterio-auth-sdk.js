(function(c,C){typeof exports=="object"&&typeof module!="undefined"?C(exports):typeof define=="function"&&define.amd?define(["exports"],C):(c=typeof globalThis!="undefined"?globalThis:c||self,C(c.XterioAuth={}))})(this,function(c){"use strict";var Xt=Object.defineProperty,Kt=Object.defineProperties;var Gt=Object.getOwnPropertyDescriptors;var nt=Object.getOwnPropertySymbols;var Wt=Object.prototype.hasOwnProperty,Zt=Object.prototype.propertyIsEnumerable;var ot=(c,C,x)=>C in c?Xt(c,C,{enumerable:!0,configurable:!0,writable:!0,value:x}):c[C]=x,b=(c,C)=>{for(var x in C||(C={}))Wt.call(C,x)&&ot(c,x,C[x]);if(nt)for(var x of nt(C))Zt.call(C,x)&&ot(c,x,C[x]);return c},M=(c,C)=>Kt(c,Gt(C));var u=(c,C,x)=>new Promise((oe,G)=>{var W=D=>{try{Z(x.next(D))}catch($){G($)}},fe=D=>{try{Z(x.throw(D))}catch($){G($)}},Z=D=>D.done?oe(D.value):Promise.resolve(D.value).then(W,fe);Z((x=x.apply(c,C)).next())});c.Env=void 0,function(r){r.Dev="Dev",r.Staging="Staging",r.Production="Production"}(c.Env||(c.Env={}));var C;(function(r){r.EN="en",r.ZH_HANS="zh_hans",r.ZH_HANT="zh_hant",r.JA="ja",r.KO="ko"})(C||(C={})),c.LoginType=void 0,function(r){r.Default="default",r.Email="email",r.Mini="mini"}(c.LoginType||(c.LoginType={}));const x="%[a-f0-9]{2}",oe=new RegExp("("+x+")|([^%]+?)","gi"),G=new RegExp("("+x+")+","gi");function W(r,e){try{return[decodeURIComponent(r.join(""))]}catch(o){}if(r.length===1)return r;e=e||1;const t=r.slice(0,e),n=r.slice(e);return Array.prototype.concat.call([],W(t),W(n))}function fe(r){try{return decodeURIComponent(r)}catch(e){let t=r.match(oe)||[];for(let n=1;n<t.length;n++)r=W(t,n).join(""),t=r.match(oe)||[];return r}}function Z(r){const e={"%FE%FF":"��","%FF%FE":"��"};let t=G.exec(r);for(;t;){try{e[t[0]]=decodeURIComponent(t[0])}catch(o){const i=fe(t[0]);i!==t[0]&&(e[t[0]]=i)}t=G.exec(r)}e["%C2"]="�";const n=Object.keys(e);for(const o of n)r=r.replace(new RegExp(o,"g"),e[o]);return r}function D(r){if(typeof r!="string")throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof r+"`");try{return decodeURIComponent(r)}catch(e){return Z(r)}}function $(r,e){const t={};if(Array.isArray(e))for(const n of e){const o=Object.getOwnPropertyDescriptor(r,n);o!=null&&o.enumerable&&Object.defineProperty(t,n,o)}else for(const n of Reflect.ownKeys(r)){const o=Object.getOwnPropertyDescriptor(r,n);if(o.enumerable){const i=r[n];e(n,i,r)&&Object.defineProperty(t,n,o)}}return t}function Yt(r,e){if(Array.isArray(e)){const t=new Set(e);return $(r,n=>!t.has(n))}return $(r,(t,n,o)=>!e(t,n,o))}function Ie(r,e){if(!(typeof r=="string"&&typeof e=="string"))throw new TypeError("Expected the arguments to be of type `string`");if(r===""||e==="")return[];const t=r.indexOf(e);return t===-1?[]:[r.slice(0,t),r.slice(t+e.length)]}const it=r=>r==null,st=r=>encodeURIComponent(r).replaceAll(/[!'()*]/g,e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`),me=Symbol("encodeFragmentIdentifier");function at(r){switch(r.arrayFormat){case"index":return e=>(t,n)=>{const o=t.length;return n===void 0||r.skipNull&&n===null||r.skipEmptyString&&n===""?t:n===null?[...t,[E(e,r),"[",o,"]"].join("")]:[...t,[E(e,r),"[",E(o,r),"]=",E(n,r)].join("")]};case"bracket":return e=>(t,n)=>n===void 0||r.skipNull&&n===null||r.skipEmptyString&&n===""?t:n===null?[...t,[E(e,r),"[]"].join("")]:[...t,[E(e,r),"[]=",E(n,r)].join("")];case"colon-list-separator":return e=>(t,n)=>n===void 0||r.skipNull&&n===null||r.skipEmptyString&&n===""?t:n===null?[...t,[E(e,r),":list="].join("")]:[...t,[E(e,r),":list=",E(n,r)].join("")];case"comma":case"separator":case"bracket-separator":{const e=r.arrayFormat==="bracket-separator"?"[]=":"=";return t=>(n,o)=>o===void 0||r.skipNull&&o===null||r.skipEmptyString&&o===""?n:(o=o===null?"":o,n.length===0?[[E(t,r),e,E(o,r)].join("")]:[[n,E(o,r)].join(r.arrayFormatSeparator)])}default:return e=>(t,n)=>n===void 0||r.skipNull&&n===null||r.skipEmptyString&&n===""?t:n===null?[...t,E(e,r)]:[...t,[E(e,r),"=",E(n,r)].join("")]}}function lt(r){let e;switch(r.arrayFormat){case"index":return(t,n,o)=>{if(e=/\[(\d*)]$/.exec(t),t=t.replace(/\[\d*]$/,""),!e){o[t]=n;return}o[t]===void 0&&(o[t]={}),o[t][e[1]]=n};case"bracket":return(t,n,o)=>{if(e=/(\[])$/.exec(t),t=t.replace(/\[]$/,""),!e){o[t]=n;return}if(o[t]===void 0){o[t]=[n];return}o[t]=[...o[t],n]};case"colon-list-separator":return(t,n,o)=>{if(e=/(:list)$/.exec(t),t=t.replace(/:list$/,""),!e){o[t]=n;return}if(o[t]===void 0){o[t]=[n];return}o[t]=[...o[t],n]};case"comma":case"separator":return(t,n,o)=>{const i=typeof n=="string"&&n.includes(r.arrayFormatSeparator),s=typeof n=="string"&&!i&&R(n,r).includes(r.arrayFormatSeparator);n=s?R(n,r):n;const a=i||s?n.split(r.arrayFormatSeparator).map(l=>R(l,r)):n===null?n:R(n,r);o[t]=a};case"bracket-separator":return(t,n,o)=>{const i=/(\[])$/.test(t);if(t=t.replace(/\[]$/,""),!i){o[t]=n&&R(n,r);return}const s=n===null?[]:n.split(r.arrayFormatSeparator).map(a=>R(a,r));if(o[t]===void 0){o[t]=s;return}o[t]=[...o[t],...s]};default:return(t,n,o)=>{if(o[t]===void 0){o[t]=n;return}o[t]=[...[o[t]].flat(),n]}}}function ke(r){if(typeof r!="string"||r.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function E(r,e){return e.encode?e.strict?st(r):encodeURIComponent(r):r}function R(r,e){return e.decode?D(r):r}function Se(r){return Array.isArray(r)?r.sort():typeof r=="object"?Se(Object.keys(r)).sort((e,t)=>Number(e)-Number(t)).map(e=>r[e]):r}function Te(r){const e=r.indexOf("#");return e!==-1&&(r=r.slice(0,e)),r}function ct(r){let e="";const t=r.indexOf("#");return t!==-1&&(e=r.slice(t)),e}function Le(r,e,t){return t==="string"&&typeof r=="string"?r:typeof t=="function"&&typeof r=="string"?t(r):e.parseBooleans&&r!==null&&(r.toLowerCase()==="true"||r.toLowerCase()==="false")?r.toLowerCase()==="true":t==="number"&&!Number.isNaN(Number(r))&&typeof r=="string"&&r.trim()!==""||e.parseNumbers&&!Number.isNaN(Number(r))&&typeof r=="string"&&r.trim()!==""?Number(r):r}function pe(r){r=Te(r);const e=r.indexOf("?");return e===-1?"":r.slice(e+1)}function ge(r,e){e=b({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1,types:Object.create(null)},e),ke(e.arrayFormatSeparator);const t=lt(e),n=Object.create(null);if(typeof r!="string"||(r=r.trim().replace(/^[?#&]/,""),!r))return n;for(const o of r.split("&")){if(o==="")continue;const i=e.decode?o.replaceAll("+"," "):o;let[s,a]=Ie(i,"=");s===void 0&&(s=i),a=a===void 0?null:["comma","separator","bracket-separator"].includes(e.arrayFormat)?a:R(a,e),t(R(s,e),a,n)}for(const[o,i]of Object.entries(n))if(typeof i=="object"&&i!==null&&e.types[o]!=="string")for(const[s,a]of Object.entries(i)){const l=e.types[o]?e.types[o].replace("[]",""):void 0;i[s]=Le(a,e,l)}else typeof i=="object"&&i!==null&&e.types[o]==="string"?n[o]=Object.values(i).join(e.arrayFormatSeparator):n[o]=Le(i,e,e.types[o]);return e.sort===!1?n:(e.sort===!0?Object.keys(n).sort():Object.keys(n).sort(e.sort)).reduce((o,i)=>{const s=n[i];return o[i]=s&&typeof s=="object"&&!Array.isArray(s)?Se(s):s,o},Object.create(null))}function Fe(r,e){if(!r)return"";e=b({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},e),ke(e.arrayFormatSeparator);const t=s=>e.skipNull&&it(r[s])||e.skipEmptyString&&r[s]==="",n=at(e),o={};for(const[s,a]of Object.entries(r))t(s)||(o[s]=a);const i=Object.keys(o);return e.sort!==!1&&i.sort(e.sort),i.map(s=>{const a=r[s];return a===void 0?"":a===null?E(s,e):Array.isArray(a)?a.length===0&&e.arrayFormat==="bracket-separator"?E(s,e)+"[]":a.reduce(n(s),[]).join("&"):E(s,e)+"="+E(a,e)}).filter(s=>s.length>0).join("&")}function Ue(r,e){var o,i;e=b({decode:!0},e);let[t,n]=Ie(r,"#");return t===void 0&&(t=r),b({url:(i=(o=t==null?void 0:t.split("?"))==null?void 0:o[0])!=null?i:"",query:ge(pe(r),e)},e&&e.parseFragmentIdentifier&&n?{fragmentIdentifier:R(n,e)}:{})}function Pe(r,e){e=b({encode:!0,strict:!0,[me]:!0},e);const t=Te(r.url).split("?")[0]||"",n=pe(r.url),o=b(b({},ge(n,{sort:!1})),r.query);let i=Fe(o,e);i&&(i=`?${i}`);let s=ct(r.url);if(typeof r.fragmentIdentifier=="string"){const a=new URL(t);a.hash=r.fragmentIdentifier,s=e[me]?a.hash:`#${r.fragmentIdentifier}`}return`${t}${i}${s}`}function Ae(r,e,t){t=b({parseFragmentIdentifier:!0,[me]:!1},t);const{url:n,query:o,fragmentIdentifier:i}=Ue(r,t);return Pe({url:n,query:$(o,e),fragmentIdentifier:i},t)}function dt(r,e,t){const n=Array.isArray(e)?o=>!e.includes(o):(o,i)=>!e(o,i);return Ae(r,n,t)}const ie=Object.freeze(Object.defineProperty({__proto__:null,exclude:dt,extract:pe,parse:ge,parseUrl:Ue,pick:Ae,stringify:Fe,stringifyUrl:Pe},Symbol.toStringTag,{value:"Module"})),ut="@xterio-sdk/auth",ve="0.0.2",vr={name:ut,version:ve,description:"xterio-auth",author:"xterio platform",license:"ISC",keywords:["xterio-auth"],main:"./dist/lib/index.js",module:"./dist/es/index.js",types:"./dist/types/index.d.ts",typings:"./dist/types/index.d.ts",exports:{".":{types:"./dist/types/index.d.ts",import:"./dist/es/index.js",require:"./dist/lib/index.js",default:"./dist/es/index.js",style:"./dist/es/style.css"},"./style/main.css":{import:"./dist/es/style.css",require:"./dist/es/style.css"},"./dist/es/style.css":"./dist/es/style.css"},style:"./dist/es/style.css",files:["dist"],homepage:"https://gitlab.itlibecc.com/changying/platform/xteriosdk-web.git#README",repository:{type:"git",url:"https://gitlab.itlibecc.com/changying/platform/xteriosdk-web.git",directory:"xterio-auth"},bugs:{url:"https://gitlab.itlibecc.com/changying/platform/xteriosdk-web/issues"},sideEffects:!1,publishConfig:{access:"public"},scripts:{test:"jest",dev:"vite --port 3000",build:"rm -rf dist/* && vite build","build:umd":"rm -rf dist/* && vite build --config vite.config.umdbuild.mts","dev-watch":"vite build --watch",preview:"vite preview"},devDependencies:{"@babel/core":"^7.25.2","@babel/preset-env":"^7.25.3","@babel/preset-typescript":"^7.24.7","@rollup/plugin-typescript":"^11.1.6","@types/jest":"^29.5.12","@types/js-cookie":"^3.0.6","@types/node":"^22.3.0","babel-jest":"^29.7.0","babel-plugin-module-resolver":"^5.0.2",jest:"^29.7.0",sass:"^1.77.8","ts-jest":"^29.2.4",typescript:"^5.5.4",vite:"^5.4.0","vite-plugin-dts":"^4.0.3","vite-plugin-svgr":"^4.2.0","vite-tsconfig-paths":"^5.0.1"},dependencies:{"js-base64":"^3.7.7","js-cookie":"^3.0.5","query-string":"^9.1.0"}},g=(...r)=>{console.log(`[XterioAuth(v${ve})]`,...r)},ht=()=>ve,wr=()=>{const r=Date.now()*Math.pow(10,3),e=Math.floor(Math.random()*Math.pow(10,3));return r+e},ft=r=>{r=r||32;const e="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",t=e.length;let n="";for(let o=0;o<r;o++)n+=e.charAt(Math.floor(Math.random()*t));return n},Y={LOGIN:"xter_auth_login_success",ACCOUNT:"xter_auth_response_userinfo",REQ_ACCOUNT:"xter_auth_request_userinfo"},I={LOGIN_TYPE:"xter_auth_login_type",TOKENS:"xter_auth_login_tokens",ID_TOKEN:"xter_auth_id_token",REFRESH_TOKEN:"xter_auth_refresh_token",ACCESS_TOKEN:"xter_auth_access_token",USERINFO:"xter_auth_userinfo"};/*! js-cookie v3.0.5 | MIT */function se(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)r[n]=t[n]}return r}var mt={read:function(r){return r[0]==='"'&&(r=r.slice(1,-1)),r.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(r){return encodeURIComponent(r).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}};function we(r,e){function t(o,i,s){if(typeof document!="undefined"){s=se({},e,s),typeof s.expires=="number"&&(s.expires=new Date(Date.now()+s.expires*864e5)),s.expires&&(s.expires=s.expires.toUTCString()),o=encodeURIComponent(o).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var a="";for(var l in s)s[l]&&(a+="; "+l,s[l]!==!0&&(a+="="+s[l].split(";")[0]));return document.cookie=o+"="+r.write(i,o)+a}}function n(o){if(!(typeof document=="undefined"||arguments.length&&!o)){for(var i=document.cookie?document.cookie.split("; "):[],s={},a=0;a<i.length;a++){var l=i[a].split("="),d=l.slice(1).join("=");try{var v=decodeURIComponent(l[0]);if(s[v]=r.read(d,v),o===v)break}catch(w){}}return o?s[o]:s}}return Object.create({set:t,get:n,remove:function(o,i){t(o,"",se({},i,{expires:-1}))},withAttributes:function(o){return we(this.converter,se({},this.attributes,o))},withConverter:function(o){return we(se({},this.converter,o),this.attributes)}},{attributes:{value:Object.freeze(e)},converter:{value:Object.freeze(r)}})}var V=we(mt,{path:"/"});class k{static set loginType(e){localStorage.setItem(I.LOGIN_TYPE,e)}static get loginType(){const e=localStorage.getItem(I.LOGIN_TYPE);return e||void 0}static set tokens(e){const{access_token:t="",id_token:n="",refresh_token:o=""}=e;V.set(I.ACCESS_TOKEN,t,{expires:1}),V.set(I.ID_TOKEN,n,{expires:1}),V.set(I.REFRESH_TOKEN,o)}static get tokens(){return{access_token:V.get(I.ACCESS_TOKEN)||"",id_token:V.get(I.ID_TOKEN)||"",refresh_token:V.get(I.REFRESH_TOKEN)||""}}static deleteTokens(){V.remove(I.ACCESS_TOKEN),V.remove(I.REFRESH_TOKEN),V.remove(I.ID_TOKEN)}static set userInfo(e){localStorage.setItem(I.USERINFO,JSON.stringify(e))}static get userInfo(){const e=localStorage.getItem(I.USERINFO);try{if(e)return JSON.parse(e)}catch(t){return}}static deleteUserInfo(){localStorage.removeItem(I.USERINFO)}static delete(e){localStorage.removeItem(e)}}class h{}h.client_id="",h.baseURL="",h.authorizeUrl="";class N{static setTokens(e){const{id_token:t="",access_token:n="",refresh_token:o=""}=e||{};h.tokens={id_token:t,access_token:n,refresh_token:o},k.tokens=e}static removeTokens(){h.tokens=void 0}static get idToken(){var e;return((e=h.tokens)===null||e===void 0?void 0:e.id_token)||""}static get refreshToken(){var e;return((e=h.tokens)===null||e===void 0?void 0:e.refresh_token)||""}}class J{static setUserInfo(e){h.userInfo=e,k.userInfo=e}static removeUserInfo(){h.userInfo=void 0}static get userInfo(){return h.userInfo}}function pt(r){return u(this,null,function*(){const e=yield r.json();return e.err_code!=0?(r.status===401&&e.err_code===91001||r.status,Promise.reject(e)):e.data})}function gt(r,e){return!e||/^https?:\/\//i.test(r)?r:r.startsWith("/")?`${e}${r}`:`${e}/${r}`}const Q=s=>u(this,[s],function*({method:r,path:e,params:t,headers:n,data:o,Authorization:i}){var a;if(!h.client_id)throw new Error("You need set xterio-auth info");if(t){const w=ie.stringify(t);e+=(e.includes("?")?"&":"?")+`${w}`}const l=gt(e,h.baseURL),d={method:r,headers:b({"content-type":"application/json",sdkVersion:ht(),platform:"pc",clientId:h.client_id,timestamp:Date.now().toString(),language:"en",nonce:ft(),Authorization:i||((a=k.tokens)===null||a===void 0?void 0:a.id_token)||""},n)};if(o){const w=r!=="PUT"&&(n==null?void 0:n["content-type"])!=="application/x-www-form-urlencoded";d.body=w?JSON.stringify(o):o}const v=new Request(l,d);try{const w=yield fetch(v);return r==="PUT"?w:pt(w)}catch(w){throw new Error("Network error")}});function ye(r,e,t){return u(this,null,function*(){return Q({method:"GET",path:r,params:e,Authorization:t})})}function j(r,e,t,n){return u(this,null,function*(){return Q({method:"POST",path:r,data:e,headers:n,Authorization:t})})}function vt(r,e){return u(this,null,function*(){return Q({method:"DELETE",path:r,data:e})})}function wt(r,e,t){return u(this,null,function*(){return Q({method:"PUT",path:r,data:e,headers:t})})}function yr(r,e,t,n){return u(this,null,function*(){return Q({method:"PATCH",path:r,data:e,headers:t,Authorization:n})})}class z{static set listeners(e){this._listeners=e}static get listeners(){return this._listeners}static on(e,t){this._listeners[e]||(this._listeners[e]=[]),this._listeners[e].push(t)}static off(e,t){this._listeners[e]&&(this._listeners[e]=this._listeners[e].filter(n=>n!==t))}static emit(e,...t){this._listeners[e]&&this._listeners[e].forEach(n=>{n(...t)})}static remove(e){this._listeners[e]&&delete this._listeners[e]}static subscribe(e,t){const n=t||Y.ACCOUNT;g("subscribe event",n);const o=i=>{e==null||e(i)};this._cacheMap.set(n,o),this.on(n,o)}static unsubscribe(e){const t=e||Y.ACCOUNT;g("unsubscribe event",t);const n=this._cacheMap.get(t);n&&(this.off(t,n),this._cacheMap.delete(t))}static clear(){this.listeners={},this._cacheMap.clear()}}z._listeners={},z._cacheMap=new Map;class B{static login(e){return u(this,null,function*(){const{client_id:t,client_secret:n,redirect_uri:o,grant_type:i}=h.config||{},a={client_id:t,client_secret:n,redirect_uri:o,grant_type:i,code:e};g("go login");const l=yield j("/account/v1/oauth2/token",a).then(d=>(g("login success."),N.setTokens(d),d)).catch(d=>(g("login failed."),null));if(l!=null&&l.id_token){g("get userinfo");const d=yield this.getUserInfo();if(d.uuid)return d}return null})}static getUserInfo(){return u(this,null,function*(){const[e,t]=yield Promise.all([this.getProfile(),this.getWallet()]),n=M(b({},e),{wallet:t});return J.setUserInfo(n),n!=null&&n.uuid&&z.emit(Y.ACCOUNT,n),n})}static getProfile(){return u(this,null,function*(){const e=yield ye("/account/v1/user/profile").then(t=>(g("get profile success."),t)).catch(t=>(g("get profile failed."),null));return e!=null&&e.uuid?b({},e):{}})}static getWallet(){return u(this,null,function*(){const e=yield ye("/account/v1/wallet").then(t=>(g("get wallet success."),t)).catch(t=>(g("get wallet failed."),null));return(e==null?void 0:e.wallet)||[]})}static loginService(e,t){return u(this,null,function*(){const n=yield j("/account/v1/login",{username:e,password:t}).catch(o=>M(b({},o),{error:!0}));return g("ttl login",n!=null&&n.error?"failed":"success"),n!=null&&n.error||N.setTokens(n),n!=null&&n.error?M(b({},n),{error:!0}):M(b({},n),{error:!1})})}static refreshTokenService(e){return j("/auth/v1/refresh",{refresh_token:e}).catch(()=>({}))}static registerService(o){return u(this,arguments,function*({username:e,password:t,subscribe:n}){const i=yield j("/account/v1/register",{username:e,password:t,subscribe:n?1:0,invite_code:"","h-recaptcha-response":""}).catch(s=>M(b({},s),{error:!0}));return i!=null&&i.error?{error:!0,err_code:i==null?void 0:i.err_code}:{error:!1}})}static registerConfirmService(o){return u(this,arguments,function*({username:e,password:t,code:n}){const i=yield j("/account/v1/register/code/confirm",{username:e,code:n,password:t}).catch(s=>({error:!0,err_code:s.err_code}));return i!=null&&i.error||N.setTokens(i),i!=null&&i.error?i:M(b({},i),{error:!1})})}static sendForgotCodeService(t){return u(this,arguments,function*({email:e}){const n=yield j("/account/v1/password/forgot?source=forgot",{username:e}).catch(o=>({error:!0,err_code:o.err_code}));return n!=null&&n.error?n:M(b({},n),{error:!1})})}static resetPassword(o){return u(this,arguments,function*({email:e,code:t,password:n}){const i=yield j("/account/v1/password/forgot/confirm",{username:e,password:n,confirmation_code:t}).catch(s=>({error:!0,err_code:s.err_code}));return i!=null&&i.error?i:M(b({},i),{error:!1})})}}const yt="data:image/svg+xml,%3csvg%20width='116'%20height='24'%20viewBox='0%200%20116.36363983154297%2024'%20xmlns='http://www.w3.org/2000/svg'%20class='mb-0'%3e%3cg%20clip-path='url(%23clip0_0_335)'%20fill-rule='evenodd'%20clip-rule='evenodd'%3e%3cpath%20d='M28.032%203.485a.222.222%200%2000.024.067c.006.355.014.709.027%201.073a4979.123%204979.123%200%2001.084%2010.93c-.003.18.01.36.035.538.323%201.904%201.251%203.422%202.9%204.466%201.12.71%202.363%201.104%203.658%201.347a20.98%2020.98%200%20005.866.214c.113-.01.121-.06.121-.152-.005-1.454-.005-2.91%200-4.37%200-.117-.036-.137-.143-.137a10.497%2010.497%200%2001-2.263-.267c-1-.246-1.919-.646-2.642-1.403-.681-.713-1.061-1.553-1.055-2.554a286.7%20286.7%200%20000-3.71c-.002-.165.05-.19.199-.19h4.782c.113%200%20.15-.023.15-.145a531.922%20531.922%200%20010-4.265c0-.131-.037-.15-.159-.15-1.634.005-3.278.005-4.916.005-.132%200-.177-.023-.177-.168V.77l-.008-.001.006-.003.006-.039h-6.495v2.758zM1.285%2021.519c-.185.187-.372.375-.557.566-.004.064.033.059.066.054.01-.001.02-.003.028-.002h7.892a.235.235%200%2000.183-.084l2.242-2.3%201.945-2.004.004-.003c.044-.045.075-.075.137-.009.322.342.648.676.973%201.01l.09.093a888.395%20888.395%200%20013.104%203.22.245.245%200%2000.197.08h7.863l.025.002c.03.005.062.01.084-.03l-.013-.015c-.009-.01-.017-.02-.026-.028l-2.454-2.536-3.906-4.037c-.607-.63-1.217-1.26-1.83-1.887-.08-.088-.112-.148%200-.243a3.69%203.69%200%2000.304-.311l2.76-2.848%204.348-4.5.851-.886h-7.951a.377.377%200%2000-.298.13c-.422.446-.847.885-1.271%201.324l-.001.001-.365.377-.658.679c-.596.613-1.191%201.227-1.783%201.85-.093.093-.13.088-.214%200l-.679-.706-.004-.004-.001-.001-.962-1c-.82-.842-1.638-1.687-2.455-2.533a.307.307%200%2000-.243-.108H.892c-.011%200-.024-.003-.036-.006-.04-.008-.082-.016-.1.047.603.61%201.2%201.221%201.792%201.836l3.873%204.005c.868.9%201.738%201.801%202.61%202.702.058.058.054.087%200%20.142-.14.137-.275.277-.41.417l-.146.152-4.32%204.45-2.364%202.431c-.168.173-.337.343-.506.513zm75.88-15.013a14.2%2014.2%200%2000-1.882%201.259%201.053%201.053%200%2000-.005-.069V4.933c0-.117-.018-.158-.15-.158-1.734.005-3.468.005-5.202%200-.126%200-.154.035-.154.157v17.143c-.002.129.037.152.16.152%201.728-.006%203.457-.006%205.186%200%20.14%200%20.16-.046.16-.168v-6.981c-.002-.085.01-.17.035-.25.255-.8.686-1.533%201.262-2.144.852-.934%201.902-1.6%203.04-2.134a16.1%2016.1%200%20013.839-1.233c.096-.018.13-.048.13-.152V4.916c0-.088%200-.155-.122-.144-.082.006-.166.007-.25.007-.067%200-.133.001-.2.004-2.057.11-4.06.7-5.848%201.723zm14.31%209.27v6.29c0%20.14-.038.162-.167.162h-4.99c-.122%200-.159-.027-.159-.154V9.429c0-.122.037-.156.158-.156h4.992c.13%200%20.166.03.166.163-.003%202.114-.003%204.227%200%206.34zm-34.051-.8h-9.638c-.09%200-.136%200-.155.022-.02.023-.013.069%200%20.161.18%201.25%201.014%202.09%202.265%202.25.37.03.741.036%201.112.02h3.759l1.308.003c.435.002.871.003%201.307.003.712%200%201.423%200%202.134-.015.495-.01.931-.218%201.355-.449.307-.169.6-.363.875-.581a.148.148%200%2001.196-.018c1.32.742%202.645%201.481%203.97%202.217.1.054.098.091.05.179-.84%201.486-2.1%202.473-3.669%203.096-.33.132-.67.237-1.016.316a1.413%201.413%200%2001-.327.037l-4.1-.001c-2.733-.002-5.467-.004-8.2.001a5.605%205.605%200%2001-2.928-.815c-1.293-.768-2.14-1.905-2.686-3.283a10.58%2010.58%200%2001-.662-3.005c-.095-1.046-.076-2.1.057-3.143.243-1.83.851-3.504%202.116-4.89a7.38%207.38%200%20013.851-2.258c.093-.02.188-.03.282-.029l3.468-.003c3.004-.003%206.008-.007%209.013.014%201.276.009%202.395.522%203.34%201.384.902.823%201.479%201.856%201.896%202.987.394%201.108.649%202.261.758%203.432.08.736.112%201.477.096%202.217%200%20.131-.041.15-.159.15h-9.668zm-2.53-3.56H47.77c-.089%200-.133%200-.153-.023-.021-.022-.016-.069-.005-.162.09-.788.571-1.285%201.233-1.646.302-.169.642-.255.988-.252%203.485.01%206.973.01%2010.464%200a1.492%201.492%200%20011.24.608c.306.41.526.877.646%201.374.019.07.013.107-.071.097a1.012%201.012%200%2000-.105%200l-7.111.004z'%20fill='currentColor'%3e%3c/path%3e%3cpath%20d='M113.607%2020.397a10.451%2010.451%200%20002.149-9.746c-1.696-5.954-8.221-9.124-13.981-6.796-.984.397-1.863.964-2.714%201.589-1.028.764-2.2.992-3.46.764-.973-.175-1.84-.587-2.674-1.073a2.051%202.051%200%2001-.91-1.101%202.726%202.726%200%2001-.086-.313%203.19%203.19%200%2000-5.396-1.542%203.187%203.187%200%2000-.894%201.974c-.192%202.29%202.083%204.035%204.246%203.246a2.172%202.172%200%20011.84.132%2010.35%2010.35%200%20011.728%201.124c1.325%201.086%201.977%202.45%201.824%204.187a9.748%209.748%200%2000.399%203.636%2010.456%2010.456%200%200017.929%203.919zm-12.321-9.728a5.272%205.272%200%2000-.889%202.928%205.281%205.281%200%20005.264%205.272%205.275%205.275%200%20004.874-3.25%205.272%205.272%200%2000-9.249-4.95z'%20fill='url(%23paint0_linear_0_335)'%3e%3c/path%3e%3c/g%3e%3cdefs%3e%3clinearGradient%20id='paint0_linear_0_335'%20x1='85.629'%20y1='1.216'%20x2='116.167'%20y2='24.119'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20stop-color='%23CBF2FE'%3e%3c/stop%3e%3cstop%20offset='0.391'%20stop-color='%237DD5F9'%3e%3c/stop%3e%3cstop%20offset='0.735'%20stop-color='%23E6B1F7'%3e%3c/stop%3e%3cstop%20offset='1'%20stop-color='%23E1DFA2'%3e%3c/stop%3e%3c/linearGradient%3e%3cclipPath%20id='clip0_0_335'%3e%3cpath%20fill='%23fff'%20d='M0%200h116.364v24H0z'%3e%3c/path%3e%3c/clipPath%3e%3c/defs%3e%3c/svg%3e";class bt{getElement(){const e=document.createElement("div");return e.classList.add("xa-modal-logo"),e.innerHTML=`
      <img src="${yt}" alt="Xterio" class="auth-logo" />
    `,e}}const be={"icon-close":'<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M13.414 12l6-6L18 4.586l-6 6-6-6L4.586 6l6 6-6 6L6 19.414l6-6 6 6L19.414 18l-6-6z" fill="currentColor"></path></svg>',"icon-show":'<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" style="color: rgb(254, 254, 254);"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 4C4 4 2 12 2 12s2 8 10 8 10-8 10-8-2-8-10-8zm-7.716 7.52c-.076.18-.137.342-.187.48A10.894 10.894 0 005.6 14.8C6.827 16.436 8.786 18 12 18c3.214 0 5.173-1.564 6.4-3.2a10.89 10.89 0 001.503-2.8A10.89 10.89 0 0018.4 9.2C17.173 7.564 15.214 6 12 6 8.786 6 6.827 7.564 5.6 9.2c-.626.834-1.05 1.68-1.316 2.32zM14 12a2 2 0 11-4 0 2 2 0 014 0zm2 0a4 4 0 11-8 0 4 4 0 018 0z" fill="currentColor"></path></svg>',"icon-hide":'<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" style="color: rgb(254, 254, 254);"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 4C4 4 2 12 2 12s1.028 4.113 4.56 6.44L5 20l1.414 1.414 2.023-2.023c1.03.38 2.21.609 3.563.609 8 0 10-8 10-8s-.516-2.066-2.074-4.098l1.488-1.488L20 5l-1.43 1.43C17.052 5.073 14.927 4 12 4zm5.153 3.847C15.948 6.797 14.293 6 12 6 8.786 6 6.827 7.564 5.6 9.2A10.894 10.894 0 004.097 12 10.894 10.894 0 005.6 14.8c.605.807 1.388 1.596 2.411 2.189l9.142-9.142zm-7.11 9.939A8.673 8.673 0 0012 18c3.214 0 5.173-1.564 6.4-3.2a10.89 10.89 0 001.503-2.8 10.946 10.946 0 00-1.406-2.668l-2.5 2.5L16 12a4 4 0 01-4.168 3.996l-1.79 1.79zM12 10c.064 0 .128.003.191.009l1.591-1.591a4 4 0 00-5.364 5.364l1.591-1.591A2 2 0 0112 10z" fill="currentColor"></path></svg>'},br=(...r)=>{let e="";for(let t=0;t<Math.floor(r.length/2);t++){const n=r[t*2],o=r[t*2+1];e+=`${n}: ${o};`}return e},Be=(r,e=16,t)=>{const n=document.createElement("div");return n.style.cssText=`width: ${e}px; height:${e}px; display:inline-block; color: ${t!=null?t:"#ccc"};`,n.innerHTML=be==null?void 0:be[r],n};class O{constructor(e){this.clearIcon=null,this.props=e,this.inputElement=null,this.root=this.createInputElement(),this.setUpEventListeners()}createInputElement(){const{id:e,type:t,label:n,wrapperClassNames:o,showClearIcon:i,showPasswordToggleIcon:s,onChange:a,onBlur:l,onFocus:d}=this.props,v=document.createElement("div");v.classList.add("xa-input-wrapper",`xa-input-wrapper-${t}`),o&&o.forEach(p=>v.classList.add(p));const w=document.createElement("span");w.className="xa-input-label",w.textContent=n,v.appendChild(w);const A=document.createElement("div");A.className="xa-input-inner";const _=document.createElement("input");if(_.type=t==="password"?"password":t,_.id="auth-input",_.className="xa-input",_.placeholder="",this.inputElement=_,A.appendChild(_),i){const p=document.createElement("div");p.className="xa-input-clear",p.appendChild(Be("icon-close")),p.style.visibility="hidden",p.addEventListener("click",()=>{_.value="",p.style.visibility="hidden"}),this.clearIcon=p,A.appendChild(p)}if(t==="password"&&s){const p=document.createElement("div");p.className="xa-input-value-hide",p.addEventListener("click",()=>{_.type==="password"?(_.type="text",p.className="xa-input-value-show"):(_.type="password",p.className="xa-input-value-hide")}),A.appendChild(p)}if(this.props.addonAfterSendButton){const{onClick:p,onCountdownEnd:L}=this.props.addonAfterSendButton,y=document.createElement("button");y.className="xa-input-addon-btn",y.textContent="SEND",y.addEventListener("click",ne=>{ne.stopPropagation(),ne.preventDefault(),y.disabled=!0;let he=60;const Ht=setInterval(()=>{he--,he===0?(y.disabled=!1,y.textContent="SEND",clearInterval(Ht),L==null||L()):(y.disabled=!0,y.textContent=`${he-1}s`)},1e3);y.textContent=`${he}s`,p==null||p()}),A.appendChild(y)}_.addEventListener("input",p=>{var L,y;const ne=(y=(L=p.target)===null||L===void 0?void 0:L.value)!==null&&y!==void 0?y:"";this.clearIcon&&(this.clearIcon.style.visibility=ne?"visible":"hidden"),a&&a(ne)}),_.addEventListener("focus",p=>{var L,y;d&&d((y=(L=p.target)===null||L===void 0?void 0:L.value)!==null&&y!==void 0?y:"")}),_.addEventListener("blur",p=>{var L,y;l&&l((y=(L=p.target)===null||L===void 0?void 0:L.value)!==null&&y!==void 0?y:"")}),v.appendChild(A);const ue=document.createElement("p");return ue.className="xa-error-tip",this.props.showError?ue.textContent=this.props.errorMessage||"":ue.style.display="none",v.appendChild(ue),v}getElement(){return this.root}setUpEventListeners(){const e=this.root;this.root.addEventListener("click",()=>{const n=this.root.querySelector(".xa-input");n&&n.focus()}),this.root.querySelectorAll(".xa-input").forEach(n=>{n.addEventListener("focus",()=>{const o=n.closest(".xa-input-wrapper"),i=o==null?void 0:o.querySelector(".xa-input-label");i&&i.classList.add("xa-input-label_filled")}),n.addEventListener("blur",()=>{const o=n.closest(".xa-input-wrapper"),i=o==null?void 0:o.querySelector(".xa-input-label");i&&n.value===""&&i.classList.remove("xa-input-label_filled")})})}showError(e){const t=this.root.querySelector(".xa-error-tip");t.textContent=e,t.style.display="block"}hideError(){const e=this.root.querySelector(".xa-error-tip");e.style.display="none"}getValue(){return this.inputElement.value}setValue(e){this.inputElement.value=e,this.props.onChange&&this.props.onChange(e)}}class Ct{constructor(){this.loader=document.createElement("div")}getElement(){return this.loader.classList.add("xa-loader"),this.loader}show(){var e;(e=this.loader)===null||e===void 0||e.classList.remove("xa-hide")}hide(){var e;console.log("laoder",this.loader),(e=this.loader)===null||e===void 0||e.classList.add("xa-hide")}}class ee{constructor(e){this.props=e,this.root=this.createButtonElement()}createButtonElement(){const{id:e,text:t,wrapperClassNames:n,disabled:o,onClick:i}=this.props,s=document.createElement("button");s.className="xa-login-button",s.textContent=t;const a=new Ct;return a.hide(),s.insertBefore(a.getElement(),s.firstChild),this.loader=a,n&&n.forEach(l=>s.classList.add(l)),o&&(s.disabled=!0,s.classList.add("xa-login-button_disabled")),i&&s.addEventListener("click",l=>i(l)),s}getElement(){return this.root}setDisabled(e){this.root.disabled=e,e?this.root.classList.add("xa-login-button_disabled"):this.root.classList.remove("xa-login-button_disabled")}setLoading(e){var t,n;e?(t=this.loader)===null||t===void 0||t.show():(n=this.loader)===null||n===void 0||n.hide()}}var F;(function(r){r.Login="login",r.Signup="signup",r.SignupCode="signupCode",r.ForgotPassword="forgotPassword",r.PasswordSuccess="passwordSuccess"})(F||(F={}));class te{constructor(e,t){this.modal=e}}class ae{constructor(){this.formList=[]}add(e,t){this.formList.push({name:e,formItem:t})}findFormItem(e){var t;const n=(t=this.formList.find(o=>o.name===e))===null||t===void 0?void 0:t.formItem;return console.log({find:n}),n}clearFormItemError(e){var t;const n=(t=this.formList.find(o=>o.name===e))===null||t===void 0?void 0:t.formItem;n==null||n.clearError()}getFormItemValue(e){var t,n,o;const i=(t=this.formList.find(s=>s.name===e))===null||t===void 0?void 0:t.formItem;return(o=(n=i==null?void 0:i.value)===null||n===void 0?void 0:n.toString())!==null&&o!==void 0?o:""}getFormItemChecked(e){var t;const n=(t=this.formList.find(o=>o.name===e))===null||t===void 0?void 0:t.formItem;return!!(n!=null&&n.value)}}const Et=r=>!!r&&/\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*/.test(r),_t=r=>!!r&&/^(?=.*[A-Z])(?=.*\d)[\S]{8,}$/.test(r);function Cr(r){return/^[0-9]{6}$/g.test(r)}const Er=r=>/^[!-~ ]{1,20}$/.test(r),Ce=r=>Et(r)?"":"Invalid Email",Ne=r=>_t(r)?"":"Password must be at least 8 characters with 1 upper case letter and 1 number",Oe=(r,e)=>r===e?"":"The passwords don't match";class P{constructor(e,t,n){this._value="",this.root=document.createElement("div"),this.root.className="xa-form-item",this.root.innerHTML=`
    <div class="xa-form-item-error"></div>`,this.root.setAttribute("data-name",e),this.root.insertBefore(t,this.root.firstChild),this.label=document.createElement("span"),this.getValueFunction=n}getElement(){return this.root}get value(){return this.getValueFunction()}setError(e){var t,n;this.root.querySelector(".xa-form-item-error").innerHTML=e,e?(t=this.root.querySelector(".xa-input-wrapper"))===null||t===void 0||t.classList.add("xa-error-border"):(n=this.root.querySelector(".xa-input-wrapper"))===null||n===void 0||n.classList.remove("xa-error-border")}isValidate(){var e;return!(!((e=this.root.querySelector(".xa-form-item-error"))===null||e===void 0)&&e.innerHTML)}clearError(){var e;this.root.querySelector(".xa-form-item-error").innerHTML="",(e=this.root.querySelector(".xa-input-wrapper"))===null||e===void 0||e.classList.remove("xa-error-border")}}var T;(function(r){r.Email="email",r.Password="password"})(T||(T={}));class Me extends te{constructor(e,t){super(e),this.loginButton=null,this.emailInput=null,this.pwdInput=null,this.form=new ae}render(){if(!this.modal.modalContainer)return;const e=this.modal.modalContainer;this.modal.setTitle("Sign in","Sign in with email"),this.renderEmailInput(e),this.renderPwdInput(e),this.renderTips(e),this.renderLoginButton(e),this.setupListeners()}renderEmailInput(e){const t=new O({label:"EMAIL",type:"text",showClearIcon:!0,onChange:o=>{this.form.clearFormItemError(T.Email),this.handleEmailChange(o)},onBlur:o=>{var i;(i=this.form.findFormItem(T.Email))===null||i===void 0||i.setError(Ce(o)),this.handleEmailChange(o)}});this.emailInput=t;const n=new P(T.Email,t.getElement(),()=>t.getValue());this.form.add(T.Email,n),this.append(e,n.getElement())}renderPwdInput(e){const t=new O({label:"PASSWORD",type:"password",showClearIcon:!0,onChange:o=>{this.handlePasswordChange(o)},onBlur:o=>{var i;(i=this.form.findFormItem(T.Password))===null||i===void 0||i.setError(Ne(o)),this.handlePasswordChange(o)}});this.pwdInput=t;const n=new P(T.Password,t.getElement(),()=>t.getValue());this.form.add(T.Password,n),this.append(e,n.getElement())}renderTips(e){const t=document.createElement("div");t.classList.add("xa-login-tip","xa-flex","xa-justify-between"),t.innerHTML=`
      <div>No account yet? <a class="xa-to-sign-up">Sign up</a></div>
      <div>
        <a class="xa-to-forgotpwd">Forgot password?</a>
      </div>
    `,e.appendChild(t)}renderLoginButton(e){const t=new ee({text:"SIGN IN",disabled:!0,onClick:n=>{console.log("signUpButton clicked"),this.handleLogin()}});this.loginButton=t,this.append(e,t.getElement())}setupListeners(){var e,t;const n=(e=this.modal.modalContainer)===null||e===void 0?void 0:e.querySelector(".xa-to-sign-up");n==null||n.addEventListener("click",()=>this.modal.switchModalState(F.Signup));const o=(t=this.modal.modalContainer)===null||t===void 0?void 0:t.querySelector(".xa-to-forgotpwd");o==null||o.addEventListener("click",()=>this.modal.switchModalState(F.ForgotPassword))}handleEmailChange(e){var t,n;console.log({value:e}),(t=this.loginButton)===null||t===void 0||t.setDisabled(e.length===0||!(!((n=this.form.findFormItem(T.Email))===null||n===void 0)&&n.isValidate()))}handlePasswordChange(e){var t,n;(t=this.loginButton)===null||t===void 0||t.setDisabled(e.length===0||!(!((n=this.form.findFormItem(T.Password))===null||n===void 0)&&n.isValidate()))}handleLogin(){return u(this,null,function*(){var e,t,n,o,i,s,a,l,d;const v=(e=this.emailInput)===null||e===void 0?void 0:e.getValue(),w=(t=this.pwdInput)===null||t===void 0?void 0:t.getValue();if(!v||!w)return;(n=this.loginButton)===null||n===void 0||n.setLoading(!0);const{error:A,err_code:_}=yield this.modal.store.login(v,w);if((o=this.loginButton)===null||o===void 0||o.setLoading(!1),A){switch(_){case 11001:(i=this.form.findFormItem(T.Email))===null||i===void 0||i.setError("Wrong email or password");break;case 11103:(s=this.form.findFormItem(T.Password))===null||s===void 0||s.setError("Invalid password");break;case 11113:(a=this.form.findFormItem(T.Password))===null||a===void 0||a.setError("User does not exist.");break;case 11004:(l=this.form.findFormItem(T.Password))===null||l===void 0||l.setError("Too many attempts to login");break;default:(d=this.form.findFormItem(T.Password))===null||d===void 0||d.setError("Unknown error, please try again later");break}return}this.modal.close()})}append(e,t){e.appendChild(t)}}const xt="https://xter.io/privacy-policy",It="https://xter.io/terms-of-service";class De{constructor(e){this._checked=!1,this._checked=!!e.defaultChecked,this.props=e,this.root=document.createElement("div"),this.root.className="xa-checkbox-wrapper",this.checkboxInput=document.createElement("input"),this.checkboxInput.type="checkbox",this.checkboxInput.className="xa-checkbox-input",this.checkboxInput.checked=this._checked,this.checkboxLabel=document.createElement("label"),this.checkboxLabel.className="xa-checkbox-label",this.root.appendChild(this.checkboxInput),this.root.appendChild(this.checkboxLabel),this.root.addEventListener("click",this.handleCheckboxChange.bind(this)),this.updateCheckboxState()}getElement(){return this.root}handleCheckboxChange(){const{onChange:e}=this.props;this._checked=!this._checked,this.updateCheckboxState(),e==null||e(this._checked)}updateCheckboxState(){this._checked?(this.checkboxLabel.style.borderColor="#0a1161",this.checkboxLabel.style.backgroundColor="#0a1161",this.checkboxInput.checked=!0):(this.checkboxLabel.style.borderColor="#0a1161",this.checkboxLabel.style.backgroundColor="transparent",this.checkboxInput.checked=!1)}get checked(){return this._checked}}var f;(function(r){r.Email="email",r.Password="password",r.ConfirmPassword="confirmPassword",r.Terms="terms",r.Subscribe="subscribe"})(f||(f={}));class kt extends te{constructor(e,t){super(e),this.signUpButton=null,this.extraData=t||{},this.form=new ae}render(){if(!this.modal.modalContainer)return;const e=this.modal.modalContainer;this.modal.setTitle("Create Xterio account","Sign up with email"),this.renderEmailInput(e),this.renderPwdInput(e),this.renderConfirmPwdInput(e),this.renderTipsCheckList(e),this.renderConfirmButton(e),this.renderBackTip(e),this.setupListeners()}renderBackTip(e){const t=document.createElement("div");t.classList.add("xa-w-full","xa-text-center"),t.innerHTML=`
      <div class="xa-login-tip">
        <span>Already have an account? </span>
        <a class="xa-to-sign-in"> Sign in </a>
      </div>
    `,this.append(e,t)}renderConfirmButton(e){const t=new ee({text:"SIGN UP",disabled:!0,onClick:n=>{console.log("signUpButton clicked"),this.handleSignUp()}});this.signUpButton=t,this.append(e,t.getElement())}renderTipsCheckList(e){const t=document.createElement("div"),n=document.createElement("div");n.classList.add("xa-login-tip","xa-flex"),n.innerHTML=`
      <div>
        <span>I am 18 years of age or older and agree to the terms of the</span>
        <a href="${It}" target="_blank"> Terms of Service </a>
        <span>and the</span>
        <a href="${xt}" target="_blank"> Privacy Policy </a>
      </div>
        `;const o=new De({defaultChecked:!0,onChange:w=>{this.form.clearFormItemError(f.Terms)}}),i=o.getElement();i.classList.add("xa-login-tip-checkbox"),n.insertBefore(i,n.firstChild),t.appendChild(n);const s=new P(f.Terms,n,()=>o.checked);this.form.add(f.Terms,s),t.appendChild(s.getElement());const a=document.createElement("div");a.classList.add("xa-login-tip","xa-flex","xa-items-center"),a.innerHTML=`<div class="xa-login-tip">
        <span>Subscribe to updates via email</span>
      </div>`;const l=new De({defaultChecked:!1}),d=l.getElement();d.classList.add("xa-login-tip-checkbox"),a.insertBefore(d,a.firstChild),t.appendChild(a);const v=new P(f.Subscribe,a,()=>l.checked);this.form.add(f.Subscribe,v),t.appendChild(v.getElement()),this.append(e,t)}renderConfirmPwdInput(e){const t=new O({label:"CONFRIM PASSWORD",type:"password",showClearIcon:!0,onChange:o=>{this.handlePasswordChange(o)},onBlur:o=>{var i;(i=this.form.findFormItem(f.ConfirmPassword))===null||i===void 0||i.setError(Oe(this.form.getFormItemValue(f.Password),o))}});this.confirmPwdInput=t;const n=new P(f.ConfirmPassword,t.getElement(),()=>this.confirmPwdInput.getValue());this.form.add(f.ConfirmPassword,n),this.append(e,n.getElement())}renderPwdInput(e){const t=new O({label:"PASSWORD",type:"password",showClearIcon:!0,onChange:o=>{this.handlePasswordChange(o)},onBlur:o=>{var i;(i=this.form.findFormItem(f.Password))===null||i===void 0||i.setError(Ne(o))}});this.pwdInput=t;const n=new P(f.Password,t.getElement(),()=>this.pwdInput.getValue());this.form.add(f.Password,n),this.append(e,n.getElement())}renderEmailInput(e){const t=new O({label:"EMAIL",type:"text",showClearIcon:!0,onChange:o=>{this.form.clearFormItemError(f.Email),this.handleEmailChange(o)},onBlur:o=>{var i;(i=this.form.findFormItem(f.Email))===null||i===void 0||i.setError(Ce(o))}});this.emailInput=t;const n=new P(f.Email,t.getElement(),()=>this.emailInput.getValue());this.form.add(f.Email,n),this.append(e,n.getElement())}setupListeners(){var e,t;const n=(e=this.modal.modalContainer)===null||e===void 0?void 0:e.querySelector(".xa-to-sign-in");n==null||n.addEventListener("click",()=>this.modal.switchModalState(F.Login));const o=(t=this.modal.modalContainer)===null||t===void 0?void 0:t.querySelector(".xa-to-forgotpwd");o==null||o.addEventListener("click",()=>this.modal.switchModalState(F.ForgotPassword))}handleEmailChange(e){var t;console.log({value:e}),(t=this.signUpButton)===null||t===void 0||t.setDisabled(e.length===0)}handlePasswordChange(e){}handleSignUp(){return u(this,null,function*(){var e,t,n,o,i,s;console.log(this.form);const a=this.form.getFormItemValue(f.Email),l=this.form.getFormItemValue(f.Password),d=this.form.getFormItemValue(f.ConfirmPassword),v=!!this.form.getFormItemChecked(f.Terms),w=!!this.form.getFormItemChecked(f.Subscribe);if(!v){(e=this.form.findFormItem(f.Terms))===null||e===void 0||e.setError("You have to accept Terms of Service and Privacy Policy to continue.");return}if(!a||!l)return;(t=this.signUpButton)===null||t===void 0||t.setLoading(!0);const{error:A,err_code:_}=yield B.registerService({username:a,password:l,subscribe:w});if((n=this.signUpButton)===null||n===void 0||n.setLoading(!1),A){switch(_){case 11102:(o=this.form.findFormItem(f.Email))===null||o===void 0||o.setError("User already registered.");break;case 11103:(i=this.form.findFormItem(f.Password))===null||i===void 0||i.setError("Invalid password.");break;default:(s=this.form.findFormItem(f.Subscribe))===null||s===void 0||s.setError("Unknown error, please try again later.");break}return}this.modal.switchModalState(F.SignupCode,{email:a,password:l})})}append(e,t){e.appendChild(t)}}var m;(function(r){r.Email="email",r.Code="code",r.Password="password",r.ConfirmPassword="confirmPassword"})(m||(m={}));class St extends te{constructor(e,t){super(e),this.continueButton=null,this.form=new ae}render(){if(!this.modal.modalContainer)return;const e=this.modal.modalContainer;this.modal.setTitle("Forgot password","Please enter your email and email verification code"),this.renderEmailInput(e),this.renderCodeInput(e),this.renderPwdInput(e),this.renderConfirmPwdInput(e),this.renderConfirmButton(e),this.renderBackTip(e),this.setupListeners()}renderEmailInput(e){const t=new O({label:"EMAIL",type:"text",showClearIcon:!0,onChange:o=>{this.form.clearFormItemError(m.Email),this.handleEmailChange(o)},onBlur:o=>{var i;(i=this.form.findFormItem(m.Email))===null||i===void 0||i.setError(Ce(o))}}),n=new P(m.Email,t.getElement(),()=>t.getValue());this.form.add(m.Email,n),this.append(e,n.getElement())}renderCodeInput(e){const t=new O({label:"ENTER CODE",type:"text",onChange:o=>{this.handleEmailChange(o)},addonAfterSendButton:{onClick:()=>{var o;if(!this.form.getFormItemValue(m.Email)){(o=this.form.findFormItem(m.Email))===null||o===void 0||o.setError("Email is required");return}B.sendForgotCodeService({email:this.form.getFormItemValue(m.Email)})},onCountdownEnd:()=>{console.log("countdown end")}}}),n=new P(m.Code,t.getElement(),()=>t.getValue());this.form.add(m.Code,n),this.append(e,n.getElement())}renderPwdInput(e){const t=new O({label:"NEW PASSWORD",type:"password",showClearIcon:!0,onChange:o=>{this.handlePasswordChange(o)}}),n=new P(m.Password,t.getElement(),()=>t.getValue());this.form.add(m.Password,n),this.append(e,n.getElement())}renderConfirmPwdInput(e){const t=new O({label:"CONFRIM PASSWORD",type:"password",showClearIcon:!0,onChange:o=>{this.handlePasswordChange(o)},onBlur:o=>{var i;(i=this.form.findFormItem(m.ConfirmPassword))===null||i===void 0||i.setError(Oe(this.form.getFormItemValue(m.Password),o))}}),n=new P(m.ConfirmPassword,t.getElement(),()=>t.getValue());this.form.add(m.ConfirmPassword,n),this.append(e,n.getElement())}renderConfirmButton(e){const t=new ee({text:"CONTINUE",disabled:!0,onClick:n=>{console.log("continueButton clicked"),this.handleUpdatePassword()}});this.continueButton=t,this.append(e,t.getElement())}renderBackTip(e){const t=document.createElement("div");t.classList.add("xa-w-full","xa-text-center"),t.innerHTML=`
      <div class="xa-login-tip">
       <span>Back to </span>
        <a class="xa-to-sign-in"> Sign in </a>
      </div>
    `,this.append(e,t)}setupListeners(){var e,t;const n=(e=this.modal.modalContainer)===null||e===void 0?void 0:e.querySelector(".xa-to-sign-in");n==null||n.addEventListener("click",()=>this.modal.switchModalState(F.Login));const o=(t=this.modal.modalContainer)===null||t===void 0?void 0:t.querySelector(".xa-to-forgotpwd");o==null||o.addEventListener("click",()=>this.modal.switchModalState(F.ForgotPassword))}handleEmailChange(e){var t;console.log({value:e}),(t=this.continueButton)===null||t===void 0||t.setDisabled(e.length===0)}handlePasswordChange(e){}handleUpdatePassword(){return u(this,null,function*(){var e,t,n,o,i,s,a;console.log(this.form);const l=this.form.getFormItemValue(m.Email),d=this.form.getFormItemValue(m.Password),v=this.form.getFormItemValue(m.ConfirmPassword),w=this.form.getFormItemValue(m.Code);if(!l||!d)return;(e=this.continueButton)===null||e===void 0||e.setLoading(!0);const{error:A,err_code:_}=yield B.resetPassword({email:l,password:d,code:w});if((t=this.continueButton)===null||t===void 0||t.setLoading(!1),A){switch(_){case 10001:(n=this.form.findFormItem(m.Code))===null||n===void 0||n.setError("Invalid verification code");break;case 11111:(o=this.form.findFormItem(m.Code))===null||o===void 0||o.setError("Invalid verification code");break;case 11112:(i=this.form.findFormItem(m.Code))===null||i===void 0||i.setError("Verification code expired");break;case 11113:(s=this.form.findFormItem(m.Email))===null||s===void 0||s.setError("User does not exist");break;default:(a=this.form.findFormItem(m.ConfirmPassword))===null||a===void 0||a.setError("Unknown error, please try again later.");break}return}this.modal.switchModalState(F.PasswordSuccess)})}append(e,t){e.appendChild(t)}}class Tt{constructor(){this.listeners=new Set}subscribe(e){return this.listeners.add(e),()=>this.listeners.delete(e)}notify(){this.listeners.forEach(e=>e())}}class Lt{constructor(){var e,t,n;this.accessToken=(e=k.tokens)===null||e===void 0?void 0:e.access_token,this.refreshToken=(t=k.tokens)===null||t===void 0?void 0:t.refresh_token,this.idToken=(n=k.tokens)===null||n===void 0?void 0:n.id_token}setTokens({accessToken:e,refreshToken:t,idToken:n}){this.accessToken=e,this.refreshToken=t,this.idToken=n,k.tokens={access_token:e,id_token:n,refresh_token:t}}removeTokens(){this.accessToken=void 0,this.refreshToken=void 0,this.idToken=void 0,k.deleteTokens()}}class Ft extends Tt{constructor(){super(),this.userState={isLogin:!1,userInfo:null},this.tokenManager=new Lt,this.refreshUserInfo(),this.listenStateChange()}listenStateChange(){const e={isLogin:!1,userInfo:null};this.userState=new Proxy(e,{set:(t,n,o)=>(console.log("userinfo settttt",o,t),t[n]!==o&&(t[n]=o,this.setPersistUserInfo(),this.notify()),!0)})}login(e,t){return u(this,null,function*(){const{error:n,err_code:o,access_token:i,id_token:s,refresh_token:a}=yield B.loginService(e,t);return!n&&i&&a?(this.tokenManager.setTokens({accessToken:i,refreshToken:a,idToken:s}),yield this.getUserInfo(),this.userState.isLogin=!0):this.userState.isLogin=!1,{error:!!n,err_code:o}})}confirmSignUpLogin(o){return u(this,arguments,function*({username:e,password:t,code:n}){const{error:i,err_code:s,access_token:a,id_token:l,refresh_token:d}=yield B.registerConfirmService({username:e,password:t,code:n});return!i&&a&&d?(this.tokenManager.setTokens({accessToken:a,refreshToken:d,idToken:l}),yield this.getUserInfo(),this.userState.isLogin=!0):this.userState.isLogin=!1,{error:!!i,err_code:s}})}getUserInfo(){return u(this,null,function*(){const e=yield B.getUserInfo();return e&&e.uuid&&(this.userState.userInfo=b(b({},this.userState.userInfo),e),this.userState.isLogin=!0),e})}setPersistUserInfo(){this.userState.userInfo&&(k.userInfo=this.userState.userInfo)}getPersistUserInfo(){return k.userInfo}refreshUserInfo(){return u(this,null,function*(){z.subscribe(e=>{this.userState.userInfo=e,this.userState.isLogin=K.isLogin}),this.tokenManager.idToken||this.logout()})}logout(){this.userState.isLogin=!1,this.userState.userInfo=null,this.tokenManager.removeTokens()}}var q;(function(r){r.Code="code"})(q||(q={}));class Ut extends te{constructor(e,t){super(e),this.signUpButton=null,this.extraData=t||{},this.form=new ae}render(){if(!this.modal.modalContainer)return;const e=this.modal.modalContainer;this.modal.setTitle("Verify email","Verification code has been sent to",this.extraData.email),this.renderCodeInput(e),this.renderConfirmButton(e),this.renderBackTip(e),this.setupListeners()}renderCodeInput(e){const t=new O({id:"xaCodeInput",label:"ENTER CODE",type:"text",showClearIcon:!0,onChange:o=>{this.handleCodeChange(o)}}),n=new P(q.Code,t.getElement(),()=>t.getValue());this.form.add(q.Code,n),this.append(e,n.getElement())}renderConfirmButton(e){const t=new ee({text:"CONTINUE",disabled:!0,onClick:n=>{console.log("signUpButton clicked"),this.handleContinueSignUp()}});this.signUpButton=t,this.append(e,t.getElement())}renderBackTip(e){const t=document.createElement("div");t.classList.add("xa-w-full","xa-text-center"),t.innerHTML=`
      <div class="xa-login-tip">
        <span>Already have an account? </span>
        <a class="xa-to-sign-in"> Sign in </a>
      </div>
    `,this.append(e,t)}setupListeners(){var e,t;const n=(e=this.modal.modalContainer)===null||e===void 0?void 0:e.querySelector(".xa-to-sign-in");n==null||n.addEventListener("click",()=>this.modal.switchModalState(F.Login));const o=(t=this.modal.modalContainer)===null||t===void 0?void 0:t.querySelector(".xa-to-forgotpwd");o==null||o.addEventListener("click",()=>this.modal.switchModalState(F.ForgotPassword))}handleCodeChange(e){var t;(t=this.signUpButton)===null||t===void 0||t.setDisabled(e.length===0)}append(e,t){e.appendChild(t)}handleContinueSignUp(){return u(this,null,function*(){var e,t,n,o,i,s;console.log(this.form);const a=this.form.getFormItemValue(q.Code),l=(e=this.extraData)===null||e===void 0?void 0:e.password,d=(t=this.extraData)===null||t===void 0?void 0:t.email;if(!l||!d||!a)return;(n=this.signUpButton)===null||n===void 0||n.setLoading(!0);const{error:v,err_code:w}=yield this.modal.store.confirmSignUpLogin({username:d,password:l,code:a});if((o=this.signUpButton)===null||o===void 0||o.setLoading(!1),v){switch(w){case 11111:(i=this.form.findFormItem(q.Code))===null||i===void 0||i.setError("Invalid verification code");break;default:(s=this.form.findFormItem(q.Code))===null||s===void 0||s.setError("Unknown error, please try again later.");break}return}this.modal.close()})}}const Pt="data:image/svg+xml,%3csvg%20width='80'%20height='80'%20viewBox='0%200%2064%2064'%20xmlns='http://www.w3.org/2000/svg'%3e%3csvg%20width='64'%20height='64'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3ccircle%20cx='32'%20cy='32'%20r='24'%20fill='url(%23paint0_linear_0_548)'%3e%3c/circle%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M44.535%2026L29%2041.535%2019.465%2032%2023%2028.465l6%206%2012-12L44.535%2026z'%20fill='%230A1161'%3e%3c/path%3e%3cdefs%3e%3clinearGradient%20id='paint0_linear_0_548'%20x1='8'%20y1='32.828'%20x2='56'%20y2='32.828'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20stop-color='%239EE6FC'%3e%3c/stop%3e%3cstop%20offset='1'%20stop-color='%23EBB9E7'%3e%3c/stop%3e%3c/linearGradient%3e%3c/defs%3e%3c/svg%3e%3c/svg%3e";function At(){const r=document.createElement("div");return r.classList.add("xa-modal-logo"),r.innerHTML=`
      <img src="${Pt}" alt="Xterio" class="xa-icon-success" />
    `,r}class Bt extends te{constructor(e,t){super(e)}render(){if(!this.modal.modalContainer)return;const e=this.modal.modalContainer;this.append(e,At()),this.modal.setTitle("Password has been changed!","Your password has been changed successfully"),this.renderConfirmButton(e)}renderConfirmButton(e){const t=new ee({text:"SIGN IN",onClick:n=>{this.modal.switchModalState(F.Login)}});this.append(e,t.getElement())}append(e,t){e.appendChild(t)}}class U{constructor(e){this.apiUrl=e,this.currentState=new Me(this),this.store=new Ft}static get instance(){if(!U._instance)throw new Error("AuthSDK is not initialized. Call AuthSDK.init(apiUrl, redirectUri) first.");return U._instance}static init(e){console.log("init....."),U._instance||(U._instance=new U(e))}open(){const e=document.createElement("div");e.className="xa-modal-overlay",this.modalOverlay=e,e.addEventListener("click",n=>{n.target});const t=document.createElement("div");this.modalContainer=t,t.className="xa-modal",this.renderCommonElement(t),e.appendChild(t),document.body.appendChild(e),this.currentState.render()}close(){var e,t;(e=this.modalContainer)===null||e===void 0||e.remove(),(t=this.modalOverlay)===null||t===void 0||t.remove()}renderCommonElement(e){const t=new bt;e.appendChild(t.getElement());const n=Be("icon-close",24,"#838383");n.addEventListener("click",()=>this.close()),n.className="xa-signin-close",e.appendChild(n);const o=document.createElement("div");o.className="xa-signin-title-container",o.innerHTML=`
        <h3 class="xa-signin-title">Sign in</h3>
        <p class="xa-signin-sub-title">Sign in with email</p>
        <div class="xa-signin-title-email"></div>
       `,e.appendChild(o)}setTitle(e,t,n){const o=document.querySelector(".xa-signin-title"),i=document.querySelector(".xa-signin-sub-title"),s=document.querySelector(".xa-signin-title-email");o.innerHTML=e,i.innerHTML=t,s&&n&&(s.innerHTML=n)}renderContent(){this.modalContainer&&(this.modalContainer.innerHTML="",this.renderCommonElement(this.modalContainer)),this.currentState.render()}switchModalState(e,t){switch(e){case"login":this.currentState=new Me(this,t);break;case"signup":this.currentState=new kt(this,t);break;case"signupCode":this.currentState=new Ut(this,t);break;case"forgotPassword":this.currentState=new St(this,t);break;case F.PasswordSuccess:this.currentState=new Bt(this,t);break}this.renderContent()}}const Re="3.7.7",Nt=Re,H=typeof Buffer=="function",Ve=typeof TextDecoder=="function"?new TextDecoder:void 0,je=typeof TextEncoder=="function"?new TextEncoder:void 0,re=Array.prototype.slice.call("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="),le=(r=>{let e={};return r.forEach((t,n)=>e[t]=n),e})(re),Ot=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,S=String.fromCharCode.bind(String),$e=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):r=>new Uint8Array(Array.prototype.slice.call(r,0)),ze=r=>r.replace(/=/g,"").replace(/[+\/]/g,e=>e=="+"?"-":"_"),qe=r=>r.replace(/[^A-Za-z0-9\+\/]/g,""),He=r=>{let e,t,n,o,i="";const s=r.length%3;for(let a=0;a<r.length;){if((t=r.charCodeAt(a++))>255||(n=r.charCodeAt(a++))>255||(o=r.charCodeAt(a++))>255)throw new TypeError("invalid character found");e=t<<16|n<<8|o,i+=re[e>>18&63]+re[e>>12&63]+re[e>>6&63]+re[e&63]}return s?i.slice(0,s-3)+"===".substring(s):i},Ee=typeof btoa=="function"?r=>btoa(r):H?r=>Buffer.from(r,"binary").toString("base64"):He,_e=H?r=>Buffer.from(r).toString("base64"):r=>{let t=[];for(let n=0,o=r.length;n<o;n+=4096)t.push(S.apply(null,r.subarray(n,n+4096)));return Ee(t.join(""))},ce=(r,e=!1)=>e?ze(_e(r)):_e(r),Mt=r=>{if(r.length<2){var e=r.charCodeAt(0);return e<128?r:e<2048?S(192|e>>>6)+S(128|e&63):S(224|e>>>12&15)+S(128|e>>>6&63)+S(128|e&63)}else{var e=65536+(r.charCodeAt(0)-55296)*1024+(r.charCodeAt(1)-56320);return S(240|e>>>18&7)+S(128|e>>>12&63)+S(128|e>>>6&63)+S(128|e&63)}},Dt=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,Xe=r=>r.replace(Dt,Mt),Ke=H?r=>Buffer.from(r,"utf8").toString("base64"):je?r=>_e(je.encode(r)):r=>Ee(Xe(r)),X=(r,e=!1)=>e?ze(Ke(r)):Ke(r),Ge=r=>X(r,!0),Rt=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,Vt=r=>{switch(r.length){case 4:var e=(7&r.charCodeAt(0))<<18|(63&r.charCodeAt(1))<<12|(63&r.charCodeAt(2))<<6|63&r.charCodeAt(3),t=e-65536;return S((t>>>10)+55296)+S((t&1023)+56320);case 3:return S((15&r.charCodeAt(0))<<12|(63&r.charCodeAt(1))<<6|63&r.charCodeAt(2));default:return S((31&r.charCodeAt(0))<<6|63&r.charCodeAt(1))}},We=r=>r.replace(Rt,Vt),Ze=r=>{if(r=r.replace(/\s+/g,""),!Ot.test(r))throw new TypeError("malformed base64.");r+="==".slice(2-(r.length&3));let e,t="",n,o;for(let i=0;i<r.length;)e=le[r.charAt(i++)]<<18|le[r.charAt(i++)]<<12|(n=le[r.charAt(i++)])<<6|(o=le[r.charAt(i++)]),t+=n===64?S(e>>16&255):o===64?S(e>>16&255,e>>8&255):S(e>>16&255,e>>8&255,e&255);return t},xe=typeof atob=="function"?r=>atob(qe(r)):H?r=>Buffer.from(r,"base64").toString("binary"):Ze,Ye=H?r=>$e(Buffer.from(r,"base64")):r=>$e(xe(r).split("").map(e=>e.charCodeAt(0))),Je=r=>Ye(Qe(r)),jt=H?r=>Buffer.from(r,"base64").toString("utf8"):Ve?r=>Ve.decode(Ye(r)):r=>We(xe(r)),Qe=r=>qe(r.replace(/[-_]/g,e=>e=="-"?"+":"/")),de=r=>jt(Qe(r)),$t=r=>{if(typeof r!="string")return!1;const e=r.replace(/\s+/g,"").replace(/={0,2}$/,"");return!/[^\s0-9a-zA-Z\+/]/.test(e)||!/[^\s0-9a-zA-Z\-_]/.test(e)},et=r=>({value:r,enumerable:!1,writable:!0,configurable:!0}),tt=function(){const r=(e,t)=>Object.defineProperty(String.prototype,e,et(t));r("fromBase64",function(){return de(this)}),r("toBase64",function(e){return X(this,e)}),r("toBase64URI",function(){return X(this,!0)}),r("toBase64URL",function(){return X(this,!0)}),r("toUint8Array",function(){return Je(this)})},rt=function(){const r=(e,t)=>Object.defineProperty(Uint8Array.prototype,e,et(t));r("toBase64",function(e){return ce(this,e)}),r("toBase64URI",function(){return ce(this,!0)}),r("toBase64URL",function(){return ce(this,!0)})},Ir={version:Re,VERSION:Nt,atob:xe,atobPolyfill:Ze,btoa:Ee,btoaPolyfill:He,fromBase64:de,toBase64:X,encode:X,encodeURI:Ge,encodeURL:Ge,utob:Xe,btou:We,decode:de,isValid:$t,fromUint8Array:ce,toUint8Array:Je,extendString:tt,extendUint8Array:rt,extendBuiltins:()=>{tt(),rt()}},zt={[c.Env.Dev]:"https://api.playvrs.net",[c.Env.Staging]:"https://api.xterio.net",[c.Env.Production]:"https://api.xterio.net"};class K{static get isLogin(){var e;return!!(!((e=J.userInfo)===null||e===void 0)&&e.uuid)}static get userinfo(){return J.userInfo}static get isVaildIdToken(){var e;const t=N.idToken;if(!t)return g("invalid token 1"),!1;const n=(e=t.split("."))===null||e===void 0?void 0:e[1];if(!n)return g("invalid token 2"),!1;try{const{aud:o,exp:i=0,sub:s}=JSON.parse(de(n));return!(!o||Date.now()>i*1e3)}catch(o){return g("invalid token 3",o),!1}}static checkToken(){return u(this,null,function*(){const e=k.tokens;e&&N.setTokens(e);const t=N.idToken,n=N.refreshToken;if(!t&&n){const i=yield B.refreshTokenService(n);N.setTokens({refresh_token:n,id_token:i.id_token,access_token:i.access_token})}const o=K.isVaildIdToken;g("check the tokens valid status:",o),o?yield B.getUserInfo():this.clearData()})}static checkCode(){return u(this,null,function*(){var e,t;const n=k.loginType;if(g("check the authorize status",n),n!==c.LoginType.Default&&n!==c.LoginType.Email)return;const o=(e=h.config)===null||e===void 0?void 0:e.redirect_uri;if(!o||!location.href.startsWith(o)){g("not check, different redirect_uri");return}const s=(t=ie.parseUrl(location.href,{types:{code:"string"}}).query)===null||t===void 0?void 0:t.code;if(!s)throw new Error("no authorize");o&&history.pushState(null,"",o),g("going to login ...");const a=yield B.login(s);a!=null&&a.uuid&&k.delete(I.LOGIN_TYPE)})}static init(e,t){return u(this,null,function*(){const{client_id:n,client_secret:o,redirect_uri:i="",mode:s}=e,a=t!=null?t:c.Env.Dev,l=zt[a],d={client_id:n||"",client_secret:o||"",redirect_uri:i,response_type:"code",scope:"all",mode:s||"default",grant_type:"authorization_code",logout:"1"};h.client_id=n||"",h.env=a,h.baseURL=l,h.authorizeUrl=l+"/account/v1/oauth2/authorize?"+ie.stringify(d),h.config=d,z.clear(),U.init(l),g(U.instance),yield this.checkToken(),window.addEventListener("load",v=>u(this,null,function*(){yield this.checkCode()}))})}static clearData(){k.delete(I.LOGIN_TYPE),k.deleteTokens(),k.deleteUserInfo(),N.removeTokens(),J.removeUserInfo()}static logout(){var e,t;g("logout success"),this.clearData(),(t=(e=U==null?void 0:U.instance)===null||e===void 0?void 0:e.store)===null||t===void 0||t.logout()}static login(e){return u(this,null,function*(){if(!h.config){g("xterio auth sdk initial failed");return}if(e&&e!==c.LoginType.Mini&&(h.config=M(b({},h.config),{mode:e}),h.authorizeUrl=h.baseURL+"/account/v1/oauth2/authorize?"+ie.stringify(h.config)),K.isLogin){g("already logined."),z.emit(Y.ACCOUNT,J.userInfo);return}if(K.isVaildIdToken)return g("get userinfo"),B.getUserInfo();if(e===c.LoginType.Mini){U.instance.open();return}k.loginType=e||c.LoginType.Default,g("going to authorize ..."),location.href=h.authorizeUrl})}}const qt=({onLoginStateChange:r})=>{const e=U.instance;function t(){e.open()}function n(){e.store.logout()}return e.store.subscribe(()=>{r==null||r(e.store.userState.isLogin,e.store.userState.userInfo)}),{open:t,logout:n}};c.XTERIO_CONST=I,c.XTERIO_EVENTS=Y,c.XterAuthModal=U,c.XterEventEmiter=z,c.XterioAuth=K,c.XterioAuthService=B,c.XterioAuthTokensManager=N,c.deleteFetcher=vt,c.getFetcher=ye,c.postFetcher=j,c.putFetcher=wt,c.useXterLoginModal=qt,Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})});
