(function(d,p){typeof exports=="object"&&typeof module!="undefined"?p(exports):typeof define=="function"&&define.amd?define(["exports"],p):(d=typeof globalThis!="undefined"?globalThis:d||self,p(d.XterioAuth={}))})(this,function(d){"use strict";var Zt=Object.defineProperty,Yt=Object.defineProperties;var Jt=Object.getOwnPropertyDescriptors;var rt=Object.getOwnPropertySymbols;var Qt=Object.prototype.hasOwnProperty,er=Object.prototype.propertyIsEnumerable;var nt=(d,p,E)=>p in d?Zt(d,p,{enumerable:!0,configurable:!0,writable:!0,value:E}):d[p]=E,y=(d,p)=>{for(var E in p||(p={}))Qt.call(p,E)&&nt(d,E,p[E]);if(rt)for(var E of rt(p))er.call(p,E)&&nt(d,E,p[E]);return d},B=(d,p)=>Yt(d,Jt(p));var u=(d,p,E)=>new Promise((P,H)=>{var te=N=>{try{V(E.next(N))}catch(K){H(K)}},re=N=>{try{V(E.throw(N))}catch(K){H(K)}},V=N=>N.done?P(N.value):Promise.resolve(N.value).then(te,re);V((E=E.apply(d,p)).next())});var p=(r=>(r.Dev="Dev",r.Staging="Staging",r.Production="Production",r))(p||{}),E=(r=>(r.EN="en",r.ZH_HANS="zh_hans",r.ZH_HANT="zh_hant",r.JA="ja",r.KO="ko",r))(E||{}),P=(r=>(r.Default="default",r.Email="email",r.Mini="mini",r))(P||{});const H="%[a-f0-9]{2}",te=new RegExp("("+H+")|([^%]+?)","gi"),re=new RegExp("("+H+")+","gi");function V(r,e){try{return[decodeURIComponent(r.join(""))]}catch(s){}if(r.length===1)return r;e=e||1;const t=r.slice(0,e),n=r.slice(e);return Array.prototype.concat.call([],V(t),V(n))}function N(r){try{return decodeURIComponent(r)}catch(e){let t=r.match(te)||[];for(let n=1;n<t.length;n++)r=V(t,n).join(""),t=r.match(te)||[];return r}}function K(r){const e={"%FE%FF":"��","%FF%FE":"��"};let t=re.exec(r);for(;t;){try{e[t[0]]=decodeURIComponent(t[0])}catch(s){const o=N(t[0]);o!==t[0]&&(e[t[0]]=o)}t=re.exec(r)}e["%C2"]="�";const n=Object.keys(e);for(const s of n)r=r.replace(new RegExp(s,"g"),e[s]);return r}function st(r){if(typeof r!="string")throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof r+"`");try{return decodeURIComponent(r)}catch(e){return K(r)}}function he(r,e){const t={};if(Array.isArray(e))for(const n of e){const s=Object.getOwnPropertyDescriptor(r,n);s!=null&&s.enumerable&&Object.defineProperty(t,n,s)}else for(const n of Reflect.ownKeys(r)){const s=Object.getOwnPropertyDescriptor(r,n);if(s.enumerable){const o=r[n];e(n,o,r)&&Object.defineProperty(t,n,s)}}return t}function tr(r,e){if(Array.isArray(e)){const t=new Set(e);return he(r,n=>!t.has(n))}return he(r,(t,n,s)=>!e(t,n,s))}function ke(r,e){if(!(typeof r=="string"&&typeof e=="string"))throw new TypeError("Expected the arguments to be of type `string`");if(r===""||e==="")return[];const t=r.indexOf(e);return t===-1?[]:[r.slice(0,t),r.slice(t+e.length)]}const ot=r=>r==null,it=r=>encodeURIComponent(r).replaceAll(/[!'()*]/g,e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`),fe=Symbol("encodeFragmentIdentifier");function at(r){switch(r.arrayFormat){case"index":return e=>(t,n)=>{const s=t.length;return n===void 0||r.skipNull&&n===null||r.skipEmptyString&&n===""?t:n===null?[...t,[C(e,r),"[",s,"]"].join("")]:[...t,[C(e,r),"[",C(s,r),"]=",C(n,r)].join("")]};case"bracket":return e=>(t,n)=>n===void 0||r.skipNull&&n===null||r.skipEmptyString&&n===""?t:n===null?[...t,[C(e,r),"[]"].join("")]:[...t,[C(e,r),"[]=",C(n,r)].join("")];case"colon-list-separator":return e=>(t,n)=>n===void 0||r.skipNull&&n===null||r.skipEmptyString&&n===""?t:n===null?[...t,[C(e,r),":list="].join("")]:[...t,[C(e,r),":list=",C(n,r)].join("")];case"comma":case"separator":case"bracket-separator":{const e=r.arrayFormat==="bracket-separator"?"[]=":"=";return t=>(n,s)=>s===void 0||r.skipNull&&s===null||r.skipEmptyString&&s===""?n:(s=s===null?"":s,n.length===0?[[C(t,r),e,C(s,r)].join("")]:[[n,C(s,r)].join(r.arrayFormatSeparator)])}default:return e=>(t,n)=>n===void 0||r.skipNull&&n===null||r.skipEmptyString&&n===""?t:n===null?[...t,C(e,r)]:[...t,[C(e,r),"=",C(n,r)].join("")]}}function ct(r){let e;switch(r.arrayFormat){case"index":return(t,n,s)=>{if(e=/\[(\d*)]$/.exec(t),t=t.replace(/\[\d*]$/,""),!e){s[t]=n;return}s[t]===void 0&&(s[t]={}),s[t][e[1]]=n};case"bracket":return(t,n,s)=>{if(e=/(\[])$/.exec(t),t=t.replace(/\[]$/,""),!e){s[t]=n;return}if(s[t]===void 0){s[t]=[n];return}s[t]=[...s[t],n]};case"colon-list-separator":return(t,n,s)=>{if(e=/(:list)$/.exec(t),t=t.replace(/:list$/,""),!e){s[t]=n;return}if(s[t]===void 0){s[t]=[n];return}s[t]=[...s[t],n]};case"comma":case"separator":return(t,n,s)=>{const o=typeof n=="string"&&n.includes(r.arrayFormatSeparator),i=typeof n=="string"&&!o&&O(n,r).includes(r.arrayFormatSeparator);n=i?O(n,r):n;const a=o||i?n.split(r.arrayFormatSeparator).map(c=>O(c,r)):n===null?n:O(n,r);s[t]=a};case"bracket-separator":return(t,n,s)=>{const o=/(\[])$/.test(t);if(t=t.replace(/\[]$/,""),!o){s[t]=n&&O(n,r);return}const i=n===null?[]:n.split(r.arrayFormatSeparator).map(a=>O(a,r));if(s[t]===void 0){s[t]=i;return}s[t]=[...s[t],...i]};default:return(t,n,s)=>{if(s[t]===void 0){s[t]=n;return}s[t]=[...[s[t]].flat(),n]}}}function Se(r){if(typeof r!="string"||r.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function C(r,e){return e.encode?e.strict?it(r):encodeURIComponent(r):r}function O(r,e){return e.decode?st(r):r}function ve(r){return Array.isArray(r)?r.sort():typeof r=="object"?ve(Object.keys(r)).sort((e,t)=>Number(e)-Number(t)).map(e=>r[e]):r}function _e(r){const e=r.indexOf("#");return e!==-1&&(r=r.slice(0,e)),r}function lt(r){let e="";const t=r.indexOf("#");return t!==-1&&(e=r.slice(t)),e}function Te(r,e,t){return t==="string"&&typeof r=="string"?r:typeof t=="function"&&typeof r=="string"?t(r):e.parseBooleans&&r!==null&&(r.toLowerCase()==="true"||r.toLowerCase()==="false")?r.toLowerCase()==="true":t==="number"&&!Number.isNaN(Number(r))&&typeof r=="string"&&r.trim()!==""||e.parseNumbers&&!Number.isNaN(Number(r))&&typeof r=="string"&&r.trim()!==""?Number(r):r}function me(r){r=_e(r);const e=r.indexOf("?");return e===-1?"":r.slice(e+1)}function pe(r,e){e=y({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1,types:Object.create(null)},e),Se(e.arrayFormatSeparator);const t=ct(e),n=Object.create(null);if(typeof r!="string"||(r=r.trim().replace(/^[?#&]/,""),!r))return n;for(const s of r.split("&")){if(s==="")continue;const o=e.decode?s.replaceAll("+"," "):s;let[i,a]=ke(o,"=");i===void 0&&(i=o),a=a===void 0?null:["comma","separator","bracket-separator"].includes(e.arrayFormat)?a:O(a,e),t(O(i,e),a,n)}for(const[s,o]of Object.entries(n))if(typeof o=="object"&&o!==null&&e.types[s]!=="string")for(const[i,a]of Object.entries(o)){const c=e.types[s]?e.types[s].replace("[]",""):void 0;o[i]=Te(a,e,c)}else typeof o=="object"&&o!==null&&e.types[s]==="string"?n[s]=Object.values(o).join(e.arrayFormatSeparator):n[s]=Te(o,e,e.types[s]);return e.sort===!1?n:(e.sort===!0?Object.keys(n).sort():Object.keys(n).sort(e.sort)).reduce((s,o)=>{const i=n[o];return s[o]=i&&typeof i=="object"&&!Array.isArray(i)?ve(i):i,s},Object.create(null))}function Fe(r,e){if(!r)return"";e=y({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},e),Se(e.arrayFormatSeparator);const t=i=>e.skipNull&&ot(r[i])||e.skipEmptyString&&r[i]==="",n=at(e),s={};for(const[i,a]of Object.entries(r))t(i)||(s[i]=a);const o=Object.keys(s);return e.sort!==!1&&o.sort(e.sort),o.map(i=>{const a=r[i];return a===void 0?"":a===null?C(i,e):Array.isArray(a)?a.length===0&&e.arrayFormat==="bracket-separator"?C(i,e)+"[]":a.reduce(n(i),[]).join("&"):C(i,e)+"="+C(a,e)}).filter(i=>i.length>0).join("&")}function Le(r,e){var s,o;e=y({decode:!0},e);let[t,n]=ke(r,"#");return t===void 0&&(t=r),y({url:(o=(s=t==null?void 0:t.split("?"))==null?void 0:s[0])!=null?o:"",query:pe(me(r),e)},e&&e.parseFragmentIdentifier&&n?{fragmentIdentifier:O(n,e)}:{})}function Ue(r,e){e=y({encode:!0,strict:!0,[fe]:!0},e);const t=_e(r.url).split("?")[0]||"",n=me(r.url),s=y(y({},pe(n,{sort:!1})),r.query);let o=Fe(s,e);o&&(o=`?${o}`);let i=lt(r.url);if(typeof r.fragmentIdentifier=="string"){const a=new URL(t);a.hash=r.fragmentIdentifier,i=e[fe]?a.hash:`#${r.fragmentIdentifier}`}return`${t}${o}${i}`}function Ae(r,e,t){t=y({parseFragmentIdentifier:!0,[fe]:!1},t);const{url:n,query:s,fragmentIdentifier:o}=Le(r,t);return Ue({url:n,query:he(s,e),fragmentIdentifier:o},t)}function dt(r,e,t){const n=Array.isArray(e)?s=>!e.includes(s):(s,o)=>!e(s,o);return Ae(r,n,t)}const ne=Object.freeze(Object.defineProperty({__proto__:null,exclude:dt,extract:me,parse:pe,parseUrl:Le,pick:Ae,stringify:Fe,stringifyUrl:Ue},Symbol.toStringTag,{value:"Module"})),ut="xterio-sdk",ge="1.0.0",dr={name:ut,version:ge,description:"",main:"index.js",scripts:{preinstall:"npx -y only-allow pnpm",clear:'find . -name "node_modules" -type d -exec rm -rf {} +',test:'echo "Error: no test specified" && exit 1',prepare:"husky",commitlint:"npx commitlint --edit $1",lint:"eslint .","lint:fix":"eslint . --fix",build:"tsx sh/build.ts","build:tg-mini-app":"turbo tg-mini-app#build --filter=tg-mini-app --filter=@xterio-sdk/auth","build:auth":"tsx sh/build.ts auth","build:wallet":"tsx sh/build.ts wallet","dev:auth":"cd xterio-auth && npm run dev","dev:wallet":"cd xterio-wallet && npm run dev","dev:tg-mini-app":"turbo watch dev-watch --filter=tg-mini-app --filter=@xterio-sdk/auth","example:auth":"cd examples/example-auth && npm run dev","example:auth-react":"cd examples/example-auth-react && npm run dev","example:auth-vue":"cd examples/example-auth-vue && npm run dev","example:auth-tg":"cd examples/tg-mini-app && npm run dev","example:wallet":"cd examples/example-wallet-react && npm run dev"},keywords:[],author:"",license:"ISC",devDependencies:{"@commitlint/cli":"^19.4.0","@commitlint/config-conventional":"^19.2.2","@eslint/js":"^9.9.0","@types/fs-extra":"^11.0.4","@typescript-eslint/eslint-plugin":"^8.0.1","@typescript-eslint/parser":"^8.0.1",chalk:"^5.3.0",consola:"^3.2.3",eslint:"^9.9.0","eslint-config-prettier":"^9.1.0","eslint-define-config":"^2.1.0","eslint-plugin-n":"^16.6.2","eslint-plugin-oxlint":"^0.7.1","eslint-plugin-prettier":"^5.2.1","eslint-plugin-promise":"^6.6.0","eslint-plugin-react":"^7.35.0","fs-extra":"^11.2.0",globals:"^15.9.0",husky:"^9.1.4","lint-staged":"^15.2.8",prettier:"^3.3.3",tsx:"^4.19.0",turbo:"^2.1.1",typescript:"^5.5.4","typescript-eslint":"^8.0.1"},"lint-staged":{"*.{js,ts,jsx,tsx}":"eslint --fix"},packageManager:"pnpm@9.9.0"},f=(...r)=>{console.log(`[XterioAuth(v${ge})]`,...r)},ht=()=>ge,ur=()=>{const r=Date.now()*Math.pow(10,3),e=Math.floor(Math.random()*Math.pow(10,3));return r+e},ft=r=>{r=r||32;const e="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",t=e.length;let n="";for(let s=0;s<r;s++)n+=e.charAt(Math.floor(Math.random()*t));return n},G={LOGIN:"xter_auth_login_success",ACCOUNT:"xter_auth_response_userinfo",REQ_ACCOUNT:"xter_auth_request_userinfo"},I={LOGIN_TYPE:"xter_auth_login_type",TOKENS:"xter_auth_login_tokens",ID_TOKEN:"xter_auth_id_token",REFRESH_TOKEN:"xter_auth_refresh_token",ACCESS_TOKEN:"xter_auth_access_token",USERINFO:"xter_auth_userinfo"};/*! js-cookie v3.0.5 | MIT */function se(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)r[n]=t[n]}return r}var mt={read:function(r){return r[0]==='"'&&(r=r.slice(1,-1)),r.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(r){return encodeURIComponent(r).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}};function we(r,e){function t(s,o,i){if(typeof document!="undefined"){i=se({},e,i),typeof i.expires=="number"&&(i.expires=new Date(Date.now()+i.expires*864e5)),i.expires&&(i.expires=i.expires.toUTCString()),s=encodeURIComponent(s).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var a="";for(var c in i)i[c]&&(a+="; "+c,i[c]!==!0&&(a+="="+i[c].split(";")[0]));return document.cookie=s+"="+r.write(o,s)+a}}function n(s){if(!(typeof document=="undefined"||arguments.length&&!s)){for(var o=document.cookie?document.cookie.split("; "):[],i={},a=0;a<o.length;a++){var c=o[a].split("="),l=c.slice(1).join("=");try{var h=decodeURIComponent(c[0]);if(i[h]=r.read(l,h),s===h)break}catch(g){}}return s?i[s]:i}}return Object.create({set:t,get:n,remove:function(s,o){t(s,"",se({},o,{expires:-1}))},withAttributes:function(s){return we(this.converter,se({},this.attributes,s))},withConverter:function(s){return we(se({},this.converter,s),this.attributes)}},{attributes:{value:Object.freeze(e)},converter:{value:Object.freeze(r)}})}var M=we(mt,{path:"/"});class k{static set loginType(e){localStorage.setItem(I.LOGIN_TYPE,e)}static get loginType(){const e=localStorage.getItem(I.LOGIN_TYPE);return e||void 0}static set tokens(e){const{access_token:t="",id_token:n="",refresh_token:s=""}=e;M.set(I.ACCESS_TOKEN,t,{expires:1}),M.set(I.ID_TOKEN,n,{expires:1}),M.set(I.REFRESH_TOKEN,s)}static get tokens(){return{access_token:M.get(I.ACCESS_TOKEN)||"",id_token:M.get(I.ID_TOKEN)||"",refresh_token:M.get(I.REFRESH_TOKEN)||""}}static deleteTokens(){M.remove(I.ACCESS_TOKEN),M.remove(I.REFRESH_TOKEN),M.remove(I.ID_TOKEN)}static set userInfo(e){localStorage.setItem(I.USERINFO,JSON.stringify(e))}static get userInfo(){const e=localStorage.getItem(I.USERINFO);try{if(e)return JSON.parse(e)}catch(t){return}}static deleteUserInfo(){localStorage.removeItem(I.USERINFO)}static delete(e){localStorage.removeItem(e)}}const Q=class Q{};Q.client_id="",Q.baseURL="",Q.authorizeUrl="";let m=Q;class D{static setTokens(e){const{id_token:t="",access_token:n="",refresh_token:s=""}=e||{};m.tokens={id_token:t,access_token:n,refresh_token:s},k.tokens=e}static removeTokens(){m.tokens=void 0}static get idToken(){var e;return((e=m.tokens)==null?void 0:e.id_token)||""}static get refreshToken(){var e;return((e=m.tokens)==null?void 0:e.refresh_token)||""}}class X{static setUserInfo(e){m.userInfo=e,k.userInfo=e}static removeUserInfo(){m.userInfo=void 0}static get userInfo(){return m.userInfo}}function pt(r){return u(this,null,function*(){const e=yield r.json();return e.err_code!=0?(r.status===401&&e.err_code===91001||r.status,Promise.reject(e)):e.data})}function gt(r,e){return!e||/^https?:\/\//i.test(r)?r:r.startsWith("/")?`${e}${r}`:`${e}/${r}`}const W=i=>u(this,[i],function*({method:r,path:e,params:t,headers:n,data:s,Authorization:o}){var h;if(!m.client_id)throw new Error("You need set xterio-auth info");if(t){const g=ne.stringify(t);e+=(e.includes("?")?"&":"?")+`${g}`}const a=gt(e,m.baseURL),c={method:r,headers:y({"content-type":"application/json",sdkVersion:ht(),platform:"pc",clientId:m.client_id,timestamp:Date.now().toString(),language:"en",nonce:ft(),Authorization:o||((h=k.tokens)==null?void 0:h.id_token)||""},n)};if(s){const g=r!=="PUT"&&(n==null?void 0:n["content-type"])!=="application/x-www-form-urlencoded";c.body=g?JSON.stringify(s):s}const l=new Request(a,c);try{const g=yield fetch(l);return r==="PUT"?g:pt(g)}catch(g){throw new Error("Network error")}});function xe(r,e,t){return u(this,null,function*(){return W({method:"GET",path:r,params:e,Authorization:t})})}function R(r,e,t,n){return u(this,null,function*(){return W({method:"POST",path:r,data:e,headers:n,Authorization:t})})}function wt(r,e){return u(this,null,function*(){return W({method:"DELETE",path:r,data:e})})}function xt(r,e,t){return u(this,null,function*(){return W({method:"PUT",path:r,data:e,headers:t})})}function hr(r,e,t,n){return u(this,null,function*(){return W({method:"PATCH",path:r,data:e,headers:t,Authorization:n})})}const le=class le{static set listeners(e){this._listeners=e}static get listeners(){return this._listeners}static on(e,t){this._listeners[e]||(this._listeners[e]=[]),this._listeners[e].push(t)}static off(e,t){this._listeners[e]&&(this._listeners[e]=this._listeners[e].filter(n=>n!==t))}static emit(e,...t){this._listeners[e]&&this._listeners[e].forEach(n=>{n(...t)})}static remove(e){this._listeners[e]&&delete this._listeners[e]}static subscribe(e,t){const n=t||G.ACCOUNT;f("subscribe event",n);const s=o=>{e==null||e(o)};this._cacheMap.set(n,s),this.on(n,s)}static unsubscribe(e){const t=e||G.ACCOUNT;f("unsubscribe event",t);const n=this._cacheMap.get(t);n&&(this.off(t,n),this._cacheMap.delete(t))}static clear(){this.listeners={},this._cacheMap.clear()}};le._listeners={},le._cacheMap=new Map;let j=le;class U{static login(e){return u(this,null,function*(){const{client_id:t,client_secret:n,redirect_uri:s,grant_type:o}=m.config||{},a={client_id:t,client_secret:n,redirect_uri:s,grant_type:o,code:e};f("go login");const c=yield R("/account/v1/oauth2/token",a).then(l=>(f("login success."),D.setTokens(l),l)).catch(l=>(f("login failed."),null));if(c!=null&&c.id_token){f("get userinfo");const l=yield this.getUserInfo();if(l.uuid)return l}return null})}static getUserInfo(){return u(this,null,function*(){const[e,t]=yield Promise.all([this.getProfile(),this.getWallet()]),n=B(y({},e),{wallet:t});return X.setUserInfo(n),n!=null&&n.uuid&&j.emit(G.ACCOUNT,n),n})}static getProfile(){return u(this,null,function*(){const e=yield xe("/account/v1/user/profile").then(t=>(f("get profile success."),t)).catch(t=>(f("get profile failed."),null));return e!=null&&e.uuid?y({},e):{}})}static getWallet(){return u(this,null,function*(){const e=yield xe("/account/v1/wallet").then(t=>(f("get wallet success."),t)).catch(t=>(f("get wallet failed."),null));return(e==null?void 0:e.wallet)||[]})}static loginService(e,t){return u(this,null,function*(){const n=yield R("/account/v1/login",{username:e,password:t}).catch(s=>B(y({},s),{error:!0}));return f("ttl login",n.error?"failed":"success"),n!=null&&n.error?B(y({},n),{error:!0}):B(y({},n),{error:!1})})}static refreshTokenService(e){return R("/auth/v1/refresh",{refresh_token:e}).catch(()=>({}))}static registerService(s){return u(this,arguments,function*({username:e,password:t,subscribe:n}){const o=yield R("/account/v1/register",{username:e,password:t,subscribe:n?1:0,invite_code:"","h-recaptcha-response":""}).catch(i=>B(y({},i),{error:!0}));return f("ttl register",o.error?"failed":"success"),o!=null&&o.error?{error:!0,err_code:o.err_code}:{error:!1}})}static registerConfirmService(s){return u(this,arguments,function*({username:e,password:t,code:n}){const o=yield R("/account/v1/register/code/confirm",{username:e,code:n,password:t}).catch(i=>({error:!0,err_code:i.err_code}));return f("ttl register confirm",o.error?"failed":"success"),o.error?o:B(y({},o),{error:!1})})}static sendForgotCodeService(t){return u(this,arguments,function*({email:e}){const n=yield R("/account/v1/password/forgot?source=forgot",{username:e}).catch(s=>({error:!0,err_code:s.err_code}));return f("ttl forgot psd",n.error?"failed":"success"),n.error?n:B(y({},n),{error:!1})})}static resetPassword(s){return u(this,arguments,function*({email:e,code:t,password:n}){const o=yield R("/account/v1/password/forgot/confirm",{username:e,password:n,confirmation_code:t}).catch(i=>({error:!0,err_code:i.err_code}));return f("ttl forgot psd confirm",o.error?"failed":"success"),o.error?o:B(y({},o),{error:!1})})}}const yt="data:image/svg+xml,%3csvg%20width='116'%20height='24'%20viewBox='0%200%20116.36363983154297%2024'%20xmlns='http://www.w3.org/2000/svg'%20class='mb-0'%3e%3cg%20clip-path='url(%23clip0_0_335)'%20fill-rule='evenodd'%20clip-rule='evenodd'%3e%3cpath%20d='M28.032%203.485a.222.222%200%2000.024.067c.006.355.014.709.027%201.073a4979.123%204979.123%200%2001.084%2010.93c-.003.18.01.36.035.538.323%201.904%201.251%203.422%202.9%204.466%201.12.71%202.363%201.104%203.658%201.347a20.98%2020.98%200%20005.866.214c.113-.01.121-.06.121-.152-.005-1.454-.005-2.91%200-4.37%200-.117-.036-.137-.143-.137a10.497%2010.497%200%2001-2.263-.267c-1-.246-1.919-.646-2.642-1.403-.681-.713-1.061-1.553-1.055-2.554a286.7%20286.7%200%20000-3.71c-.002-.165.05-.19.199-.19h4.782c.113%200%20.15-.023.15-.145a531.922%20531.922%200%20010-4.265c0-.131-.037-.15-.159-.15-1.634.005-3.278.005-4.916.005-.132%200-.177-.023-.177-.168V.77l-.008-.001.006-.003.006-.039h-6.495v2.758zM1.285%2021.519c-.185.187-.372.375-.557.566-.004.064.033.059.066.054.01-.001.02-.003.028-.002h7.892a.235.235%200%2000.183-.084l2.242-2.3%201.945-2.004.004-.003c.044-.045.075-.075.137-.009.322.342.648.676.973%201.01l.09.093a888.395%20888.395%200%20013.104%203.22.245.245%200%2000.197.08h7.863l.025.002c.03.005.062.01.084-.03l-.013-.015c-.009-.01-.017-.02-.026-.028l-2.454-2.536-3.906-4.037c-.607-.63-1.217-1.26-1.83-1.887-.08-.088-.112-.148%200-.243a3.69%203.69%200%2000.304-.311l2.76-2.848%204.348-4.5.851-.886h-7.951a.377.377%200%2000-.298.13c-.422.446-.847.885-1.271%201.324l-.001.001-.365.377-.658.679c-.596.613-1.191%201.227-1.783%201.85-.093.093-.13.088-.214%200l-.679-.706-.004-.004-.001-.001-.962-1c-.82-.842-1.638-1.687-2.455-2.533a.307.307%200%2000-.243-.108H.892c-.011%200-.024-.003-.036-.006-.04-.008-.082-.016-.1.047.603.61%201.2%201.221%201.792%201.836l3.873%204.005c.868.9%201.738%201.801%202.61%202.702.058.058.054.087%200%20.142-.14.137-.275.277-.41.417l-.146.152-4.32%204.45-2.364%202.431c-.168.173-.337.343-.506.513zm75.88-15.013a14.2%2014.2%200%2000-1.882%201.259%201.053%201.053%200%2000-.005-.069V4.933c0-.117-.018-.158-.15-.158-1.734.005-3.468.005-5.202%200-.126%200-.154.035-.154.157v17.143c-.002.129.037.152.16.152%201.728-.006%203.457-.006%205.186%200%20.14%200%20.16-.046.16-.168v-6.981c-.002-.085.01-.17.035-.25.255-.8.686-1.533%201.262-2.144.852-.934%201.902-1.6%203.04-2.134a16.1%2016.1%200%20013.839-1.233c.096-.018.13-.048.13-.152V4.916c0-.088%200-.155-.122-.144-.082.006-.166.007-.25.007-.067%200-.133.001-.2.004-2.057.11-4.06.7-5.848%201.723zm14.31%209.27v6.29c0%20.14-.038.162-.167.162h-4.99c-.122%200-.159-.027-.159-.154V9.429c0-.122.037-.156.158-.156h4.992c.13%200%20.166.03.166.163-.003%202.114-.003%204.227%200%206.34zm-34.051-.8h-9.638c-.09%200-.136%200-.155.022-.02.023-.013.069%200%20.161.18%201.25%201.014%202.09%202.265%202.25.37.03.741.036%201.112.02h3.759l1.308.003c.435.002.871.003%201.307.003.712%200%201.423%200%202.134-.015.495-.01.931-.218%201.355-.449.307-.169.6-.363.875-.581a.148.148%200%2001.196-.018c1.32.742%202.645%201.481%203.97%202.217.1.054.098.091.05.179-.84%201.486-2.1%202.473-3.669%203.096-.33.132-.67.237-1.016.316a1.413%201.413%200%2001-.327.037l-4.1-.001c-2.733-.002-5.467-.004-8.2.001a5.605%205.605%200%2001-2.928-.815c-1.293-.768-2.14-1.905-2.686-3.283a10.58%2010.58%200%2001-.662-3.005c-.095-1.046-.076-2.1.057-3.143.243-1.83.851-3.504%202.116-4.89a7.38%207.38%200%20013.851-2.258c.093-.02.188-.03.282-.029l3.468-.003c3.004-.003%206.008-.007%209.013.014%201.276.009%202.395.522%203.34%201.384.902.823%201.479%201.856%201.896%202.987.394%201.108.649%202.261.758%203.432.08.736.112%201.477.096%202.217%200%20.131-.041.15-.159.15h-9.668zm-2.53-3.56H47.77c-.089%200-.133%200-.153-.023-.021-.022-.016-.069-.005-.162.09-.788.571-1.285%201.233-1.646.302-.169.642-.255.988-.252%203.485.01%206.973.01%2010.464%200a1.492%201.492%200%20011.24.608c.306.41.526.877.646%201.374.019.07.013.107-.071.097a1.012%201.012%200%2000-.105%200l-7.111.004z'%20fill='currentColor'%3e%3c/path%3e%3cpath%20d='M113.607%2020.397a10.451%2010.451%200%20002.149-9.746c-1.696-5.954-8.221-9.124-13.981-6.796-.984.397-1.863.964-2.714%201.589-1.028.764-2.2.992-3.46.764-.973-.175-1.84-.587-2.674-1.073a2.051%202.051%200%2001-.91-1.101%202.726%202.726%200%2001-.086-.313%203.19%203.19%200%2000-5.396-1.542%203.187%203.187%200%2000-.894%201.974c-.192%202.29%202.083%204.035%204.246%203.246a2.172%202.172%200%20011.84.132%2010.35%2010.35%200%20011.728%201.124c1.325%201.086%201.977%202.45%201.824%204.187a9.748%209.748%200%2000.399%203.636%2010.456%2010.456%200%200017.929%203.919zm-12.321-9.728a5.272%205.272%200%2000-.889%202.928%205.281%205.281%200%20005.264%205.272%205.275%205.275%200%20004.874-3.25%205.272%205.272%200%2000-9.249-4.95z'%20fill='url(%23paint0_linear_0_335)'%3e%3c/path%3e%3c/g%3e%3cdefs%3e%3clinearGradient%20id='paint0_linear_0_335'%20x1='85.629'%20y1='1.216'%20x2='116.167'%20y2='24.119'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20stop-color='%23CBF2FE'%3e%3c/stop%3e%3cstop%20offset='0.391'%20stop-color='%237DD5F9'%3e%3c/stop%3e%3cstop%20offset='0.735'%20stop-color='%23E6B1F7'%3e%3c/stop%3e%3cstop%20offset='1'%20stop-color='%23E1DFA2'%3e%3c/stop%3e%3c/linearGradient%3e%3cclipPath%20id='clip0_0_335'%3e%3cpath%20fill='%23fff'%20d='M0%200h116.364v24H0z'%3e%3c/path%3e%3c/clipPath%3e%3c/defs%3e%3c/svg%3e";class Ct{getElement(){const e=document.createElement("div");return e.classList.add("xa-modal-logo"),e.innerHTML=`
      <img src="${yt}" alt="Xterio" class="auth-logo" />
    `,e}}const ye={"icon-close":'<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M13.414 12l6-6L18 4.586l-6 6-6-6L4.586 6l6 6-6 6L6 19.414l6-6 6 6L19.414 18l-6-6z" fill="currentColor"></path></svg>',"icon-show":'<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" style="color: rgb(254, 254, 254);"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 4C4 4 2 12 2 12s2 8 10 8 10-8 10-8-2-8-10-8zm-7.716 7.52c-.076.18-.137.342-.187.48A10.894 10.894 0 005.6 14.8C6.827 16.436 8.786 18 12 18c3.214 0 5.173-1.564 6.4-3.2a10.89 10.89 0 001.503-2.8A10.89 10.89 0 0018.4 9.2C17.173 7.564 15.214 6 12 6 8.786 6 6.827 7.564 5.6 9.2c-.626.834-1.05 1.68-1.316 2.32zM14 12a2 2 0 11-4 0 2 2 0 014 0zm2 0a4 4 0 11-8 0 4 4 0 018 0z" fill="currentColor"></path></svg>',"icon-hide":'<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" style="color: rgb(254, 254, 254);"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 4C4 4 2 12 2 12s1.028 4.113 4.56 6.44L5 20l1.414 1.414 2.023-2.023c1.03.38 2.21.609 3.563.609 8 0 10-8 10-8s-.516-2.066-2.074-4.098l1.488-1.488L20 5l-1.43 1.43C17.052 5.073 14.927 4 12 4zm5.153 3.847C15.948 6.797 14.293 6 12 6 8.786 6 6.827 7.564 5.6 9.2A10.894 10.894 0 004.097 12 10.894 10.894 0 005.6 14.8c.605.807 1.388 1.596 2.411 2.189l9.142-9.142zm-7.11 9.939A8.673 8.673 0 0012 18c3.214 0 5.173-1.564 6.4-3.2a10.89 10.89 0 001.503-2.8 10.946 10.946 0 00-1.406-2.668l-2.5 2.5L16 12a4 4 0 01-4.168 3.996l-1.79 1.79zM12 10c.064 0 .128.003.191.009l1.591-1.591a4 4 0 00-5.364 5.364l1.591-1.591A2 2 0 0112 10z" fill="currentColor"></path></svg>'},fr=(...r)=>{let e="";for(let t=0;t<Math.floor(r.length/2);t++){const n=r[t*2],s=r[t*2+1];e+=`${n}: ${s};`}return e},Be=(r,e=16,t)=>{const n=document.createElement("div");return n.style.cssText=`width: ${e}px; height:${e}px; display:inline-block; color: ${t!=null?t:"#ccc"};`,n.innerHTML=ye==null?void 0:ye[r],n};class A{constructor(e){this.clearIcon=null,this.props=e,this.inputElement=null,this.root=this.createInputElement(),this.setUpEventListeners()}createInputElement(){const{id:e,type:t,label:n,wrapperClassNames:s,showClearIcon:o,showPasswordToggleIcon:i,onChange:a,onBlur:c,onFocus:l}=this.props,h=document.createElement("div");h.classList.add("xa-input-wrapper",`xa-input-wrapper-${t}`),s&&s.forEach(w=>h.classList.add(w));const g=document.createElement("span");g.className="xa-input-label",g.textContent=n,h.appendChild(g);const v=document.createElement("div");v.className="xa-input-inner";const x=document.createElement("input");if(x.type=t==="password"?"password":t,x.id="auth-input",x.className="xa-input",x.placeholder="",this.inputElement=x,v.appendChild(x),o){const w=document.createElement("div");w.className="xa-input-clear",w.appendChild(Be("icon-close")),w.style.visibility="hidden",w.addEventListener("click",()=>{x.value="",w.style.visibility="hidden"}),this.clearIcon=w,v.appendChild(w)}if(t==="password"&&i){const w=document.createElement("div");w.className="xa-input-value-hide",w.addEventListener("click",()=>{x.type==="password"?(x.type="text",w.className="xa-input-value-show"):(x.type="password",w.className="xa-input-value-hide")}),v.appendChild(w)}if(this.props.addonAfterSendButton){const{onClick:w,onCountdownEnd:L}=this.props.addonAfterSendButton,b=document.createElement("button");b.className="xa-input-addon-btn",b.textContent="SEND",b.addEventListener("click",ee=>{ee.stopPropagation(),ee.preventDefault(),b.disabled=!0;let ue=60;const Wt=setInterval(()=>{ue--,ue===0?(b.disabled=!1,b.textContent="SEND",clearInterval(Wt),L==null||L()):(b.disabled=!0,b.textContent=`${ue-1}s`)},1e3);b.textContent=`${ue}s`,w==null||w()}),v.appendChild(b)}x.addEventListener("input",w=>{var b,ee;const L=(ee=(b=w.target)==null?void 0:b.value)!=null?ee:"";this.clearIcon&&(this.clearIcon.style.visibility=L?"visible":"hidden"),a&&a(L)}),x.addEventListener("focus",w=>{var L,b;l&&l((b=(L=w.target)==null?void 0:L.value)!=null?b:"")}),x.addEventListener("blur",w=>{var L,b;c&&c((b=(L=w.target)==null?void 0:L.value)!=null?b:"")}),h.appendChild(v);const de=document.createElement("p");return de.className="xa-error-tip",this.props.showError?de.textContent=this.props.errorMessage||"":de.style.display="none",h.appendChild(de),h}getElement(){return this.root}setUpEventListeners(){const e=this.root;this.root.addEventListener("click",()=>{const n=this.root.querySelector(".xa-input");n&&n.focus()}),this.root.querySelectorAll(".xa-input").forEach(n=>{n.addEventListener("focus",()=>{const s=n.closest(".xa-input-wrapper"),o=s==null?void 0:s.querySelector(".xa-input-label");o&&o.classList.add("xa-input-label_filled")}),n.addEventListener("blur",()=>{const s=n.closest(".xa-input-wrapper"),o=s==null?void 0:s.querySelector(".xa-input-label");o&&n.value===""&&o.classList.remove("xa-input-label_filled")})})}showError(e){const t=this.root.querySelector(".xa-error-tip");t.textContent=e,t.style.display="block"}hideError(){const e=this.root.querySelector(".xa-error-tip");e.style.display="none"}getValue(){return this.inputElement.value}setValue(e){this.inputElement.value=e,this.props.onChange&&this.props.onChange(e)}}class bt{constructor(){this.loader=document.createElement("div")}getElement(){return this.loader.classList.add("xa-loader"),this.loader}show(){var e;(e=this.loader)==null||e.classList.remove("xa-hide")}hide(){var e;console.log("laoder",this.loader),(e=this.loader)==null||e.classList.add("xa-hide")}}class Z{constructor(e){this.props=e,this.root=this.createButtonElement()}createButtonElement(){const{id:e,text:t,wrapperClassNames:n,disabled:s,onClick:o}=this.props,i=document.createElement("button");i.className="xa-login-button",i.textContent=t;const a=new bt;return a.hide(),i.insertBefore(a.getElement(),i.firstChild),this.loader=a,n&&n.forEach(c=>i.classList.add(c)),s&&(i.disabled=!0,i.classList.add("xa-login-button_disabled")),o&&i.addEventListener("click",c=>o(c)),i}getElement(){return this.root}setDisabled(e){this.root.disabled=e,e?this.root.classList.add("xa-login-button_disabled"):this.root.classList.remove("xa-login-button_disabled")}setLoading(e){var t,n;e?(t=this.loader)==null||t.show():(n=this.loader)==null||n.hide()}}var T=(r=>(r.Login="login",r.Signup="signup",r.SignupCode="signupCode",r.ForgotPassword="forgotPassword",r.PasswordSuccess="passwordSuccess",r))(T||{});class Y{constructor(e,t){this.modal=e}}class oe{constructor(){this.formList=[]}add(e,t){this.formList.push({name:e,formItem:t})}findFormItem(e){var n;const t=(n=this.formList.find(s=>s.name===e))==null?void 0:n.formItem;return console.log({find:t}),t}clearFormItemError(e){var n;const t=(n=this.formList.find(s=>s.name===e))==null?void 0:n.formItem;t==null||t.clearError()}getFormItemValue(e){var n,s,o;const t=(n=this.formList.find(i=>i.name===e))==null?void 0:n.formItem;return(o=(s=t==null?void 0:t.value)==null?void 0:s.toString())!=null?o:""}getFormItemChecked(e){var n;const t=(n=this.formList.find(s=>s.name===e))==null?void 0:n.formItem;return!!(t!=null&&t.value)}}const Et=r=>!!r&&/\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*/.test(r),It=r=>!!r&&/^(?=.*[A-Z])(?=.*\d)[\S]{8,}$/.test(r);function mr(r){return/^[0-9]{6}$/g.test(r)}const pr=r=>/^[!-~ ]{1,20}$/.test(r),Ce=r=>Et(r)?"":"Invalie Email",Pe=r=>It(r)?"":"Password must be at least 8 characters with 1 upper case letter and 1 number",Ne=(r,e)=>r===e?"":"The passwords don't match";class F{constructor(e,t,n){this._value="",this.root=document.createElement("div"),this.root.className="xa-form-item",this.root.innerHTML=`
    <div class="xa-form-item-error"></div>`,this.root.setAttribute("data-name",e),this.root.insertBefore(t,this.root.firstChild),this.label=document.createElement("span"),this.getValueFunction=n}getElement(){return this.root}get value(){return this.getValueFunction()}setError(e){var t,n;this.root.querySelector(".xa-form-item-error").innerHTML=e,e?(t=this.root.querySelector(".xa-input-wrapper"))==null||t.classList.add("xa-error-border"):(n=this.root.querySelector(".xa-input-wrapper"))==null||n.classList.remove("xa-error-border")}isValidate(){var e;return!((e=this.root.querySelector(".xa-form-item-error"))!=null&&e.innerHTML)}clearError(){var e;this.root.querySelector(".xa-form-item-error").innerHTML="",(e=this.root.querySelector(".xa-input-wrapper"))==null||e.classList.remove("xa-error-border")}}var kt=(r=>(r.Email="email",r.Password="password",r))(kt||{});class Oe extends Y{constructor(e,t){super(e),this.loginButton=null,this.emailInput=null,this.pwdInput=null,this.form=new oe}render(){if(!this.modal.modalContainer)return;const e=this.modal.modalContainer;this.modal.setTitle("Sign in","Sign in with email"),this.renderEmailInput(e),this.renderPwdInput(e),this.renderTips(e),this.renderLoginButton(e),this.setupListeners()}renderEmailInput(e){const t=new A({label:"EMAIL",type:"text",showClearIcon:!0,onChange:s=>{this.form.clearFormItemError("email"),this.handleEmailChange(s)},onBlur:s=>{var o;(o=this.form.findFormItem("email"))==null||o.setError(Ce(s)),this.handleEmailChange(s)}});this.emailInput=t;const n=new F("email",t.getElement(),()=>t.getValue());this.form.add("email",n),this.append(e,n.getElement())}renderPwdInput(e){const t=new A({label:"PASSWORD",type:"password",showClearIcon:!0,onChange:s=>{this.handlePasswordChange(s)},onBlur:s=>{var o;(o=this.form.findFormItem("password"))==null||o.setError(Pe(s)),this.handlePasswordChange(s)}});this.pwdInput=t;const n=new F("password",t.getElement(),()=>t.getValue());this.form.add("password",n),this.append(e,n.getElement())}renderTips(e){const t=document.createElement("div");t.classList.add("xa-login-tip","xa-flex","xa-justify-between"),t.innerHTML=`
      <div>No account yet? <a class="xa-to-sign-up">Sign up</a></div>
      <div>
        <a class="xa-to-forgotpwd">Forgot password?</a>
      </div>
    `,e.appendChild(t)}renderLoginButton(e){const t=new Z({text:"SIGN IN",disabled:!0,onClick:n=>{console.log("signUpButton clicked"),this.handleLogin()}});this.loginButton=t,this.append(e,t.getElement())}setupListeners(){var n,s;const e=(n=this.modal.modalContainer)==null?void 0:n.querySelector(".xa-to-sign-up");e==null||e.addEventListener("click",()=>this.modal.switchModalState(T.Signup));const t=(s=this.modal.modalContainer)==null?void 0:s.querySelector(".xa-to-forgotpwd");t==null||t.addEventListener("click",()=>this.modal.switchModalState(T.ForgotPassword))}handleEmailChange(e){var t,n;console.log({value:e}),(n=this.loginButton)==null||n.setDisabled(e.length===0||!((t=this.form.findFormItem("email"))!=null&&t.isValidate()))}handlePasswordChange(e){var t,n;(n=this.loginButton)==null||n.setDisabled(e.length===0||!((t=this.form.findFormItem("password"))!=null&&t.isValidate()))}handleLogin(){return u(this,null,function*(){var o,i,a,c,l,h,g,v,x;const e=(o=this.emailInput)==null?void 0:o.getValue(),t=(i=this.pwdInput)==null?void 0:i.getValue();if(!e||!t)return;(a=this.loginButton)==null||a.setLoading(!0);const{error:n,err_code:s}=yield this.modal.store.login(e,t);if((c=this.loginButton)==null||c.setLoading(!1),n){switch(s){case 11001:(l=this.form.findFormItem("email"))==null||l.setError("Wrong email or password");break;case 11103:(h=this.form.findFormItem("password"))==null||h.setError("Invalid password");break;case 11113:(g=this.form.findFormItem("password"))==null||g.setError("User does not exist.");break;case 11004:(v=this.form.findFormItem("password"))==null||v.setError("Too many attempts to login");break;default:(x=this.form.findFormItem("password"))==null||x.setError("Unknown error, please try again later");break}return}this.modal.close()})}append(e,t){e.appendChild(t)}}const St="https://xter.io/privacy-policy",vt="https://xter.io/terms-of-service";class Me{constructor(e){this._checked=!1,this._checked=!!e.defaultChecked,this.props=e,this.root=document.createElement("div"),this.root.className="xa-checkbox-wrapper",this.checkboxInput=document.createElement("input"),this.checkboxInput.type="checkbox",this.checkboxInput.className="xa-checkbox-input",this.checkboxInput.checked=this._checked,this.checkboxLabel=document.createElement("label"),this.checkboxLabel.className="xa-checkbox-label",this.root.appendChild(this.checkboxInput),this.root.appendChild(this.checkboxLabel),this.root.addEventListener("click",this.handleCheckboxChange.bind(this)),this.updateCheckboxState()}getElement(){return this.root}handleCheckboxChange(){const{onChange:e}=this.props;this._checked=!this._checked,this.updateCheckboxState(),e==null||e(this._checked)}updateCheckboxState(){this._checked?(this.checkboxLabel.style.borderColor="#0a1161",this.checkboxLabel.style.backgroundColor="#0a1161",this.checkboxInput.checked=!0):(this.checkboxLabel.style.borderColor="#0a1161",this.checkboxLabel.style.backgroundColor="transparent",this.checkboxInput.checked=!1)}get checked(){return this._checked}}var _t=(r=>(r.Email="email",r.Password="password",r.ConfirmPassword="confirmPassword",r.Terms="terms",r.Subscribe="subscribe",r))(_t||{});class Tt extends Y{constructor(e,t){super(e),this.signUpButton=null,this.extraData=t||{},this.form=new oe}render(){if(!this.modal.modalContainer)return;const e=this.modal.modalContainer;this.modal.setTitle("Create Xterio account","Sign up with email"),this.renderEmailInput(e),this.renderPwdInput(e),this.renderConfirmPwdInput(e),this.renderTipsCheckList(e),this.renderConfirmButton(e),this.renderBackTip(e),this.setupListeners()}renderBackTip(e){const t=document.createElement("div");t.classList.add("xa-w-full","xa-text-center"),t.innerHTML=`
      <div class="xa-login-tip">
        <span>Already have an account? </span>
        <a class="xa-to-sign-in"> Sign in </a>
      </div>
    `,this.append(e,t)}renderConfirmButton(e){const t=new Z({text:"SIGN UP",disabled:!0,onClick:n=>{console.log("signUpButton clicked"),this.handleSignUp()}});this.signUpButton=t,this.append(e,t.getElement())}renderTipsCheckList(e){const t=document.createElement("div"),n=document.createElement("div");n.classList.add("xa-login-tip","xa-flex"),n.innerHTML=`
      <div>
        <span>I am 18 years of age or older and agree to the terms of the</span>
        <a href="${vt}" target="_blank"> Terms of Service </a>
        <span>and the</span>
        <a href="${St}" target="_blank"> Privacy Policy </a>
      </div>
        `;const s=new Me({defaultChecked:!0,onChange:g=>{this.form.clearFormItemError("terms")}}),o=s.getElement();o.classList.add("xa-login-tip-checkbox"),n.insertBefore(o,n.firstChild),t.appendChild(n);const i=new F("terms",n,()=>s.checked);this.form.add("terms",i),t.appendChild(i.getElement());const a=document.createElement("div");a.classList.add("xa-login-tip","xa-flex","xa-items-center"),a.innerHTML=`<div class="xa-login-tip">
        <span>Subscribe to updates via email</span>
      </div>`;const c=new Me({defaultChecked:!1}),l=c.getElement();l.classList.add("xa-login-tip-checkbox"),a.insertBefore(l,a.firstChild),t.appendChild(a);const h=new F("subscribe",a,()=>c.checked);this.form.add("subscribe",h),t.appendChild(h.getElement()),this.append(e,t)}renderConfirmPwdInput(e){const t=new A({label:"CONFRIM PASSWORD",type:"password",showClearIcon:!0,onChange:s=>{this.handlePasswordChange(s)},onBlur:s=>{var o;(o=this.form.findFormItem("confirmPassword"))==null||o.setError(Ne(this.form.getFormItemValue("password"),s))}});this.confirmPwdInput=t;const n=new F("confirmPassword",t.getElement(),()=>this.confirmPwdInput.getValue());this.form.add("confirmPassword",n),this.append(e,n.getElement())}renderPwdInput(e){const t=new A({label:"PASSWORD",type:"password",showClearIcon:!0,onChange:s=>{this.handlePasswordChange(s)},onBlur:s=>{var o;(o=this.form.findFormItem("password"))==null||o.setError(Pe(s))}});this.pwdInput=t;const n=new F("password",t.getElement(),()=>this.pwdInput.getValue());this.form.add("password",n),this.append(e,n.getElement())}renderEmailInput(e){const t=new A({label:"EMAIL",type:"text",showClearIcon:!0,onChange:s=>{this.form.clearFormItemError("email"),this.handleEmailChange(s)},onBlur:s=>{var o;(o=this.form.findFormItem("email"))==null||o.setError(Ce(s))}});this.emailInput=t;const n=new F("email",t.getElement(),()=>this.emailInput.getValue());this.form.add("email",n),this.append(e,n.getElement())}setupListeners(){var n,s;const e=(n=this.modal.modalContainer)==null?void 0:n.querySelector(".xa-to-sign-in");e==null||e.addEventListener("click",()=>this.modal.switchModalState(T.Login));const t=(s=this.modal.modalContainer)==null?void 0:s.querySelector(".xa-to-forgotpwd");t==null||t.addEventListener("click",()=>this.modal.switchModalState(T.ForgotPassword))}handleEmailChange(e){var t;console.log({value:e}),(t=this.signUpButton)==null||t.setDisabled(e.length===0)}handlePasswordChange(e){}handleSignUp(){return u(this,null,function*(){var c,l,h,g,v,x;console.log(this.form);const e=this.form.getFormItemValue("email"),t=this.form.getFormItemValue("password"),n=this.form.getFormItemValue("confirmPassword"),s=!!this.form.getFormItemChecked("terms"),o=!!this.form.getFormItemChecked("subscribe");if(!s){(c=this.form.findFormItem("terms"))==null||c.setError("You have to accept Terms of Service and Privacy Policy to continue.");return}if(!e||!t)return;(l=this.signUpButton)==null||l.setLoading(!0);const{error:i,err_code:a}=yield U.registerService({username:e,password:t,subscribe:o});if((h=this.signUpButton)==null||h.setLoading(!1),i){switch(a){case 11102:(g=this.form.findFormItem("email"))==null||g.setError("User already registered.");break;case 11103:(v=this.form.findFormItem("password"))==null||v.setError("Invalid password.");break;default:(x=this.form.findFormItem("subscribe"))==null||x.setError("Unknown error, please try again later.");break}return}this.modal.switchModalState(T.SignupCode,{email:e,password:t})})}append(e,t){e.appendChild(t)}}var Ft=(r=>(r.Email="email",r.Code="code",r.Password="password",r.ConfirmPassword="confirmPassword",r))(Ft||{});class Lt extends Y{constructor(e,t){super(e),this.continueButton=null,this.form=new oe}render(){if(!this.modal.modalContainer)return;const e=this.modal.modalContainer;this.modal.setTitle("Forgot password","Please enter your email and email verification code"),this.renderEmailInput(e),this.renderCodeInput(e),this.renderPwdInput(e),this.renderConfirmPwdInput(e),this.renderConfirmButton(e),this.renderBackTip(e),this.setupListeners()}renderEmailInput(e){const t=new A({label:"EMAIL",type:"text",showClearIcon:!0,onChange:s=>{this.form.clearFormItemError("email"),this.handleEmailChange(s)},onBlur:s=>{var o;(o=this.form.findFormItem("email"))==null||o.setError(Ce(s))}}),n=new F("email",t.getElement(),()=>t.getValue());this.form.add("email",n),this.append(e,n.getElement())}renderCodeInput(e){const t=new A({label:"ENTER CODE",type:"text",onChange:s=>{this.handleEmailChange(s)},addonAfterSendButton:{onClick:()=>{var o;if(!this.form.getFormItemValue("email")){(o=this.form.findFormItem("email"))==null||o.setError("Email is required");return}U.sendForgotCodeService({email:this.form.getFormItemValue("email")})},onCountdownEnd:()=>{console.log("countdown end")}}}),n=new F("code",t.getElement(),()=>t.getValue());this.form.add("code",n),this.append(e,n.getElement())}renderPwdInput(e){const t=new A({label:"NEW PASSWORD",type:"password",showClearIcon:!0,onChange:s=>{this.handlePasswordChange(s)}}),n=new F("password",t.getElement(),()=>t.getValue());this.form.add("password",n),this.append(e,n.getElement())}renderConfirmPwdInput(e){const t=new A({label:"CONFRIM PASSWORD",type:"password",showClearIcon:!0,onChange:s=>{this.handlePasswordChange(s)},onBlur:s=>{var o;(o=this.form.findFormItem("confirmPassword"))==null||o.setError(Ne(this.form.getFormItemValue("password"),s))}}),n=new F("confirmPassword",t.getElement(),()=>t.getValue());this.form.add("confirmPassword",n),this.append(e,n.getElement())}renderConfirmButton(e){const t=new Z({text:"CONTINUE",disabled:!0,onClick:n=>{console.log("continueButton clicked"),this.handleUpdatePassword()}});this.continueButton=t,this.append(e,t.getElement())}renderBackTip(e){const t=document.createElement("div");t.classList.add("xa-w-full","xa-text-center"),t.innerHTML=`
      <div class="xa-login-tip">
       <span>Back to </span>
        <a class="xa-to-sign-in"> Sign in </a>
      </div>
    `,this.append(e,t)}setupListeners(){var n,s;const e=(n=this.modal.modalContainer)==null?void 0:n.querySelector(".xa-to-sign-in");e==null||e.addEventListener("click",()=>this.modal.switchModalState(T.Login));const t=(s=this.modal.modalContainer)==null?void 0:s.querySelector(".xa-to-forgotpwd");t==null||t.addEventListener("click",()=>this.modal.switchModalState(T.ForgotPassword))}handleEmailChange(e){var t;console.log({value:e}),(t=this.continueButton)==null||t.setDisabled(e.length===0)}handlePasswordChange(e){}handleUpdatePassword(){return u(this,null,function*(){var a,c,l,h,g,v,x;console.log(this.form);const e=this.form.getFormItemValue("email"),t=this.form.getFormItemValue("password"),n=this.form.getFormItemValue("confirmPassword"),s=this.form.getFormItemValue("code");if(!e||!t)return;(a=this.continueButton)==null||a.setLoading(!0);const{error:o,err_code:i}=yield U.resetPassword({email:e,password:t,code:s});if((c=this.continueButton)==null||c.setLoading(!1),o){switch(i){case 10001:(l=this.form.findFormItem("code"))==null||l.setError("Invalid verification code");break;case 11111:(h=this.form.findFormItem("code"))==null||h.setError("Invalid verification code");break;case 11112:(g=this.form.findFormItem("code"))==null||g.setError("Verification code expired");break;case 11113:(v=this.form.findFormItem("email"))==null||v.setError("User does not exist");break;default:(x=this.form.findFormItem("confirmPassword"))==null||x.setError("Unknown error, please try again later.");break}return}this.modal.switchModalState(T.PasswordSuccess)})}append(e,t){e.appendChild(t)}}class Ut{constructor(){this.listeners=new Set}subscribe(e){return this.listeners.add(e),()=>this.listeners.delete(e)}notify(){this.listeners.forEach(e=>e())}}class At{constructor(){var e,t,n;this.accessToken=(e=k.tokens)==null?void 0:e.access_token,this.refreshToken=(t=k.tokens)==null?void 0:t.refresh_token,this.idToken=(n=k.tokens)==null?void 0:n.id_token}setTokens({accessToken:e,refreshToken:t,idToken:n}){this.accessToken=e,this.refreshToken=t,this.idToken=n,k.tokens={access_token:e,id_token:n,refresh_token:t}}removeTokens(){this.accessToken=void 0,this.refreshToken=void 0,this.idToken=void 0,k.deleteTokens()}}class Bt extends Ut{constructor(){super(),this.userState={isLogin:!1,userInfo:null},this.tokenManager=new At,this.refreshUserInfo(),this.listenStateChange()}listenStateChange(){const e={isLogin:!1,userInfo:null};this.userState=new Proxy(e,{set:(t,n,s)=>(console.log("userinfo settttt",s,t),t[n]!==s&&(t[n]=s,this.setPersistUserInfo(),this.notify()),!0)})}login(e,t){return u(this,null,function*(){const{error:n,err_code:s,access_token:o,id_token:i,refresh_token:a}=yield U.loginService(e,t);return!n&&o&&a?(this.tokenManager.setTokens({accessToken:o,refreshToken:a,idToken:i}),yield this.getUserInfo(),this.userState.isLogin=!0):this.userState.isLogin=!1,{error:!!n,err_code:s}})}confirmSignUpLogin(s){return u(this,arguments,function*({username:e,password:t,code:n}){const{error:o,err_code:i,access_token:a,id_token:c,refresh_token:l}=yield U.registerConfirmService({username:e,password:t,code:n});return!o&&a&&l?(this.tokenManager.setTokens({accessToken:a,refreshToken:l,idToken:c}),yield this.getUserInfo(),this.userState.isLogin=!0):this.userState.isLogin=!1,{error:!!o,err_code:i}})}getUserInfo(){return u(this,null,function*(){const e=yield U.getUserInfo();return e&&e.uuid&&(this.userState.userInfo=y(y({},this.userState.userInfo),e),this.userState.isLogin=!0),e})}setPersistUserInfo(){this.userState.userInfo&&(k.userInfo=this.userState.userInfo)}getPersistUserInfo(){return k.userInfo}refreshUserInfo(){return u(this,null,function*(){j.subscribe(e=>{this.userState.userInfo=e,this.userState.isLogin=q.isLogin}),this.tokenManager.idToken||this.logout()})}logout(){this.userState.isLogin=!1,this.userState.userInfo=null,this.tokenManager.removeTokens()}}var Pt=(r=>(r.Code="code",r))(Pt||{});class Nt extends Y{constructor(e,t){super(e),this.signUpButton=null,this.extraData=t||{},this.form=new oe}render(){if(!this.modal.modalContainer)return;const e=this.modal.modalContainer;this.modal.setTitle("Verify email","Verification code has been sent to",this.extraData.email),this.renderCodeInput(e),this.renderConfirmButton(e),this.renderBackTip(e),this.setupListeners()}renderCodeInput(e){const t=new A({id:"xaCodeInput",label:"ENTER CODE",type:"text",showClearIcon:!0,onChange:s=>{this.handleCodeChange(s)}}),n=new F("code",t.getElement(),()=>t.getValue());this.form.add("code",n),this.append(e,n.getElement())}renderConfirmButton(e){const t=new Z({text:"CONTINUE",disabled:!0,onClick:n=>{console.log("signUpButton clicked"),this.handleContinueSignUp()}});this.signUpButton=t,this.append(e,t.getElement())}renderBackTip(e){const t=document.createElement("div");t.classList.add("xa-w-full","xa-text-center"),t.innerHTML=`
      <div class="xa-login-tip">
        <span>Already have an account? </span>
        <a class="xa-to-sign-in"> Sign in </a>
      </div>
    `,this.append(e,t)}setupListeners(){var n,s;const e=(n=this.modal.modalContainer)==null?void 0:n.querySelector(".xa-to-sign-in");e==null||e.addEventListener("click",()=>this.modal.switchModalState(T.Login));const t=(s=this.modal.modalContainer)==null?void 0:s.querySelector(".xa-to-forgotpwd");t==null||t.addEventListener("click",()=>this.modal.switchModalState(T.ForgotPassword))}handleCodeChange(e){var t;(t=this.signUpButton)==null||t.setDisabled(e.length===0)}append(e,t){e.appendChild(t)}handleContinueSignUp(){return u(this,null,function*(){var i,a,c,l,h,g;console.log(this.form);const e=this.form.getFormItemValue("code"),t=(i=this.extraData)==null?void 0:i.password,n=(a=this.extraData)==null?void 0:a.email;if(!t||!n||!e)return;(c=this.signUpButton)==null||c.setLoading(!0);const{error:s,err_code:o}=yield this.modal.store.confirmSignUpLogin({username:n,password:t,code:e});if((l=this.signUpButton)==null||l.setLoading(!1),s){switch(o){case 11111:(h=this.form.findFormItem("code"))==null||h.setError("Invalid verification code");break;default:(g=this.form.findFormItem("code"))==null||g.setError("Unknown error, please try again later.");break}return}this.modal.close()})}}const Ot="data:image/svg+xml,%3csvg%20width='80'%20height='80'%20viewBox='0%200%2064%2064'%20xmlns='http://www.w3.org/2000/svg'%3e%3csvg%20width='64'%20height='64'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3ccircle%20cx='32'%20cy='32'%20r='24'%20fill='url(%23paint0_linear_0_548)'%3e%3c/circle%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M44.535%2026L29%2041.535%2019.465%2032%2023%2028.465l6%206%2012-12L44.535%2026z'%20fill='%230A1161'%3e%3c/path%3e%3cdefs%3e%3clinearGradient%20id='paint0_linear_0_548'%20x1='8'%20y1='32.828'%20x2='56'%20y2='32.828'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20stop-color='%239EE6FC'%3e%3c/stop%3e%3cstop%20offset='1'%20stop-color='%23EBB9E7'%3e%3c/stop%3e%3c/linearGradient%3e%3c/defs%3e%3c/svg%3e%3c/svg%3e";function Mt(){const r=document.createElement("div");return r.classList.add("xa-modal-logo"),r.innerHTML=`
      <img src="${Ot}" alt="Xterio" class="xa-icon-success" />
    `,r}class Dt extends Y{constructor(e,t){super(e)}render(){if(!this.modal.modalContainer)return;const e=this.modal.modalContainer;this.append(e,Mt()),this.modal.setTitle("Password has been changed!","Your password has been changed successfully"),this.renderConfirmButton(e)}renderConfirmButton(e){const t=new Z({text:"SIGN IN",onClick:n=>{this.modal.switchModalState(T.Login)}});this.append(e,t.getElement())}append(e,t){e.appendChild(t)}}class _{constructor(e){this.apiUrl=e,this.currentState=new Oe(this),this.store=new Bt}static get instance(){if(!_._instance)throw new Error("AuthSDK is not initialized. Call AuthSDK.init(apiUrl, redirectUri) first.");return _._instance}static init(e){console.log("init....."),_._instance||(_._instance=new _(e))}open(){const e=document.createElement("div");e.className="xa-modal-overlay",this.modalOverlay=e,e.addEventListener("click",n=>{n.target});const t=document.createElement("div");this.modalContainer=t,t.className="xa-modal",this.renderCommonElement(t),e.appendChild(t),document.body.appendChild(e),this.currentState.render()}close(){var e,t;(e=this.modalContainer)==null||e.remove(),(t=this.modalOverlay)==null||t.remove()}renderCommonElement(e){const t=new Ct;e.appendChild(t.getElement());const n=Be("icon-close",24,"#838383");n.addEventListener("click",()=>this.close()),n.className="xa-signin-close",e.appendChild(n);const s=document.createElement("div");s.className="xa-signin-title-container",s.innerHTML=`
        <h3 class="xa-signin-title">Sign in</h3>
        <p class="xa-signin-sub-title">Sign in with email</p>
        <div class="xa-signin-title-email"></div>
       `,e.appendChild(s)}setTitle(e,t,n){const s=document.querySelector(".xa-signin-title"),o=document.querySelector(".xa-signin-sub-title"),i=document.querySelector(".xa-signin-title-email");s.innerHTML=e,o.innerHTML=t,i&&n&&(i.innerHTML=n)}renderContent(){this.modalContainer&&(this.modalContainer.innerHTML="",this.renderCommonElement(this.modalContainer)),this.currentState.render()}switchModalState(e,t){switch(e){case"login":this.currentState=new Oe(this,t);break;case"signup":this.currentState=new Tt(this,t);break;case"signupCode":this.currentState=new Nt(this,t);break;case"forgotPassword":this.currentState=new Lt(this,t);break;case T.PasswordSuccess:this.currentState=new Dt(this,t);break}this.renderContent()}}const De="3.7.7",Rt=De,z=typeof Buffer=="function",Re=typeof TextDecoder=="function"?new TextDecoder:void 0,Ve=typeof TextEncoder=="function"?new TextEncoder:void 0,J=Array.prototype.slice.call("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="),ie=(r=>{let e={};return r.forEach((t,n)=>e[t]=n),e})(J),Vt=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,S=String.fromCharCode.bind(String),je=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):r=>new Uint8Array(Array.prototype.slice.call(r,0)),ze=r=>r.replace(/=/g,"").replace(/[+\/]/g,e=>e=="+"?"-":"_"),$e=r=>r.replace(/[^A-Za-z0-9\+\/]/g,""),qe=r=>{let e,t,n,s,o="";const i=r.length%3;for(let a=0;a<r.length;){if((t=r.charCodeAt(a++))>255||(n=r.charCodeAt(a++))>255||(s=r.charCodeAt(a++))>255)throw new TypeError("invalid character found");e=t<<16|n<<8|s,o+=J[e>>18&63]+J[e>>12&63]+J[e>>6&63]+J[e&63]}return i?o.slice(0,i-3)+"===".substring(i):o},be=typeof btoa=="function"?r=>btoa(r):z?r=>Buffer.from(r,"binary").toString("base64"):qe,Ee=z?r=>Buffer.from(r).toString("base64"):r=>{let t=[];for(let n=0,s=r.length;n<s;n+=4096)t.push(S.apply(null,r.subarray(n,n+4096)));return be(t.join(""))},ae=(r,e=!1)=>e?ze(Ee(r)):Ee(r),jt=r=>{if(r.length<2){var e=r.charCodeAt(0);return e<128?r:e<2048?S(192|e>>>6)+S(128|e&63):S(224|e>>>12&15)+S(128|e>>>6&63)+S(128|e&63)}else{var e=65536+(r.charCodeAt(0)-55296)*1024+(r.charCodeAt(1)-56320);return S(240|e>>>18&7)+S(128|e>>>12&63)+S(128|e>>>6&63)+S(128|e&63)}},zt=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,He=r=>r.replace(zt,jt),Ke=z?r=>Buffer.from(r,"utf8").toString("base64"):Ve?r=>Ee(Ve.encode(r)):r=>be(He(r)),$=(r,e=!1)=>e?ze(Ke(r)):Ke(r),Ge=r=>$(r,!0),$t=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,qt=r=>{switch(r.length){case 4:var e=(7&r.charCodeAt(0))<<18|(63&r.charCodeAt(1))<<12|(63&r.charCodeAt(2))<<6|63&r.charCodeAt(3),t=e-65536;return S((t>>>10)+55296)+S((t&1023)+56320);case 3:return S((15&r.charCodeAt(0))<<12|(63&r.charCodeAt(1))<<6|63&r.charCodeAt(2));default:return S((31&r.charCodeAt(0))<<6|63&r.charCodeAt(1))}},Xe=r=>r.replace($t,qt),We=r=>{if(r=r.replace(/\s+/g,""),!Vt.test(r))throw new TypeError("malformed base64.");r+="==".slice(2-(r.length&3));let e,t="",n,s;for(let o=0;o<r.length;)e=ie[r.charAt(o++)]<<18|ie[r.charAt(o++)]<<12|(n=ie[r.charAt(o++)])<<6|(s=ie[r.charAt(o++)]),t+=n===64?S(e>>16&255):s===64?S(e>>16&255,e>>8&255):S(e>>16&255,e>>8&255,e&255);return t},Ie=typeof atob=="function"?r=>atob($e(r)):z?r=>Buffer.from(r,"base64").toString("binary"):We,Ze=z?r=>je(Buffer.from(r,"base64")):r=>je(Ie(r).split("").map(e=>e.charCodeAt(0))),Ye=r=>Ze(Je(r)),Ht=z?r=>Buffer.from(r,"base64").toString("utf8"):Re?r=>Re.decode(Ze(r)):r=>Xe(Ie(r)),Je=r=>$e(r.replace(/[-_]/g,e=>e=="-"?"+":"/")),ce=r=>Ht(Je(r)),Kt=r=>{if(typeof r!="string")return!1;const e=r.replace(/\s+/g,"").replace(/={0,2}$/,"");return!/[^\s0-9a-zA-Z\+/]/.test(e)||!/[^\s0-9a-zA-Z\-_]/.test(e)},Qe=r=>({value:r,enumerable:!1,writable:!0,configurable:!0}),et=function(){const r=(e,t)=>Object.defineProperty(String.prototype,e,Qe(t));r("fromBase64",function(){return ce(this)}),r("toBase64",function(e){return $(this,e)}),r("toBase64URI",function(){return $(this,!0)}),r("toBase64URL",function(){return $(this,!0)}),r("toUint8Array",function(){return Ye(this)})},tt=function(){const r=(e,t)=>Object.defineProperty(Uint8Array.prototype,e,Qe(t));r("toBase64",function(e){return ae(this,e)}),r("toBase64URI",function(){return ae(this,!0)}),r("toBase64URL",function(){return ae(this,!0)})},xr={version:De,VERSION:Rt,atob:Ie,atobPolyfill:We,btoa:be,btoaPolyfill:qe,fromBase64:ce,toBase64:$,encode:$,encodeURI:Ge,encodeURL:Ge,utob:He,btou:Xe,decode:ce,isValid:Kt,fromUint8Array:ae,toUint8Array:Ye,extendString:et,extendUint8Array:tt,extendBuiltins:()=>{et(),tt()}},Gt={[p.Dev]:"https://api.playvrs.net",[p.Staging]:"https://api.xterio.net",[p.Production]:"https://api.xterio.net"};class q{static get isLogin(){var e;return!!((e=X.userInfo)!=null&&e.uuid)}static get userinfo(){return X.userInfo}static get isVaildIdToken(){var n;const e=D.idToken;if(!e)return f("invalid token 1"),!1;const t=(n=e.split("."))==null?void 0:n[1];if(!t)return f("invalid token 2"),!1;try{const{aud:s,exp:o=0,sub:i}=JSON.parse(ce(t));return!(!s||Date.now()>o*1e3)}catch(s){return f("invalid token 3",s),!1}}static checkToken(){return u(this,null,function*(){const e=k.tokens;e&&D.setTokens(e);const t=D.idToken,n=D.refreshToken;if(!t&&n){const o=yield U.refreshTokenService(n);D.setTokens({refresh_token:n,id_token:o.id_token,access_token:o.access_token})}const s=q.isVaildIdToken;f("check the tokens valid status:",s),s?yield U.getUserInfo():this.clearData()})}static checkCode(){return u(this,null,function*(){var i,a;const e=k.loginType;if(f("check the authorize status",e),e!==P.Default&&e!==P.Email)return;const t=(i=m.config)==null?void 0:i.redirect_uri;if(!t||!location.href.startsWith(t)){f("not check, different redirect_uri");return}const s=(a=ne.parseUrl(location.href,{types:{code:"string"}}).query)==null?void 0:a.code;if(!s)throw new Error("no authorize");t&&history.pushState(null,"",t),f("going to login ...");const o=yield U.login(s);o!=null&&o.uuid&&k.delete(I.LOGIN_TYPE)})}static init(e,t){return u(this,null,function*(){const{client_id:n,client_secret:s,redirect_uri:o="",mode:i}=e,a=t!=null?t:p.Dev,c=Gt[a],l={client_id:n||"",client_secret:s||"",redirect_uri:o,response_type:"code",scope:"all",mode:i||"default",grant_type:"authorization_code",logout:"1"};m.client_id=n||"",m.env=a,m.baseURL=c,m.authorizeUrl=c+"/account/v1/oauth2/authorize?"+ne.stringify(l),m.config=l,j.clear(),_.init(c),f(_.instance),yield this.checkToken(),window.addEventListener("load",h=>u(this,null,function*(){yield this.checkCode()}))})}static clearData(){k.delete(I.LOGIN_TYPE),k.deleteTokens(),k.deleteUserInfo(),D.removeTokens(),X.removeUserInfo()}static logout(){var e,t;f("logout success"),this.clearData(),(t=(e=_==null?void 0:_.instance)==null?void 0:e.store)==null||t.logout()}static login(e){return u(this,null,function*(){if(!m.config){f("xterio auth sdk initial failed");return}if(e&&e!==P.Mini&&(m.config=B(y({},m.config),{mode:e}),m.authorizeUrl=m.baseURL+"/account/v1/oauth2/authorize?"+ne.stringify(m.config)),q.isLogin){f("already logined."),j.emit(G.ACCOUNT,X.userInfo);return}if(q.isVaildIdToken)return f("get userinfo"),U.getUserInfo();if(e===P.Mini){_.instance.open();return}k.loginType=e||P.Default,f("going to authorize ..."),location.href=m.authorizeUrl})}}const Xt=({onLoginStateChange:r})=>{const e=_.instance;function t(){e.open()}function n(){e.store.logout()}return e.store.subscribe(()=>{r==null||r(e.store.userState.isLogin,e.store.userState.userInfo)}),{open:t,logout:n}};d.Env=p,d.LoginType=P,d.XTERIO_CONST=I,d.XTERIO_EVENTS=G,d.XterAuthModal=_,d.XterEventEmiter=j,d.XterioAuth=q,d.XterioAuthService=U,d.XterioAuthTokensManager=D,d.deleteFetcher=wt,d.getFetcher=xe,d.postFetcher=R,d.putFetcher=xt,d.useXterLoginModal=Xt,Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})});
