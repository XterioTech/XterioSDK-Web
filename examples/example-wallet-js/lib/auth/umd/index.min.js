(function(B,_){typeof exports=="object"&&typeof module!="undefined"?_(exports):typeof define=="function"&&define.amd?define(["exports"],_):(B=typeof globalThis!="undefined"?globalThis:B||self,_(B.XterioAuth={}))})(this,function(B){"use strict";var an=Object.defineProperty,cn=Object.defineProperties;var ln=Object.getOwnPropertyDescriptors;var Ot=Object.getOwnPropertySymbols;var un=Object.prototype.hasOwnProperty,hn=Object.prototype.propertyIsEnumerable;var T=Math.pow,Dt=(B,_,A)=>_ in B?an(B,_,{enumerable:!0,configurable:!0,writable:!0,value:A}):B[_]=A,U=(B,_)=>{for(var A in _||(_={}))un.call(_,A)&&Dt(B,A,_[A]);if(Ot)for(var A of Ot(_))hn.call(_,A)&&Dt(B,A,_[A]);return B},G=(B,_)=>cn(B,ln(_));var b=(B,_,A)=>new Promise((te,re)=>{var _e=Y=>{try{pe(A.next(Y))}catch(xe){re(xe)}},Te=Y=>{try{pe(A.throw(Y))}catch(xe){re(xe)}},pe=Y=>Y.done?te(Y.value):Promise.resolve(Y.value).then(_e,Te);pe((A=A.apply(B,_)).next())});/*! XterioAuth v0.0.8 */var _=(i=>(i.Dev="Dev",i.Staging="Staging",i.Production="Production",i))(_||{}),A=(i=>(i.Default="default",i.Email="email",i.Mini="mini",i))(A||{}),te=(i=>(i.alert="alert",i.page="page",i.iframeDom="dom",i.iframeUri="url",i))(te||{}),re=(i=>(i.asset="asset",i.nft="nft",i.account="account",i.wallet="wallet",i))(re||{});const _e="%[a-f0-9]{2}",Te=new RegExp("("+_e+")|([^%]+?)","gi"),pe=new RegExp("("+_e+")+","gi");function Y(i,e){try{return[decodeURIComponent(i.join(""))]}catch(a){}if(i.length===1)return i;e=e||1;const n=i.slice(0,e),s=i.slice(e);return Array.prototype.concat.call([],Y(n),Y(s))}function xe(i){try{return decodeURIComponent(i)}catch(e){let n=i.match(Te)||[];for(let s=1;s<n.length;s++)i=Y(n,s).join(""),n=i.match(Te)||[];return i}}function Mt(i){const e={"%FE%FF":"��","%FF%FE":"��"};let n=pe.exec(i);for(;n;){try{e[n[0]]=decodeURIComponent(n[0])}catch(a){const l=xe(n[0]);l!==n[0]&&(e[n[0]]=l)}n=pe.exec(i)}e["%C2"]="�";const s=Object.keys(e);for(const a of s)i=i.replace(new RegExp(a,"g"),e[a]);return i}function $t(i){if(typeof i!="string")throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof i+"`");try{return decodeURIComponent(i)}catch(e){return Mt(i)}}function Ht(i,e){const n={};if(Array.isArray(e))for(const s of e){const a=Object.getOwnPropertyDescriptor(i,s);a!=null&&a.enumerable&&Object.defineProperty(n,s,a)}else for(const s of Reflect.ownKeys(i)){const a=Object.getOwnPropertyDescriptor(i,s);if(a.enumerable){const l=i[s];e(s,l,i)&&Object.defineProperty(n,s,a)}}return n}function et(i,e){if(!(typeof i=="string"&&typeof e=="string"))throw new TypeError("Expected the arguments to be of type `string`");if(i===""||e==="")return[];const n=i.indexOf(e);return n===-1?[]:[i.slice(0,n),i.slice(n+e.length)]}const Vt=i=>i==null,qt=i=>encodeURIComponent(i).replaceAll(/[!'()*]/g,e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`),Me=Symbol("encodeFragmentIdentifier");function jt(i){switch(i.arrayFormat){case"index":return e=>(n,s)=>{const a=n.length;return s===void 0||i.skipNull&&s===null||i.skipEmptyString&&s===""?n:s===null?[...n,[P(e,i),"[",a,"]"].join("")]:[...n,[P(e,i),"[",P(a,i),"]=",P(s,i)].join("")]};case"bracket":return e=>(n,s)=>s===void 0||i.skipNull&&s===null||i.skipEmptyString&&s===""?n:s===null?[...n,[P(e,i),"[]"].join("")]:[...n,[P(e,i),"[]=",P(s,i)].join("")];case"colon-list-separator":return e=>(n,s)=>s===void 0||i.skipNull&&s===null||i.skipEmptyString&&s===""?n:s===null?[...n,[P(e,i),":list="].join("")]:[...n,[P(e,i),":list=",P(s,i)].join("")];case"comma":case"separator":case"bracket-separator":{const e=i.arrayFormat==="bracket-separator"?"[]=":"=";return n=>(s,a)=>a===void 0||i.skipNull&&a===null||i.skipEmptyString&&a===""?s:(a=a===null?"":a,s.length===0?[[P(n,i),e,P(a,i)].join("")]:[[s,P(a,i)].join(i.arrayFormatSeparator)])}default:return e=>(n,s)=>s===void 0||i.skipNull&&s===null||i.skipEmptyString&&s===""?n:s===null?[...n,P(e,i)]:[...n,[P(e,i),"=",P(s,i)].join("")]}}function zt(i){let e;switch(i.arrayFormat){case"index":return(n,s,a)=>{if(e=/\[(\d*)]$/.exec(n),n=n.replace(/\[\d*]$/,""),!e){a[n]=s;return}a[n]===void 0&&(a[n]={}),a[n][e[1]]=s};case"bracket":return(n,s,a)=>{if(e=/(\[])$/.exec(n),n=n.replace(/\[]$/,""),!e){a[n]=s;return}if(a[n]===void 0){a[n]=[s];return}a[n]=[...a[n],s]};case"colon-list-separator":return(n,s,a)=>{if(e=/(:list)$/.exec(n),n=n.replace(/:list$/,""),!e){a[n]=s;return}if(a[n]===void 0){a[n]=[s];return}a[n]=[...a[n],s]};case"comma":case"separator":return(n,s,a)=>{const l=typeof s=="string"&&s.includes(i.arrayFormatSeparator),d=typeof s=="string"&&!l&&ne(s,i).includes(i.arrayFormatSeparator);s=d?ne(s,i):s;const m=l||d?s.split(i.arrayFormatSeparator).map(g=>ne(g,i)):s===null?s:ne(s,i);a[n]=m};case"bracket-separator":return(n,s,a)=>{const l=/(\[])$/.test(n);if(n=n.replace(/\[]$/,""),!l){a[n]=s&&ne(s,i);return}const d=s===null?[]:s.split(i.arrayFormatSeparator).map(m=>ne(m,i));if(a[n]===void 0){a[n]=d;return}a[n]=[...a[n],...d]};default:return(n,s,a)=>{if(a[n]===void 0){a[n]=s;return}a[n]=[...[a[n]].flat(),s]}}}function tt(i){if(typeof i!="string"||i.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function P(i,e){return e.encode?e.strict?qt(i):encodeURIComponent(i):i}function ne(i,e){return e.decode?$t(i):i}function rt(i){return Array.isArray(i)?i.sort():typeof i=="object"?rt(Object.keys(i)).sort((e,n)=>Number(e)-Number(n)).map(e=>i[e]):i}function nt(i){const e=i.indexOf("#");return e!==-1&&(i=i.slice(0,e)),i}function Gt(i){let e="";const n=i.indexOf("#");return n!==-1&&(e=i.slice(n)),e}function it(i,e,n){return n==="string"&&typeof i=="string"?i:typeof n=="function"&&typeof i=="string"?n(i):e.parseBooleans&&i!==null&&(i.toLowerCase()==="true"||i.toLowerCase()==="false")?i.toLowerCase()==="true":n==="number"&&!Number.isNaN(Number(i))&&typeof i=="string"&&i.trim()!==""||e.parseNumbers&&!Number.isNaN(Number(i))&&typeof i=="string"&&i.trim()!==""?Number(i):i}function $e(i){i=nt(i);const e=i.indexOf("?");return e===-1?"":i.slice(e+1)}function He(i,e){e=U({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1,types:Object.create(null)},e),tt(e.arrayFormatSeparator);const n=zt(e),s=Object.create(null);if(typeof i!="string"||(i=i.trim().replace(/^[?#&]/,""),!i))return s;for(const a of i.split("&")){if(a==="")continue;const l=e.decode?a.replaceAll("+"," "):a;let[d,m]=et(l,"=");d===void 0&&(d=l),m=m===void 0?null:["comma","separator","bracket-separator"].includes(e.arrayFormat)?m:ne(m,e),n(ne(d,e),m,s)}for(const[a,l]of Object.entries(s))if(typeof l=="object"&&l!==null&&e.types[a]!=="string")for(const[d,m]of Object.entries(l)){const g=e.types[a]?e.types[a].replace("[]",""):void 0;l[d]=it(m,e,g)}else typeof l=="object"&&l!==null&&e.types[a]==="string"?s[a]=Object.values(l).join(e.arrayFormatSeparator):s[a]=it(l,e,e.types[a]);return e.sort===!1?s:(e.sort===!0?Object.keys(s).sort():Object.keys(s).sort(e.sort)).reduce((a,l)=>{const d=s[l];return a[l]=d&&typeof d=="object"&&!Array.isArray(d)?rt(d):d,a},Object.create(null))}function ot(i,e){if(!i)return"";e=U({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},e),tt(e.arrayFormatSeparator);const n=d=>e.skipNull&&Vt(i[d])||e.skipEmptyString&&i[d]==="",s=jt(e),a={};for(const[d,m]of Object.entries(i))n(d)||(a[d]=m);const l=Object.keys(a);return e.sort!==!1&&l.sort(e.sort),l.map(d=>{const m=i[d];return m===void 0?"":m===null?P(d,e):Array.isArray(m)?m.length===0&&e.arrayFormat==="bracket-separator"?P(d,e)+"[]":m.reduce(s(d),[]).join("&"):P(d,e)+"="+P(m,e)}).filter(d=>d.length>0).join("&")}function st(i,e){var a,l;e=U({decode:!0},e);let[n,s]=et(i,"#");return n===void 0&&(n=i),U({url:(l=(a=n==null?void 0:n.split("?"))==null?void 0:a[0])!=null?l:"",query:He($e(i),e)},e&&e.parseFragmentIdentifier&&s?{fragmentIdentifier:ne(s,e)}:{})}function at(i,e){e=U({encode:!0,strict:!0,[Me]:!0},e);const n=nt(i.url).split("?")[0]||"",s=$e(i.url),a=U(U({},He(s,{sort:!1})),i.query);let l=ot(a,e);l&&(l=`?${l}`);let d=Gt(i.url);if(typeof i.fragmentIdentifier=="string"){const m=new URL(n);m.hash=i.fragmentIdentifier,d=e[Me]?m.hash:`#${i.fragmentIdentifier}`}return`${n}${l}${d}`}function ct(i,e,n){n=U({parseFragmentIdentifier:!0,[Me]:!1},n);const{url:s,query:a,fragmentIdentifier:l}=st(i,n);return at({url:s,query:Ht(a,e),fragmentIdentifier:l},n)}function Kt(i,e,n){const s=Array.isArray(e)?a=>!e.includes(a):(a,l)=>!e(a,l);return ct(i,s,n)}const Ee=Object.freeze(Object.defineProperty({__proto__:null,exclude:Kt,extract:$e,parse:He,parseUrl:st,pick:ct,stringify:ot,stringifyUrl:at},Symbol.toStringTag,{value:"Module"})),Ie="0.0.8",Ue="XterioAuth",lt={debug:1,info:2,warn:3,error:4,off:5};let ut=lt.debug;const Xt=i=>{ut=i},Le=(i,...e)=>{i==="OFF"||ut>lt[i.toLocaleLowerCase()]||(i==="ERROR"?console.error(`[${Ue}(v${Ie})]`,...e):i==="WARN"?console.warn(`[${Ue}(v${Ie})]`,...e):i==="DEBUG"?console.debug(`[${Ue}(v${Ie})]`,...e):console.log(`[${Ue}(v${Ie})]`,...e))},k={info:(...i)=>{Le("INFO",...i)},debug:(...i)=>{Le("DEBUG",...i)},warn:(...i)=>{Le("WARN",...i)},error:(...i)=>{Le("ERROR",...i)}},Wt=()=>Ie,Yt=i=>{i=i||32;const e="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",n=e.length;let s="";for(let a=0;a<i;a++)s+=e.charAt(Math.floor(Math.random()*n));return s},ae={[_.Dev]:{HCAPTCHA_SITE_KEY:"24e8a314-60ce-4d6e-bf78-c01c598a29f6",API_BASE:"https://api.playvrs.net",PAGE_BASE:"https://d39wr9n5mj2b6n.cloudfront.net"},[_.Staging]:{HCAPTCHA_SITE_KEY:"f274d312-aade-4b86-a8c0-05cc85a83d32",API_BASE:"https://api.xterio.net",PAGE_BASE:"https://d3vi0apu54mmeo.cloudfront.net"},[_.Production]:{HCAPTCHA_SITE_KEY:"22e2664c-fb06-482c-992c-8b74946e763a",API_BASE:"https://api.xter.io",PAGE_BASE:"https://www.xter.io"}},he={LOGIN:"xter_auth_login_success",ACCOUNT:"xter_auth_response_userinfo",REQ_ACCOUNT:"xter_auth_request_userinfo",Expired:"xter_auth_req_expired"},$={LOGIN_TYPE:"xter_auth_login_type",TOKENS:"xter_auth_login_tokens",ID_TOKEN:"xter_auth_id_token",REFRESH_TOKEN:"xter_auth_refresh_token",ACCESS_TOKEN:"xter_auth_access_token",USERINFO:"xter_auth_userinfo"};/*! js-cookie v3.0.5 | MIT */function Ae(i){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var s in n)i[s]=n[s]}return i}var Jt={read:function(i){return i[0]==='"'&&(i=i.slice(1,-1)),i.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(i){return encodeURIComponent(i).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}};function Ve(i,e){function n(a,l,d){if(typeof document!="undefined"){d=Ae({},e,d),typeof d.expires=="number"&&(d.expires=new Date(Date.now()+d.expires*864e5)),d.expires&&(d.expires=d.expires.toUTCString()),a=encodeURIComponent(a).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var m="";for(var g in d)d[g]&&(m+="; "+g,d[g]!==!0&&(m+="="+d[g].split(";")[0]));return document.cookie=a+"="+i.write(l,a)+m}}function s(a){if(!(typeof document=="undefined"||arguments.length&&!a)){for(var l=document.cookie?document.cookie.split("; "):[],d={},m=0;m<l.length;m++){var g=l[m].split("="),w=g.slice(1).join("=");try{var u=decodeURIComponent(g[0]);if(d[u]=i.read(w,u),a===u)break}catch(y){}}return a?d[a]:d}}return Object.create({set:n,get:s,remove:function(a,l){n(a,"",Ae({},l,{expires:-1}))},withAttributes:function(a){return Ve(this.converter,Ae({},this.attributes,a))},withConverter:function(a){return Ve(Ae({},this.converter,a),this.attributes)}},{attributes:{value:Object.freeze(e)},converter:{value:Object.freeze(i)}})}var ie=Ve(Jt,{path:"/"});class H{static set loginType(e){localStorage.setItem($.LOGIN_TYPE,e)}static get loginType(){const e=localStorage.getItem($.LOGIN_TYPE);return e||void 0}static set tokens(e){const{access_token:n="",id_token:s="",refresh_token:a=""}=e;ie.set($.ACCESS_TOKEN,n,{expires:1}),ie.set($.ID_TOKEN,s,{expires:1}),ie.set($.REFRESH_TOKEN,a)}static get tokens(){return{access_token:ie.get($.ACCESS_TOKEN)||"",id_token:ie.get($.ID_TOKEN)||"",refresh_token:ie.get($.REFRESH_TOKEN)||""}}static deleteTokens(){ie.remove($.ACCESS_TOKEN),ie.remove($.REFRESH_TOKEN),ie.remove($.ID_TOKEN)}static set userInfo(e){localStorage.setItem($.USERINFO,JSON.stringify(e))}static get userInfo(){const e=localStorage.getItem($.USERINFO);try{if(e)return JSON.parse(e)}catch(n){return}}static deleteUserInfo(){localStorage.removeItem($.USERINFO)}static delete(e){localStorage.removeItem(e)}}const ce=class ce{};ce.client_id="",ce.app_id="",ce.baseURL="",ce.pageURL="",ce.authorizeUrl="",ce.onAccount=[];let x=ce;class V{static setTokens(e){const{id_token:n="",access_token:s="",refresh_token:a=""}=e||{};x.tokens={id_token:n,access_token:s,refresh_token:a},H.tokens=e}static removeTokens(){x.tokens=void 0}static get idToken(){var e;return((e=x.tokens)==null?void 0:e.id_token)||""}static get refreshToken(){var e;return((e=x.tokens)==null?void 0:e.refresh_token)||""}static get accessToken(){var e;return((e=x.tokens)==null?void 0:e.access_token)||""}}class Ce{static setUserInfo(e){x.userInfo=e,H.userInfo=e}static removeUserInfo(){x.userInfo=void 0}static get userInfo(){return x.userInfo}}const Ye=class Ye{static set listeners(e){this._listeners=e}static get listeners(){return this._listeners}static on(e,n){this._listeners[e]||(this._listeners[e]=[]),this._listeners[e].push(n)}static off(e,n){this._listeners[e]&&(this._listeners[e]=this._listeners[e].filter(s=>s!==n))}static emit(e,...n){this._listeners[e]&&this._listeners[e].forEach(s=>{s(...n)})}static remove(e){this._listeners[e]&&delete this._listeners[e]}static subscribe(e,n){const s=n||he.ACCOUNT;return k.debug("subscribe event",s),this.on(s,e),()=>{k.debug("unsubscribe this event",s),this.off(s,e)}}static unsubscribe(e){const n=e||he.ACCOUNT;k.debug("unsubscribe all event",n),this.remove(n)}static clear(){this.listeners={}}};Ye._listeners={};let J=Ye;function Zt(i){return b(this,null,function*(){const e=yield i.json();return e.err_code!=0?(i.status===401&&e.err_code===91001?J.emit(he.Expired):i.status,k.error("status",i.status,"statusText",i.statusText,"err_code",e.err_code,"err_msg",e.err_msg),Promise.reject(e)):e.data})}function Qt(i,e){return!e||/^https?:\/\//i.test(i)?i:i.startsWith("/")?`${e}${i}`:`${e}/${i}`}const ve=d=>b(this,[d],function*({method:i,path:e,params:n,headers:s,data:a,Authorization:l}){var u;if(!x.client_id)throw new Error("You need set xterio-auth info");if(n){const y=Ee.stringify(n);e+=(e.includes("?")?"&":"?")+`${y}`}const m=Qt(e,x.baseURL),g={method:i,headers:U({"content-type":"application/json","X-SDK-Version":"auth-"+Wt(),"X-Platform":"Web","X-App-ID":x.app_id,"X-Client-ID":x.client_id,"X-Timestamp":Date.now().toString(),"X-Language":"en","X-Nonce":Yt(),Authorization:l||((u=H.tokens)==null?void 0:u.id_token)||""},s)};if(a){const y=i!=="PUT"&&(s==null?void 0:s["content-type"])!=="application/x-www-form-urlencoded";g.body=y?JSON.stringify(a):a}const w=new Request(m,g);try{const y=yield fetch(w);return i==="PUT"?y:Zt(y)}catch(y){throw new Error("Network error")}});function qe(i,e,n){return b(this,null,function*(){return ve({method:"GET",path:i,params:e,Authorization:n})})}function oe(i,e,n,s){return b(this,null,function*(){return ve({method:"POST",path:i,data:e,headers:s,Authorization:n})})}function er(i,e){return b(this,null,function*(){return ve({method:"DELETE",path:i,data:e})})}function tr(i,e,n){return b(this,null,function*(){return ve({method:"PUT",path:i,data:e,headers:n})})}class K{static login(e){return b(this,null,function*(){const{client_id:n="",client_secret:s="",redirect_uri:a="",grant_type:l=""}=x.config||{},d={client_id:n,client_secret:s,redirect_uri:a,grant_type:l,code:e},m=new URLSearchParams(d);k.debug("go login");const g=yield oe("/account/v1/oauth2/token",m,"",{"content-type":"application/x-www-form-urlencoded"}).then(w=>(k.info("login success."),V.setTokens(w),w)).catch(w=>(k.error("login failed."),null));if(g!=null&&g.id_token){k.debug("get userinfo");const w=yield this.getUserInfo();if(w.uuid)return w}return null})}static getUserInfo(){return b(this,null,function*(){const[e,n]=yield Promise.all([this.getProfile(),this.getWallet()]),s=G(U({},e),{wallet:n});return Ce.setUserInfo(s),s!=null&&s.uuid&&J.emit(he.ACCOUNT,s),s})}static getProfile(){return b(this,null,function*(){const e=yield qe("/account/v1/user/profile").then(n=>(k.info("get profile success."),n)).catch(n=>(k.error("get profile failed."),null));return e!=null&&e.uuid?U({},e):{}})}static getWallet(){return b(this,null,function*(){const e=yield qe("/account/v1/wallet").then(n=>(k.info("get wallet success."),n)).catch(n=>(k.error("get wallet failed."),null));return(e==null?void 0:e.wallet)||[]})}static loginService(e,n,s){return b(this,null,function*(){const a=yield oe("/account/v1/login",{username:e,password:n,"h-recaptcha-response":s}).catch(l=>G(U({},l),{error:!0}));return k.info("ttl login",a!=null&&a.error?"failed":"success"),a!=null&&a.error||V.setTokens(a),a!=null&&a.error?G(U({},a),{error:!0}):G(U({},a),{error:!1})})}static refreshTokenService(e){return oe("/auth/v1/refresh",{refresh_token:e}).catch(()=>({}))}static registerService(l){return b(this,arguments,function*({username:e,password:n,subscribe:s,hcaptchaResponseToken:a=""}){const d=yield oe("/account/v1/register",{username:e,password:n,subscribe:s?1:0,invite_code:"","h-recaptcha-response":a}).catch(m=>G(U({},m),{error:!0}));return d!=null&&d.error?{error:!0,err_code:d==null?void 0:d.err_code}:{error:!1}})}static registerConfirmService(a){return b(this,arguments,function*({username:e,password:n,code:s}){const l=yield oe("/account/v1/register/code/confirm",{username:e,code:s,password:n}).catch(d=>({error:!0,err_code:d.err_code}));return l!=null&&l.error||V.setTokens(l),l!=null&&l.error?l:G(U({},l),{error:!1})})}static sendForgotCodeService(n){return b(this,arguments,function*({email:e}){const s=yield oe("/account/v1/password/forgot?source=forgot",{username:e}).catch(a=>({error:!0,err_code:a.err_code}));return s!=null&&s.error?s:G(U({},s),{error:!1})})}static resetPassword(a){return b(this,arguments,function*({email:e,code:n,password:s}){const l=yield oe("/account/v1/password/forgot/confirm",{username:e,password:s,confirmation_code:n}).catch(d=>({error:!0,err_code:d.err_code}));return l!=null&&l.error?l:G(U({},l),{error:!1})})}static getOtacByTokens(){return b(this,null,function*(){const e=V.idToken,n=V.refreshToken,s=V.accessToken;if(!e||!n)return"";const a=yield oe("/auth/v1/otac",{access_token:s,id_token:e,refresh_token:n}).catch(()=>({code:""}));return(a==null?void 0:a.code)||""})}}const rr="data:image/svg+xml,%3csvg%20width='116'%20height='24'%20viewBox='0%200%20116.36363983154297%2024'%20xmlns='http://www.w3.org/2000/svg'%20class='mb-0'%3e%3cg%20clip-path='url(%23clip0_0_335)'%20fill-rule='evenodd'%20clip-rule='evenodd'%3e%3cpath%20d='M28.032%203.485a.222.222%200%2000.024.067c.006.355.014.709.027%201.073a4979.123%204979.123%200%2001.084%2010.93c-.003.18.01.36.035.538.323%201.904%201.251%203.422%202.9%204.466%201.12.71%202.363%201.104%203.658%201.347a20.98%2020.98%200%20005.866.214c.113-.01.121-.06.121-.152-.005-1.454-.005-2.91%200-4.37%200-.117-.036-.137-.143-.137a10.497%2010.497%200%2001-2.263-.267c-1-.246-1.919-.646-2.642-1.403-.681-.713-1.061-1.553-1.055-2.554a286.7%20286.7%200%20000-3.71c-.002-.165.05-.19.199-.19h4.782c.113%200%20.15-.023.15-.145a531.922%20531.922%200%20010-4.265c0-.131-.037-.15-.159-.15-1.634.005-3.278.005-4.916.005-.132%200-.177-.023-.177-.168V.77l-.008-.001.006-.003.006-.039h-6.495v2.758zM1.285%2021.519c-.185.187-.372.375-.557.566-.004.064.033.059.066.054.01-.001.02-.003.028-.002h7.892a.235.235%200%2000.183-.084l2.242-2.3%201.945-2.004.004-.003c.044-.045.075-.075.137-.009.322.342.648.676.973%201.01l.09.093a888.395%20888.395%200%20013.104%203.22.245.245%200%2000.197.08h7.863l.025.002c.03.005.062.01.084-.03l-.013-.015c-.009-.01-.017-.02-.026-.028l-2.454-2.536-3.906-4.037c-.607-.63-1.217-1.26-1.83-1.887-.08-.088-.112-.148%200-.243a3.69%203.69%200%2000.304-.311l2.76-2.848%204.348-4.5.851-.886h-7.951a.377.377%200%2000-.298.13c-.422.446-.847.885-1.271%201.324l-.001.001-.365.377-.658.679c-.596.613-1.191%201.227-1.783%201.85-.093.093-.13.088-.214%200l-.679-.706-.004-.004-.001-.001-.962-1c-.82-.842-1.638-1.687-2.455-2.533a.307.307%200%2000-.243-.108H.892c-.011%200-.024-.003-.036-.006-.04-.008-.082-.016-.1.047.603.61%201.2%201.221%201.792%201.836l3.873%204.005c.868.9%201.738%201.801%202.61%202.702.058.058.054.087%200%20.142-.14.137-.275.277-.41.417l-.146.152-4.32%204.45-2.364%202.431c-.168.173-.337.343-.506.513zm75.88-15.013a14.2%2014.2%200%2000-1.882%201.259%201.053%201.053%200%2000-.005-.069V4.933c0-.117-.018-.158-.15-.158-1.734.005-3.468.005-5.202%200-.126%200-.154.035-.154.157v17.143c-.002.129.037.152.16.152%201.728-.006%203.457-.006%205.186%200%20.14%200%20.16-.046.16-.168v-6.981c-.002-.085.01-.17.035-.25.255-.8.686-1.533%201.262-2.144.852-.934%201.902-1.6%203.04-2.134a16.1%2016.1%200%20013.839-1.233c.096-.018.13-.048.13-.152V4.916c0-.088%200-.155-.122-.144-.082.006-.166.007-.25.007-.067%200-.133.001-.2.004-2.057.11-4.06.7-5.848%201.723zm14.31%209.27v6.29c0%20.14-.038.162-.167.162h-4.99c-.122%200-.159-.027-.159-.154V9.429c0-.122.037-.156.158-.156h4.992c.13%200%20.166.03.166.163-.003%202.114-.003%204.227%200%206.34zm-34.051-.8h-9.638c-.09%200-.136%200-.155.022-.02.023-.013.069%200%20.161.18%201.25%201.014%202.09%202.265%202.25.37.03.741.036%201.112.02h3.759l1.308.003c.435.002.871.003%201.307.003.712%200%201.423%200%202.134-.015.495-.01.931-.218%201.355-.449.307-.169.6-.363.875-.581a.148.148%200%2001.196-.018c1.32.742%202.645%201.481%203.97%202.217.1.054.098.091.05.179-.84%201.486-2.1%202.473-3.669%203.096-.33.132-.67.237-1.016.316a1.413%201.413%200%2001-.327.037l-4.1-.001c-2.733-.002-5.467-.004-8.2.001a5.605%205.605%200%2001-2.928-.815c-1.293-.768-2.14-1.905-2.686-3.283a10.58%2010.58%200%2001-.662-3.005c-.095-1.046-.076-2.1.057-3.143.243-1.83.851-3.504%202.116-4.89a7.38%207.38%200%20013.851-2.258c.093-.02.188-.03.282-.029l3.468-.003c3.004-.003%206.008-.007%209.013.014%201.276.009%202.395.522%203.34%201.384.902.823%201.479%201.856%201.896%202.987.394%201.108.649%202.261.758%203.432.08.736.112%201.477.096%202.217%200%20.131-.041.15-.159.15h-9.668zm-2.53-3.56H47.77c-.089%200-.133%200-.153-.023-.021-.022-.016-.069-.005-.162.09-.788.571-1.285%201.233-1.646.302-.169.642-.255.988-.252%203.485.01%206.973.01%2010.464%200a1.492%201.492%200%20011.24.608c.306.41.526.877.646%201.374.019.07.013.107-.071.097a1.012%201.012%200%2000-.105%200l-7.111.004z'%20fill='currentColor'%3e%3c/path%3e%3cpath%20d='M113.607%2020.397a10.451%2010.451%200%20002.149-9.746c-1.696-5.954-8.221-9.124-13.981-6.796-.984.397-1.863.964-2.714%201.589-1.028.764-2.2.992-3.46.764-.973-.175-1.84-.587-2.674-1.073a2.051%202.051%200%2001-.91-1.101%202.726%202.726%200%2001-.086-.313%203.19%203.19%200%2000-5.396-1.542%203.187%203.187%200%2000-.894%201.974c-.192%202.29%202.083%204.035%204.246%203.246a2.172%202.172%200%20011.84.132%2010.35%2010.35%200%20011.728%201.124c1.325%201.086%201.977%202.45%201.824%204.187a9.748%209.748%200%2000.399%203.636%2010.456%2010.456%200%200017.929%203.919zm-12.321-9.728a5.272%205.272%200%2000-.889%202.928%205.281%205.281%200%20005.264%205.272%205.275%205.275%200%20004.874-3.25%205.272%205.272%200%2000-9.249-4.95z'%20fill='url(%23paint0_linear_0_335)'%3e%3c/path%3e%3c/g%3e%3cdefs%3e%3clinearGradient%20id='paint0_linear_0_335'%20x1='85.629'%20y1='1.216'%20x2='116.167'%20y2='24.119'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20stop-color='%23CBF2FE'%3e%3c/stop%3e%3cstop%20offset='0.391'%20stop-color='%237DD5F9'%3e%3c/stop%3e%3cstop%20offset='0.735'%20stop-color='%23E6B1F7'%3e%3c/stop%3e%3cstop%20offset='1'%20stop-color='%23E1DFA2'%3e%3c/stop%3e%3c/linearGradient%3e%3cclipPath%20id='clip0_0_335'%3e%3cpath%20fill='%23fff'%20d='M0%200h116.364v24H0z'%3e%3c/path%3e%3c/clipPath%3e%3c/defs%3e%3c/svg%3e";class nr{getElement(){const e=document.createElement("div");return e.classList.add("xa-modal-logo"),e.innerHTML=`
      <img src="${rr}" alt="Xterio" class="auth-logo" />
    `,e}}const je={"icon-close":'<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M13.414 12l6-6L18 4.586l-6 6-6-6L4.586 6l6 6-6 6L6 19.414l6-6 6 6L19.414 18l-6-6z" fill="currentColor"></path></svg>',"icon-show":'<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" style="color: rgb(254, 254, 254);"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 4C4 4 2 12 2 12s2 8 10 8 10-8 10-8-2-8-10-8zm-7.716 7.52c-.076.18-.137.342-.187.48A10.894 10.894 0 005.6 14.8C6.827 16.436 8.786 18 12 18c3.214 0 5.173-1.564 6.4-3.2a10.89 10.89 0 001.503-2.8A10.89 10.89 0 0018.4 9.2C17.173 7.564 15.214 6 12 6 8.786 6 6.827 7.564 5.6 9.2c-.626.834-1.05 1.68-1.316 2.32zM14 12a2 2 0 11-4 0 2 2 0 014 0zm2 0a4 4 0 11-8 0 4 4 0 018 0z" fill="currentColor"></path></svg>',"icon-hide":'<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" style="color: rgb(254, 254, 254);"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 4C4 4 2 12 2 12s1.028 4.113 4.56 6.44L5 20l1.414 1.414 2.023-2.023c1.03.38 2.21.609 3.563.609 8 0 10-8 10-8s-.516-2.066-2.074-4.098l1.488-1.488L20 5l-1.43 1.43C17.052 5.073 14.927 4 12 4zm5.153 3.847C15.948 6.797 14.293 6 12 6 8.786 6 6.827 7.564 5.6 9.2A10.894 10.894 0 004.097 12 10.894 10.894 0 005.6 14.8c.605.807 1.388 1.596 2.411 2.189l9.142-9.142zm-7.11 9.939A8.673 8.673 0 0012 18c3.214 0 5.173-1.564 6.4-3.2a10.89 10.89 0 001.503-2.8 10.946 10.946 0 00-1.406-2.668l-2.5 2.5L16 12a4 4 0 01-4.168 3.996l-1.79 1.79zM12 10c.064 0 .128.003.191.009l1.591-1.591a4 4 0 00-5.364 5.364l1.591-1.591A2 2 0 0112 10z" fill="currentColor"></path></svg>'},ht=(i,e=16,n)=>{const s=document.createElement("div");return s.style.cssText=`width: ${e}px; height:${e}px; display:inline-block; color: ${n!=null?n:"#ccc"};`,s.innerHTML=je==null?void 0:je[i],s};class Z{constructor(e){this.clearIcon=null,this.props=e,this.inputElement=null,this.root=this.createInputElement(),this.setUpEventListeners()}createInputElement(){const{id:e,type:n,label:s,wrapperClassNames:a,showClearIcon:l,showPasswordToggleIcon:d,onChange:m,onBlur:g,onFocus:w}=this.props,u=document.createElement("div");u.classList.add("xa-input-wrapper",`xa-input-wrapper-${n}`),a&&a.forEach(C=>u.classList.add(C));const y=document.createElement("span");y.className="xa-input-label",y.textContent=s,u.appendChild(y);const F=document.createElement("div");F.className="xa-input-inner";const E=document.createElement("input");if(E.type=n==="password"?"password":n,E.id="auth-input",E.className="xa-input",E.placeholder="",this.inputElement=E,F.appendChild(E),l){const C=document.createElement("div");C.className="xa-input-clear",C.appendChild(ht("icon-close")),C.style.visibility="hidden",C.addEventListener("click",()=>{E.value="",C.style.visibility="hidden"}),this.clearIcon=C,F.appendChild(C)}if(n==="password"&&d){const C=document.createElement("div");C.className="xa-input-value-hide",C.addEventListener("click",()=>{E.type==="password"?(E.type="text",C.className="xa-input-value-show"):(E.type="password",C.className="xa-input-value-hide")}),F.appendChild(C)}if(this.props.addonAfterSendButton){const{onClick:C,onCountdownEnd:D}=this.props.addonAfterSendButton,R=document.createElement("button");R.className="xa-input-addon-btn",R.textContent="SEND",R.addEventListener("click",se=>{se.stopPropagation(),se.preventDefault(),R.disabled=!0;let ge=60;const ke=setInterval(()=>{ge--,ge===0?(R.disabled=!1,R.textContent="SEND",clearInterval(ke),D==null||D()):(R.disabled=!0,R.textContent=`${ge-1}s`)},1e3);R.textContent=`${ge}s`,C==null||C()}),F.appendChild(R)}E.addEventListener("input",C=>{var R,se;const D=(se=(R=C.target)==null?void 0:R.value)!=null?se:"";this.clearIcon&&(this.clearIcon.style.visibility=D?"visible":"hidden"),m&&m(D)}),E.addEventListener("focus",C=>{var D,R;w&&w((R=(D=C.target)==null?void 0:D.value)!=null?R:"")}),E.addEventListener("blur",C=>{var D,R;g&&g((R=(D=C.target)==null?void 0:D.value)!=null?R:"")}),u.appendChild(F);const O=document.createElement("p");return O.className="xa-error-tip",this.props.showError?O.textContent=this.props.errorMessage||"":O.style.display="none",u.appendChild(O),u}getElement(){return this.root}setUpEventListeners(){this.root,this.root.addEventListener("click",()=>{const n=this.root.querySelector(".xa-input");n&&n.focus()}),this.root.querySelectorAll(".xa-input").forEach(n=>{n.addEventListener("focus",()=>{const s=n.closest(".xa-input-wrapper"),a=s==null?void 0:s.querySelector(".xa-input-label");a&&a.classList.add("xa-input-label_filled")}),n.addEventListener("blur",()=>{const s=n.closest(".xa-input-wrapper"),a=s==null?void 0:s.querySelector(".xa-input-label");a&&n.value===""&&a.classList.remove("xa-input-label_filled")})})}showError(e){const n=this.root.querySelector(".xa-error-tip");n.textContent=e,n.style.display="block"}hideError(){const e=this.root.querySelector(".xa-error-tip");e.style.display="none"}getValue(){return this.inputElement.value}setValue(e){this.inputElement.value=e,this.props.onChange&&this.props.onChange(e)}}class ir{constructor(){this.loader=document.createElement("div")}getElement(){return this.loader.classList.add("xa-loader"),this.loader}show(){var e;(e=this.loader)==null||e.classList.remove("xa-hide")}hide(){var e;(e=this.loader)==null||e.classList.add("xa-hide")}}class be{constructor(e){this.props=e,this.root=this.createButtonElement()}createButtonElement(){const{id:e,text:n,wrapperClassNames:s,disabled:a,onClick:l}=this.props,d=document.createElement("button");d.className="xa-login-button",d.textContent=n;const m=new ir;return m.hide(),d.insertBefore(m.getElement(),d.firstChild),this.loader=m,s&&s.forEach(g=>d.classList.add(g)),a&&(d.disabled=!0,d.classList.add("xa-login-button_disabled")),l&&d.addEventListener("click",g=>l(g)),d}getElement(){return this.root}setDisabled(e){this.root.disabled=e,e?this.root.classList.add("xa-login-button_disabled"):this.root.classList.remove("xa-login-button_disabled")}setLoading(e){var n,s;e?(n=this.loader)==null||n.show():(s=this.loader)==null||s.hide()}}var z=(i=>(i.Login="login",i.Signup="signup",i.SignupCode="signupCode",i.ForgotPassword="forgotPassword",i.PasswordSuccess="passwordSuccess",i))(z||{});class Be{constructor(e,n){this.modal=e}}class Ne{constructor(){this.formList=[]}add(e,n){this.formList.push({name:e,formItem:n})}findFormItem(e){var s;return(s=this.formList.find(a=>a.name===e))==null?void 0:s.formItem}clearFormItemError(e){var s;const n=(s=this.formList.find(a=>a.name===e))==null?void 0:s.formItem;n==null||n.clearError()}getFormItemValue(e){var s,a,l;const n=(s=this.formList.find(d=>d.name===e))==null?void 0:s.formItem;return(l=(a=n==null?void 0:n.value)==null?void 0:a.toString())!=null?l:""}getFormItemChecked(e){var s;const n=(s=this.formList.find(a=>a.name===e))==null?void 0:s.formItem;return!!(n!=null&&n.value)}}const or=i=>!!i&&/\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*/.test(i),sr=i=>!!i&&/^(?=.*[A-Z])(?=.*\d)[\S]{8,}$/.test(i),ze=i=>or(i)?"":"Invalid Email",dt=i=>sr(i)?"":"Password must be at least 8 characters with 1 upper case letter and 1 number",ft=(i,e)=>i===e?"":"The passwords don't match";class X{constructor(e,n,s){this._value="",this.root=document.createElement("div"),this.root.className="xa-form-item",this.root.innerHTML=`
    <div class="xa-form-item-error"></div>`,this.root.setAttribute("data-name",e),this.root.insertBefore(n,this.root.firstChild),this.label=document.createElement("span"),this.getValueFunction=s}getElement(){return this.root}get value(){return this.getValueFunction()}setError(e){var n,s;this.root.querySelector(".xa-form-item-error").innerHTML=e,e?(n=this.root.querySelector(".xa-input-wrapper"))==null||n.classList.add("xa-error-border"):(s=this.root.querySelector(".xa-input-wrapper"))==null||s.classList.remove("xa-error-border")}isValidate(){var e;return!((e=this.root.querySelector(".xa-form-item-error"))!=null&&e.innerHTML)}clearError(){var e;this.root.querySelector(".xa-form-item-error").innerHTML="",(e=this.root.querySelector(".xa-input-wrapper"))==null||e.classList.remove("xa-error-border")}}const pt=!1;class mt extends Be{constructor(e,n){super(e),this.loginButton=null,this.emailInput=null,this.pwdInput=null,this.form=new Ne}render(){if(!this.modal.modalContainer)return;const e=this.modal.modalContainer;this.modal.setTitle("Sign in","Sign in with email"),this.renderEmailInput(e),this.renderPwdInput(e),this.renderHcaptcha(e),this.renderTips(e),this.renderLoginButton(e),this.setupListeners()}renderEmailInput(e){const n=new Z({label:"EMAIL",type:"text",showClearIcon:!0,onChange:a=>{this.form.clearFormItemError("email"),this.handleEmailChange(a)},onBlur:a=>{var l;(l=this.form.findFormItem("email"))==null||l.setError(ze(a)),this.handleEmailChange(a)}});this.emailInput=n;const s=new X("email",n.getElement(),()=>n.getValue());this.form.add("email",s),this.append(e,s.getElement())}renderPwdInput(e){const n=new Z({label:"PASSWORD",type:"password",showClearIcon:!0,onChange:a=>{this.handlePasswordChange(a)},onBlur:a=>{var l;(l=this.form.findFormItem("password"))==null||l.setError(dt(a)),this.handlePasswordChange(a)}});this.pwdInput=n;const s=new X("password",n.getElement(),()=>n.getValue());this.form.add("password",s),this.append(e,s.getElement())}renderHcaptcha(e){var s;const n=document.createElement("div");n.id="hcaptcha",n.classList.add("h-captcha"),hcaptcha.render(n,{size:"invisible",sitekey:(ae==null?void 0:ae[(s=this.modal)==null?void 0:s.env].HCAPTCHA_SITE_KEY)||""}),e.appendChild(n)}renderTips(e){const n=document.createElement("div");n.classList.add("xa-login-tip","xa-flex","xa-justify-between"),n.innerHTML=`
      <div>No account yet? <a class="xa-to-sign-up">Sign up</a></div>
      <div>
        <a class="xa-to-forgotpwd">Forgot password?</a>
      </div>
    `,e.appendChild(n)}renderLoginButton(e){const n=new be({text:"SIGN IN",disabled:!0,onClick:s=>{this.handleLogin()}});this.loginButton=n,this.append(e,n.getElement())}setupListeners(){var s,a;const e=(s=this.modal.modalContainer)==null?void 0:s.querySelector(".xa-to-sign-up");e==null||e.addEventListener("click",()=>this.modal.switchModalState(z.Signup));const n=(a=this.modal.modalContainer)==null?void 0:a.querySelector(".xa-to-forgotpwd");n==null||n.addEventListener("click",()=>this.modal.switchModalState(z.ForgotPassword))}handleEmailChange(e){var n,s;(s=this.loginButton)==null||s.setDisabled(e.length===0||!((n=this.form.findFormItem("email"))!=null&&n.isValidate()))}handlePasswordChange(e){var n,s;(s=this.loginButton)==null||s.setDisabled(e.length===0||!((n=this.form.findFormItem("password"))!=null&&n.isValidate()))}getHCaptchaResponse(){return b(this,null,function*(){try{const e=hcaptcha.execute({async:!0}),{response:n}=yield e;return n||""}catch(e){return""}})}handleLogin(){return b(this,null,function*(){var d,m,g,w,u,y,F,E,O,C;const e=(d=this.emailInput)==null?void 0:d.getValue(),n=(m=this.pwdInput)==null?void 0:m.getValue();if(!e||!n)return;(g=this.loginButton)==null||g.setLoading(!0);const s=yield this.getHCaptchaResponse();if(!s&&!pt){(w=this.loginButton)==null||w.setLoading(!1);return}const{error:a,err_code:l}=yield this.modal.store.login(e,n,s);if((u=this.loginButton)==null||u.setLoading(!1),a){switch(l){case 11001:(y=this.form.findFormItem("email"))==null||y.setError("Wrong email or password");break;case 11103:(F=this.form.findFormItem("password"))==null||F.setError("Invalid password");break;case 11113:(E=this.form.findFormItem("password"))==null||E.setError("User does not exist.");break;case 11004:(O=this.form.findFormItem("password"))==null||O.setError("Too many attempts to login");break;default:(C=this.form.findFormItem("password"))==null||C.setError("Unknown error, please try again later");break}return}this.modal.close()})}append(e,n){e.appendChild(n)}}const ar="https://xter.io/privacy-policy",cr="https://xter.io/terms-of-service",lr="https://js.hcaptcha.com/1/api.js";class gt{constructor(e){this._checked=!1,this._checked=!!e.defaultChecked,this.props=e,this.root=document.createElement("div"),this.root.className="xa-checkbox-wrapper",this.checkboxInput=document.createElement("input"),this.checkboxInput.type="checkbox",this.checkboxInput.className="xa-checkbox-input",this.checkboxInput.checked=this._checked,this.checkboxLabel=document.createElement("label"),this.checkboxLabel.className="xa-checkbox-label",this.root.appendChild(this.checkboxInput),this.root.appendChild(this.checkboxLabel),this.root.addEventListener("click",this.handleCheckboxChange.bind(this)),this.updateCheckboxState()}getElement(){return this.root}handleCheckboxChange(){const{onChange:e}=this.props;this._checked=!this._checked,this.updateCheckboxState(),e==null||e(this._checked)}updateCheckboxState(){this._checked?(this.checkboxLabel.style.borderColor="#0a1161",this.checkboxLabel.style.backgroundColor="#0a1161",this.checkboxInput.checked=!0):(this.checkboxLabel.style.borderColor="#0a1161",this.checkboxLabel.style.backgroundColor="transparent",this.checkboxInput.checked=!1)}get checked(){return this._checked}}class ur extends Be{constructor(e,n){super(e),this.signUpButton=null,this.extraData=n||{},this.form=new Ne}render(){if(!this.modal.modalContainer)return;const e=this.modal.modalContainer;this.modal.setTitle("Create Xterio account","Sign up with email"),this.renderEmailInput(e),this.renderPwdInput(e),this.renderConfirmPwdInput(e),this.renderHCaptcha(e),this.renderTipsCheckList(e),this.renderConfirmButton(e),this.renderBackTip(e),this.setupListeners()}renderBackTip(e){const n=document.createElement("div");n.classList.add("xa-w-full","xa-text-center"),n.innerHTML=`
      <div class="xa-login-tip">
        <span>Already have an account? </span>
        <a class="xa-to-sign-in"> Sign in </a>
      </div>
    `,this.append(e,n)}renderConfirmButton(e){const n=new be({text:"SIGN UP",disabled:!0,onClick:s=>{this.handleSignUp()}});this.signUpButton=n,this.append(e,n.getElement())}renderTipsCheckList(e){const n=document.createElement("div"),s=document.createElement("div");s.classList.add("xa-login-tip","xa-flex"),s.innerHTML=`
      <div>
        <span>I am 18 years of age or older and agree to the terms of the</span>
        <a href="${cr}" target="_blank"> Terms of Service </a>
        <span>and the</span>
        <a href="${ar}" target="_blank"> Privacy Policy </a>
      </div>
        `;const a=new gt({defaultChecked:!0,onChange:y=>{this.form.clearFormItemError("terms")}}),l=a.getElement();l.classList.add("xa-login-tip-checkbox"),s.insertBefore(l,s.firstChild),n.appendChild(s);const d=new X("terms",s,()=>a.checked);this.form.add("terms",d),n.appendChild(d.getElement());const m=document.createElement("div");m.classList.add("xa-login-tip","xa-flex","xa-items-center"),m.innerHTML=`<div class="xa-login-tip">
        <span>Subscribe to updates via email</span>
      </div>`;const g=new gt({defaultChecked:!1}),w=g.getElement();w.classList.add("xa-login-tip-checkbox"),m.insertBefore(w,m.firstChild),n.appendChild(m);const u=new X("subscribe",m,()=>g.checked);this.form.add("subscribe",u),n.appendChild(u.getElement()),this.append(e,n)}renderConfirmPwdInput(e){const n=new Z({label:"CONFRIM PASSWORD",type:"password",showClearIcon:!0,onChange:a=>{this.handlePasswordChange(a)},onBlur:a=>{var l;(l=this.form.findFormItem("confirmPassword"))==null||l.setError(ft(this.form.getFormItemValue("password"),a))}});this.confirmPwdInput=n;const s=new X("confirmPassword",n.getElement(),()=>this.confirmPwdInput.getValue());this.form.add("confirmPassword",s),this.append(e,s.getElement())}renderHCaptcha(e){var s;const n=document.createElement("div");n.id="hcaptcha",n.classList.add("h-captcha"),hcaptcha.render(n,{size:"invisible",sitekey:(ae==null?void 0:ae[(s=this.modal)==null?void 0:s.env].HCAPTCHA_SITE_KEY)||""}),e.appendChild(n)}renderPwdInput(e){const n=new Z({label:"PASSWORD",type:"password",showClearIcon:!0,onChange:a=>{this.handlePasswordChange(a)},onBlur:a=>{var l;(l=this.form.findFormItem("password"))==null||l.setError(dt(a))}});this.pwdInput=n;const s=new X("password",n.getElement(),()=>this.pwdInput.getValue());this.form.add("password",s),this.append(e,s.getElement())}renderEmailInput(e){const n=new Z({label:"EMAIL",type:"text",showClearIcon:!0,onChange:a=>{this.form.clearFormItemError("email"),this.handleEmailChange(a)},onBlur:a=>{var l;(l=this.form.findFormItem("email"))==null||l.setError(ze(a))}});this.emailInput=n;const s=new X("email",n.getElement(),()=>this.emailInput.getValue());this.form.add("email",s),this.append(e,s.getElement())}setupListeners(){var s,a;const e=(s=this.modal.modalContainer)==null?void 0:s.querySelector(".xa-to-sign-in");e==null||e.addEventListener("click",()=>this.modal.switchModalState(z.Login));const n=(a=this.modal.modalContainer)==null?void 0:a.querySelector(".xa-to-forgotpwd");n==null||n.addEventListener("click",()=>this.modal.switchModalState(z.ForgotPassword))}handleEmailChange(e){var n;(n=this.signUpButton)==null||n.setDisabled(e.length===0)}handlePasswordChange(e){}getHCaptchaResponse(){return b(this,null,function*(){try{const e=hcaptcha.execute({async:!0}),{response:n}=yield e;return n||""}catch(e){return""}})}handleSignUp(){return b(this,null,function*(){var g,w,u,y,F,E,O;const e=this.form.getFormItemValue("email"),n=this.form.getFormItemValue("password");this.form.getFormItemValue("confirmPassword");const s=!!this.form.getFormItemChecked("terms"),a=!!this.form.getFormItemChecked("subscribe");if(!s){(g=this.form.findFormItem("terms"))==null||g.setError("You have to accept Terms of Service and Privacy Policy to continue.");return}if(!e||!n)return;(w=this.signUpButton)==null||w.setLoading(!0);const l=yield this.getHCaptchaResponse();if(!l&&!pt){(u=this.signUpButton)==null||u.setLoading(!1);return}const{error:d,err_code:m}=yield K.registerService({username:e,password:n,subscribe:a,hcaptchaResponseToken:l});if((y=this.signUpButton)==null||y.setLoading(!1),d){switch(m){case 11102:(F=this.form.findFormItem("email"))==null||F.setError("User already registered.");break;case 11103:(E=this.form.findFormItem("password"))==null||E.setError("Invalid password.");break;default:(O=this.form.findFormItem("subscribe"))==null||O.setError("Unknown error, please try again later.");break}return}this.modal.switchModalState(z.SignupCode,{email:e,password:n})})}append(e,n){e.appendChild(n)}}class hr extends Be{constructor(e,n){super(e),this.continueButton=null,this.form=new Ne}render(){if(!this.modal.modalContainer)return;const e=this.modal.modalContainer;this.modal.setTitle("Forgot password","Please enter your email and email verification code"),this.renderEmailInput(e),this.renderCodeInput(e),this.renderPwdInput(e),this.renderConfirmPwdInput(e),this.renderConfirmButton(e),this.renderBackTip(e),this.setupListeners()}renderEmailInput(e){const n=new Z({label:"EMAIL",type:"text",showClearIcon:!0,onChange:a=>{this.form.clearFormItemError("email"),this.handleEmailChange(a)},onBlur:a=>{var l;(l=this.form.findFormItem("email"))==null||l.setError(ze(a))}}),s=new X("email",n.getElement(),()=>n.getValue());this.form.add("email",s),this.append(e,s.getElement())}renderCodeInput(e){const n=new Z({label:"ENTER CODE",type:"text",onChange:a=>{this.handleEmailChange(a)},addonAfterSendButton:{onClick:()=>{var l;if(!this.form.getFormItemValue("email")){(l=this.form.findFormItem("email"))==null||l.setError("Email is required");return}K.sendForgotCodeService({email:this.form.getFormItemValue("email")})},onCountdownEnd:()=>{}}}),s=new X("code",n.getElement(),()=>n.getValue());this.form.add("code",s),this.append(e,s.getElement())}renderPwdInput(e){const n=new Z({label:"NEW PASSWORD",type:"password",showClearIcon:!0,onChange:a=>{this.handlePasswordChange(a)}}),s=new X("password",n.getElement(),()=>n.getValue());this.form.add("password",s),this.append(e,s.getElement())}renderConfirmPwdInput(e){const n=new Z({label:"CONFRIM PASSWORD",type:"password",showClearIcon:!0,onChange:a=>{this.handlePasswordChange(a)},onBlur:a=>{var l;(l=this.form.findFormItem("confirmPassword"))==null||l.setError(ft(this.form.getFormItemValue("password"),a))}}),s=new X("confirmPassword",n.getElement(),()=>n.getValue());this.form.add("confirmPassword",s),this.append(e,s.getElement())}renderConfirmButton(e){const n=new be({text:"CONTINUE",disabled:!0,onClick:s=>{this.handleUpdatePassword()}});this.continueButton=n,this.append(e,n.getElement())}renderBackTip(e){const n=document.createElement("div");n.classList.add("xa-w-full","xa-text-center"),n.innerHTML=`
      <div class="xa-login-tip">
       <span>Back to </span>
        <a class="xa-to-sign-in"> Sign in </a>
      </div>
    `,this.append(e,n)}setupListeners(){var s,a;const e=(s=this.modal.modalContainer)==null?void 0:s.querySelector(".xa-to-sign-in");e==null||e.addEventListener("click",()=>this.modal.switchModalState(z.Login));const n=(a=this.modal.modalContainer)==null?void 0:a.querySelector(".xa-to-forgotpwd");n==null||n.addEventListener("click",()=>this.modal.switchModalState(z.ForgotPassword))}handleEmailChange(e){var n;(n=this.continueButton)==null||n.setDisabled(e.length===0)}handlePasswordChange(e){}handleUpdatePassword(){return b(this,null,function*(){var d,m,g,w,u,y,F;const e=this.form.getFormItemValue("email"),n=this.form.getFormItemValue("password");this.form.getFormItemValue("confirmPassword");const s=this.form.getFormItemValue("code");if(!e||!n)return;(d=this.continueButton)==null||d.setLoading(!0);const{error:a,err_code:l}=yield K.resetPassword({email:e,password:n,code:s});if((m=this.continueButton)==null||m.setLoading(!1),a){switch(l){case 10001:(g=this.form.findFormItem("code"))==null||g.setError("Invalid verification code");break;case 11111:(w=this.form.findFormItem("code"))==null||w.setError("Invalid verification code");break;case 11112:(u=this.form.findFormItem("code"))==null||u.setError("Verification code expired");break;case 11113:(y=this.form.findFormItem("email"))==null||y.setError("User does not exist");break;default:(F=this.form.findFormItem("confirmPassword"))==null||F.setError("Unknown error, please try again later.");break}return}this.modal.switchModalState(z.PasswordSuccess)})}append(e,n){e.appendChild(n)}}class dr{constructor(){this.listeners=new Set}subscribe(e){return this.listeners.add(e),()=>this.listeners.delete(e)}notify(){this.listeners.forEach(e=>e())}}class fr{constructor(){var e,n,s;this.accessToken=(e=H.tokens)==null?void 0:e.access_token,this.refreshToken=(n=H.tokens)==null?void 0:n.refresh_token,this.idToken=(s=H.tokens)==null?void 0:s.id_token}setTokens({accessToken:e,refreshToken:n,idToken:s}){this.accessToken=e,this.refreshToken=n,this.idToken=s,H.tokens={access_token:e,id_token:s,refresh_token:n}}removeTokens(){this.accessToken=void 0,this.refreshToken=void 0,this.idToken=void 0,H.deleteTokens()}}class pr extends dr{constructor(){super(),this.userState={isLogin:!1,userInfo:null},this.tokenManager=new fr,this.refreshUserInfo(),this.listenStateChange()}listenStateChange(){const e={isLogin:!1,userInfo:null};this.userState=new Proxy(e,{set:(n,s,a)=>(n[s]!==a&&(n[s]=a,this.setPersistUserInfo(),this.notify()),!0)})}login(e,n,s){return b(this,null,function*(){const{error:a,err_code:l,access_token:d,id_token:m,refresh_token:g}=yield K.loginService(e,n,s);return!a&&d&&g?(this.tokenManager.setTokens({accessToken:d,refreshToken:g,idToken:m}),yield this.getUserInfo(),this.userState.isLogin=!0):this.userState.isLogin=!1,{error:!!a,err_code:l}})}confirmSignUpLogin(a){return b(this,arguments,function*({username:e,password:n,code:s}){const{error:l,err_code:d,access_token:m,id_token:g,refresh_token:w}=yield K.registerConfirmService({username:e,password:n,code:s});return!l&&m&&w?(this.tokenManager.setTokens({accessToken:m,refreshToken:w,idToken:g}),yield this.getUserInfo(),this.userState.isLogin=!0):this.userState.isLogin=!1,{error:!!l,err_code:d}})}getUserInfo(){return b(this,null,function*(){const e=yield K.getUserInfo();return e&&e.uuid&&(this.userState.userInfo=U(U({},this.userState.userInfo),e),this.userState.isLogin=!0),e})}setPersistUserInfo(){this.userState.userInfo&&(H.userInfo=this.userState.userInfo)}getPersistUserInfo(){return H.userInfo}refreshUserInfo(){return b(this,null,function*(){J.subscribe(e=>{this.userState.userInfo=e,this.userState.isLogin=Fe.isLogin}),this.tokenManager.idToken||this.logout()})}logout(){this.userState.isLogin=!1,this.userState.userInfo=null,this.tokenManager.removeTokens()}}class mr extends Be{constructor(e,n){super(e),this.signUpButton=null,this.extraData=n||{},this.form=new Ne}render(){if(!this.modal.modalContainer)return;const e=this.modal.modalContainer;this.modal.setTitle("Verify email","Verification code has been sent to",this.extraData.email),this.renderCodeInput(e),this.renderConfirmButton(e),this.renderBackTip(e),this.setupListeners()}renderCodeInput(e){const n=new Z({id:"xaCodeInput",label:"ENTER CODE",type:"text",showClearIcon:!0,onChange:a=>{this.handleCodeChange(a)}}),s=new X("code",n.getElement(),()=>n.getValue());this.form.add("code",s),this.append(e,s.getElement())}renderConfirmButton(e){const n=new be({text:"CONTINUE",disabled:!0,onClick:s=>{this.handleContinueSignUp()}});this.signUpButton=n,this.append(e,n.getElement())}renderBackTip(e){const n=document.createElement("div");n.classList.add("xa-w-full","xa-text-center"),n.innerHTML=`
      <div class="xa-login-tip">
        <span>Already have an account? </span>
        <a class="xa-to-sign-in"> Sign in </a>
      </div>
    `,this.append(e,n)}setupListeners(){var s,a;const e=(s=this.modal.modalContainer)==null?void 0:s.querySelector(".xa-to-sign-in");e==null||e.addEventListener("click",()=>this.modal.switchModalState(z.Login));const n=(a=this.modal.modalContainer)==null?void 0:a.querySelector(".xa-to-forgotpwd");n==null||n.addEventListener("click",()=>this.modal.switchModalState(z.ForgotPassword))}handleCodeChange(e){var n;(n=this.signUpButton)==null||n.setDisabled(e.length===0)}append(e,n){e.appendChild(n)}handleContinueSignUp(){return b(this,null,function*(){var d,m,g,w,u,y;const e=this.form.getFormItemValue("code"),n=(d=this.extraData)==null?void 0:d.password,s=(m=this.extraData)==null?void 0:m.email;if(!n||!s||!e)return;(g=this.signUpButton)==null||g.setLoading(!0);const{error:a,err_code:l}=yield this.modal.store.confirmSignUpLogin({username:s,password:n,code:e});if((w=this.signUpButton)==null||w.setLoading(!1),a){switch(l){case 11111:(u=this.form.findFormItem("code"))==null||u.setError("Invalid verification code");break;default:(y=this.form.findFormItem("code"))==null||y.setError("Unknown error, please try again later.");break}return}this.modal.close()})}}const gr="data:image/svg+xml,%3csvg%20width='80'%20height='80'%20viewBox='0%200%2064%2064'%20xmlns='http://www.w3.org/2000/svg'%3e%3csvg%20width='64'%20height='64'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3ccircle%20cx='32'%20cy='32'%20r='24'%20fill='url(%23paint0_linear_0_548)'%3e%3c/circle%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M44.535%2026L29%2041.535%2019.465%2032%2023%2028.465l6%206%2012-12L44.535%2026z'%20fill='%230A1161'%3e%3c/path%3e%3cdefs%3e%3clinearGradient%20id='paint0_linear_0_548'%20x1='8'%20y1='32.828'%20x2='56'%20y2='32.828'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20stop-color='%239EE6FC'%3e%3c/stop%3e%3cstop%20offset='1'%20stop-color='%23EBB9E7'%3e%3c/stop%3e%3c/linearGradient%3e%3c/defs%3e%3c/svg%3e%3c/svg%3e";function wr(){const i=document.createElement("div");return i.classList.add("xa-modal-logo"),i.innerHTML=`
      <img src="${gr}" alt="Xterio" class="xa-icon-success" />
    `,i}class yr extends Be{constructor(e,n){super(e)}render(){if(!this.modal.modalContainer)return;const e=this.modal.modalContainer;this.append(e,wr()),this.modal.setTitle("Password has been changed!","Your password has been changed successfully"),this.renderConfirmButton(e)}renderConfirmButton(e){const n=new be({text:"SIGN IN",onClick:s=>{this.modal.switchModalState(z.Login)}});this.append(e,n.getElement())}append(e,n){e.appendChild(n)}}class q{constructor({apiUrl:e,env:n}){this.apiUrl=e,this.env=n||_.Dev,this.initHCaptcha(),this.currentState=new mt(this),this.store=new pr}static get instance(){if(!q._instance)throw new Error("Xterio Auth SDK is not initialized. Call XterioAuth.init({apiUrl, env}) first.");return q._instance}static init({apiUrl:e,env:n}){q._instance||(q._instance=new q({apiUrl:e,env:n}))}initHCaptcha(){const e=document.createElement("script");e.src=lr,e.async=!0,e.defer=!0,document.head.appendChild(e)}open(){const e=document.createElement("div");e.className="xa-modal-overlay",this.modalOverlay=e,e.addEventListener("click",s=>{s.target});const n=document.createElement("div");this.modalContainer=n,n.className="xa-modal",this.renderCommonElement(n),e.appendChild(n),document.body.appendChild(e),this.currentState.render()}close(){var e,n;(e=this.modalContainer)==null||e.remove(),(n=this.modalOverlay)==null||n.remove()}renderCommonElement(e){const n=new nr;e.appendChild(n.getElement());const s=ht("icon-close",24,"#838383");s.addEventListener("click",()=>this.close()),s.className="xa-signin-close",e.appendChild(s);const a=document.createElement("div");a.className="xa-signin-title-container",a.innerHTML=`
        <h3 class="xa-signin-title">Sign in</h3>
        <p class="xa-signin-sub-title">Sign in with email</p>
        <div class="xa-signin-title-email"></div>
       `,e.appendChild(a)}setTitle(e,n,s){const a=document.querySelector(".xa-signin-title"),l=document.querySelector(".xa-signin-sub-title"),d=document.querySelector(".xa-signin-title-email");a.innerHTML=e,l.innerHTML=n,d&&s&&(d.innerHTML=s)}renderContent(){this.modalContainer&&(this.modalContainer.innerHTML="",this.renderCommonElement(this.modalContainer)),this.currentState.render()}switchModalState(e,n){switch(e){case"login":this.currentState=new mt(this,n);break;case"signup":this.currentState=new ur(this,n);break;case"signupCode":this.currentState=new mr(this,n);break;case"forgotPassword":this.currentState=new hr(this,n);break;case z.PasswordSuccess:this.currentState=new yr(this,n);break}this.renderContent()}}var wt={},Re={};Re.byteLength=Ir,Re.toByteArray=br,Re.fromByteArray=kr;for(var Q=[],W=[],xr=typeof Uint8Array!="undefined"?Uint8Array:Array,Ge="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",me=0,Er=Ge.length;me<Er;++me)Q[me]=Ge[me],W[Ge.charCodeAt(me)]=me;W[45]=62,W[95]=63;function yt(i){var e=i.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=i.indexOf("=");n===-1&&(n=e);var s=n===e?0:4-n%4;return[n,s]}function Ir(i){var e=yt(i),n=e[0],s=e[1];return(n+s)*3/4-s}function Cr(i,e,n){return(e+n)*3/4-n}function br(i){var e,n=yt(i),s=n[0],a=n[1],l=new xr(Cr(i,s,a)),d=0,m=a>0?s-4:s,g;for(g=0;g<m;g+=4)e=W[i.charCodeAt(g)]<<18|W[i.charCodeAt(g+1)]<<12|W[i.charCodeAt(g+2)]<<6|W[i.charCodeAt(g+3)],l[d++]=e>>16&255,l[d++]=e>>8&255,l[d++]=e&255;return a===2&&(e=W[i.charCodeAt(g)]<<2|W[i.charCodeAt(g+1)]>>4,l[d++]=e&255),a===1&&(e=W[i.charCodeAt(g)]<<10|W[i.charCodeAt(g+1)]<<4|W[i.charCodeAt(g+2)]>>2,l[d++]=e>>8&255,l[d++]=e&255),l}function Br(i){return Q[i>>18&63]+Q[i>>12&63]+Q[i>>6&63]+Q[i&63]}function Fr(i,e,n){for(var s,a=[],l=e;l<n;l+=3)s=(i[l]<<16&16711680)+(i[l+1]<<8&65280)+(i[l+2]&255),a.push(Br(s));return a.join("")}function kr(i){for(var e,n=i.length,s=n%3,a=[],l=16383,d=0,m=n-s;d<m;d+=l)a.push(Fr(i,d,d+l>m?m:d+l));return s===1?(e=i[n-1],a.push(Q[e>>2]+Q[e<<4&63]+"==")):s===2&&(e=(i[n-2]<<8)+i[n-1],a.push(Q[e>>10]+Q[e>>4&63]+Q[e<<2&63]+"=")),a.join("")}var Ke={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */Ke.read=function(i,e,n,s,a){var l,d,m=a*8-s-1,g=(1<<m)-1,w=g>>1,u=-7,y=n?a-1:0,F=n?-1:1,E=i[e+y];for(y+=F,l=E&(1<<-u)-1,E>>=-u,u+=m;u>0;l=l*256+i[e+y],y+=F,u-=8);for(d=l&(1<<-u)-1,l>>=-u,u+=s;u>0;d=d*256+i[e+y],y+=F,u-=8);if(l===0)l=1-w;else{if(l===g)return d?NaN:(E?-1:1)*(1/0);d=d+Math.pow(2,s),l=l-w}return(E?-1:1)*d*Math.pow(2,l-s)},Ke.write=function(i,e,n,s,a,l){var d,m,g,w=l*8-a-1,u=(1<<w)-1,y=u>>1,F=a===23?Math.pow(2,-24)-Math.pow(2,-77):0,E=s?0:l-1,O=s?1:-1,C=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(m=isNaN(e)?1:0,d=u):(d=Math.floor(Math.log(e)/Math.LN2),e*(g=Math.pow(2,-d))<1&&(d--,g*=2),d+y>=1?e+=F/g:e+=F*Math.pow(2,1-y),e*g>=2&&(d++,g/=2),d+y>=u?(m=0,d=u):d+y>=1?(m=(e*g-1)*Math.pow(2,a),d=d+y):(m=e*Math.pow(2,y-1)*Math.pow(2,a),d=0));a>=8;i[n+E]=m&255,E+=O,m/=256,a-=8);for(d=d<<a|m,w+=a;w>0;i[n+E]=d&255,E+=O,d/=256,w-=8);i[n+E-O]|=C*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(i){const e=Re,n=Ke,s=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;i.Buffer=u,i.SlowBuffer=$r,i.INSPECT_MAX_BYTES=50;const a=2147483647;i.kMaxLength=a;const{Uint8Array:l,ArrayBuffer:d,SharedArrayBuffer:m}=globalThis;u.TYPED_ARRAY_SUPPORT=g(),!u.TYPED_ARRAY_SUPPORT&&typeof console!="undefined"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function g(){try{const o=new l(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,l.prototype),Object.setPrototypeOf(o,t),o.foo()===42}catch(o){return!1}}Object.defineProperty(u.prototype,"parent",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.buffer}}),Object.defineProperty(u.prototype,"offset",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.byteOffset}});function w(o){if(o>a)throw new RangeError('The value "'+o+'" is invalid for option "size"');const t=new l(o);return Object.setPrototypeOf(t,u.prototype),t}function u(o,t,r){if(typeof o=="number"){if(typeof t=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return O(o)}return y(o,t,r)}u.poolSize=8192;function y(o,t,r){if(typeof o=="string")return C(o,t);if(d.isView(o))return R(o);if(o==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof o);if(ee(o,d)||o&&ee(o.buffer,d)||typeof m!="undefined"&&(ee(o,m)||o&&ee(o.buffer,m)))return se(o,t,r);if(typeof o=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const c=o.valueOf&&o.valueOf();if(c!=null&&c!==o)return u.from(c,t,r);const h=ge(o);if(h)return h;if(typeof Symbol!="undefined"&&Symbol.toPrimitive!=null&&typeof o[Symbol.toPrimitive]=="function")return u.from(o[Symbol.toPrimitive]("string"),t,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof o)}u.from=function(o,t,r){return y(o,t,r)},Object.setPrototypeOf(u.prototype,l.prototype),Object.setPrototypeOf(u,l);function F(o){if(typeof o!="number")throw new TypeError('"size" argument must be of type number');if(o<0)throw new RangeError('The value "'+o+'" is invalid for option "size"')}function E(o,t,r){return F(o),o<=0?w(o):t!==void 0?typeof r=="string"?w(o).fill(t,r):w(o).fill(t):w(o)}u.alloc=function(o,t,r){return E(o,t,r)};function O(o){return F(o),w(o<0?0:ke(o)|0)}u.allocUnsafe=function(o){return O(o)},u.allocUnsafeSlow=function(o){return O(o)};function C(o,t){if((typeof t!="string"||t==="")&&(t="utf8"),!u.isEncoding(t))throw new TypeError("Unknown encoding: "+t);const r=Bt(o,t)|0;let c=w(r);const h=c.write(o,t);return h!==r&&(c=c.slice(0,h)),c}function D(o){const t=o.length<0?0:ke(o.length)|0,r=w(t);for(let c=0;c<t;c+=1)r[c]=o[c]&255;return r}function R(o){if(ee(o,l)){const t=new l(o);return se(t.buffer,t.byteOffset,t.byteLength)}return D(o)}function se(o,t,r){if(t<0||o.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(o.byteLength<t+(r||0))throw new RangeError('"length" is outside of buffer bounds');let c;return t===void 0&&r===void 0?c=new l(o):r===void 0?c=new l(o,t):c=new l(o,t,r),Object.setPrototypeOf(c,u.prototype),c}function ge(o){if(u.isBuffer(o)){const t=ke(o.length)|0,r=w(t);return r.length===0||o.copy(r,0,0,t),r}if(o.length!==void 0)return typeof o.length!="number"||Qe(o.length)?w(0):D(o);if(o.type==="Buffer"&&Array.isArray(o.data))return D(o.data)}function ke(o){if(o>=a)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+a.toString(16)+" bytes");return o|0}function $r(o){return+o!=o&&(o=0),u.alloc(+o)}u.isBuffer=function(t){return t!=null&&t._isBuffer===!0&&t!==u.prototype},u.compare=function(t,r){if(ee(t,l)&&(t=u.from(t,t.offset,t.byteLength)),ee(r,l)&&(r=u.from(r,r.offset,r.byteLength)),!u.isBuffer(t)||!u.isBuffer(r))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(t===r)return 0;let c=t.length,h=r.length;for(let f=0,p=Math.min(c,h);f<p;++f)if(t[f]!==r[f]){c=t[f],h=r[f];break}return c<h?-1:h<c?1:0},u.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(t,r){if(!Array.isArray(t))throw new TypeError('"list" argument must be an Array of Buffers');if(t.length===0)return u.alloc(0);let c;if(r===void 0)for(r=0,c=0;c<t.length;++c)r+=t[c].length;const h=u.allocUnsafe(r);let f=0;for(c=0;c<t.length;++c){let p=t[c];if(ee(p,l))f+p.length>h.length?(u.isBuffer(p)||(p=u.from(p)),p.copy(h,f)):l.prototype.set.call(h,p,f);else if(u.isBuffer(p))p.copy(h,f);else throw new TypeError('"list" argument must be an Array of Buffers');f+=p.length}return h};function Bt(o,t){if(u.isBuffer(o))return o.length;if(d.isView(o)||ee(o,d))return o.byteLength;if(typeof o!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof o);const r=o.length,c=arguments.length>2&&arguments[2]===!0;if(!c&&r===0)return 0;let h=!1;for(;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return Ze(o).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return r*2;case"hex":return r>>>1;case"base64":return Pt(o).length;default:if(h)return c?-1:Ze(o).length;t=(""+t).toLowerCase(),h=!0}}u.byteLength=Bt;function Hr(o,t,r){let c=!1;if((t===void 0||t<0)&&(t=0),t>this.length||((r===void 0||r>this.length)&&(r=this.length),r<=0)||(r>>>=0,t>>>=0,r<=t))return"";for(o||(o="utf8");;)switch(o){case"hex":return Jr(this,t,r);case"utf8":case"utf-8":return St(this,t,r);case"ascii":return Wr(this,t,r);case"latin1":case"binary":return Yr(this,t,r);case"base64":return Kr(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Zr(this,t,r);default:if(c)throw new TypeError("Unknown encoding: "+o);o=(o+"").toLowerCase(),c=!0}}u.prototype._isBuffer=!0;function fe(o,t,r){const c=o[t];o[t]=o[r],o[r]=c}u.prototype.swap16=function(){const t=this.length;if(t%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let r=0;r<t;r+=2)fe(this,r,r+1);return this},u.prototype.swap32=function(){const t=this.length;if(t%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let r=0;r<t;r+=4)fe(this,r,r+3),fe(this,r+1,r+2);return this},u.prototype.swap64=function(){const t=this.length;if(t%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let r=0;r<t;r+=8)fe(this,r,r+7),fe(this,r+1,r+6),fe(this,r+2,r+5),fe(this,r+3,r+4);return this},u.prototype.toString=function(){const t=this.length;return t===0?"":arguments.length===0?St(this,0,t):Hr.apply(this,arguments)},u.prototype.toLocaleString=u.prototype.toString,u.prototype.equals=function(t){if(!u.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t?!0:u.compare(this,t)===0},u.prototype.inspect=function(){let t="";const r=i.INSPECT_MAX_BYTES;return t=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(t+=" ... "),"<Buffer "+t+">"},s&&(u.prototype[s]=u.prototype.inspect),u.prototype.compare=function(t,r,c,h,f){if(ee(t,l)&&(t=u.from(t,t.offset,t.byteLength)),!u.isBuffer(t))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof t);if(r===void 0&&(r=0),c===void 0&&(c=t?t.length:0),h===void 0&&(h=0),f===void 0&&(f=this.length),r<0||c>t.length||h<0||f>this.length)throw new RangeError("out of range index");if(h>=f&&r>=c)return 0;if(h>=f)return-1;if(r>=c)return 1;if(r>>>=0,c>>>=0,h>>>=0,f>>>=0,this===t)return 0;let p=f-h,I=c-r;const v=Math.min(p,I),L=this.slice(h,f),N=t.slice(r,c);for(let S=0;S<v;++S)if(L[S]!==N[S]){p=L[S],I=N[S];break}return p<I?-1:I<p?1:0};function Ft(o,t,r,c,h){if(o.length===0)return-1;if(typeof r=="string"?(c=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,Qe(r)&&(r=h?0:o.length-1),r<0&&(r=o.length+r),r>=o.length){if(h)return-1;r=o.length-1}else if(r<0)if(h)r=0;else return-1;if(typeof t=="string"&&(t=u.from(t,c)),u.isBuffer(t))return t.length===0?-1:kt(o,t,r,c,h);if(typeof t=="number")return t=t&255,typeof l.prototype.indexOf=="function"?h?l.prototype.indexOf.call(o,t,r):l.prototype.lastIndexOf.call(o,t,r):kt(o,[t],r,c,h);throw new TypeError("val must be string, number or Buffer")}function kt(o,t,r,c,h){let f=1,p=o.length,I=t.length;if(c!==void 0&&(c=String(c).toLowerCase(),c==="ucs2"||c==="ucs-2"||c==="utf16le"||c==="utf-16le")){if(o.length<2||t.length<2)return-1;f=2,p/=2,I/=2,r/=2}function v(N,S){return f===1?N[S]:N.readUInt16BE(S*f)}let L;if(h){let N=-1;for(L=r;L<p;L++)if(v(o,L)===v(t,N===-1?0:L-N)){if(N===-1&&(N=L),L-N+1===I)return N*f}else N!==-1&&(L-=L-N),N=-1}else for(r+I>p&&(r=p-I),L=r;L>=0;L--){let N=!0;for(let S=0;S<I;S++)if(v(o,L+S)!==v(t,S)){N=!1;break}if(N)return L}return-1}u.prototype.includes=function(t,r,c){return this.indexOf(t,r,c)!==-1},u.prototype.indexOf=function(t,r,c){return Ft(this,t,r,c,!0)},u.prototype.lastIndexOf=function(t,r,c){return Ft(this,t,r,c,!1)};function Vr(o,t,r,c){r=Number(r)||0;const h=o.length-r;c?(c=Number(c),c>h&&(c=h)):c=h;const f=t.length;c>f/2&&(c=f/2);let p;for(p=0;p<c;++p){const I=parseInt(t.substr(p*2,2),16);if(Qe(I))return p;o[r+p]=I}return p}function qr(o,t,r,c){return De(Ze(t,o.length-r),o,r,c)}function jr(o,t,r,c){return De(rn(t),o,r,c)}function zr(o,t,r,c){return De(Pt(t),o,r,c)}function Gr(o,t,r,c){return De(nn(t,o.length-r),o,r,c)}u.prototype.write=function(t,r,c,h){if(r===void 0)h="utf8",c=this.length,r=0;else if(c===void 0&&typeof r=="string")h=r,c=this.length,r=0;else if(isFinite(r))r=r>>>0,isFinite(c)?(c=c>>>0,h===void 0&&(h="utf8")):(h=c,c=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const f=this.length-r;if((c===void 0||c>f)&&(c=f),t.length>0&&(c<0||r<0)||r>this.length)throw new RangeError("Attempt to write outside buffer bounds");h||(h="utf8");let p=!1;for(;;)switch(h){case"hex":return Vr(this,t,r,c);case"utf8":case"utf-8":return qr(this,t,r,c);case"ascii":case"latin1":case"binary":return jr(this,t,r,c);case"base64":return zr(this,t,r,c);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Gr(this,t,r,c);default:if(p)throw new TypeError("Unknown encoding: "+h);h=(""+h).toLowerCase(),p=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function Kr(o,t,r){return t===0&&r===o.length?e.fromByteArray(o):e.fromByteArray(o.slice(t,r))}function St(o,t,r){r=Math.min(o.length,r);const c=[];let h=t;for(;h<r;){const f=o[h];let p=null,I=f>239?4:f>223?3:f>191?2:1;if(h+I<=r){let v,L,N,S;switch(I){case 1:f<128&&(p=f);break;case 2:v=o[h+1],(v&192)===128&&(S=(f&31)<<6|v&63,S>127&&(p=S));break;case 3:v=o[h+1],L=o[h+2],(v&192)===128&&(L&192)===128&&(S=(f&15)<<12|(v&63)<<6|L&63,S>2047&&(S<55296||S>57343)&&(p=S));break;case 4:v=o[h+1],L=o[h+2],N=o[h+3],(v&192)===128&&(L&192)===128&&(N&192)===128&&(S=(f&15)<<18|(v&63)<<12|(L&63)<<6|N&63,S>65535&&S<1114112&&(p=S))}}p===null?(p=65533,I=1):p>65535&&(p-=65536,c.push(p>>>10&1023|55296),p=56320|p&1023),c.push(p),h+=I}return Xr(c)}const _t=4096;function Xr(o){const t=o.length;if(t<=_t)return String.fromCharCode.apply(String,o);let r="",c=0;for(;c<t;)r+=String.fromCharCode.apply(String,o.slice(c,c+=_t));return r}function Wr(o,t,r){let c="";r=Math.min(o.length,r);for(let h=t;h<r;++h)c+=String.fromCharCode(o[h]&127);return c}function Yr(o,t,r){let c="";r=Math.min(o.length,r);for(let h=t;h<r;++h)c+=String.fromCharCode(o[h]);return c}function Jr(o,t,r){const c=o.length;(!t||t<0)&&(t=0),(!r||r<0||r>c)&&(r=c);let h="";for(let f=t;f<r;++f)h+=on[o[f]];return h}function Zr(o,t,r){const c=o.slice(t,r);let h="";for(let f=0;f<c.length-1;f+=2)h+=String.fromCharCode(c[f]+c[f+1]*256);return h}u.prototype.slice=function(t,r){const c=this.length;t=~~t,r=r===void 0?c:~~r,t<0?(t+=c,t<0&&(t=0)):t>c&&(t=c),r<0?(r+=c,r<0&&(r=0)):r>c&&(r=c),r<t&&(r=t);const h=this.subarray(t,r);return Object.setPrototypeOf(h,u.prototype),h};function M(o,t,r){if(o%1!==0||o<0)throw new RangeError("offset is not uint");if(o+t>r)throw new RangeError("Trying to access beyond buffer length")}u.prototype.readUintLE=u.prototype.readUIntLE=function(t,r,c){t=t>>>0,r=r>>>0,c||M(t,r,this.length);let h=this[t],f=1,p=0;for(;++p<r&&(f*=256);)h+=this[t+p]*f;return h},u.prototype.readUintBE=u.prototype.readUIntBE=function(t,r,c){t=t>>>0,r=r>>>0,c||M(t,r,this.length);let h=this[t+--r],f=1;for(;r>0&&(f*=256);)h+=this[t+--r]*f;return h},u.prototype.readUint8=u.prototype.readUInt8=function(t,r){return t=t>>>0,r||M(t,1,this.length),this[t]},u.prototype.readUint16LE=u.prototype.readUInt16LE=function(t,r){return t=t>>>0,r||M(t,2,this.length),this[t]|this[t+1]<<8},u.prototype.readUint16BE=u.prototype.readUInt16BE=function(t,r){return t=t>>>0,r||M(t,2,this.length),this[t]<<8|this[t+1]},u.prototype.readUint32LE=u.prototype.readUInt32LE=function(t,r){return t=t>>>0,r||M(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+this[t+3]*16777216},u.prototype.readUint32BE=u.prototype.readUInt32BE=function(t,r){return t=t>>>0,r||M(t,4,this.length),this[t]*16777216+(this[t+1]<<16|this[t+2]<<8|this[t+3])},u.prototype.readBigUInt64LE=ue(function(t){t=t>>>0,ye(t,"offset");const r=this[t],c=this[t+7];(r===void 0||c===void 0)&&Se(t,this.length-8);const h=r+this[++t]*T(2,8)+this[++t]*T(2,16)+this[++t]*T(2,24),f=this[++t]+this[++t]*T(2,8)+this[++t]*T(2,16)+c*T(2,24);return BigInt(h)+(BigInt(f)<<BigInt(32))}),u.prototype.readBigUInt64BE=ue(function(t){t=t>>>0,ye(t,"offset");const r=this[t],c=this[t+7];(r===void 0||c===void 0)&&Se(t,this.length-8);const h=r*T(2,24)+this[++t]*T(2,16)+this[++t]*T(2,8)+this[++t],f=this[++t]*T(2,24)+this[++t]*T(2,16)+this[++t]*T(2,8)+c;return(BigInt(h)<<BigInt(32))+BigInt(f)}),u.prototype.readIntLE=function(t,r,c){t=t>>>0,r=r>>>0,c||M(t,r,this.length);let h=this[t],f=1,p=0;for(;++p<r&&(f*=256);)h+=this[t+p]*f;return f*=128,h>=f&&(h-=Math.pow(2,8*r)),h},u.prototype.readIntBE=function(t,r,c){t=t>>>0,r=r>>>0,c||M(t,r,this.length);let h=r,f=1,p=this[t+--h];for(;h>0&&(f*=256);)p+=this[t+--h]*f;return f*=128,p>=f&&(p-=Math.pow(2,8*r)),p},u.prototype.readInt8=function(t,r){return t=t>>>0,r||M(t,1,this.length),this[t]&128?(255-this[t]+1)*-1:this[t]},u.prototype.readInt16LE=function(t,r){t=t>>>0,r||M(t,2,this.length);const c=this[t]|this[t+1]<<8;return c&32768?c|4294901760:c},u.prototype.readInt16BE=function(t,r){t=t>>>0,r||M(t,2,this.length);const c=this[t+1]|this[t]<<8;return c&32768?c|4294901760:c},u.prototype.readInt32LE=function(t,r){return t=t>>>0,r||M(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},u.prototype.readInt32BE=function(t,r){return t=t>>>0,r||M(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},u.prototype.readBigInt64LE=ue(function(t){t=t>>>0,ye(t,"offset");const r=this[t],c=this[t+7];(r===void 0||c===void 0)&&Se(t,this.length-8);const h=this[t+4]+this[t+5]*T(2,8)+this[t+6]*T(2,16)+(c<<24);return(BigInt(h)<<BigInt(32))+BigInt(r+this[++t]*T(2,8)+this[++t]*T(2,16)+this[++t]*T(2,24))}),u.prototype.readBigInt64BE=ue(function(t){t=t>>>0,ye(t,"offset");const r=this[t],c=this[t+7];(r===void 0||c===void 0)&&Se(t,this.length-8);const h=(r<<24)+this[++t]*T(2,16)+this[++t]*T(2,8)+this[++t];return(BigInt(h)<<BigInt(32))+BigInt(this[++t]*T(2,24)+this[++t]*T(2,16)+this[++t]*T(2,8)+c)}),u.prototype.readFloatLE=function(t,r){return t=t>>>0,r||M(t,4,this.length),n.read(this,t,!0,23,4)},u.prototype.readFloatBE=function(t,r){return t=t>>>0,r||M(t,4,this.length),n.read(this,t,!1,23,4)},u.prototype.readDoubleLE=function(t,r){return t=t>>>0,r||M(t,8,this.length),n.read(this,t,!0,52,8)},u.prototype.readDoubleBE=function(t,r){return t=t>>>0,r||M(t,8,this.length),n.read(this,t,!1,52,8)};function j(o,t,r,c,h,f){if(!u.isBuffer(o))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>h||t<f)throw new RangeError('"value" argument is out of bounds');if(r+c>o.length)throw new RangeError("Index out of range")}u.prototype.writeUintLE=u.prototype.writeUIntLE=function(t,r,c,h){if(t=+t,r=r>>>0,c=c>>>0,!h){const I=Math.pow(2,8*c)-1;j(this,t,r,c,I,0)}let f=1,p=0;for(this[r]=t&255;++p<c&&(f*=256);)this[r+p]=t/f&255;return r+c},u.prototype.writeUintBE=u.prototype.writeUIntBE=function(t,r,c,h){if(t=+t,r=r>>>0,c=c>>>0,!h){const I=Math.pow(2,8*c)-1;j(this,t,r,c,I,0)}let f=c-1,p=1;for(this[r+f]=t&255;--f>=0&&(p*=256);)this[r+f]=t/p&255;return r+c},u.prototype.writeUint8=u.prototype.writeUInt8=function(t,r,c){return t=+t,r=r>>>0,c||j(this,t,r,1,255,0),this[r]=t&255,r+1},u.prototype.writeUint16LE=u.prototype.writeUInt16LE=function(t,r,c){return t=+t,r=r>>>0,c||j(this,t,r,2,65535,0),this[r]=t&255,this[r+1]=t>>>8,r+2},u.prototype.writeUint16BE=u.prototype.writeUInt16BE=function(t,r,c){return t=+t,r=r>>>0,c||j(this,t,r,2,65535,0),this[r]=t>>>8,this[r+1]=t&255,r+2},u.prototype.writeUint32LE=u.prototype.writeUInt32LE=function(t,r,c){return t=+t,r=r>>>0,c||j(this,t,r,4,4294967295,0),this[r+3]=t>>>24,this[r+2]=t>>>16,this[r+1]=t>>>8,this[r]=t&255,r+4},u.prototype.writeUint32BE=u.prototype.writeUInt32BE=function(t,r,c){return t=+t,r=r>>>0,c||j(this,t,r,4,4294967295,0),this[r]=t>>>24,this[r+1]=t>>>16,this[r+2]=t>>>8,this[r+3]=t&255,r+4};function Tt(o,t,r,c,h){Rt(t,c,h,o,r,7);let f=Number(t&BigInt(4294967295));o[r++]=f,f=f>>8,o[r++]=f,f=f>>8,o[r++]=f,f=f>>8,o[r++]=f;let p=Number(t>>BigInt(32)&BigInt(4294967295));return o[r++]=p,p=p>>8,o[r++]=p,p=p>>8,o[r++]=p,p=p>>8,o[r++]=p,r}function Ut(o,t,r,c,h){Rt(t,c,h,o,r,7);let f=Number(t&BigInt(4294967295));o[r+7]=f,f=f>>8,o[r+6]=f,f=f>>8,o[r+5]=f,f=f>>8,o[r+4]=f;let p=Number(t>>BigInt(32)&BigInt(4294967295));return o[r+3]=p,p=p>>8,o[r+2]=p,p=p>>8,o[r+1]=p,p=p>>8,o[r]=p,r+8}u.prototype.writeBigUInt64LE=ue(function(t,r=0){return Tt(this,t,r,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeBigUInt64BE=ue(function(t,r=0){return Ut(this,t,r,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeIntLE=function(t,r,c,h){if(t=+t,r=r>>>0,!h){const v=Math.pow(2,8*c-1);j(this,t,r,c,v-1,-v)}let f=0,p=1,I=0;for(this[r]=t&255;++f<c&&(p*=256);)t<0&&I===0&&this[r+f-1]!==0&&(I=1),this[r+f]=(t/p>>0)-I&255;return r+c},u.prototype.writeIntBE=function(t,r,c,h){if(t=+t,r=r>>>0,!h){const v=Math.pow(2,8*c-1);j(this,t,r,c,v-1,-v)}let f=c-1,p=1,I=0;for(this[r+f]=t&255;--f>=0&&(p*=256);)t<0&&I===0&&this[r+f+1]!==0&&(I=1),this[r+f]=(t/p>>0)-I&255;return r+c},u.prototype.writeInt8=function(t,r,c){return t=+t,r=r>>>0,c||j(this,t,r,1,127,-128),t<0&&(t=255+t+1),this[r]=t&255,r+1},u.prototype.writeInt16LE=function(t,r,c){return t=+t,r=r>>>0,c||j(this,t,r,2,32767,-32768),this[r]=t&255,this[r+1]=t>>>8,r+2},u.prototype.writeInt16BE=function(t,r,c){return t=+t,r=r>>>0,c||j(this,t,r,2,32767,-32768),this[r]=t>>>8,this[r+1]=t&255,r+2},u.prototype.writeInt32LE=function(t,r,c){return t=+t,r=r>>>0,c||j(this,t,r,4,2147483647,-2147483648),this[r]=t&255,this[r+1]=t>>>8,this[r+2]=t>>>16,this[r+3]=t>>>24,r+4},u.prototype.writeInt32BE=function(t,r,c){return t=+t,r=r>>>0,c||j(this,t,r,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),this[r]=t>>>24,this[r+1]=t>>>16,this[r+2]=t>>>8,this[r+3]=t&255,r+4},u.prototype.writeBigInt64LE=ue(function(t,r=0){return Tt(this,t,r,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),u.prototype.writeBigInt64BE=ue(function(t,r=0){return Ut(this,t,r,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function Lt(o,t,r,c,h,f){if(r+c>o.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function At(o,t,r,c,h){return t=+t,r=r>>>0,h||Lt(o,t,r,4),n.write(o,t,r,c,23,4),r+4}u.prototype.writeFloatLE=function(t,r,c){return At(this,t,r,!0,c)},u.prototype.writeFloatBE=function(t,r,c){return At(this,t,r,!1,c)};function vt(o,t,r,c,h){return t=+t,r=r>>>0,h||Lt(o,t,r,8),n.write(o,t,r,c,52,8),r+8}u.prototype.writeDoubleLE=function(t,r,c){return vt(this,t,r,!0,c)},u.prototype.writeDoubleBE=function(t,r,c){return vt(this,t,r,!1,c)},u.prototype.copy=function(t,r,c,h){if(!u.isBuffer(t))throw new TypeError("argument should be a Buffer");if(c||(c=0),!h&&h!==0&&(h=this.length),r>=t.length&&(r=t.length),r||(r=0),h>0&&h<c&&(h=c),h===c||t.length===0||this.length===0)return 0;if(r<0)throw new RangeError("targetStart out of bounds");if(c<0||c>=this.length)throw new RangeError("Index out of range");if(h<0)throw new RangeError("sourceEnd out of bounds");h>this.length&&(h=this.length),t.length-r<h-c&&(h=t.length-r+c);const f=h-c;return this===t&&typeof l.prototype.copyWithin=="function"?this.copyWithin(r,c,h):l.prototype.set.call(t,this.subarray(c,h),r),f},u.prototype.fill=function(t,r,c,h){if(typeof t=="string"){if(typeof r=="string"?(h=r,r=0,c=this.length):typeof c=="string"&&(h=c,c=this.length),h!==void 0&&typeof h!="string")throw new TypeError("encoding must be a string");if(typeof h=="string"&&!u.isEncoding(h))throw new TypeError("Unknown encoding: "+h);if(t.length===1){const p=t.charCodeAt(0);(h==="utf8"&&p<128||h==="latin1")&&(t=p)}}else typeof t=="number"?t=t&255:typeof t=="boolean"&&(t=Number(t));if(r<0||this.length<r||this.length<c)throw new RangeError("Out of range index");if(c<=r)return this;r=r>>>0,c=c===void 0?this.length:c>>>0,t||(t=0);let f;if(typeof t=="number")for(f=r;f<c;++f)this[f]=t;else{const p=u.isBuffer(t)?t:u.from(t,h),I=p.length;if(I===0)throw new TypeError('The value "'+t+'" is invalid for argument "value"');for(f=0;f<c-r;++f)this[f+r]=p[f%I]}return this};const we={};function Je(o,t,r){we[o]=class extends r{constructor(){super(),Object.defineProperty(this,"message",{value:t.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${o}]`,this.stack,delete this.name}get code(){return o}set code(h){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:h,writable:!0})}toString(){return`${this.name} [${o}]: ${this.message}`}}}Je("ERR_BUFFER_OUT_OF_BOUNDS",function(o){return o?`${o} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),Je("ERR_INVALID_ARG_TYPE",function(o,t){return`The "${o}" argument must be of type number. Received type ${typeof t}`},TypeError),Je("ERR_OUT_OF_RANGE",function(o,t,r){let c=`The value of "${o}" is out of range.`,h=r;return Number.isInteger(r)&&Math.abs(r)>T(2,32)?h=Nt(String(r)):typeof r=="bigint"&&(h=String(r),(r>T(BigInt(2),BigInt(32))||r<-T(BigInt(2),BigInt(32)))&&(h=Nt(h)),h+="n"),c+=` It must be ${t}. Received ${h}`,c},RangeError);function Nt(o){let t="",r=o.length;const c=o[0]==="-"?1:0;for(;r>=c+4;r-=3)t=`_${o.slice(r-3,r)}${t}`;return`${o.slice(0,r)}${t}`}function Qr(o,t,r){ye(t,"offset"),(o[t]===void 0||o[t+r]===void 0)&&Se(t,o.length-(r+1))}function Rt(o,t,r,c,h,f){if(o>r||o<t){const p=typeof t=="bigint"?"n":"";let I;throw t===0||t===BigInt(0)?I=`>= 0${p} and < 2${p} ** ${(f+1)*8}${p}`:I=`>= -(2${p} ** ${(f+1)*8-1}${p}) and < 2 ** ${(f+1)*8-1}${p}`,new we.ERR_OUT_OF_RANGE("value",I,o)}Qr(c,h,f)}function ye(o,t){if(typeof o!="number")throw new we.ERR_INVALID_ARG_TYPE(t,"number",o)}function Se(o,t,r){throw Math.floor(o)!==o?(ye(o,r),new we.ERR_OUT_OF_RANGE("offset","an integer",o)):t<0?new we.ERR_BUFFER_OUT_OF_BOUNDS:new we.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${t}`,o)}const en=/[^+/0-9A-Za-z-_]/g;function tn(o){if(o=o.split("=")[0],o=o.trim().replace(en,""),o.length<2)return"";for(;o.length%4!==0;)o=o+"=";return o}function Ze(o,t){t=t||1/0;let r;const c=o.length;let h=null;const f=[];for(let p=0;p<c;++p){if(r=o.charCodeAt(p),r>55295&&r<57344){if(!h){if(r>56319){(t-=3)>-1&&f.push(239,191,189);continue}else if(p+1===c){(t-=3)>-1&&f.push(239,191,189);continue}h=r;continue}if(r<56320){(t-=3)>-1&&f.push(239,191,189),h=r;continue}r=(h-55296<<10|r-56320)+65536}else h&&(t-=3)>-1&&f.push(239,191,189);if(h=null,r<128){if((t-=1)<0)break;f.push(r)}else if(r<2048){if((t-=2)<0)break;f.push(r>>6|192,r&63|128)}else if(r<65536){if((t-=3)<0)break;f.push(r>>12|224,r>>6&63|128,r&63|128)}else if(r<1114112){if((t-=4)<0)break;f.push(r>>18|240,r>>12&63|128,r>>6&63|128,r&63|128)}else throw new Error("Invalid code point")}return f}function rn(o){const t=[];for(let r=0;r<o.length;++r)t.push(o.charCodeAt(r)&255);return t}function nn(o,t){let r,c,h;const f=[];for(let p=0;p<o.length&&!((t-=2)<0);++p)r=o.charCodeAt(p),c=r>>8,h=r%256,f.push(h),f.push(c);return f}function Pt(o){return e.toByteArray(tn(o))}function De(o,t,r,c){let h;for(h=0;h<c&&!(h+r>=t.length||h>=o.length);++h)t[h+r]=o[h];return h}function ee(o,t){return o instanceof t||o!=null&&o.constructor!=null&&o.constructor.name!=null&&o.constructor.name===t.name}function Qe(o){return o!==o}const on=function(){const o="0123456789abcdef",t=new Array(256);for(let r=0;r<16;++r){const c=r*16;for(let h=0;h<16;++h)t[c+h]=o[r]+o[h]}return t}();function ue(o){return typeof BigInt=="undefined"?sn:o}function sn(){throw new Error("BigInt not supported")}})(wt);const Pe=wt.Buffer,Xe=typeof Pe=="function",xt=typeof TextDecoder=="function"?new TextDecoder:void 0;typeof TextEncoder=="function"&&new TextEncoder;const Sr=Array.prototype.slice.call("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="),Oe=(i=>{let e={};return i.forEach((n,s)=>e[n]=s),e})(Sr),_r=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,de=String.fromCharCode.bind(String),Et=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):i=>new Uint8Array(Array.prototype.slice.call(i,0)),It=i=>i.replace(/[^A-Za-z0-9\+\/]/g,""),Tr=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,Ur=i=>{switch(i.length){case 4:var e=(7&i.charCodeAt(0))<<18|(63&i.charCodeAt(1))<<12|(63&i.charCodeAt(2))<<6|63&i.charCodeAt(3),n=e-65536;return de((n>>>10)+55296)+de((n&1023)+56320);case 3:return de((15&i.charCodeAt(0))<<12|(63&i.charCodeAt(1))<<6|63&i.charCodeAt(2));default:return de((31&i.charCodeAt(0))<<6|63&i.charCodeAt(1))}},Lr=i=>i.replace(Tr,Ur),Ct=typeof atob=="function"?i=>atob(It(i)):Xe?i=>Pe.from(i,"base64").toString("binary"):i=>{if(i=i.replace(/\s+/g,""),!_r.test(i))throw new TypeError("malformed base64.");i+="==".slice(2-(i.length&3));let e,n="",s,a;for(let l=0;l<i.length;)e=Oe[i.charAt(l++)]<<18|Oe[i.charAt(l++)]<<12|(s=Oe[i.charAt(l++)])<<6|(a=Oe[i.charAt(l++)]),n+=s===64?de(e>>16&255):a===64?de(e>>16&255,e>>8&255):de(e>>16&255,e>>8&255,e&255);return n},Ar=Xe?i=>Et(Pe.from(i,"base64")):i=>Et(Ct(i).split("").map(e=>e.charCodeAt(0))),vr=Xe?i=>Pe.from(i,"base64").toString("utf8"):xt?i=>xt.decode(Ar(i)):i=>Lr(Ct(i)),Nr=i=>It(i.replace(/[-_]/g,e=>e=="-"?"+":"/")),Rr=i=>vr(Nr(i)),Pr=i=>i.split(" ").reduce((n,s)=>n+`xterioauth-${s} `,""),We=(i,e)=>{const n=document.createElement("div");if(n.className=Pr(i),e){const s=a=>{e==null||e()};return n.addEventListener("click",s),{element:n,remove:()=>{n.removeEventListener("click",s)}}}return{element:n}},bt=i=>{const{element:e}=We("modal-shadow"),{element:n,remove:s}=We("modal-bg pointer",()=>{s==null||s(),e.remove()}),{element:a}=We("modal-container-iframe");e.appendChild(n),e.appendChild(a);const l=document.createElement("iframe");return l.width="100%",l.height="100%",l.frameBorder="0",l.src=i,a.appendChild(l),e},Or=()=>b(this,null,function*(){if((yield Fe.getIdToken())&&!(x!=null&&x.otac)){const e=yield K.getOtacByTokens();e&&(x.otac=e,setTimeout(()=>{x.otac=""},2*60*1e3))}return(x==null?void 0:x.otac)||""}),Dr=(i,e,n)=>b(this,null,function*(){var F;const{active:s="ingame",keyword:a,collection:l,features:d}=n||{},m=e||te.alert,g=((F=x.config)==null?void 0:F.app_id)||"";if(!g)throw new Error("You must set xterio-auth app_id");const w=x.pageURL;let u="";if(i===re.asset)u=`${w}/asset?source=1&app_id=${g}&active=${s}`;else if(i===re.account)u=`${w}/settings?source=1`;else if(i===re.wallet)u=`${w}/settings?source=1&tab=wallet`;else if(i===re.nft){let E={source:1,app_id:g};l&&(E=G(U({},E),{collection:l})),a&&(E=G(U({},E),{keyword:encodeURIComponent(a)})),d&&(E=G(U({},E),{features:encodeURIComponent(JSON.stringify(d))})),u=`${w}/marketplace?${Ee.stringify(E)}`}const y=yield Or();if(y&&(u+=`&_otac=${y}`),k.debug("open xerio page uri:",u),m===te.iframeUri)return u;if(m===te.iframeDom)return bt(u).querySelector("iframe");if(m===te.alert){document.body.appendChild(bt(u));return}m===te.page&&(location.href=u)}),le=class le{static get isLogin(){var e;return!!((e=Ce.userInfo)!=null&&e.uuid)}static get userinfo(){return Ce.userInfo}static get isVaildIdToken(){var s;const e=V.idToken;if(!e)return k.error("invalid token: idtoken null"),!1;const n=(s=e.split("."))==null?void 0:s[1];if(!n)return k.error("invalid token: idtoken error"),!1;try{const{aud:a,exp:l=0,sub:d}=JSON.parse(Rr(n));return!(!a||Date.now()>(l-60)*1e3)}catch(a){return k.error("invalid token: idtoken error"),!1}}static checkToken(e="init"){return b(this,null,function*(){const n=H.tokens;n&&V.setTokens(n);const s=V.idToken,a=V.refreshToken;if(!s&&a){const d=yield K.refreshTokenService(a);V.setTokens({refresh_token:a,id_token:d.id_token,access_token:d.access_token})}const l=le.isVaildIdToken;return k.info("check the tokens valid status:",l),l?e==="init"&&(yield K.getUserInfo()):this.clearData(),V.idToken||""})}static checkCode(){return b(this,null,function*(){var d,m;const e=H.loginType;if(k.debug("check the authorize status",e),e!==A.Default&&e!==A.Email)return;const n=(d=x.config)==null?void 0:d.redirect_uri;if(!n||!location.href.startsWith(n)){k.error("not check, different redirect_uri");return}const a=(m=Ee.parseUrl(location.href,{types:{code:"string"}}).query)==null?void 0:m.code;if(!a)throw new Error("no authorize");n&&history.pushState(null,"",n),k.debug("going to login ...");const l=yield K.login(a);l!=null&&l.uuid&&H.delete($.LOGIN_TYPE)})}static getIdToken(){return b(this,null,function*(){return yield this.checkToken("getIdToken")})}static init(e,n){return b(this,null,function*(){const{app_id:s="",client_id:a="",client_secret:l="",redirect_uri:d="",mode:m="default",logout:g="1",logLevel:w=1}=e;Xt(w);const u=n!=null?n:_.Dev,y=ae[u].API_BASE,F={app_id:s,client_id:a,client_secret:l,redirect_uri:d,response_type:"code",scope:"all",mode:m,grant_type:"authorization_code",logout:g};x.app_id=s,x.client_id=a,x.env=u,x.baseURL=y,x.pageURL=ae[u].PAGE_BASE;const{response_type:E,scope:O}=F;x.authorizeUrl=y+"/account/v1/oauth2/authorize?"+Ee.stringify({client_id:a,redirect_uri:d,response_type:E,scope:O,mode:m,logout:g}),x.config=F,J.clear(),J.subscribe(C=>{k.debug("the userinfo callback count=",x.onAccount.length),x.onAccount.map(D=>D(C))}),J.subscribe(()=>{this.clearData()},he.Expired),q.init({apiUrl:y,env:u}),k.debug(q.instance),yield this.checkToken(),window.addEventListener("load",C=>b(this,null,function*(){yield this.checkCode()}))})}static clearData(){H.deleteTokens(),H.deleteUserInfo(),V.removeTokens(),Ce.removeUserInfo()}static logout(){var e,n;k.debug("logout success"),this.clearData(),(n=(e=q==null?void 0:q.instance)==null?void 0:e.store)==null||n.logout()}static login(e){return b(this,null,function*(){if(!x.config){k.error("xterio auth sdk initial failed");return}if(e&&e!==A.Mini){x.config=G(U({},x.config),{mode:e});const{response_type:n,scope:s,logout:a,client_id:l,redirect_uri:d}=x.config;x.authorizeUrl=x.baseURL+"/account/v1/oauth2/authorize?"+Ee.stringify({client_id:l,redirect_uri:d,response_type:n,scope:s,mode:e,logout:a})}if(le.isLogin){k.debug("already logined."),J.emit(he.ACCOUNT,Ce.userInfo);return}if(le.isVaildIdToken)return k.debug("get userinfo"),K.getUserInfo();if(e===A.Mini){q.instance.open();return}H.loginType=e||A.Default,k.debug("going to authorize ..."),location.href=x.authorizeUrl})}static getUserInfo(e){x.onAccount.push(e),le.userinfo&&e(le.userinfo)}};le.openPage=Dr;let Fe=le;const Mr=({onLoginStateChange:i})=>{const e=q.instance;function n(){e.open()}function s(){e.store.logout()}return e.store.subscribe(()=>{i==null||i(e.store.userState.isLogin,e.store.userState.userInfo)}),{open:n,logout:s}};B.Env=_,B.LoginType=A,B.OpenPageMode=te,B.PageType=re,B.XTERIO_CONST=$,B.XTERIO_EVENTS=he,B.XterAuthModal=q,B.XterEventEmiter=J,B.XterioAuth=Fe,B.XterioAuthService=K,B.XterioAuthTokensManager=V,B.deleteFetcher=er,B.getFetcher=qe,B.postFetcher=oe,B.putFetcher=tr,B.useXterLoginModal=Mr,Object.defineProperty(B,Symbol.toStringTag,{value:"Module"})});/*! XterioAuth v0.0.8 */
//# sourceMappingURL=index.min.js.map
