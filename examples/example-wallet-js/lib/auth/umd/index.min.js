(function(E,_){typeof exports=="object"&&typeof module!="undefined"?_(exports):typeof define=="function"&&define.amd?define(["exports"],_):(E=typeof globalThis!="undefined"?globalThis:E||self,_(E.XterioAuth={}))})(this,function(E){"use strict";var Hr=Object.defineProperty,Gr=Object.defineProperties;var Xr=Object.getOwnPropertyDescriptors;var _t=Object.getOwnPropertySymbols;var Kr=Object.prototype.hasOwnProperty,Wr=Object.prototype.propertyIsEnumerable;var S=Math.pow,Tt=(E,_,L)=>_ in E?Hr(E,_,{enumerable:!0,configurable:!0,writable:!0,value:L}):E[_]=L,P=(E,_)=>{for(var L in _||(_={}))Kr.call(_,L)&&Tt(E,L,_[L]);if(_t)for(var L of _t(_))Wr.call(_,L)&&Tt(E,L,_[L]);return E},Z=(E,_)=>Gr(E,Xr(_));var C=(E,_,L)=>new Promise((Fe,pe)=>{var be=Q=>{try{ge(L.next(Q))}catch(we){pe(we)}},me=Q=>{try{ge(L.throw(Q))}catch(we){pe(we)}},ge=Q=>Q.done?Fe(Q.value):Promise.resolve(Q.value).then(be,me);ge((L=L.apply(E,_)).next())});/*! XterioAuth v0.0.2 */var _=(i=>(i.Dev="Dev",i.Staging="Staging",i.Production="Production",i))(_||{}),L=(i=>(i.Default="default",i.Email="email",i.Mini="mini",i))(L||{});const Fe="%[a-f0-9]{2}",pe=new RegExp("("+Fe+")|([^%]+?)","gi"),be=new RegExp("("+Fe+")+","gi");function me(i,t){try{return[decodeURIComponent(i.join(""))]}catch(c){}if(i.length===1)return i;t=t||1;const n=i.slice(0,t),s=i.slice(t);return Array.prototype.concat.call([],me(n),me(s))}function ge(i){try{return decodeURIComponent(i)}catch(t){let n=i.match(pe)||[];for(let s=1;s<n.length;s++)i=me(n,s).join(""),n=i.match(pe)||[];return i}}function Q(i){const t={"%FE%FF":"��","%FF%FE":"��"};let n=be.exec(i);for(;n;){try{t[n[0]]=decodeURIComponent(n[0])}catch(c){const l=ge(n[0]);l!==n[0]&&(t[n[0]]=l)}n=be.exec(i)}t["%C2"]="�";const s=Object.keys(t);for(const c of s)i=i.replace(new RegExp(c,"g"),t[c]);return i}function we(i){if(typeof i!="string")throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof i+"`");try{return decodeURIComponent(i)}catch(t){return Q(i)}}function Ut(i,t){const n={};if(Array.isArray(t))for(const s of t){const c=Object.getOwnPropertyDescriptor(i,s);c!=null&&c.enumerable&&Object.defineProperty(n,s,c)}else for(const s of Reflect.ownKeys(i)){const c=Object.getOwnPropertyDescriptor(i,s);if(c.enumerable){const l=i[s];t(s,l,i)&&Object.defineProperty(n,s,c)}}return n}function Ke(i,t){if(!(typeof i=="string"&&typeof t=="string"))throw new TypeError("Expected the arguments to be of type `string`");if(i===""||t==="")return[];const n=i.indexOf(t);return n===-1?[]:[i.slice(0,n),i.slice(n+t.length)]}const Lt=i=>i==null,At=i=>encodeURIComponent(i).replaceAll(/[!'()*]/g,t=>`%${t.charCodeAt(0).toString(16).toUpperCase()}`),ve=Symbol("encodeFragmentIdentifier");function Nt(i){switch(i.arrayFormat){case"index":return t=>(n,s)=>{const c=n.length;return s===void 0||i.skipNull&&s===null||i.skipEmptyString&&s===""?n:s===null?[...n,[R(t,i),"[",c,"]"].join("")]:[...n,[R(t,i),"[",R(c,i),"]=",R(s,i)].join("")]};case"bracket":return t=>(n,s)=>s===void 0||i.skipNull&&s===null||i.skipEmptyString&&s===""?n:s===null?[...n,[R(t,i),"[]"].join("")]:[...n,[R(t,i),"[]=",R(s,i)].join("")];case"colon-list-separator":return t=>(n,s)=>s===void 0||i.skipNull&&s===null||i.skipEmptyString&&s===""?n:s===null?[...n,[R(t,i),":list="].join("")]:[...n,[R(t,i),":list=",R(s,i)].join("")];case"comma":case"separator":case"bracket-separator":{const t=i.arrayFormat==="bracket-separator"?"[]=":"=";return n=>(s,c)=>c===void 0||i.skipNull&&c===null||i.skipEmptyString&&c===""?s:(c=c===null?"":c,s.length===0?[[R(n,i),t,R(c,i)].join("")]:[[s,R(c,i)].join(i.arrayFormatSeparator)])}default:return t=>(n,s)=>s===void 0||i.skipNull&&s===null||i.skipEmptyString&&s===""?n:s===null?[...n,R(t,i)]:[...n,[R(t,i),"=",R(s,i)].join("")]}}function Pt(i){let t;switch(i.arrayFormat){case"index":return(n,s,c)=>{if(t=/\[(\d*)]$/.exec(n),n=n.replace(/\[\d*]$/,""),!t){c[n]=s;return}c[n]===void 0&&(c[n]={}),c[n][t[1]]=s};case"bracket":return(n,s,c)=>{if(t=/(\[])$/.exec(n),n=n.replace(/\[]$/,""),!t){c[n]=s;return}if(c[n]===void 0){c[n]=[s];return}c[n]=[...c[n],s]};case"colon-list-separator":return(n,s,c)=>{if(t=/(:list)$/.exec(n),n=n.replace(/:list$/,""),!t){c[n]=s;return}if(c[n]===void 0){c[n]=[s];return}c[n]=[...c[n],s]};case"comma":case"separator":return(n,s,c)=>{const l=typeof s=="string"&&s.includes(i.arrayFormatSeparator),d=typeof s=="string"&&!l&&ee(s,i).includes(i.arrayFormatSeparator);s=d?ee(s,i):s;const m=l||d?s.split(i.arrayFormatSeparator).map(g=>ee(g,i)):s===null?s:ee(s,i);c[n]=m};case"bracket-separator":return(n,s,c)=>{const l=/(\[])$/.test(n);if(n=n.replace(/\[]$/,""),!l){c[n]=s&&ee(s,i);return}const d=s===null?[]:s.split(i.arrayFormatSeparator).map(m=>ee(m,i));if(c[n]===void 0){c[n]=d;return}c[n]=[...c[n],...d]};default:return(n,s,c)=>{if(c[n]===void 0){c[n]=s;return}c[n]=[...[c[n]].flat(),s]}}}function We(i){if(typeof i!="string"||i.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function R(i,t){return t.encode?t.strict?At(i):encodeURIComponent(i):i}function ee(i,t){return t.decode?we(i):i}function Ye(i){return Array.isArray(i)?i.sort():typeof i=="object"?Ye(Object.keys(i)).sort((t,n)=>Number(t)-Number(n)).map(t=>i[t]):i}function Je(i){const t=i.indexOf("#");return t!==-1&&(i=i.slice(0,t)),i}function vt(i){let t="";const n=i.indexOf("#");return n!==-1&&(t=i.slice(n)),t}function Ze(i,t,n){return n==="string"&&typeof i=="string"?i:typeof n=="function"&&typeof i=="string"?n(i):t.parseBooleans&&i!==null&&(i.toLowerCase()==="true"||i.toLowerCase()==="false")?i.toLowerCase()==="true":n==="number"&&!Number.isNaN(Number(i))&&typeof i=="string"&&i.trim()!==""||t.parseNumbers&&!Number.isNaN(Number(i))&&typeof i=="string"&&i.trim()!==""?Number(i):i}function Re(i){i=Je(i);const t=i.indexOf("?");return t===-1?"":i.slice(t+1)}function Me(i,t){t=P({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1,types:Object.create(null)},t),We(t.arrayFormatSeparator);const n=Pt(t),s=Object.create(null);if(typeof i!="string"||(i=i.trim().replace(/^[?#&]/,""),!i))return s;for(const c of i.split("&")){if(c==="")continue;const l=t.decode?c.replaceAll("+"," "):c;let[d,m]=Ke(l,"=");d===void 0&&(d=l),m=m===void 0?null:["comma","separator","bracket-separator"].includes(t.arrayFormat)?m:ee(m,t),n(ee(d,t),m,s)}for(const[c,l]of Object.entries(s))if(typeof l=="object"&&l!==null&&t.types[c]!=="string")for(const[d,m]of Object.entries(l)){const g=t.types[c]?t.types[c].replace("[]",""):void 0;l[d]=Ze(m,t,g)}else typeof l=="object"&&l!==null&&t.types[c]==="string"?s[c]=Object.values(l).join(t.arrayFormatSeparator):s[c]=Ze(l,t,t.types[c]);return t.sort===!1?s:(t.sort===!0?Object.keys(s).sort():Object.keys(s).sort(t.sort)).reduce((c,l)=>{const d=s[l];return c[l]=d&&typeof d=="object"&&!Array.isArray(d)?Ye(d):d,c},Object.create(null))}function Qe(i,t){if(!i)return"";t=P({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},t),We(t.arrayFormatSeparator);const n=d=>t.skipNull&&Lt(i[d])||t.skipEmptyString&&i[d]==="",s=Nt(t),c={};for(const[d,m]of Object.entries(i))n(d)||(c[d]=m);const l=Object.keys(c);return t.sort!==!1&&l.sort(t.sort),l.map(d=>{const m=i[d];return m===void 0?"":m===null?R(d,t):Array.isArray(m)?m.length===0&&t.arrayFormat==="bracket-separator"?R(d,t)+"[]":m.reduce(s(d),[]).join("&"):R(d,t)+"="+R(m,t)}).filter(d=>d.length>0).join("&")}function et(i,t){var c,l;t=P({decode:!0},t);let[n,s]=Ke(i,"#");return n===void 0&&(n=i),P({url:(l=(c=n==null?void 0:n.split("?"))==null?void 0:c[0])!=null?l:"",query:Me(Re(i),t)},t&&t.parseFragmentIdentifier&&s?{fragmentIdentifier:ee(s,t)}:{})}function tt(i,t){t=P({encode:!0,strict:!0,[ve]:!0},t);const n=Je(i.url).split("?")[0]||"",s=Re(i.url),c=P(P({},Me(s,{sort:!1})),i.query);let l=Qe(c,t);l&&(l=`?${l}`);let d=vt(i.url);if(typeof i.fragmentIdentifier=="string"){const m=new URL(n);m.hash=i.fragmentIdentifier,d=t[ve]?m.hash:`#${i.fragmentIdentifier}`}return`${n}${l}${d}`}function rt(i,t,n){n=P({parseFragmentIdentifier:!0,[ve]:!1},n);const{url:s,query:c,fragmentIdentifier:l}=et(i,n);return tt({url:s,query:Ut(c,t),fragmentIdentifier:l},n)}function Rt(i,t,n){const s=Array.isArray(t)?c=>!t.includes(c):(c,l)=>!t(c,l);return rt(i,s,n)}const ke=Object.freeze(Object.defineProperty({__proto__:null,exclude:Rt,extract:Re,parse:Me,parseUrl:et,pick:rt,stringify:Qe,stringifyUrl:tt},Symbol.toStringTag,{value:"Module"})),nt="0.0.2",T=(...i)=>{console.log(`[XterioAuth(v${nt})]`,...i)},Mt=()=>nt,Ot=i=>{i=i||32;const t="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",n=t.length;let s="";for(let c=0;c<i;c++)s+=t.charAt(Math.floor(Math.random()*n));return s},ye={LOGIN:"xter_auth_login_success",ACCOUNT:"xter_auth_response_userinfo",REQ_ACCOUNT:"xter_auth_request_userinfo"},O={LOGIN_TYPE:"xter_auth_login_type",TOKENS:"xter_auth_login_tokens",ID_TOKEN:"xter_auth_id_token",REFRESH_TOKEN:"xter_auth_refresh_token",ACCESS_TOKEN:"xter_auth_access_token",USERINFO:"xter_auth_userinfo"};/*! js-cookie v3.0.5 | MIT */function Se(i){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)i[s]=n[s]}return i}var Dt={read:function(i){return i[0]==='"'&&(i=i.slice(1,-1)),i.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(i){return encodeURIComponent(i).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}};function Oe(i,t){function n(c,l,d){if(typeof document!="undefined"){d=Se({},t,d),typeof d.expires=="number"&&(d.expires=new Date(Date.now()+d.expires*864e5)),d.expires&&(d.expires=d.expires.toUTCString()),c=encodeURIComponent(c).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var m="";for(var g in d)d[g]&&(m+="; "+g,d[g]!==!0&&(m+="="+d[g].split(";")[0]));return document.cookie=c+"="+i.write(l,c)+m}}function s(c){if(!(typeof document=="undefined"||arguments.length&&!c)){for(var l=document.cookie?document.cookie.split("; "):[],d={},m=0;m<l.length;m++){var g=l[m].split("="),w=g.slice(1).join("=");try{var h=decodeURIComponent(g[0]);if(d[h]=i.read(w,h),c===h)break}catch(y){}}return c?d[c]:d}}return Object.create({set:n,get:s,remove:function(c,l){n(c,"",Se({},l,{expires:-1}))},withAttributes:function(c){return Oe(this.converter,Se({},this.attributes,c))},withConverter:function(c){return Oe(Se({},this.converter,c),this.attributes)}},{attributes:{value:Object.freeze(t)},converter:{value:Object.freeze(i)}})}var te=Oe(Dt,{path:"/"});class D{static set loginType(t){localStorage.setItem(O.LOGIN_TYPE,t)}static get loginType(){const t=localStorage.getItem(O.LOGIN_TYPE);return t||void 0}static set tokens(t){const{access_token:n="",id_token:s="",refresh_token:c=""}=t;te.set(O.ACCESS_TOKEN,n,{expires:1}),te.set(O.ID_TOKEN,s,{expires:1}),te.set(O.REFRESH_TOKEN,c)}static get tokens(){return{access_token:te.get(O.ACCESS_TOKEN)||"",id_token:te.get(O.ID_TOKEN)||"",refresh_token:te.get(O.REFRESH_TOKEN)||""}}static deleteTokens(){te.remove(O.ACCESS_TOKEN),te.remove(O.REFRESH_TOKEN),te.remove(O.ID_TOKEN)}static set userInfo(t){localStorage.setItem(O.USERINFO,JSON.stringify(t))}static get userInfo(){const t=localStorage.getItem(O.USERINFO);try{if(t)return JSON.parse(t)}catch(n){return}}static deleteUserInfo(){localStorage.removeItem(O.USERINFO)}static delete(t){localStorage.removeItem(t)}}const ue=class ue{};ue.client_id="",ue.app_id="",ue.baseURL="",ue.authorizeUrl="";let F=ue;class X{static setTokens(t){const{id_token:n="",access_token:s="",refresh_token:c=""}=t||{};F.tokens={id_token:n,access_token:s,refresh_token:c},D.tokens=t}static removeTokens(){F.tokens=void 0}static get idToken(){var t;return((t=F.tokens)==null?void 0:t.id_token)||""}static get refreshToken(){var t;return((t=F.tokens)==null?void 0:t.refresh_token)||""}}class xe{static setUserInfo(t){F.userInfo=t,D.userInfo=t}static removeUserInfo(){F.userInfo=void 0}static get userInfo(){return F.userInfo}}function $t(i){return C(this,null,function*(){const t=yield i.json();return t.err_code!=0?(i.status===401&&t.err_code===91001||i.status,Promise.reject(t)):t.data})}function Vt(i,t){return!t||/^https?:\/\//i.test(i)?i:i.startsWith("/")?`${t}${i}`:`${t}/${i}`}const _e=d=>C(this,[d],function*({method:i,path:t,params:n,headers:s,data:c,Authorization:l}){var h;if(!F.client_id)throw new Error("You need set xterio-auth info");if(n){const y=ke.stringify(n);t+=(t.includes("?")?"&":"?")+`${y}`}const m=Vt(t,F.baseURL),g={method:i,headers:P({"content-type":"application/json","X-SDK-Version":"auth-"+Mt(),"X-Platform":"Web","X-App-ID":F.app_id,"X-Client-ID":F.client_id,"X-Timestamp":Date.now().toString(),"X-Language":"en","X-Nonce":Ot(),Authorization:l||((h=D.tokens)==null?void 0:h.id_token)||""},s)};if(c){const y=i!=="PUT"&&(s==null?void 0:s["content-type"])!=="application/x-www-form-urlencoded";g.body=y?JSON.stringify(c):c}const w=new Request(m,g);try{const y=yield fetch(w);return i==="PUT"?y:$t(y)}catch(y){throw new Error("Network error")}});function De(i,t,n){return C(this,null,function*(){return _e({method:"GET",path:i,params:t,Authorization:n})})}function ne(i,t,n,s){return C(this,null,function*(){return _e({method:"POST",path:i,data:t,headers:s,Authorization:n})})}function qt(i,t){return C(this,null,function*(){return _e({method:"DELETE",path:i,data:t})})}function jt(i,t,n){return C(this,null,function*(){return _e({method:"PUT",path:i,data:t,headers:n})})}const Ne=class Ne{static set listeners(t){this._listeners=t}static get listeners(){return this._listeners}static on(t,n){this._listeners[t]||(this._listeners[t]=[]),this._listeners[t].push(n)}static off(t,n){this._listeners[t]&&(this._listeners[t]=this._listeners[t].filter(s=>s!==n))}static emit(t,...n){this._listeners[t]&&this._listeners[t].forEach(s=>{s(...n)})}static remove(t){this._listeners[t]&&delete this._listeners[t]}static subscribe(t,n){const s=n||ye.ACCOUNT;T("subscribe event",s);const c=l=>{t==null||t(l)};this._cacheMap.set(s,c),this.on(s,c)}static unsubscribe(t){const n=t||ye.ACCOUNT;T("unsubscribe event",n);const s=this._cacheMap.get(n);s&&(this.off(n,s),this._cacheMap.delete(n))}static clear(){this.listeners={},this._cacheMap.clear()}};Ne._listeners={},Ne._cacheMap=new Map;let oe=Ne;class K{static login(t){return C(this,null,function*(){const{client_id:n="",client_secret:s="",redirect_uri:c="",grant_type:l=""}=F.config||{},d={client_id:n,client_secret:s,redirect_uri:c,grant_type:l,code:t},m=new URLSearchParams(d);T("go login");const g=yield ne("/account/v1/oauth2/token",m,"",{"content-type":"application/x-www-form-urlencoded"}).then(w=>(T("login success."),X.setTokens(w),w)).catch(w=>(T("login failed."),null));if(g!=null&&g.id_token){T("get userinfo");const w=yield this.getUserInfo();if(w.uuid)return w}return null})}static getUserInfo(){return C(this,null,function*(){const[t,n]=yield Promise.all([this.getProfile(),this.getWallet()]),s=Z(P({},t),{wallet:n});return xe.setUserInfo(s),s!=null&&s.uuid&&oe.emit(ye.ACCOUNT,s),s})}static getProfile(){return C(this,null,function*(){const t=yield De("/account/v1/user/profile").then(n=>(T("get profile success."),n)).catch(n=>(T("get profile failed."),null));return t!=null&&t.uuid?P({},t):{}})}static getWallet(){return C(this,null,function*(){const t=yield De("/account/v1/wallet").then(n=>(T("get wallet success."),n)).catch(n=>(T("get wallet failed."),null));return(t==null?void 0:t.wallet)||[]})}static loginService(t,n){return C(this,null,function*(){const s=yield ne("/account/v1/login",{username:t,password:n}).catch(c=>Z(P({},c),{error:!0}));return T("ttl login",s!=null&&s.error?"failed":"success"),s!=null&&s.error||X.setTokens(s),s!=null&&s.error?Z(P({},s),{error:!0}):Z(P({},s),{error:!1})})}static refreshTokenService(t){return ne("/auth/v1/refresh",{refresh_token:t}).catch(()=>({}))}static registerService(c){return C(this,arguments,function*({username:t,password:n,subscribe:s}){const l=yield ne("/account/v1/register",{username:t,password:n,subscribe:s?1:0,invite_code:"","h-recaptcha-response":""}).catch(d=>Z(P({},d),{error:!0}));return l!=null&&l.error?{error:!0,err_code:l==null?void 0:l.err_code}:{error:!1}})}static registerConfirmService(c){return C(this,arguments,function*({username:t,password:n,code:s}){const l=yield ne("/account/v1/register/code/confirm",{username:t,code:s,password:n}).catch(d=>({error:!0,err_code:d.err_code}));return l!=null&&l.error||X.setTokens(l),l!=null&&l.error?l:Z(P({},l),{error:!1})})}static sendForgotCodeService(n){return C(this,arguments,function*({email:t}){const s=yield ne("/account/v1/password/forgot?source=forgot",{username:t}).catch(c=>({error:!0,err_code:c.err_code}));return s!=null&&s.error?s:Z(P({},s),{error:!1})})}static resetPassword(c){return C(this,arguments,function*({email:t,code:n,password:s}){const l=yield ne("/account/v1/password/forgot/confirm",{username:t,password:s,confirmation_code:n}).catch(d=>({error:!0,err_code:d.err_code}));return l!=null&&l.error?l:Z(P({},l),{error:!1})})}}const zt="data:image/svg+xml,%3csvg%20width='116'%20height='24'%20viewBox='0%200%20116.36363983154297%2024'%20xmlns='http://www.w3.org/2000/svg'%20class='mb-0'%3e%3cg%20clip-path='url(%23clip0_0_335)'%20fill-rule='evenodd'%20clip-rule='evenodd'%3e%3cpath%20d='M28.032%203.485a.222.222%200%2000.024.067c.006.355.014.709.027%201.073a4979.123%204979.123%200%2001.084%2010.93c-.003.18.01.36.035.538.323%201.904%201.251%203.422%202.9%204.466%201.12.71%202.363%201.104%203.658%201.347a20.98%2020.98%200%20005.866.214c.113-.01.121-.06.121-.152-.005-1.454-.005-2.91%200-4.37%200-.117-.036-.137-.143-.137a10.497%2010.497%200%2001-2.263-.267c-1-.246-1.919-.646-2.642-1.403-.681-.713-1.061-1.553-1.055-2.554a286.7%20286.7%200%20000-3.71c-.002-.165.05-.19.199-.19h4.782c.113%200%20.15-.023.15-.145a531.922%20531.922%200%20010-4.265c0-.131-.037-.15-.159-.15-1.634.005-3.278.005-4.916.005-.132%200-.177-.023-.177-.168V.77l-.008-.001.006-.003.006-.039h-6.495v2.758zM1.285%2021.519c-.185.187-.372.375-.557.566-.004.064.033.059.066.054.01-.001.02-.003.028-.002h7.892a.235.235%200%2000.183-.084l2.242-2.3%201.945-2.004.004-.003c.044-.045.075-.075.137-.009.322.342.648.676.973%201.01l.09.093a888.395%20888.395%200%20013.104%203.22.245.245%200%2000.197.08h7.863l.025.002c.03.005.062.01.084-.03l-.013-.015c-.009-.01-.017-.02-.026-.028l-2.454-2.536-3.906-4.037c-.607-.63-1.217-1.26-1.83-1.887-.08-.088-.112-.148%200-.243a3.69%203.69%200%2000.304-.311l2.76-2.848%204.348-4.5.851-.886h-7.951a.377.377%200%2000-.298.13c-.422.446-.847.885-1.271%201.324l-.001.001-.365.377-.658.679c-.596.613-1.191%201.227-1.783%201.85-.093.093-.13.088-.214%200l-.679-.706-.004-.004-.001-.001-.962-1c-.82-.842-1.638-1.687-2.455-2.533a.307.307%200%2000-.243-.108H.892c-.011%200-.024-.003-.036-.006-.04-.008-.082-.016-.1.047.603.61%201.2%201.221%201.792%201.836l3.873%204.005c.868.9%201.738%201.801%202.61%202.702.058.058.054.087%200%20.142-.14.137-.275.277-.41.417l-.146.152-4.32%204.45-2.364%202.431c-.168.173-.337.343-.506.513zm75.88-15.013a14.2%2014.2%200%2000-1.882%201.259%201.053%201.053%200%2000-.005-.069V4.933c0-.117-.018-.158-.15-.158-1.734.005-3.468.005-5.202%200-.126%200-.154.035-.154.157v17.143c-.002.129.037.152.16.152%201.728-.006%203.457-.006%205.186%200%20.14%200%20.16-.046.16-.168v-6.981c-.002-.085.01-.17.035-.25.255-.8.686-1.533%201.262-2.144.852-.934%201.902-1.6%203.04-2.134a16.1%2016.1%200%20013.839-1.233c.096-.018.13-.048.13-.152V4.916c0-.088%200-.155-.122-.144-.082.006-.166.007-.25.007-.067%200-.133.001-.2.004-2.057.11-4.06.7-5.848%201.723zm14.31%209.27v6.29c0%20.14-.038.162-.167.162h-4.99c-.122%200-.159-.027-.159-.154V9.429c0-.122.037-.156.158-.156h4.992c.13%200%20.166.03.166.163-.003%202.114-.003%204.227%200%206.34zm-34.051-.8h-9.638c-.09%200-.136%200-.155.022-.02.023-.013.069%200%20.161.18%201.25%201.014%202.09%202.265%202.25.37.03.741.036%201.112.02h3.759l1.308.003c.435.002.871.003%201.307.003.712%200%201.423%200%202.134-.015.495-.01.931-.218%201.355-.449.307-.169.6-.363.875-.581a.148.148%200%2001.196-.018c1.32.742%202.645%201.481%203.97%202.217.1.054.098.091.05.179-.84%201.486-2.1%202.473-3.669%203.096-.33.132-.67.237-1.016.316a1.413%201.413%200%2001-.327.037l-4.1-.001c-2.733-.002-5.467-.004-8.2.001a5.605%205.605%200%2001-2.928-.815c-1.293-.768-2.14-1.905-2.686-3.283a10.58%2010.58%200%2001-.662-3.005c-.095-1.046-.076-2.1.057-3.143.243-1.83.851-3.504%202.116-4.89a7.38%207.38%200%20013.851-2.258c.093-.02.188-.03.282-.029l3.468-.003c3.004-.003%206.008-.007%209.013.014%201.276.009%202.395.522%203.34%201.384.902.823%201.479%201.856%201.896%202.987.394%201.108.649%202.261.758%203.432.08.736.112%201.477.096%202.217%200%20.131-.041.15-.159.15h-9.668zm-2.53-3.56H47.77c-.089%200-.133%200-.153-.023-.021-.022-.016-.069-.005-.162.09-.788.571-1.285%201.233-1.646.302-.169.642-.255.988-.252%203.485.01%206.973.01%2010.464%200a1.492%201.492%200%20011.24.608c.306.41.526.877.646%201.374.019.07.013.107-.071.097a1.012%201.012%200%2000-.105%200l-7.111.004z'%20fill='currentColor'%3e%3c/path%3e%3cpath%20d='M113.607%2020.397a10.451%2010.451%200%20002.149-9.746c-1.696-5.954-8.221-9.124-13.981-6.796-.984.397-1.863.964-2.714%201.589-1.028.764-2.2.992-3.46.764-.973-.175-1.84-.587-2.674-1.073a2.051%202.051%200%2001-.91-1.101%202.726%202.726%200%2001-.086-.313%203.19%203.19%200%2000-5.396-1.542%203.187%203.187%200%2000-.894%201.974c-.192%202.29%202.083%204.035%204.246%203.246a2.172%202.172%200%20011.84.132%2010.35%2010.35%200%20011.728%201.124c1.325%201.086%201.977%202.45%201.824%204.187a9.748%209.748%200%2000.399%203.636%2010.456%2010.456%200%200017.929%203.919zm-12.321-9.728a5.272%205.272%200%2000-.889%202.928%205.281%205.281%200%20005.264%205.272%205.275%205.275%200%20004.874-3.25%205.272%205.272%200%2000-9.249-4.95z'%20fill='url(%23paint0_linear_0_335)'%3e%3c/path%3e%3c/g%3e%3cdefs%3e%3clinearGradient%20id='paint0_linear_0_335'%20x1='85.629'%20y1='1.216'%20x2='116.167'%20y2='24.119'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20stop-color='%23CBF2FE'%3e%3c/stop%3e%3cstop%20offset='0.391'%20stop-color='%237DD5F9'%3e%3c/stop%3e%3cstop%20offset='0.735'%20stop-color='%23E6B1F7'%3e%3c/stop%3e%3cstop%20offset='1'%20stop-color='%23E1DFA2'%3e%3c/stop%3e%3c/linearGradient%3e%3cclipPath%20id='clip0_0_335'%3e%3cpath%20fill='%23fff'%20d='M0%200h116.364v24H0z'%3e%3c/path%3e%3c/clipPath%3e%3c/defs%3e%3c/svg%3e";class Ht{getElement(){const t=document.createElement("div");return t.classList.add("xa-modal-logo"),t.innerHTML=`
      <img src="${zt}" alt="Xterio" class="auth-logo" />
    `,t}}const $e={"icon-close":'<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M13.414 12l6-6L18 4.586l-6 6-6-6L4.586 6l6 6-6 6L6 19.414l6-6 6 6L19.414 18l-6-6z" fill="currentColor"></path></svg>',"icon-show":'<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" style="color: rgb(254, 254, 254);"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 4C4 4 2 12 2 12s2 8 10 8 10-8 10-8-2-8-10-8zm-7.716 7.52c-.076.18-.137.342-.187.48A10.894 10.894 0 005.6 14.8C6.827 16.436 8.786 18 12 18c3.214 0 5.173-1.564 6.4-3.2a10.89 10.89 0 001.503-2.8A10.89 10.89 0 0018.4 9.2C17.173 7.564 15.214 6 12 6 8.786 6 6.827 7.564 5.6 9.2c-.626.834-1.05 1.68-1.316 2.32zM14 12a2 2 0 11-4 0 2 2 0 014 0zm2 0a4 4 0 11-8 0 4 4 0 018 0z" fill="currentColor"></path></svg>',"icon-hide":'<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" style="color: rgb(254, 254, 254);"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 4C4 4 2 12 2 12s1.028 4.113 4.56 6.44L5 20l1.414 1.414 2.023-2.023c1.03.38 2.21.609 3.563.609 8 0 10-8 10-8s-.516-2.066-2.074-4.098l1.488-1.488L20 5l-1.43 1.43C17.052 5.073 14.927 4 12 4zm5.153 3.847C15.948 6.797 14.293 6 12 6 8.786 6 6.827 7.564 5.6 9.2A10.894 10.894 0 004.097 12 10.894 10.894 0 005.6 14.8c.605.807 1.388 1.596 2.411 2.189l9.142-9.142zm-7.11 9.939A8.673 8.673 0 0012 18c3.214 0 5.173-1.564 6.4-3.2a10.89 10.89 0 001.503-2.8 10.946 10.946 0 00-1.406-2.668l-2.5 2.5L16 12a4 4 0 01-4.168 3.996l-1.79 1.79zM12 10c.064 0 .128.003.191.009l1.591-1.591a4 4 0 00-5.364 5.364l1.591-1.591A2 2 0 0112 10z" fill="currentColor"></path></svg>'},it=(i,t=16,n)=>{const s=document.createElement("div");return s.style.cssText=`width: ${t}px; height:${t}px; display:inline-block; color: ${n!=null?n:"#ccc"};`,s.innerHTML=$e==null?void 0:$e[i],s};class W{constructor(t){this.clearIcon=null,this.props=t,this.inputElement=null,this.root=this.createInputElement(),this.setUpEventListeners()}createInputElement(){const{id:t,type:n,label:s,wrapperClassNames:c,showClearIcon:l,showPasswordToggleIcon:d,onChange:m,onBlur:g,onFocus:w}=this.props,h=document.createElement("div");h.classList.add("xa-input-wrapper",`xa-input-wrapper-${n}`),c&&c.forEach(B=>h.classList.add(B));const y=document.createElement("span");y.className="xa-input-label",y.textContent=s,h.appendChild(y);const b=document.createElement("div");b.className="xa-input-inner";const I=document.createElement("input");if(I.type=n==="password"?"password":n,I.id="auth-input",I.className="xa-input",I.placeholder="",this.inputElement=I,b.appendChild(I),l){const B=document.createElement("div");B.className="xa-input-clear",B.appendChild(it("icon-close")),B.style.visibility="hidden",B.addEventListener("click",()=>{I.value="",B.style.visibility="hidden"}),this.clearIcon=B,b.appendChild(B)}if(n==="password"&&d){const B=document.createElement("div");B.className="xa-input-value-hide",B.addEventListener("click",()=>{I.type==="password"?(I.type="text",B.className="xa-input-value-show"):(I.type="password",B.className="xa-input-value-hide")}),b.appendChild(B)}if(this.props.addonAfterSendButton){const{onClick:B,onCountdownEnd:$}=this.props.addonAfterSendButton,v=document.createElement("button");v.className="xa-input-addon-btn",v.textContent="SEND",v.addEventListener("click",re=>{re.stopPropagation(),re.preventDefault(),v.disabled=!0;let he=60;const Ce=setInterval(()=>{he--,he===0?(v.disabled=!1,v.textContent="SEND",clearInterval(Ce),$==null||$()):(v.disabled=!0,v.textContent=`${he-1}s`)},1e3);v.textContent=`${he}s`,B==null||B()}),b.appendChild(v)}I.addEventListener("input",B=>{var v,re;const $=(re=(v=B.target)==null?void 0:v.value)!=null?re:"";this.clearIcon&&(this.clearIcon.style.visibility=$?"visible":"hidden"),m&&m($)}),I.addEventListener("focus",B=>{var $,v;w&&w((v=($=B.target)==null?void 0:$.value)!=null?v:"")}),I.addEventListener("blur",B=>{var $,v;g&&g((v=($=B.target)==null?void 0:$.value)!=null?v:"")}),h.appendChild(b);const z=document.createElement("p");return z.className="xa-error-tip",this.props.showError?z.textContent=this.props.errorMessage||"":z.style.display="none",h.appendChild(z),h}getElement(){return this.root}setUpEventListeners(){this.root,this.root.addEventListener("click",()=>{const n=this.root.querySelector(".xa-input");n&&n.focus()}),this.root.querySelectorAll(".xa-input").forEach(n=>{n.addEventListener("focus",()=>{const s=n.closest(".xa-input-wrapper"),c=s==null?void 0:s.querySelector(".xa-input-label");c&&c.classList.add("xa-input-label_filled")}),n.addEventListener("blur",()=>{const s=n.closest(".xa-input-wrapper"),c=s==null?void 0:s.querySelector(".xa-input-label");c&&n.value===""&&c.classList.remove("xa-input-label_filled")})})}showError(t){const n=this.root.querySelector(".xa-error-tip");n.textContent=t,n.style.display="block"}hideError(){const t=this.root.querySelector(".xa-error-tip");t.style.display="none"}getValue(){return this.inputElement.value}setValue(t){this.inputElement.value=t,this.props.onChange&&this.props.onChange(t)}}class Gt{constructor(){this.loader=document.createElement("div")}getElement(){return this.loader.classList.add("xa-loader"),this.loader}show(){var t;(t=this.loader)==null||t.classList.remove("xa-hide")}hide(){var t;(t=this.loader)==null||t.classList.add("xa-hide")}}class Ee{constructor(t){this.props=t,this.root=this.createButtonElement()}createButtonElement(){const{id:t,text:n,wrapperClassNames:s,disabled:c,onClick:l}=this.props,d=document.createElement("button");d.className="xa-login-button",d.textContent=n;const m=new Gt;return m.hide(),d.insertBefore(m.getElement(),d.firstChild),this.loader=m,s&&s.forEach(g=>d.classList.add(g)),c&&(d.disabled=!0,d.classList.add("xa-login-button_disabled")),l&&d.addEventListener("click",g=>l(g)),d}getElement(){return this.root}setDisabled(t){this.root.disabled=t,t?this.root.classList.add("xa-login-button_disabled"):this.root.classList.remove("xa-login-button_disabled")}setLoading(t){var n,s;t?(n=this.loader)==null||n.show():(s=this.loader)==null||s.hide()}}var j=(i=>(i.Login="login",i.Signup="signup",i.SignupCode="signupCode",i.ForgotPassword="forgotPassword",i.PasswordSuccess="passwordSuccess",i))(j||{});class Ie{constructor(t,n){this.modal=t}}class Te{constructor(){this.formList=[]}add(t,n){this.formList.push({name:t,formItem:n})}findFormItem(t){var s;return(s=this.formList.find(c=>c.name===t))==null?void 0:s.formItem}clearFormItemError(t){var s;const n=(s=this.formList.find(c=>c.name===t))==null?void 0:s.formItem;n==null||n.clearError()}getFormItemValue(t){var s,c,l;const n=(s=this.formList.find(d=>d.name===t))==null?void 0:s.formItem;return(l=(c=n==null?void 0:n.value)==null?void 0:c.toString())!=null?l:""}getFormItemChecked(t){var s;const n=(s=this.formList.find(c=>c.name===t))==null?void 0:s.formItem;return!!(n!=null&&n.value)}}const Xt=i=>!!i&&/\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*/.test(i),Kt=i=>!!i&&/^(?=.*[A-Z])(?=.*\d)[\S]{8,}$/.test(i),Ve=i=>Xt(i)?"":"Invalid Email",ot=i=>Kt(i)?"":"Password must be at least 8 characters with 1 upper case letter and 1 number",st=(i,t)=>i===t?"":"The passwords don't match";class H{constructor(t,n,s){this._value="",this.root=document.createElement("div"),this.root.className="xa-form-item",this.root.innerHTML=`
    <div class="xa-form-item-error"></div>`,this.root.setAttribute("data-name",t),this.root.insertBefore(n,this.root.firstChild),this.label=document.createElement("span"),this.getValueFunction=s}getElement(){return this.root}get value(){return this.getValueFunction()}setError(t){var n,s;this.root.querySelector(".xa-form-item-error").innerHTML=t,t?(n=this.root.querySelector(".xa-input-wrapper"))==null||n.classList.add("xa-error-border"):(s=this.root.querySelector(".xa-input-wrapper"))==null||s.classList.remove("xa-error-border")}isValidate(){var t;return!((t=this.root.querySelector(".xa-form-item-error"))!=null&&t.innerHTML)}clearError(){var t;this.root.querySelector(".xa-form-item-error").innerHTML="",(t=this.root.querySelector(".xa-input-wrapper"))==null||t.classList.remove("xa-error-border")}}class at extends Ie{constructor(t,n){super(t),this.loginButton=null,this.emailInput=null,this.pwdInput=null,this.form=new Te}render(){if(!this.modal.modalContainer)return;const t=this.modal.modalContainer;this.modal.setTitle("Sign in","Sign in with email"),this.renderEmailInput(t),this.renderPwdInput(t),this.renderTips(t),this.renderLoginButton(t),this.setupListeners()}renderEmailInput(t){const n=new W({label:"EMAIL",type:"text",showClearIcon:!0,onChange:c=>{this.form.clearFormItemError("email"),this.handleEmailChange(c)},onBlur:c=>{var l;(l=this.form.findFormItem("email"))==null||l.setError(Ve(c)),this.handleEmailChange(c)}});this.emailInput=n;const s=new H("email",n.getElement(),()=>n.getValue());this.form.add("email",s),this.append(t,s.getElement())}renderPwdInput(t){const n=new W({label:"PASSWORD",type:"password",showClearIcon:!0,onChange:c=>{this.handlePasswordChange(c)},onBlur:c=>{var l;(l=this.form.findFormItem("password"))==null||l.setError(ot(c)),this.handlePasswordChange(c)}});this.pwdInput=n;const s=new H("password",n.getElement(),()=>n.getValue());this.form.add("password",s),this.append(t,s.getElement())}renderTips(t){const n=document.createElement("div");n.classList.add("xa-login-tip","xa-flex","xa-justify-between"),n.innerHTML=`
      <div>No account yet? <a class="xa-to-sign-up">Sign up</a></div>
      <div>
        <a class="xa-to-forgotpwd">Forgot password?</a>
      </div>
    `,t.appendChild(n)}renderLoginButton(t){const n=new Ee({text:"SIGN IN",disabled:!0,onClick:s=>{this.handleLogin()}});this.loginButton=n,this.append(t,n.getElement())}setupListeners(){var s,c;const t=(s=this.modal.modalContainer)==null?void 0:s.querySelector(".xa-to-sign-up");t==null||t.addEventListener("click",()=>this.modal.switchModalState(j.Signup));const n=(c=this.modal.modalContainer)==null?void 0:c.querySelector(".xa-to-forgotpwd");n==null||n.addEventListener("click",()=>this.modal.switchModalState(j.ForgotPassword))}handleEmailChange(t){var n,s;(s=this.loginButton)==null||s.setDisabled(t.length===0||!((n=this.form.findFormItem("email"))!=null&&n.isValidate()))}handlePasswordChange(t){var n,s;(s=this.loginButton)==null||s.setDisabled(t.length===0||!((n=this.form.findFormItem("password"))!=null&&n.isValidate()))}handleLogin(){return C(this,null,function*(){var l,d,m,g,w,h,y,b,I;const t=(l=this.emailInput)==null?void 0:l.getValue(),n=(d=this.pwdInput)==null?void 0:d.getValue();if(!t||!n)return;(m=this.loginButton)==null||m.setLoading(!0);const{error:s,err_code:c}=yield this.modal.store.login(t,n);if((g=this.loginButton)==null||g.setLoading(!1),s){switch(c){case 11001:(w=this.form.findFormItem("email"))==null||w.setError("Wrong email or password");break;case 11103:(h=this.form.findFormItem("password"))==null||h.setError("Invalid password");break;case 11113:(y=this.form.findFormItem("password"))==null||y.setError("User does not exist.");break;case 11004:(b=this.form.findFormItem("password"))==null||b.setError("Too many attempts to login");break;default:(I=this.form.findFormItem("password"))==null||I.setError("Unknown error, please try again later");break}return}this.modal.close()})}append(t,n){t.appendChild(n)}}const Wt="https://xter.io/privacy-policy",Yt="https://xter.io/terms-of-service";class ct{constructor(t){this._checked=!1,this._checked=!!t.defaultChecked,this.props=t,this.root=document.createElement("div"),this.root.className="xa-checkbox-wrapper",this.checkboxInput=document.createElement("input"),this.checkboxInput.type="checkbox",this.checkboxInput.className="xa-checkbox-input",this.checkboxInput.checked=this._checked,this.checkboxLabel=document.createElement("label"),this.checkboxLabel.className="xa-checkbox-label",this.root.appendChild(this.checkboxInput),this.root.appendChild(this.checkboxLabel),this.root.addEventListener("click",this.handleCheckboxChange.bind(this)),this.updateCheckboxState()}getElement(){return this.root}handleCheckboxChange(){const{onChange:t}=this.props;this._checked=!this._checked,this.updateCheckboxState(),t==null||t(this._checked)}updateCheckboxState(){this._checked?(this.checkboxLabel.style.borderColor="#0a1161",this.checkboxLabel.style.backgroundColor="#0a1161",this.checkboxInput.checked=!0):(this.checkboxLabel.style.borderColor="#0a1161",this.checkboxLabel.style.backgroundColor="transparent",this.checkboxInput.checked=!1)}get checked(){return this._checked}}class Jt extends Ie{constructor(t,n){super(t),this.signUpButton=null,this.extraData=n||{},this.form=new Te}render(){if(!this.modal.modalContainer)return;const t=this.modal.modalContainer;this.modal.setTitle("Create Xterio account","Sign up with email"),this.renderEmailInput(t),this.renderPwdInput(t),this.renderConfirmPwdInput(t),this.renderTipsCheckList(t),this.renderConfirmButton(t),this.renderBackTip(t),this.setupListeners()}renderBackTip(t){const n=document.createElement("div");n.classList.add("xa-w-full","xa-text-center"),n.innerHTML=`
      <div class="xa-login-tip">
        <span>Already have an account? </span>
        <a class="xa-to-sign-in"> Sign in </a>
      </div>
    `,this.append(t,n)}renderConfirmButton(t){const n=new Ee({text:"SIGN UP",disabled:!0,onClick:s=>{this.handleSignUp()}});this.signUpButton=n,this.append(t,n.getElement())}renderTipsCheckList(t){const n=document.createElement("div"),s=document.createElement("div");s.classList.add("xa-login-tip","xa-flex"),s.innerHTML=`
      <div>
        <span>I am 18 years of age or older and agree to the terms of the</span>
        <a href="${Yt}" target="_blank"> Terms of Service </a>
        <span>and the</span>
        <a href="${Wt}" target="_blank"> Privacy Policy </a>
      </div>
        `;const c=new ct({defaultChecked:!0,onChange:y=>{this.form.clearFormItemError("terms")}}),l=c.getElement();l.classList.add("xa-login-tip-checkbox"),s.insertBefore(l,s.firstChild),n.appendChild(s);const d=new H("terms",s,()=>c.checked);this.form.add("terms",d),n.appendChild(d.getElement());const m=document.createElement("div");m.classList.add("xa-login-tip","xa-flex","xa-items-center"),m.innerHTML=`<div class="xa-login-tip">
        <span>Subscribe to updates via email</span>
      </div>`;const g=new ct({defaultChecked:!1}),w=g.getElement();w.classList.add("xa-login-tip-checkbox"),m.insertBefore(w,m.firstChild),n.appendChild(m);const h=new H("subscribe",m,()=>g.checked);this.form.add("subscribe",h),n.appendChild(h.getElement()),this.append(t,n)}renderConfirmPwdInput(t){const n=new W({label:"CONFRIM PASSWORD",type:"password",showClearIcon:!0,onChange:c=>{this.handlePasswordChange(c)},onBlur:c=>{var l;(l=this.form.findFormItem("confirmPassword"))==null||l.setError(st(this.form.getFormItemValue("password"),c))}});this.confirmPwdInput=n;const s=new H("confirmPassword",n.getElement(),()=>this.confirmPwdInput.getValue());this.form.add("confirmPassword",s),this.append(t,s.getElement())}renderPwdInput(t){const n=new W({label:"PASSWORD",type:"password",showClearIcon:!0,onChange:c=>{this.handlePasswordChange(c)},onBlur:c=>{var l;(l=this.form.findFormItem("password"))==null||l.setError(ot(c))}});this.pwdInput=n;const s=new H("password",n.getElement(),()=>this.pwdInput.getValue());this.form.add("password",s),this.append(t,s.getElement())}renderEmailInput(t){const n=new W({label:"EMAIL",type:"text",showClearIcon:!0,onChange:c=>{this.form.clearFormItemError("email"),this.handleEmailChange(c)},onBlur:c=>{var l;(l=this.form.findFormItem("email"))==null||l.setError(Ve(c))}});this.emailInput=n;const s=new H("email",n.getElement(),()=>this.emailInput.getValue());this.form.add("email",s),this.append(t,s.getElement())}setupListeners(){var s,c;const t=(s=this.modal.modalContainer)==null?void 0:s.querySelector(".xa-to-sign-in");t==null||t.addEventListener("click",()=>this.modal.switchModalState(j.Login));const n=(c=this.modal.modalContainer)==null?void 0:c.querySelector(".xa-to-forgotpwd");n==null||n.addEventListener("click",()=>this.modal.switchModalState(j.ForgotPassword))}handleEmailChange(t){var n;(n=this.signUpButton)==null||n.setDisabled(t.length===0)}handlePasswordChange(t){}handleSignUp(){return C(this,null,function*(){var m,g,w,h,y,b;const t=this.form.getFormItemValue("email"),n=this.form.getFormItemValue("password");this.form.getFormItemValue("confirmPassword");const s=!!this.form.getFormItemChecked("terms"),c=!!this.form.getFormItemChecked("subscribe");if(!s){(m=this.form.findFormItem("terms"))==null||m.setError("You have to accept Terms of Service and Privacy Policy to continue.");return}if(!t||!n)return;(g=this.signUpButton)==null||g.setLoading(!0);const{error:l,err_code:d}=yield K.registerService({username:t,password:n,subscribe:c});if((w=this.signUpButton)==null||w.setLoading(!1),l){switch(d){case 11102:(h=this.form.findFormItem("email"))==null||h.setError("User already registered.");break;case 11103:(y=this.form.findFormItem("password"))==null||y.setError("Invalid password.");break;default:(b=this.form.findFormItem("subscribe"))==null||b.setError("Unknown error, please try again later.");break}return}this.modal.switchModalState(j.SignupCode,{email:t,password:n})})}append(t,n){t.appendChild(n)}}class Zt extends Ie{constructor(t,n){super(t),this.continueButton=null,this.form=new Te}render(){if(!this.modal.modalContainer)return;const t=this.modal.modalContainer;this.modal.setTitle("Forgot password","Please enter your email and email verification code"),this.renderEmailInput(t),this.renderCodeInput(t),this.renderPwdInput(t),this.renderConfirmPwdInput(t),this.renderConfirmButton(t),this.renderBackTip(t),this.setupListeners()}renderEmailInput(t){const n=new W({label:"EMAIL",type:"text",showClearIcon:!0,onChange:c=>{this.form.clearFormItemError("email"),this.handleEmailChange(c)},onBlur:c=>{var l;(l=this.form.findFormItem("email"))==null||l.setError(Ve(c))}}),s=new H("email",n.getElement(),()=>n.getValue());this.form.add("email",s),this.append(t,s.getElement())}renderCodeInput(t){const n=new W({label:"ENTER CODE",type:"text",onChange:c=>{this.handleEmailChange(c)},addonAfterSendButton:{onClick:()=>{var l;if(!this.form.getFormItemValue("email")){(l=this.form.findFormItem("email"))==null||l.setError("Email is required");return}K.sendForgotCodeService({email:this.form.getFormItemValue("email")})},onCountdownEnd:()=>{}}}),s=new H("code",n.getElement(),()=>n.getValue());this.form.add("code",s),this.append(t,s.getElement())}renderPwdInput(t){const n=new W({label:"NEW PASSWORD",type:"password",showClearIcon:!0,onChange:c=>{this.handlePasswordChange(c)}}),s=new H("password",n.getElement(),()=>n.getValue());this.form.add("password",s),this.append(t,s.getElement())}renderConfirmPwdInput(t){const n=new W({label:"CONFRIM PASSWORD",type:"password",showClearIcon:!0,onChange:c=>{this.handlePasswordChange(c)},onBlur:c=>{var l;(l=this.form.findFormItem("confirmPassword"))==null||l.setError(st(this.form.getFormItemValue("password"),c))}}),s=new H("confirmPassword",n.getElement(),()=>n.getValue());this.form.add("confirmPassword",s),this.append(t,s.getElement())}renderConfirmButton(t){const n=new Ee({text:"CONTINUE",disabled:!0,onClick:s=>{this.handleUpdatePassword()}});this.continueButton=n,this.append(t,n.getElement())}renderBackTip(t){const n=document.createElement("div");n.classList.add("xa-w-full","xa-text-center"),n.innerHTML=`
      <div class="xa-login-tip">
       <span>Back to </span>
        <a class="xa-to-sign-in"> Sign in </a>
      </div>
    `,this.append(t,n)}setupListeners(){var s,c;const t=(s=this.modal.modalContainer)==null?void 0:s.querySelector(".xa-to-sign-in");t==null||t.addEventListener("click",()=>this.modal.switchModalState(j.Login));const n=(c=this.modal.modalContainer)==null?void 0:c.querySelector(".xa-to-forgotpwd");n==null||n.addEventListener("click",()=>this.modal.switchModalState(j.ForgotPassword))}handleEmailChange(t){var n;(n=this.continueButton)==null||n.setDisabled(t.length===0)}handlePasswordChange(t){}handleUpdatePassword(){return C(this,null,function*(){var d,m,g,w,h,y,b;const t=this.form.getFormItemValue("email"),n=this.form.getFormItemValue("password");this.form.getFormItemValue("confirmPassword");const s=this.form.getFormItemValue("code");if(!t||!n)return;(d=this.continueButton)==null||d.setLoading(!0);const{error:c,err_code:l}=yield K.resetPassword({email:t,password:n,code:s});if((m=this.continueButton)==null||m.setLoading(!1),c){switch(l){case 10001:(g=this.form.findFormItem("code"))==null||g.setError("Invalid verification code");break;case 11111:(w=this.form.findFormItem("code"))==null||w.setError("Invalid verification code");break;case 11112:(h=this.form.findFormItem("code"))==null||h.setError("Verification code expired");break;case 11113:(y=this.form.findFormItem("email"))==null||y.setError("User does not exist");break;default:(b=this.form.findFormItem("confirmPassword"))==null||b.setError("Unknown error, please try again later.");break}return}this.modal.switchModalState(j.PasswordSuccess)})}append(t,n){t.appendChild(n)}}class Qt{constructor(){this.listeners=new Set}subscribe(t){return this.listeners.add(t),()=>this.listeners.delete(t)}notify(){this.listeners.forEach(t=>t())}}class er{constructor(){var t,n,s;this.accessToken=(t=D.tokens)==null?void 0:t.access_token,this.refreshToken=(n=D.tokens)==null?void 0:n.refresh_token,this.idToken=(s=D.tokens)==null?void 0:s.id_token}setTokens({accessToken:t,refreshToken:n,idToken:s}){this.accessToken=t,this.refreshToken=n,this.idToken=s,D.tokens={access_token:t,id_token:s,refresh_token:n}}removeTokens(){this.accessToken=void 0,this.refreshToken=void 0,this.idToken=void 0,D.deleteTokens()}}class tr extends Qt{constructor(){super(),this.userState={isLogin:!1,userInfo:null},this.tokenManager=new er,this.refreshUserInfo(),this.listenStateChange()}listenStateChange(){const t={isLogin:!1,userInfo:null};this.userState=new Proxy(t,{set:(n,s,c)=>(n[s]!==c&&(n[s]=c,this.setPersistUserInfo(),this.notify()),!0)})}login(t,n){return C(this,null,function*(){const{error:s,err_code:c,access_token:l,id_token:d,refresh_token:m}=yield K.loginService(t,n);return!s&&l&&m?(this.tokenManager.setTokens({accessToken:l,refreshToken:m,idToken:d}),yield this.getUserInfo(),this.userState.isLogin=!0):this.userState.isLogin=!1,{error:!!s,err_code:c}})}confirmSignUpLogin(c){return C(this,arguments,function*({username:t,password:n,code:s}){const{error:l,err_code:d,access_token:m,id_token:g,refresh_token:w}=yield K.registerConfirmService({username:t,password:n,code:s});return!l&&m&&w?(this.tokenManager.setTokens({accessToken:m,refreshToken:w,idToken:g}),yield this.getUserInfo(),this.userState.isLogin=!0):this.userState.isLogin=!1,{error:!!l,err_code:d}})}getUserInfo(){return C(this,null,function*(){const t=yield K.getUserInfo();return t&&t.uuid&&(this.userState.userInfo=P(P({},this.userState.userInfo),t),this.userState.isLogin=!0),t})}setPersistUserInfo(){this.userState.userInfo&&(D.userInfo=this.userState.userInfo)}getPersistUserInfo(){return D.userInfo}refreshUserInfo(){return C(this,null,function*(){oe.subscribe(t=>{this.userState.userInfo=t,this.userState.isLogin=le.isLogin}),this.tokenManager.idToken||this.logout()})}logout(){this.userState.isLogin=!1,this.userState.userInfo=null,this.tokenManager.removeTokens()}}class rr extends Ie{constructor(t,n){super(t),this.signUpButton=null,this.extraData=n||{},this.form=new Te}render(){if(!this.modal.modalContainer)return;const t=this.modal.modalContainer;this.modal.setTitle("Verify email","Verification code has been sent to",this.extraData.email),this.renderCodeInput(t),this.renderConfirmButton(t),this.renderBackTip(t),this.setupListeners()}renderCodeInput(t){const n=new W({id:"xaCodeInput",label:"ENTER CODE",type:"text",showClearIcon:!0,onChange:c=>{this.handleCodeChange(c)}}),s=new H("code",n.getElement(),()=>n.getValue());this.form.add("code",s),this.append(t,s.getElement())}renderConfirmButton(t){const n=new Ee({text:"CONTINUE",disabled:!0,onClick:s=>{this.handleContinueSignUp()}});this.signUpButton=n,this.append(t,n.getElement())}renderBackTip(t){const n=document.createElement("div");n.classList.add("xa-w-full","xa-text-center"),n.innerHTML=`
      <div class="xa-login-tip">
        <span>Already have an account? </span>
        <a class="xa-to-sign-in"> Sign in </a>
      </div>
    `,this.append(t,n)}setupListeners(){var s,c;const t=(s=this.modal.modalContainer)==null?void 0:s.querySelector(".xa-to-sign-in");t==null||t.addEventListener("click",()=>this.modal.switchModalState(j.Login));const n=(c=this.modal.modalContainer)==null?void 0:c.querySelector(".xa-to-forgotpwd");n==null||n.addEventListener("click",()=>this.modal.switchModalState(j.ForgotPassword))}handleCodeChange(t){var n;(n=this.signUpButton)==null||n.setDisabled(t.length===0)}append(t,n){t.appendChild(n)}handleContinueSignUp(){return C(this,null,function*(){var d,m,g,w,h,y;const t=this.form.getFormItemValue("code"),n=(d=this.extraData)==null?void 0:d.password,s=(m=this.extraData)==null?void 0:m.email;if(!n||!s||!t)return;(g=this.signUpButton)==null||g.setLoading(!0);const{error:c,err_code:l}=yield this.modal.store.confirmSignUpLogin({username:s,password:n,code:t});if((w=this.signUpButton)==null||w.setLoading(!1),c){switch(l){case 11111:(h=this.form.findFormItem("code"))==null||h.setError("Invalid verification code");break;default:(y=this.form.findFormItem("code"))==null||y.setError("Unknown error, please try again later.");break}return}this.modal.close()})}}const nr="data:image/svg+xml,%3csvg%20width='80'%20height='80'%20viewBox='0%200%2064%2064'%20xmlns='http://www.w3.org/2000/svg'%3e%3csvg%20width='64'%20height='64'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3ccircle%20cx='32'%20cy='32'%20r='24'%20fill='url(%23paint0_linear_0_548)'%3e%3c/circle%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M44.535%2026L29%2041.535%2019.465%2032%2023%2028.465l6%206%2012-12L44.535%2026z'%20fill='%230A1161'%3e%3c/path%3e%3cdefs%3e%3clinearGradient%20id='paint0_linear_0_548'%20x1='8'%20y1='32.828'%20x2='56'%20y2='32.828'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20stop-color='%239EE6FC'%3e%3c/stop%3e%3cstop%20offset='1'%20stop-color='%23EBB9E7'%3e%3c/stop%3e%3c/linearGradient%3e%3c/defs%3e%3c/svg%3e%3c/svg%3e";function ir(){const i=document.createElement("div");return i.classList.add("xa-modal-logo"),i.innerHTML=`
      <img src="${nr}" alt="Xterio" class="xa-icon-success" />
    `,i}class or extends Ie{constructor(t,n){super(t)}render(){if(!this.modal.modalContainer)return;const t=this.modal.modalContainer;this.append(t,ir()),this.modal.setTitle("Password has been changed!","Your password has been changed successfully"),this.renderConfirmButton(t)}renderConfirmButton(t){const n=new Ee({text:"SIGN IN",onClick:s=>{this.modal.switchModalState(j.Login)}});this.append(t,n.getElement())}append(t,n){t.appendChild(n)}}class V{constructor(t){this.apiUrl=t,this.currentState=new at(this),this.store=new tr}static get instance(){if(!V._instance)throw new Error("AuthSDK is not initialized. Call AuthSDK.init(apiUrl, redirectUri) first.");return V._instance}static init(t){V._instance||(V._instance=new V(t))}open(){const t=document.createElement("div");t.className="xa-modal-overlay",this.modalOverlay=t,t.addEventListener("click",s=>{s.target});const n=document.createElement("div");this.modalContainer=n,n.className="xa-modal",this.renderCommonElement(n),t.appendChild(n),document.body.appendChild(t),this.currentState.render()}close(){var t,n;(t=this.modalContainer)==null||t.remove(),(n=this.modalOverlay)==null||n.remove()}renderCommonElement(t){const n=new Ht;t.appendChild(n.getElement());const s=it("icon-close",24,"#838383");s.addEventListener("click",()=>this.close()),s.className="xa-signin-close",t.appendChild(s);const c=document.createElement("div");c.className="xa-signin-title-container",c.innerHTML=`
        <h3 class="xa-signin-title">Sign in</h3>
        <p class="xa-signin-sub-title">Sign in with email</p>
        <div class="xa-signin-title-email"></div>
       `,t.appendChild(c)}setTitle(t,n,s){const c=document.querySelector(".xa-signin-title"),l=document.querySelector(".xa-signin-sub-title"),d=document.querySelector(".xa-signin-title-email");c.innerHTML=t,l.innerHTML=n,d&&s&&(d.innerHTML=s)}renderContent(){this.modalContainer&&(this.modalContainer.innerHTML="",this.renderCommonElement(this.modalContainer)),this.currentState.render()}switchModalState(t,n){switch(t){case"login":this.currentState=new at(this,n);break;case"signup":this.currentState=new Jt(this,n);break;case"signupCode":this.currentState=new rr(this,n);break;case"forgotPassword":this.currentState=new Zt(this,n);break;case j.PasswordSuccess:this.currentState=new or(this,n);break}this.renderContent()}}var lt={},Ue={};Ue.byteLength=cr,Ue.toByteArray=ur,Ue.fromByteArray=fr;for(var Y=[],G=[],sr=typeof Uint8Array!="undefined"?Uint8Array:Array,qe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ce=0,ar=qe.length;ce<ar;++ce)Y[ce]=qe[ce],G[qe.charCodeAt(ce)]=ce;G[45]=62,G[95]=63;function ut(i){var t=i.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=i.indexOf("=");n===-1&&(n=t);var s=n===t?0:4-n%4;return[n,s]}function cr(i){var t=ut(i),n=t[0],s=t[1];return(n+s)*3/4-s}function lr(i,t,n){return(t+n)*3/4-n}function ur(i){var t,n=ut(i),s=n[0],c=n[1],l=new sr(lr(i,s,c)),d=0,m=c>0?s-4:s,g;for(g=0;g<m;g+=4)t=G[i.charCodeAt(g)]<<18|G[i.charCodeAt(g+1)]<<12|G[i.charCodeAt(g+2)]<<6|G[i.charCodeAt(g+3)],l[d++]=t>>16&255,l[d++]=t>>8&255,l[d++]=t&255;return c===2&&(t=G[i.charCodeAt(g)]<<2|G[i.charCodeAt(g+1)]>>4,l[d++]=t&255),c===1&&(t=G[i.charCodeAt(g)]<<10|G[i.charCodeAt(g+1)]<<4|G[i.charCodeAt(g+2)]>>2,l[d++]=t>>8&255,l[d++]=t&255),l}function hr(i){return Y[i>>18&63]+Y[i>>12&63]+Y[i>>6&63]+Y[i&63]}function dr(i,t,n){for(var s,c=[],l=t;l<n;l+=3)s=(i[l]<<16&16711680)+(i[l+1]<<8&65280)+(i[l+2]&255),c.push(hr(s));return c.join("")}function fr(i){for(var t,n=i.length,s=n%3,c=[],l=16383,d=0,m=n-s;d<m;d+=l)c.push(dr(i,d,d+l>m?m:d+l));return s===1?(t=i[n-1],c.push(Y[t>>2]+Y[t<<4&63]+"==")):s===2&&(t=(i[n-2]<<8)+i[n-1],c.push(Y[t>>10]+Y[t>>4&63]+Y[t<<2&63]+"=")),c.join("")}var je={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */je.read=function(i,t,n,s,c){var l,d,m=c*8-s-1,g=(1<<m)-1,w=g>>1,h=-7,y=n?c-1:0,b=n?-1:1,I=i[t+y];for(y+=b,l=I&(1<<-h)-1,I>>=-h,h+=m;h>0;l=l*256+i[t+y],y+=b,h-=8);for(d=l&(1<<-h)-1,l>>=-h,h+=s;h>0;d=d*256+i[t+y],y+=b,h-=8);if(l===0)l=1-w;else{if(l===g)return d?NaN:(I?-1:1)*(1/0);d=d+Math.pow(2,s),l=l-w}return(I?-1:1)*d*Math.pow(2,l-s)},je.write=function(i,t,n,s,c,l){var d,m,g,w=l*8-c-1,h=(1<<w)-1,y=h>>1,b=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,I=s?0:l-1,z=s?1:-1,B=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(m=isNaN(t)?1:0,d=h):(d=Math.floor(Math.log(t)/Math.LN2),t*(g=Math.pow(2,-d))<1&&(d--,g*=2),d+y>=1?t+=b/g:t+=b*Math.pow(2,1-y),t*g>=2&&(d++,g/=2),d+y>=h?(m=0,d=h):d+y>=1?(m=(t*g-1)*Math.pow(2,c),d=d+y):(m=t*Math.pow(2,y-1)*Math.pow(2,c),d=0));c>=8;i[n+I]=m&255,I+=z,m/=256,c-=8);for(d=d<<c|m,w+=c;w>0;i[n+I]=d&255,I+=z,d/=256,w-=8);i[n+I-z]|=B*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(i){const t=Ue,n=je,s=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;i.Buffer=h,i.SlowBuffer=br,i.INSPECT_MAX_BYTES=50;const c=2147483647;i.kMaxLength=c;const{Uint8Array:l,ArrayBuffer:d,SharedArrayBuffer:m}=globalThis;h.TYPED_ARRAY_SUPPORT=g(),!h.TYPED_ARRAY_SUPPORT&&typeof console!="undefined"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function g(){try{const o=new l(1),e={foo:function(){return 42}};return Object.setPrototypeOf(e,l.prototype),Object.setPrototypeOf(o,e),o.foo()===42}catch(o){return!1}}Object.defineProperty(h.prototype,"parent",{enumerable:!0,get:function(){if(h.isBuffer(this))return this.buffer}}),Object.defineProperty(h.prototype,"offset",{enumerable:!0,get:function(){if(h.isBuffer(this))return this.byteOffset}});function w(o){if(o>c)throw new RangeError('The value "'+o+'" is invalid for option "size"');const e=new l(o);return Object.setPrototypeOf(e,h.prototype),e}function h(o,e,r){if(typeof o=="number"){if(typeof e=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return z(o)}return y(o,e,r)}h.poolSize=8192;function y(o,e,r){if(typeof o=="string")return B(o,e);if(d.isView(o))return v(o);if(o==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof o);if(J(o,d)||o&&J(o.buffer,d)||typeof m!="undefined"&&(J(o,m)||o&&J(o.buffer,m)))return re(o,e,r);if(typeof o=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const a=o.valueOf&&o.valueOf();if(a!=null&&a!==o)return h.from(a,e,r);const u=he(o);if(u)return u;if(typeof Symbol!="undefined"&&Symbol.toPrimitive!=null&&typeof o[Symbol.toPrimitive]=="function")return h.from(o[Symbol.toPrimitive]("string"),e,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof o)}h.from=function(o,e,r){return y(o,e,r)},Object.setPrototypeOf(h.prototype,l.prototype),Object.setPrototypeOf(h,l);function b(o){if(typeof o!="number")throw new TypeError('"size" argument must be of type number');if(o<0)throw new RangeError('The value "'+o+'" is invalid for option "size"')}function I(o,e,r){return b(o),o<=0?w(o):e!==void 0?typeof r=="string"?w(o).fill(e,r):w(o).fill(e):w(o)}h.alloc=function(o,e,r){return I(o,e,r)};function z(o){return b(o),w(o<0?0:Ce(o)|0)}h.allocUnsafe=function(o){return z(o)},h.allocUnsafeSlow=function(o){return z(o)};function B(o,e){if((typeof e!="string"||e==="")&&(e="utf8"),!h.isEncoding(e))throw new TypeError("Unknown encoding: "+e);const r=mt(o,e)|0;let a=w(r);const u=a.write(o,e);return u!==r&&(a=a.slice(0,u)),a}function $(o){const e=o.length<0?0:Ce(o.length)|0,r=w(e);for(let a=0;a<e;a+=1)r[a]=o[a]&255;return r}function v(o){if(J(o,l)){const e=new l(o);return re(e.buffer,e.byteOffset,e.byteLength)}return $(o)}function re(o,e,r){if(e<0||o.byteLength<e)throw new RangeError('"offset" is outside of buffer bounds');if(o.byteLength<e+(r||0))throw new RangeError('"length" is outside of buffer bounds');let a;return e===void 0&&r===void 0?a=new l(o):r===void 0?a=new l(o,e):a=new l(o,e,r),Object.setPrototypeOf(a,h.prototype),a}function he(o){if(h.isBuffer(o)){const e=Ce(o.length)|0,r=w(e);return r.length===0||o.copy(r,0,0,e),r}if(o.length!==void 0)return typeof o.length!="number"||Xe(o.length)?w(0):$(o);if(o.type==="Buffer"&&Array.isArray(o.data))return $(o.data)}function Ce(o){if(o>=c)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+c.toString(16)+" bytes");return o|0}function br(o){return+o!=o&&(o=0),h.alloc(+o)}h.isBuffer=function(e){return e!=null&&e._isBuffer===!0&&e!==h.prototype},h.compare=function(e,r){if(J(e,l)&&(e=h.from(e,e.offset,e.byteLength)),J(r,l)&&(r=h.from(r,r.offset,r.byteLength)),!h.isBuffer(e)||!h.isBuffer(r))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===r)return 0;let a=e.length,u=r.length;for(let f=0,p=Math.min(a,u);f<p;++f)if(e[f]!==r[f]){a=e[f],u=r[f];break}return a<u?-1:u<a?1:0},h.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},h.concat=function(e,r){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(e.length===0)return h.alloc(0);let a;if(r===void 0)for(r=0,a=0;a<e.length;++a)r+=e[a].length;const u=h.allocUnsafe(r);let f=0;for(a=0;a<e.length;++a){let p=e[a];if(J(p,l))f+p.length>u.length?(h.isBuffer(p)||(p=h.from(p)),p.copy(u,f)):l.prototype.set.call(u,p,f);else if(h.isBuffer(p))p.copy(u,f);else throw new TypeError('"list" argument must be an Array of Buffers');f+=p.length}return u};function mt(o,e){if(h.isBuffer(o))return o.length;if(d.isView(o)||J(o,d))return o.byteLength;if(typeof o!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof o);const r=o.length,a=arguments.length>2&&arguments[2]===!0;if(!a&&r===0)return 0;let u=!1;for(;;)switch(e){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return Ge(o).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return r*2;case"hex":return r>>>1;case"base64":return St(o).length;default:if(u)return a?-1:Ge(o).length;e=(""+e).toLowerCase(),u=!0}}h.byteLength=mt;function kr(o,e,r){let a=!1;if((e===void 0||e<0)&&(e=0),e>this.length||((r===void 0||r>this.length)&&(r=this.length),r<=0)||(r>>>=0,e>>>=0,r<=e))return"";for(o||(o="utf8");;)switch(o){case"hex":return Rr(this,e,r);case"utf8":case"utf-8":return yt(this,e,r);case"ascii":return Pr(this,e,r);case"latin1":case"binary":return vr(this,e,r);case"base64":return Ar(this,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Mr(this,e,r);default:if(a)throw new TypeError("Unknown encoding: "+o);o=(o+"").toLowerCase(),a=!0}}h.prototype._isBuffer=!0;function ae(o,e,r){const a=o[e];o[e]=o[r],o[r]=a}h.prototype.swap16=function(){const e=this.length;if(e%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let r=0;r<e;r+=2)ae(this,r,r+1);return this},h.prototype.swap32=function(){const e=this.length;if(e%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let r=0;r<e;r+=4)ae(this,r,r+3),ae(this,r+1,r+2);return this},h.prototype.swap64=function(){const e=this.length;if(e%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let r=0;r<e;r+=8)ae(this,r,r+7),ae(this,r+1,r+6),ae(this,r+2,r+5),ae(this,r+3,r+4);return this},h.prototype.toString=function(){const e=this.length;return e===0?"":arguments.length===0?yt(this,0,e):kr.apply(this,arguments)},h.prototype.toLocaleString=h.prototype.toString,h.prototype.equals=function(e){if(!h.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e?!0:h.compare(this,e)===0},h.prototype.inspect=function(){let e="";const r=i.INSPECT_MAX_BYTES;return e=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(e+=" ... "),"<Buffer "+e+">"},s&&(h.prototype[s]=h.prototype.inspect),h.prototype.compare=function(e,r,a,u,f){if(J(e,l)&&(e=h.from(e,e.offset,e.byteLength)),!h.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(r===void 0&&(r=0),a===void 0&&(a=e?e.length:0),u===void 0&&(u=0),f===void 0&&(f=this.length),r<0||a>e.length||u<0||f>this.length)throw new RangeError("out of range index");if(u>=f&&r>=a)return 0;if(u>=f)return-1;if(r>=a)return 1;if(r>>>=0,a>>>=0,u>>>=0,f>>>=0,this===e)return 0;let p=f-u,x=a-r;const A=Math.min(p,x),U=this.slice(u,f),N=e.slice(r,a);for(let k=0;k<A;++k)if(U[k]!==N[k]){p=U[k],x=N[k];break}return p<x?-1:x<p?1:0};function gt(o,e,r,a,u){if(o.length===0)return-1;if(typeof r=="string"?(a=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,Xe(r)&&(r=u?0:o.length-1),r<0&&(r=o.length+r),r>=o.length){if(u)return-1;r=o.length-1}else if(r<0)if(u)r=0;else return-1;if(typeof e=="string"&&(e=h.from(e,a)),h.isBuffer(e))return e.length===0?-1:wt(o,e,r,a,u);if(typeof e=="number")return e=e&255,typeof l.prototype.indexOf=="function"?u?l.prototype.indexOf.call(o,e,r):l.prototype.lastIndexOf.call(o,e,r):wt(o,[e],r,a,u);throw new TypeError("val must be string, number or Buffer")}function wt(o,e,r,a,u){let f=1,p=o.length,x=e.length;if(a!==void 0&&(a=String(a).toLowerCase(),a==="ucs2"||a==="ucs-2"||a==="utf16le"||a==="utf-16le")){if(o.length<2||e.length<2)return-1;f=2,p/=2,x/=2,r/=2}function A(N,k){return f===1?N[k]:N.readUInt16BE(k*f)}let U;if(u){let N=-1;for(U=r;U<p;U++)if(A(o,U)===A(e,N===-1?0:U-N)){if(N===-1&&(N=U),U-N+1===x)return N*f}else N!==-1&&(U-=U-N),N=-1}else for(r+x>p&&(r=p-x),U=r;U>=0;U--){let N=!0;for(let k=0;k<x;k++)if(A(o,U+k)!==A(e,k)){N=!1;break}if(N)return U}return-1}h.prototype.includes=function(e,r,a){return this.indexOf(e,r,a)!==-1},h.prototype.indexOf=function(e,r,a){return gt(this,e,r,a,!0)},h.prototype.lastIndexOf=function(e,r,a){return gt(this,e,r,a,!1)};function Sr(o,e,r,a){r=Number(r)||0;const u=o.length-r;a?(a=Number(a),a>u&&(a=u)):a=u;const f=e.length;a>f/2&&(a=f/2);let p;for(p=0;p<a;++p){const x=parseInt(e.substr(p*2,2),16);if(Xe(x))return p;o[r+p]=x}return p}function _r(o,e,r,a){return Pe(Ge(e,o.length-r),o,r,a)}function Tr(o,e,r,a){return Pe(Vr(e),o,r,a)}function Ur(o,e,r,a){return Pe(St(e),o,r,a)}function Lr(o,e,r,a){return Pe(qr(e,o.length-r),o,r,a)}h.prototype.write=function(e,r,a,u){if(r===void 0)u="utf8",a=this.length,r=0;else if(a===void 0&&typeof r=="string")u=r,a=this.length,r=0;else if(isFinite(r))r=r>>>0,isFinite(a)?(a=a>>>0,u===void 0&&(u="utf8")):(u=a,a=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const f=this.length-r;if((a===void 0||a>f)&&(a=f),e.length>0&&(a<0||r<0)||r>this.length)throw new RangeError("Attempt to write outside buffer bounds");u||(u="utf8");let p=!1;for(;;)switch(u){case"hex":return Sr(this,e,r,a);case"utf8":case"utf-8":return _r(this,e,r,a);case"ascii":case"latin1":case"binary":return Tr(this,e,r,a);case"base64":return Ur(this,e,r,a);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Lr(this,e,r,a);default:if(p)throw new TypeError("Unknown encoding: "+u);u=(""+u).toLowerCase(),p=!0}},h.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function Ar(o,e,r){return e===0&&r===o.length?t.fromByteArray(o):t.fromByteArray(o.slice(e,r))}function yt(o,e,r){r=Math.min(o.length,r);const a=[];let u=e;for(;u<r;){const f=o[u];let p=null,x=f>239?4:f>223?3:f>191?2:1;if(u+x<=r){let A,U,N,k;switch(x){case 1:f<128&&(p=f);break;case 2:A=o[u+1],(A&192)===128&&(k=(f&31)<<6|A&63,k>127&&(p=k));break;case 3:A=o[u+1],U=o[u+2],(A&192)===128&&(U&192)===128&&(k=(f&15)<<12|(A&63)<<6|U&63,k>2047&&(k<55296||k>57343)&&(p=k));break;case 4:A=o[u+1],U=o[u+2],N=o[u+3],(A&192)===128&&(U&192)===128&&(N&192)===128&&(k=(f&15)<<18|(A&63)<<12|(U&63)<<6|N&63,k>65535&&k<1114112&&(p=k))}}p===null?(p=65533,x=1):p>65535&&(p-=65536,a.push(p>>>10&1023|55296),p=56320|p&1023),a.push(p),u+=x}return Nr(a)}const xt=4096;function Nr(o){const e=o.length;if(e<=xt)return String.fromCharCode.apply(String,o);let r="",a=0;for(;a<e;)r+=String.fromCharCode.apply(String,o.slice(a,a+=xt));return r}function Pr(o,e,r){let a="";r=Math.min(o.length,r);for(let u=e;u<r;++u)a+=String.fromCharCode(o[u]&127);return a}function vr(o,e,r){let a="";r=Math.min(o.length,r);for(let u=e;u<r;++u)a+=String.fromCharCode(o[u]);return a}function Rr(o,e,r){const a=o.length;(!e||e<0)&&(e=0),(!r||r<0||r>a)&&(r=a);let u="";for(let f=e;f<r;++f)u+=jr[o[f]];return u}function Mr(o,e,r){const a=o.slice(e,r);let u="";for(let f=0;f<a.length-1;f+=2)u+=String.fromCharCode(a[f]+a[f+1]*256);return u}h.prototype.slice=function(e,r){const a=this.length;e=~~e,r=r===void 0?a:~~r,e<0?(e+=a,e<0&&(e=0)):e>a&&(e=a),r<0?(r+=a,r<0&&(r=0)):r>a&&(r=a),r<e&&(r=e);const u=this.subarray(e,r);return Object.setPrototypeOf(u,h.prototype),u};function M(o,e,r){if(o%1!==0||o<0)throw new RangeError("offset is not uint");if(o+e>r)throw new RangeError("Trying to access beyond buffer length")}h.prototype.readUintLE=h.prototype.readUIntLE=function(e,r,a){e=e>>>0,r=r>>>0,a||M(e,r,this.length);let u=this[e],f=1,p=0;for(;++p<r&&(f*=256);)u+=this[e+p]*f;return u},h.prototype.readUintBE=h.prototype.readUIntBE=function(e,r,a){e=e>>>0,r=r>>>0,a||M(e,r,this.length);let u=this[e+--r],f=1;for(;r>0&&(f*=256);)u+=this[e+--r]*f;return u},h.prototype.readUint8=h.prototype.readUInt8=function(e,r){return e=e>>>0,r||M(e,1,this.length),this[e]},h.prototype.readUint16LE=h.prototype.readUInt16LE=function(e,r){return e=e>>>0,r||M(e,2,this.length),this[e]|this[e+1]<<8},h.prototype.readUint16BE=h.prototype.readUInt16BE=function(e,r){return e=e>>>0,r||M(e,2,this.length),this[e]<<8|this[e+1]},h.prototype.readUint32LE=h.prototype.readUInt32LE=function(e,r){return e=e>>>0,r||M(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+this[e+3]*16777216},h.prototype.readUint32BE=h.prototype.readUInt32BE=function(e,r){return e=e>>>0,r||M(e,4,this.length),this[e]*16777216+(this[e+1]<<16|this[e+2]<<8|this[e+3])},h.prototype.readBigUInt64LE=ie(function(e){e=e>>>0,fe(e,"offset");const r=this[e],a=this[e+7];(r===void 0||a===void 0)&&Be(e,this.length-8);const u=r+this[++e]*S(2,8)+this[++e]*S(2,16)+this[++e]*S(2,24),f=this[++e]+this[++e]*S(2,8)+this[++e]*S(2,16)+a*S(2,24);return BigInt(u)+(BigInt(f)<<BigInt(32))}),h.prototype.readBigUInt64BE=ie(function(e){e=e>>>0,fe(e,"offset");const r=this[e],a=this[e+7];(r===void 0||a===void 0)&&Be(e,this.length-8);const u=r*S(2,24)+this[++e]*S(2,16)+this[++e]*S(2,8)+this[++e],f=this[++e]*S(2,24)+this[++e]*S(2,16)+this[++e]*S(2,8)+a;return(BigInt(u)<<BigInt(32))+BigInt(f)}),h.prototype.readIntLE=function(e,r,a){e=e>>>0,r=r>>>0,a||M(e,r,this.length);let u=this[e],f=1,p=0;for(;++p<r&&(f*=256);)u+=this[e+p]*f;return f*=128,u>=f&&(u-=Math.pow(2,8*r)),u},h.prototype.readIntBE=function(e,r,a){e=e>>>0,r=r>>>0,a||M(e,r,this.length);let u=r,f=1,p=this[e+--u];for(;u>0&&(f*=256);)p+=this[e+--u]*f;return f*=128,p>=f&&(p-=Math.pow(2,8*r)),p},h.prototype.readInt8=function(e,r){return e=e>>>0,r||M(e,1,this.length),this[e]&128?(255-this[e]+1)*-1:this[e]},h.prototype.readInt16LE=function(e,r){e=e>>>0,r||M(e,2,this.length);const a=this[e]|this[e+1]<<8;return a&32768?a|4294901760:a},h.prototype.readInt16BE=function(e,r){e=e>>>0,r||M(e,2,this.length);const a=this[e+1]|this[e]<<8;return a&32768?a|4294901760:a},h.prototype.readInt32LE=function(e,r){return e=e>>>0,r||M(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},h.prototype.readInt32BE=function(e,r){return e=e>>>0,r||M(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},h.prototype.readBigInt64LE=ie(function(e){e=e>>>0,fe(e,"offset");const r=this[e],a=this[e+7];(r===void 0||a===void 0)&&Be(e,this.length-8);const u=this[e+4]+this[e+5]*S(2,8)+this[e+6]*S(2,16)+(a<<24);return(BigInt(u)<<BigInt(32))+BigInt(r+this[++e]*S(2,8)+this[++e]*S(2,16)+this[++e]*S(2,24))}),h.prototype.readBigInt64BE=ie(function(e){e=e>>>0,fe(e,"offset");const r=this[e],a=this[e+7];(r===void 0||a===void 0)&&Be(e,this.length-8);const u=(r<<24)+this[++e]*S(2,16)+this[++e]*S(2,8)+this[++e];return(BigInt(u)<<BigInt(32))+BigInt(this[++e]*S(2,24)+this[++e]*S(2,16)+this[++e]*S(2,8)+a)}),h.prototype.readFloatLE=function(e,r){return e=e>>>0,r||M(e,4,this.length),n.read(this,e,!0,23,4)},h.prototype.readFloatBE=function(e,r){return e=e>>>0,r||M(e,4,this.length),n.read(this,e,!1,23,4)},h.prototype.readDoubleLE=function(e,r){return e=e>>>0,r||M(e,8,this.length),n.read(this,e,!0,52,8)},h.prototype.readDoubleBE=function(e,r){return e=e>>>0,r||M(e,8,this.length),n.read(this,e,!1,52,8)};function q(o,e,r,a,u,f){if(!h.isBuffer(o))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>u||e<f)throw new RangeError('"value" argument is out of bounds');if(r+a>o.length)throw new RangeError("Index out of range")}h.prototype.writeUintLE=h.prototype.writeUIntLE=function(e,r,a,u){if(e=+e,r=r>>>0,a=a>>>0,!u){const x=Math.pow(2,8*a)-1;q(this,e,r,a,x,0)}let f=1,p=0;for(this[r]=e&255;++p<a&&(f*=256);)this[r+p]=e/f&255;return r+a},h.prototype.writeUintBE=h.prototype.writeUIntBE=function(e,r,a,u){if(e=+e,r=r>>>0,a=a>>>0,!u){const x=Math.pow(2,8*a)-1;q(this,e,r,a,x,0)}let f=a-1,p=1;for(this[r+f]=e&255;--f>=0&&(p*=256);)this[r+f]=e/p&255;return r+a},h.prototype.writeUint8=h.prototype.writeUInt8=function(e,r,a){return e=+e,r=r>>>0,a||q(this,e,r,1,255,0),this[r]=e&255,r+1},h.prototype.writeUint16LE=h.prototype.writeUInt16LE=function(e,r,a){return e=+e,r=r>>>0,a||q(this,e,r,2,65535,0),this[r]=e&255,this[r+1]=e>>>8,r+2},h.prototype.writeUint16BE=h.prototype.writeUInt16BE=function(e,r,a){return e=+e,r=r>>>0,a||q(this,e,r,2,65535,0),this[r]=e>>>8,this[r+1]=e&255,r+2},h.prototype.writeUint32LE=h.prototype.writeUInt32LE=function(e,r,a){return e=+e,r=r>>>0,a||q(this,e,r,4,4294967295,0),this[r+3]=e>>>24,this[r+2]=e>>>16,this[r+1]=e>>>8,this[r]=e&255,r+4},h.prototype.writeUint32BE=h.prototype.writeUInt32BE=function(e,r,a){return e=+e,r=r>>>0,a||q(this,e,r,4,4294967295,0),this[r]=e>>>24,this[r+1]=e>>>16,this[r+2]=e>>>8,this[r+3]=e&255,r+4};function Et(o,e,r,a,u){kt(e,a,u,o,r,7);let f=Number(e&BigInt(4294967295));o[r++]=f,f=f>>8,o[r++]=f,f=f>>8,o[r++]=f,f=f>>8,o[r++]=f;let p=Number(e>>BigInt(32)&BigInt(4294967295));return o[r++]=p,p=p>>8,o[r++]=p,p=p>>8,o[r++]=p,p=p>>8,o[r++]=p,r}function It(o,e,r,a,u){kt(e,a,u,o,r,7);let f=Number(e&BigInt(4294967295));o[r+7]=f,f=f>>8,o[r+6]=f,f=f>>8,o[r+5]=f,f=f>>8,o[r+4]=f;let p=Number(e>>BigInt(32)&BigInt(4294967295));return o[r+3]=p,p=p>>8,o[r+2]=p,p=p>>8,o[r+1]=p,p=p>>8,o[r]=p,r+8}h.prototype.writeBigUInt64LE=ie(function(e,r=0){return Et(this,e,r,BigInt(0),BigInt("0xffffffffffffffff"))}),h.prototype.writeBigUInt64BE=ie(function(e,r=0){return It(this,e,r,BigInt(0),BigInt("0xffffffffffffffff"))}),h.prototype.writeIntLE=function(e,r,a,u){if(e=+e,r=r>>>0,!u){const A=Math.pow(2,8*a-1);q(this,e,r,a,A-1,-A)}let f=0,p=1,x=0;for(this[r]=e&255;++f<a&&(p*=256);)e<0&&x===0&&this[r+f-1]!==0&&(x=1),this[r+f]=(e/p>>0)-x&255;return r+a},h.prototype.writeIntBE=function(e,r,a,u){if(e=+e,r=r>>>0,!u){const A=Math.pow(2,8*a-1);q(this,e,r,a,A-1,-A)}let f=a-1,p=1,x=0;for(this[r+f]=e&255;--f>=0&&(p*=256);)e<0&&x===0&&this[r+f+1]!==0&&(x=1),this[r+f]=(e/p>>0)-x&255;return r+a},h.prototype.writeInt8=function(e,r,a){return e=+e,r=r>>>0,a||q(this,e,r,1,127,-128),e<0&&(e=255+e+1),this[r]=e&255,r+1},h.prototype.writeInt16LE=function(e,r,a){return e=+e,r=r>>>0,a||q(this,e,r,2,32767,-32768),this[r]=e&255,this[r+1]=e>>>8,r+2},h.prototype.writeInt16BE=function(e,r,a){return e=+e,r=r>>>0,a||q(this,e,r,2,32767,-32768),this[r]=e>>>8,this[r+1]=e&255,r+2},h.prototype.writeInt32LE=function(e,r,a){return e=+e,r=r>>>0,a||q(this,e,r,4,2147483647,-2147483648),this[r]=e&255,this[r+1]=e>>>8,this[r+2]=e>>>16,this[r+3]=e>>>24,r+4},h.prototype.writeInt32BE=function(e,r,a){return e=+e,r=r>>>0,a||q(this,e,r,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[r]=e>>>24,this[r+1]=e>>>16,this[r+2]=e>>>8,this[r+3]=e&255,r+4},h.prototype.writeBigInt64LE=ie(function(e,r=0){return Et(this,e,r,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),h.prototype.writeBigInt64BE=ie(function(e,r=0){return It(this,e,r,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function Ct(o,e,r,a,u,f){if(r+a>o.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function Bt(o,e,r,a,u){return e=+e,r=r>>>0,u||Ct(o,e,r,4),n.write(o,e,r,a,23,4),r+4}h.prototype.writeFloatLE=function(e,r,a){return Bt(this,e,r,!0,a)},h.prototype.writeFloatBE=function(e,r,a){return Bt(this,e,r,!1,a)};function Ft(o,e,r,a,u){return e=+e,r=r>>>0,u||Ct(o,e,r,8),n.write(o,e,r,a,52,8),r+8}h.prototype.writeDoubleLE=function(e,r,a){return Ft(this,e,r,!0,a)},h.prototype.writeDoubleBE=function(e,r,a){return Ft(this,e,r,!1,a)},h.prototype.copy=function(e,r,a,u){if(!h.isBuffer(e))throw new TypeError("argument should be a Buffer");if(a||(a=0),!u&&u!==0&&(u=this.length),r>=e.length&&(r=e.length),r||(r=0),u>0&&u<a&&(u=a),u===a||e.length===0||this.length===0)return 0;if(r<0)throw new RangeError("targetStart out of bounds");if(a<0||a>=this.length)throw new RangeError("Index out of range");if(u<0)throw new RangeError("sourceEnd out of bounds");u>this.length&&(u=this.length),e.length-r<u-a&&(u=e.length-r+a);const f=u-a;return this===e&&typeof l.prototype.copyWithin=="function"?this.copyWithin(r,a,u):l.prototype.set.call(e,this.subarray(a,u),r),f},h.prototype.fill=function(e,r,a,u){if(typeof e=="string"){if(typeof r=="string"?(u=r,r=0,a=this.length):typeof a=="string"&&(u=a,a=this.length),u!==void 0&&typeof u!="string")throw new TypeError("encoding must be a string");if(typeof u=="string"&&!h.isEncoding(u))throw new TypeError("Unknown encoding: "+u);if(e.length===1){const p=e.charCodeAt(0);(u==="utf8"&&p<128||u==="latin1")&&(e=p)}}else typeof e=="number"?e=e&255:typeof e=="boolean"&&(e=Number(e));if(r<0||this.length<r||this.length<a)throw new RangeError("Out of range index");if(a<=r)return this;r=r>>>0,a=a===void 0?this.length:a>>>0,e||(e=0);let f;if(typeof e=="number")for(f=r;f<a;++f)this[f]=e;else{const p=h.isBuffer(e)?e:h.from(e,u),x=p.length;if(x===0)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(f=0;f<a-r;++f)this[f+r]=p[f%x]}return this};const de={};function He(o,e,r){de[o]=class extends r{constructor(){super(),Object.defineProperty(this,"message",{value:e.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${o}]`,this.stack,delete this.name}get code(){return o}set code(u){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:u,writable:!0})}toString(){return`${this.name} [${o}]: ${this.message}`}}}He("ERR_BUFFER_OUT_OF_BOUNDS",function(o){return o?`${o} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),He("ERR_INVALID_ARG_TYPE",function(o,e){return`The "${o}" argument must be of type number. Received type ${typeof e}`},TypeError),He("ERR_OUT_OF_RANGE",function(o,e,r){let a=`The value of "${o}" is out of range.`,u=r;return Number.isInteger(r)&&Math.abs(r)>S(2,32)?u=bt(String(r)):typeof r=="bigint"&&(u=String(r),(r>S(BigInt(2),BigInt(32))||r<-S(BigInt(2),BigInt(32)))&&(u=bt(u)),u+="n"),a+=` It must be ${e}. Received ${u}`,a},RangeError);function bt(o){let e="",r=o.length;const a=o[0]==="-"?1:0;for(;r>=a+4;r-=3)e=`_${o.slice(r-3,r)}${e}`;return`${o.slice(0,r)}${e}`}function Or(o,e,r){fe(e,"offset"),(o[e]===void 0||o[e+r]===void 0)&&Be(e,o.length-(r+1))}function kt(o,e,r,a,u,f){if(o>r||o<e){const p=typeof e=="bigint"?"n":"";let x;throw e===0||e===BigInt(0)?x=`>= 0${p} and < 2${p} ** ${(f+1)*8}${p}`:x=`>= -(2${p} ** ${(f+1)*8-1}${p}) and < 2 ** ${(f+1)*8-1}${p}`,new de.ERR_OUT_OF_RANGE("value",x,o)}Or(a,u,f)}function fe(o,e){if(typeof o!="number")throw new de.ERR_INVALID_ARG_TYPE(e,"number",o)}function Be(o,e,r){throw Math.floor(o)!==o?(fe(o,r),new de.ERR_OUT_OF_RANGE("offset","an integer",o)):e<0?new de.ERR_BUFFER_OUT_OF_BOUNDS:new de.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${e}`,o)}const Dr=/[^+/0-9A-Za-z-_]/g;function $r(o){if(o=o.split("=")[0],o=o.trim().replace(Dr,""),o.length<2)return"";for(;o.length%4!==0;)o=o+"=";return o}function Ge(o,e){e=e||1/0;let r;const a=o.length;let u=null;const f=[];for(let p=0;p<a;++p){if(r=o.charCodeAt(p),r>55295&&r<57344){if(!u){if(r>56319){(e-=3)>-1&&f.push(239,191,189);continue}else if(p+1===a){(e-=3)>-1&&f.push(239,191,189);continue}u=r;continue}if(r<56320){(e-=3)>-1&&f.push(239,191,189),u=r;continue}r=(u-55296<<10|r-56320)+65536}else u&&(e-=3)>-1&&f.push(239,191,189);if(u=null,r<128){if((e-=1)<0)break;f.push(r)}else if(r<2048){if((e-=2)<0)break;f.push(r>>6|192,r&63|128)}else if(r<65536){if((e-=3)<0)break;f.push(r>>12|224,r>>6&63|128,r&63|128)}else if(r<1114112){if((e-=4)<0)break;f.push(r>>18|240,r>>12&63|128,r>>6&63|128,r&63|128)}else throw new Error("Invalid code point")}return f}function Vr(o){const e=[];for(let r=0;r<o.length;++r)e.push(o.charCodeAt(r)&255);return e}function qr(o,e){let r,a,u;const f=[];for(let p=0;p<o.length&&!((e-=2)<0);++p)r=o.charCodeAt(p),a=r>>8,u=r%256,f.push(u),f.push(a);return f}function St(o){return t.toByteArray($r(o))}function Pe(o,e,r,a){let u;for(u=0;u<a&&!(u+r>=e.length||u>=o.length);++u)e[u+r]=o[u];return u}function J(o,e){return o instanceof e||o!=null&&o.constructor!=null&&o.constructor.name!=null&&o.constructor.name===e.name}function Xe(o){return o!==o}const jr=function(){const o="0123456789abcdef",e=new Array(256);for(let r=0;r<16;++r){const a=r*16;for(let u=0;u<16;++u)e[a+u]=o[r]+o[u]}return e}();function ie(o){return typeof BigInt=="undefined"?zr:o}function zr(){throw new Error("BigInt not supported")}})(lt);const Le=lt.Buffer,ze=typeof Le=="function",ht=typeof TextDecoder=="function"?new TextDecoder:void 0;typeof TextEncoder=="function"&&new TextEncoder;const pr=Array.prototype.slice.call("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="),Ae=(i=>{let t={};return i.forEach((n,s)=>t[n]=s),t})(pr),mr=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,se=String.fromCharCode.bind(String),dt=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):i=>new Uint8Array(Array.prototype.slice.call(i,0)),ft=i=>i.replace(/[^A-Za-z0-9\+\/]/g,""),gr=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,wr=i=>{switch(i.length){case 4:var t=(7&i.charCodeAt(0))<<18|(63&i.charCodeAt(1))<<12|(63&i.charCodeAt(2))<<6|63&i.charCodeAt(3),n=t-65536;return se((n>>>10)+55296)+se((n&1023)+56320);case 3:return se((15&i.charCodeAt(0))<<12|(63&i.charCodeAt(1))<<6|63&i.charCodeAt(2));default:return se((31&i.charCodeAt(0))<<6|63&i.charCodeAt(1))}},yr=i=>i.replace(gr,wr),pt=typeof atob=="function"?i=>atob(ft(i)):ze?i=>Le.from(i,"base64").toString("binary"):i=>{if(i=i.replace(/\s+/g,""),!mr.test(i))throw new TypeError("malformed base64.");i+="==".slice(2-(i.length&3));let t,n="",s,c;for(let l=0;l<i.length;)t=Ae[i.charAt(l++)]<<18|Ae[i.charAt(l++)]<<12|(s=Ae[i.charAt(l++)])<<6|(c=Ae[i.charAt(l++)]),n+=s===64?se(t>>16&255):c===64?se(t>>16&255,t>>8&255):se(t>>16&255,t>>8&255,t&255);return n},xr=ze?i=>dt(Le.from(i,"base64")):i=>dt(pt(i).split("").map(t=>t.charCodeAt(0))),Er=ze?i=>Le.from(i,"base64").toString("utf8"):ht?i=>ht.decode(xr(i)):i=>yr(pt(i)),Ir=i=>ft(i.replace(/[-_]/g,t=>t=="-"?"+":"/")),Cr=i=>Er(Ir(i)),Br={[_.Dev]:"https://api.playvrs.net",[_.Staging]:"https://api.xterio.net",[_.Production]:"https://api.xterio.net"};class le{static get isLogin(){var t;return!!((t=xe.userInfo)!=null&&t.uuid)}static get userinfo(){return xe.userInfo}static get isVaildIdToken(){var s;const t=X.idToken;if(!t)return T("invalid token 1"),!1;const n=(s=t.split("."))==null?void 0:s[1];if(!n)return T("invalid token 2"),!1;try{const{aud:c,exp:l=0,sub:d}=JSON.parse(Cr(n));return!(!c||Date.now()>(l-60)*1e3)}catch(c){return T("invalid token 3",c),!1}}static checkToken(t="init"){return C(this,null,function*(){const n=D.tokens;n&&X.setTokens(n);const s=X.idToken,c=X.refreshToken;if(!s&&c){const d=yield K.refreshTokenService(c);X.setTokens({refresh_token:c,id_token:d.id_token,access_token:d.access_token})}const l=le.isVaildIdToken;return T("check the tokens valid status:",l),l?t==="init"&&(yield K.getUserInfo()):this.clearData(),X.idToken||""})}static checkCode(){return C(this,null,function*(){var d,m;const t=D.loginType;if(T("check the authorize status",t),t!==L.Default&&t!==L.Email)return;const n=(d=F.config)==null?void 0:d.redirect_uri;if(!n||!location.href.startsWith(n)){T("not check, different redirect_uri");return}const c=(m=ke.parseUrl(location.href,{types:{code:"string"}}).query)==null?void 0:m.code;if(!c)throw new Error("no authorize");n&&history.pushState(null,"",n),T("going to login ...");const l=yield K.login(c);l!=null&&l.uuid&&D.delete(O.LOGIN_TYPE)})}static getIdToken(){return C(this,null,function*(){return yield this.checkToken("getIdToken")})}static init(t,n){return C(this,null,function*(){const{app_id:s="",client_id:c="",client_secret:l="",redirect_uri:d="",mode:m="default",logout:g="1"}=t,w=n!=null?n:_.Dev,h=Br[w],y={app_id:s,client_id:c,client_secret:l,redirect_uri:d,response_type:"code",scope:"all",mode:m,grant_type:"authorization_code",logout:g};F.app_id=s,F.client_id=c,F.env=w,F.baseURL=h;const{response_type:b,scope:I}=y;F.authorizeUrl=h+"/account/v1/oauth2/authorize?"+ke.stringify({client_id:c,redirect_uri:d,response_type:b,scope:I,mode:m,logout:g}),F.config=y,oe.clear(),V.init(h),T(V.instance),yield this.checkToken(),window.addEventListener("load",z=>C(this,null,function*(){yield this.checkCode()}))})}static clearData(){D.deleteTokens(),D.deleteUserInfo(),X.removeTokens(),xe.removeUserInfo()}static logout(){var t,n;T("logout success"),this.clearData(),(n=(t=V==null?void 0:V.instance)==null?void 0:t.store)==null||n.logout()}static login(t){return C(this,null,function*(){if(!F.config){T("xterio auth sdk initial failed");return}if(t&&t!==L.Mini){F.config=Z(P({},F.config),{mode:t});const{response_type:n,scope:s,logout:c,client_id:l,redirect_uri:d}=F.config;F.authorizeUrl=F.baseURL+"/account/v1/oauth2/authorize?"+ke.stringify({client_id:l,redirect_uri:d,response_type:n,scope:s,mode:t,logout:c})}if(le.isLogin){T("already logined."),oe.emit(ye.ACCOUNT,xe.userInfo);return}if(le.isVaildIdToken)return T("get userinfo"),K.getUserInfo();if(t===L.Mini){V.instance.open();return}D.loginType=t||L.Default,T("going to authorize ..."),location.href=F.authorizeUrl})}}const Fr=({onLoginStateChange:i})=>{const t=V.instance;function n(){t.open()}function s(){t.store.logout()}return t.store.subscribe(()=>{i==null||i(t.store.userState.isLogin,t.store.userState.userInfo)}),{open:n,logout:s}};E.Env=_,E.LoginType=L,E.XTERIO_CONST=O,E.XTERIO_EVENTS=ye,E.XterAuthModal=V,E.XterEventEmiter=oe,E.XterioAuth=le,E.XterioAuthService=K,E.XterioAuthTokensManager=X,E.deleteFetcher=qt,E.getFetcher=De,E.postFetcher=ne,E.putFetcher=jt,E.useXterLoginModal=Fr,Object.defineProperty(E,Symbol.toStringTag,{value:"Module"})});/*! XterioAuth v0.0.2 */
//# sourceMappingURL=index.min.js.map
