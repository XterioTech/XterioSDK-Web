# React Unity WebGL Integration Project

This README provides an overview of how to integrate Unity WebGL into a React application. Follow the instructions below to set up and run the project.

## Table of Contents

- [Installation](#installation)

- [Configuration](#configuration)

- [Usage](#usage)

- [Responsive Design](#responsive-design)

- [Use Xterio SDK](#use-xterio-sdk)

## Installation

```bash
npm install react-unity-webgl
npm install @xterio-sdk/auth
```

To get started, ensure you have the following dependencies installed in your React project:

## Configuration

The configuration for the Unity WebGL build is defined in the `appConfig` object. Update the paths and settings according to your Unity build output:

```js
const webGLBasePath = "/WebGL/Build/";
const webGLAssetPath = "/WebGL/StreamingAssets/";

export const appConfig = {
  companyName: "DefaultCompany",
  productName: "AODTelGame",
  productVersion: "1.0",
  loaderUrl: `${webGLBasePath}WebGL.loader.js`,
  dataUrl: `${webGLBasePath}WebGL.data`,
  frameworkUrl: `${webGLBasePath}WebGL.framework.js`,
  codeUrl: `${webGLBasePath}WebGL.wasm`,
  streamingAssetsUrl: `${webGLAssetPath}`,
};
```

### Paths Explained

- **loaderUrl**: The URL to the loader script for the Unity WebGL build.

- **dataUrl**: The URL to the data file generated by Unity.

- **frameworkUrl**: The URL to the framework file exported by Unity.

- **codeUrl**: The URL to the WebAssembly file.

- **streamingAssetsUrl**: The URL to the streaming assets folder.

## Usage

In main application component `App.tsx`, use the `useUnityContext` hook to initialize the Unity instance, Make sure to pass the `appConfig` parameter to the hook to configure the Unity build settings:

```jsx
const { unityProvider, UNSAFE__unityInstance, isLoaded, loadingProgression } =
  useUnityContext({
    ...appConfig,
  });
```

### Rendering the Unity Component

Render the Unity component within a wrapper:

```jsx
return (
  <div className="unity-wrapper" id="unity-container" ref={unityContainerRef}>
    {isLoaded === false && (
      <div className="loading-overlay">
        <p>Loading... ({loadingPercentage}%)</p>
      </div>
    )}
    <Unity
      unityProvider={unityProvider}
      style={{ width: 720, height: 1080 }}
      devicePixelRatio={devicePixelRatio}
      ref={unityCanvasRef}
      id="unity-canvas"
    />
  </div>
);
```

## Responsive Design

### Add viewport meta to support mobile view

utils/index.ts

```js
export const addViewportMeta = () => {
  if (isMobile()) {
    // Mobile device style: fill the whole browser client area with the game canvas:
    const meta = document.createElement("meta");
    meta.name = "viewport";
    meta.content =
      "width=device-width, height=device-height, initial-scale=1.0, user-scalable=no, shrink-to-fit=yes";
    document.getElementsByTagName("head")[0].appendChild(meta);
  }
};
```

main.tsx

```js
addViewportMeta();
```

### Responsive canvas size & pixel ratio

App.tsx

```jsx
useEffect(() => {
  // Resize canvas to fit window
  const container = unityContainerRef.current;
  const canvas = unityCanvasRef.current;
  if (isMobile() && container && canvas) {
    canvas.style.width = window.innerWidth + "px";
    canvas.style.height = window.innerHeight + "px";
  }

  // Update pixel ratio on window resize
  const updateDevicePixelRatio = function () {
    setDevicePixelRatio(window.devicePixelRatio);
  };
  const mediaMatcher = window.matchMedia(
    `screen and (resolution: ${devicePixelRatio}dppx)`
  );
  mediaMatcher.addEventListener("change", updateDevicePixelRatio);
  return function () {
    mediaMatcher.removeEventListener("change", updateDevicePixelRatio);
  };
}, [devicePixelRatio]);
```

## Using @xterio-sdk/auth

### Install & Initialize Xterio SDK

To integrate authentication using the Xterio SDK, you need to initialize the SDK in your main application file (e.g., `main.ts`). Follow the steps below:

1. **Install the Xterio SDK** (if you haven't already):

   ```bash
   npm install @xterio-sdk/auth
   ```

2. **Initialize the Xterio SDK** in your `main.ts` file:

   ```typescript
   import { XterioAuth } from "@xterio-sdk/auth";

   // Xterio SDK Init
   const client_id = "xxxyyyzzz"; // Replace with your actual client ID
   XterioAuth.XterioAuth.init({ client_id });

   // Make XterioAuth available globally
   (window as any).XterioAuth = XterioAuth;
   ```

### Accessing XterioAuth in Unity Script

After initializing the SDK, you can access the XterioAuth object in your Unity program through the window object. This allows you to utilize the authentication methods directly from your Unity scripts.
For example, you can call useXterLoginModal methods like this:

WebGL.framework.js

```js
function _XterLogin() {
  const { open: open, logout: logout } = XterioAuth.useXterLoginModal({
    onLoginStateChange: (isLogin, userInfo) => {
      var token = XterioAuth.XterioAuthTokensManager.idToken;
      unityInstanceRef.SendMessage("XterManager", "LoginCallBack", token);
    },
  });
  if (typeof XterioAuth !== "undefined" && XterioAuth.useXterLoginModal) {
    open();
  }
}
```
